var nt=Object.defineProperty;var O=s=>{throw TypeError(s)};var rt=(s,t,i)=>t in s?nt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i;var A=(s,t,i)=>rt(s,typeof t!="symbol"?t+"":t,i),H=(s,t,i)=>t.has(s)||O("Cannot "+i);var e=(s,t,i)=>(H(s,t,"read from private field"),i?i.call(s):t.get(s)),u=(s,t,i)=>t.has(s)?O("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,i),p=(s,t,i,o)=>(H(s,t,"write to private field"),o?o.call(s,i):t.set(s,i),i),h=(s,t,i)=>(H(s,t,"access private method"),i);import{f as ot,g as D,p as at,h as R,Q as P,l as q,j as ht,D as k,k as ct,T as dt,e as N,L as _,I as lt,i as V,m as ut,n as pt,q as ft}from"./app-Ci8th0Vv.js";import{VideoProvider as vt}from"./vidstack-video-DaHm38ly.js";import{R as yt}from"./vidstack-DqAw8m9J-Ds57PmIx.js";import"./vidstack-Bq6c3Bam-B0QXKInD.js";const gt=s=>ct(s);var T,a,r,w,x,n,E,j,M,U,F,Q,K,W,B,J,X,Y,z,G,Z;class Lt{constructor(t,i){u(this,n);u(this,T);u(this,a);u(this,r,null);u(this,w,null);A(this,"config",{});u(this,x,new Set);p(this,T,t),p(this,a,i)}get instance(){return e(this,r)}setup(t){const{streamType:i}=e(this,a).$state,o=R(i).includes("live"),c=R(i).includes("ll-");p(this,r,new t({lowLatencyMode:c,backBufferLength:c?4:o?8:void 0,renderTextTracksNatively:!1,...this.config}));const l=h(this,n,U).bind(this);for(const d of Object.values(t.Events))e(this,r).on(d,l);e(this,r).on(t.Events.ERROR,h(this,n,X).bind(this));for(const d of e(this,x))d(e(this,r));e(this,a).player.dispatch("hls-instance",{detail:e(this,r)}),e(this,r).attachMedia(e(this,T)),e(this,r).on(t.Events.AUDIO_TRACK_SWITCHED,h(this,n,K).bind(this)),e(this,r).on(t.Events.LEVEL_SWITCHED,h(this,n,W).bind(this)),e(this,r).on(t.Events.LEVEL_LOADED,h(this,n,J).bind(this)),e(this,r).on(t.Events.LEVEL_UPDATED,h(this,n,B).bind(this)),e(this,r).on(t.Events.NON_NATIVE_TEXT_TRACKS_FOUND,h(this,n,F).bind(this)),e(this,r).on(t.Events.CUES_PARSED,h(this,n,Q).bind(this)),e(this,a).qualities[P.enableAuto]=h(this,n,z).bind(this),q(e(this,a).qualities,"change",h(this,n,G).bind(this)),q(e(this,a).audioTracks,"change",h(this,n,Z).bind(this)),p(this,w,ht(h(this,n,j).bind(this)))}onInstance(t){return e(this,x).add(t),()=>e(this,x).delete(t)}loadSource(t){D(t.src)&&e(this,r)?.loadSource(t.src)}destroy(){var t;e(this,r)?.destroy(),p(this,r,null),(t=e(this,w))==null||t.call(this),p(this,w,null)}}T=new WeakMap,a=new WeakMap,r=new WeakMap,w=new WeakMap,x=new WeakMap,n=new WeakSet,E=function(t,i){return new k(gt(t),{detail:i})},j=function(){if(!e(this,a).$state.live())return;const t=new yt(h(this,n,M).bind(this));return t.start(),t.stop.bind(t)},M=function(){e(this,a).$state.liveSyncPosition.set(e(this,r)?.liveSyncPosition??1/0)},U=function(t,i){e(this,a).player?.dispatch(h(this,n,E).call(this,t,i))},F=function(t,i){const o=h(this,n,E).call(this,t,i);let c=-1;for(let l=0;l<i.tracks.length;l++){const d=i.tracks[l],L=d.subtitleTrack??d.closedCaptions,m=new dt({id:`hls-${d.kind}-${l}`,src:L?.url,label:d.label,language:L?.lang,kind:d.kind,default:d.default});m[N.readyState]=2,m[N.onModeChange]=()=>{m.mode==="showing"?(e(this,r).subtitleTrack=l,c=l):c===l&&(e(this,r).subtitleTrack=-1,c=-1)},e(this,a).textTracks.add(m,o)}},Q=function(t,i){const o=e(this,r)?.subtitleTrack,c=e(this,a).textTracks.getById(`hls-${i.type}-${o}`);if(!c)return;const l=h(this,n,E).call(this,t,i);for(const d of i.cues)d.positionAlign="auto",c.addCue(d,l)},K=function(t,i){const o=e(this,a).audioTracks[i.id];if(o){const c=h(this,n,E).call(this,t,i);e(this,a).audioTracks[_.select](o,!0,c)}},W=function(t,i){const o=e(this,a).qualities[i.level];if(o){const c=h(this,n,E).call(this,t,i);e(this,a).qualities[_.select](o,!0,c)}},B=function(t,i){i.details.totalduration>0&&e(this,a).$state.inferredLiveDVRWindow.set(i.details.totalduration)},J=function(t,i){if(e(this,a).$state.canPlay())return;const{type:o,live:c,totalduration:l,targetduration:d}=i.details,L=h(this,n,E).call(this,t,i);e(this,a).notify("stream-type-change",c?o==="EVENT"&&Number.isFinite(l)&&d>=10?"live:dvr":"live":"on-demand",L),e(this,a).notify("duration-change",l,L);const m=e(this,r).media;e(this,r).currentLevel===-1&&e(this,a).qualities[P.setAuto](!0,L);for(const v of e(this,r).audioTracks){const $={id:v.id.toString(),label:v.name,language:v.lang||"",kind:"main"};e(this,a).audioTracks[_.add]($,L)}for(const v of e(this,r).levels){const $={id:v.id?.toString()??v.height+"p",width:v.width,height:v.height,codec:v.codecSet,bitrate:v.bitrate};e(this,a).qualities[_.add]($,L)}m.dispatchEvent(new k("canplay",{trigger:L}))},X=function(t,i){if(i.fatal)switch(i.type){case"mediaError":e(this,r)?.recoverMediaError();break;default:h(this,n,Y).call(this,i.error);break}},Y=function(t){e(this,a).notify("error",{message:t.message,code:1,error:t})},z=function(){e(this,r)&&(e(this,r).currentLevel=-1)},G=function(){const{qualities:t}=e(this,a);!e(this,r)||t.auto||(e(this,r)[t.switch+"Level"]=t.selectedIndex,lt&&(e(this,T).currentTime=e(this,T).currentTime))},Z=function(){const{audioTracks:t}=e(this,a);e(this,r)&&e(this,r).audioTrack!==t.selectedIndex&&(e(this,r).audioTrack=t.selectedIndex)};var b,y,C,g,tt,it,et,st;class St{constructor(t,i,o){u(this,g);u(this,b);u(this,y);u(this,C);p(this,b,t),p(this,y,i),p(this,C,o),h(this,g,tt).call(this)}}b=new WeakMap,y=new WeakMap,C=new WeakMap,g=new WeakSet,tt=async function(){const t={onLoadStart:h(this,g,it).bind(this),onLoaded:h(this,g,et).bind(this),onLoadError:h(this,g,st).bind(this)};let i=await Tt(e(this,b),t);if(V(i)&&!D(e(this,b))&&(i=await Et(e(this,b),t)),!i)return null;if(!i.isSupported()){const o="[vidstack] `hls.js` is not supported in this environment";return e(this,y).player.dispatch(new k("hls-unsupported")),e(this,y).notify("error",{message:o,code:4}),null}return i},it=function(){e(this,y).player.dispatch(new k("hls-lib-load-start"))},et=function(t){e(this,y).player.dispatch(new k("hls-lib-loaded",{detail:t})),e(this,C).call(this,t)},st=function(t){const i=ut(t);e(this,y).player.dispatch(new k("hls-lib-load-error",{detail:i})),e(this,y).notify("error",{message:i.message,code:4,error:i})};async function Et(s,t={}){if(!V(s)){if(t.onLoadStart?.(),s.prototype&&s.prototype!==Function)return t.onLoaded?.(s),s;try{const i=(await s())?.default;if(i&&i.isSupported)t.onLoaded?.(i);else throw Error("");return i}catch(i){t.onLoadError?.(i)}}}async function Tt(s,t={}){if(D(s)){t.onLoadStart?.();try{if(await pt(s),!ft(window.Hls))throw Error("");const i=window.Hls;return t.onLoaded?.(i),i}catch(i){t.onLoadError?.(i)}}}const bt="https://cdn.jsdelivr.net";var I,f,S;class mt extends vt{constructor(){super(...arguments);A(this,"$$PROVIDER_TYPE","HLS");u(this,I,null);u(this,f,new Lt(this.video,this.ctx));u(this,S,`${bt}/npm/hls.js@^1.5.0/dist/hls.min.js`)}get ctor(){return e(this,I)}get instance(){return e(this,f).instance}get type(){return"hls"}get canLiveSync(){return!0}get config(){return e(this,f).config}set config(i){e(this,f).config=i}get library(){return e(this,S)}set library(i){p(this,S,i)}preconnect(){D(e(this,S))&&at(e(this,S))}setup(){super.setup(),new St(e(this,S),this.ctx,i=>{p(this,I,i),e(this,f).setup(i),this.ctx.notify("provider-setup",this);const o=R(this.ctx.$state.source);o&&this.loadSource(o)})}async loadSource(i,o){if(!D(i.src)){this.removeSource();return}this.media.preload=o||"",this.appendSource(i,"application/x-mpegurl"),e(this,f).loadSource(i),this.currentSrc=i}onInstance(i){const o=e(this,f).instance;return o&&i(o),e(this,f).onInstance(i)}destroy(){e(this,f).destroy()}}I=new WeakMap,f=new WeakMap,S=new WeakMap,A(mt,"supported",ot());export{mt as HLSProvider};
