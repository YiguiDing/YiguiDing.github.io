var ue=Object.defineProperty;var B=r=>{throw TypeError(r)};var de=(r,c,e)=>c in r?ue(r,c,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[c]=e;var y=(r,c,e)=>de(r,typeof c!="symbol"?c+"":c,e),A=(r,c,e)=>c.has(r)||B("Cannot "+e);var t=(r,c,e)=>(A(r,c,"read from private field"),e?e.call(r):c.get(r)),d=(r,c,e)=>c.has(r)?B("Cannot add the same private member more than once"):c instanceof WeakSet?c.add(r):c.set(r,e),u=(r,c,e,i)=>(A(r,c,"write to private field"),i?i.call(r,e):c.set(r,e),e),o=(r,c,e)=>(A(r,c,"access private method"),e);import{v as fe,w as N,x as C,p as pe,j as M,h as S,g as ye,y as U,L as I,l as be,z as ve,T as ke,Q as _}from"./app-C4NnifZf.js";import{R as me}from"./vidstack-DqAw8m9J-Ni4ar6u2.js";import{E as we}from"./vidstack-DDXt6fpN-2BLfDj-S.js";import{resolveVimeoVideoId as Pe,getVimeoVideoInfo as Te}from"./vidstack-krOAtKMi-2f5gzOW6.js";const Ce=["bufferend","bufferstart","durationchange","ended","enterpictureinpicture","error","fullscreenchange","leavepictureinpicture","loaded","playProgress","loadProgress","pause","play","playbackratechange","qualitychange","seeked","seeking","timeupdate","volumechange","waiting"];var a,p,b,m,g,V,v,$,R,w,k,E,s,z,W,Y,G,P,H,J,K,q,X,Z,ee,te,se,Q,ie,ne,ae,L,oe,F,he,O,re,ce,l,j,D;class Re extends we{constructor(e,i){super(e);d(this,s);y(this,"$$PROVIDER_TYPE","VIMEO");y(this,"scope",fe());y(this,"fullscreen");d(this,a);d(this,p,N(""));d(this,b,N(!1));d(this,m,null);d(this,g,null);d(this,V,!1);d(this,v,new C(0,0));d(this,$,new me(o(this,s,G).bind(this)));d(this,R,null);d(this,w,null);d(this,k,new Map);d(this,E,null);y(this,"cookies",!1);y(this,"title",!0);y(this,"byline",!0);y(this,"portrait",!0);y(this,"color","00ADEF");d(this,P,!1);u(this,a,i);const n=this;this.fullscreen={get active(){return t(n,V)},supported:!0,enter:()=>o(this,s,l).call(this,"requestFullscreen"),exit:()=>o(this,s,l).call(this,"exitFullscreen")}}get type(){return"vimeo"}get currentSrc(){return t(this,g)}get videoId(){return t(this,p).call(this)}get hash(){return t(this,m)}get isPro(){return t(this,b).call(this)}preconnect(){pe(this.getOrigin())}setup(){super.setup(),M(o(this,s,z).bind(this)),M(o(this,s,W).bind(this)),M(o(this,s,Y).bind(this)),t(this,a).notify("provider-setup",this)}destroy(){o(this,s,j).call(this),this.fullscreen=void 0;const e="provider destroyed";for(const i of t(this,k).values())for(const{reject:n}of i)n(e);t(this,k).clear(),o(this,s,l).call(this,"destroy")}async play(){return o(this,s,l).call(this,"play")}async pause(){return o(this,s,l).call(this,"pause")}setMuted(e){o(this,s,l).call(this,"setMuted",e)}setCurrentTime(e){o(this,s,l).call(this,"seekTo",e),t(this,a).notify("seeking",e)}setVolume(e){o(this,s,l).call(this,"setVolume",e),o(this,s,l).call(this,"setMuted",S(t(this,a).$state.muted))}setPlaybackRate(e){o(this,s,l).call(this,"setPlaybackRate",e)}async loadSource(e){if(!ye(e.src)){u(this,g,null),u(this,m,null),t(this,p).set("");return}const{videoId:i,hash:n}=Pe(e.src);t(this,p).set(i??""),u(this,m,n??null),u(this,g,e)}getOrigin(){return"https://player.vimeo.com"}buildParams(){const{keyDisabled:e}=t(this,a).$props,{playsInline:i,nativeControls:n}=t(this,a).$state,h=n();return{title:this.title,byline:this.byline,color:this.color,portrait:this.portrait,controls:h,h:this.hash,keyboard:h&&!e(),transparent:!0,playsinline:i(),dnt:!this.cookies}}onMessage(e,i){e.event?o(this,s,re).call(this,e.event,e.data,i):e.method&&o(this,s,X).call(this,e.method,e.value,i)}onLoad(){}}a=new WeakMap,p=new WeakMap,b=new WeakMap,m=new WeakMap,g=new WeakMap,V=new WeakMap,v=new WeakMap,$=new WeakMap,R=new WeakMap,w=new WeakMap,k=new WeakMap,E=new WeakMap,s=new WeakSet,z=function(){o(this,s,j).call(this);const e=t(this,p).call(this);if(!e){this.src.set("");return}this.src.set(`${this.getOrigin()}/video/${e}`),t(this,a).notify("load-start")},W=function(){const e=t(this,p).call(this);if(!e)return;const i=U(),n=new AbortController;return u(this,E,i),Te(e,n,t(this,m)).then(h=>{i.resolve(h)}).catch(h=>{i.reject()}),()=>{i.reject(),n.abort()}},Y=function(){const e=t(this,b).call(this),{$state:i,qualities:n}=t(this,a);if(i.canSetPlaybackRate.set(e),n[I.setReadonly](!e),e)return be(n,"change",()=>{if(n.auto)return;const h=n.selected?.id;h&&o(this,s,l).call(this,"setQuality",h)})},G=function(){o(this,s,l).call(this,"getCurrentTime")},P=new WeakMap,H=function(e,i){if(t(this,P)&&e===0)return;const{realCurrentTime:n,paused:h,bufferedEnd:f,seekableEnd:T,live:x}=t(this,a).$state;if(n()===e)return;const le=n();t(this,a).notify("time-change",e,i),Math.abs(le-e)>1.5&&(t(this,a).notify("seeking",e,i),!h()&&f()<e&&t(this,a).notify("waiting",void 0,i)),!x()&&T()-e<.01&&(t(this,a).notify("end",void 0,i),u(this,P,!0),setTimeout(()=>{u(this,P,!1)},500))},J=function(e,i){t(this,a).notify("seeked",e,i)},K=function(e){const i=t(this,p).call(this);t(this,E)?.promise.then(n=>{if(!n)return;const{title:h,poster:f,duration:T,pro:x}=n;t(this,b).set(x),t(this,a).notify("title-change",h,e),t(this,a).notify("poster-change",f,e),t(this,a).notify("duration-change",T,e),o(this,s,q).call(this,T,e)}).catch(()=>{i===t(this,p).call(this)&&(o(this,s,l).call(this,"getVideoTitle"),o(this,s,l).call(this,"getDuration"))})},q=function(e,i){const{nativeControls:n}=t(this,a).$state,h=n();u(this,v,new C(0,e));const f={buffered:new C(0,0),seekable:t(this,v),duration:e};t(this,a).delegate.ready(f,i),h||o(this,s,l).call(this,"_hideOverlay"),o(this,s,l).call(this,"getQualities"),o(this,s,l).call(this,"getChapters")},X=function(e,i,n){switch(e){case"getVideoTitle":const h=i;t(this,a).notify("title-change",h,n);break;case"getDuration":const f=i;t(this,a).$state.canPlay()?t(this,a).notify("duration-change",f,n):o(this,s,q).call(this,f,n);break;case"getCurrentTime":o(this,s,H).call(this,i,n);break;case"getBuffered":ve(i)&&i.length&&o(this,s,Q).call(this,i[i.length-1][1],n);break;case"setMuted":o(this,s,L).call(this,S(t(this,a).$state.volume),i,n);break;case"getChapters":o(this,s,oe).call(this,i);break;case"getQualities":o(this,s,he).call(this,i,n);break}o(this,s,D).call(this,e)?.resolve()},Z=function(){for(const e of Ce)o(this,s,l).call(this,"addEventListener",e)},ee=function(e){t(this,$).stop(),t(this,a).notify("pause",void 0,e)},te=function(e){t(this,$).start(),t(this,a).notify("play",void 0,e)},se=function(e){const{paused:i}=t(this,a).$state;!i()&&!t(this,P)&&t(this,a).notify("playing",void 0,e)},Q=function(e,i){const n={buffered:new C(0,e),seekable:t(this,v)};t(this,a).notify("progress",n,i)},ie=function(e){t(this,a).notify("waiting",void 0,e)},ne=function(e){const{paused:i}=t(this,a).$state;i()||t(this,a).notify("playing",void 0,e)},ae=function(e){const{paused:i}=t(this,a).$state;i()&&t(this,a).notify("play",void 0,e),t(this,a).notify("waiting",void 0,e)},L=function(e,i,n){const h={volume:e,muted:i};t(this,a).notify("volume-change",h,n)},oe=function(e){if(o(this,s,F).call(this),!e.length)return;const i=new ke({kind:"chapters",default:!0}),{seekableEnd:n}=t(this,a).$state;for(let h=0;h<e.length;h++){const f=e[h],T=e[h+1];i.addCue(new window.VTTCue(f.startTime,T?.startTime??n(),f.title))}u(this,w,i),t(this,a).textTracks.add(i)},F=function(){t(this,w)&&(t(this,a).textTracks.remove(t(this,w)),u(this,w,null))},he=function(e,i){t(this,a).qualities[_.enableAuto]=e.some(n=>n.id==="auto")?()=>o(this,s,l).call(this,"setQuality","auto"):void 0;for(const n of e){if(n.id==="auto")continue;const h=+n.id.slice(0,-1);isNaN(h)||t(this,a).qualities[I.add]({id:n.id,width:h*(16/9),height:h,codec:"avc1,h.264",bitrate:-1},i)}o(this,s,O).call(this,e.find(n=>n.active),i)},O=function({id:e}={},i){if(!e)return;const n=e==="auto",h=t(this,a).qualities.getById(e);n?(t(this,a).qualities[_.setAuto](n,i),t(this,a).qualities[I.select](void 0,!0,i)):t(this,a).qualities[I.select](h??void 0,!0,i)},re=function(e,i,n){switch(e){case"ready":o(this,s,Z).call(this);break;case"loaded":o(this,s,K).call(this,n);break;case"play":o(this,s,te).call(this,n);break;case"playProgress":o(this,s,se).call(this,n);break;case"pause":o(this,s,ee).call(this,n);break;case"loadProgress":o(this,s,Q).call(this,i.seconds,n);break;case"waiting":o(this,s,ae).call(this,n);break;case"bufferstart":o(this,s,ie).call(this,n);break;case"bufferend":o(this,s,ne).call(this,n);break;case"volumechange":o(this,s,L).call(this,i.volume,S(t(this,a).$state.muted),n);break;case"durationchange":u(this,v,new C(0,i.duration)),t(this,a).notify("duration-change",i.duration,n);break;case"playbackratechange":t(this,a).notify("rate-change",i.playbackRate,n);break;case"qualitychange":o(this,s,O).call(this,i,n);break;case"fullscreenchange":u(this,V,i.fullscreen),t(this,a).notify("fullscreen-change",i.fullscreen,n);break;case"enterpictureinpicture":t(this,a).notify("picture-in-picture-change",!0,n);break;case"leavepictureinpicture":t(this,a).notify("picture-in-picture-change",!1,n);break;case"ended":t(this,a).notify("end",void 0,n);break;case"error":o(this,s,ce).call(this,i,n);break;case"seek":case"seeked":o(this,s,J).call(this,i.seconds,n);break}},ce=function(e,i){const{message:n,method:h}=e;h==="setPlaybackRate"&&t(this,b).set(!1),h&&o(this,s,D).call(this,h)?.reject(n)},l=async function(e,i){let n=U(),h=t(this,k).get(e);return h||t(this,k).set(e,h=[]),h.push(n),this.postMessage({method:e,value:i}),n.promise},j=function(){t(this,$).stop(),u(this,v,new C(0,0)),u(this,E,null),u(this,R,null),t(this,b).set(!1),o(this,s,F).call(this)},D=function(e){return t(this,k).get(e)?.shift()};export{Re as VimeoProvider};
