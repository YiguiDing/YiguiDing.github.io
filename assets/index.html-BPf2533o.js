import{_ as c,c as l,d as p,w as a,b as i,r,o as u,a as n,e as s}from"./app-DjDtDPYL.js";const k={},d=i(`<h1 id="motion-driver-6-12-官方dmp库-的移植和mpu6050驱动的实现" tabindex="-1"><a class="header-anchor" href="#motion-driver-6-12-官方dmp库-的移植和mpu6050驱动的实现"><span>motion_driver_6.12(官方DMP库)的移植和MPU6050驱动的实现</span></a></h1><h2 id="目录" tabindex="-1"><a class="header-anchor" href="#目录"><span>目录</span></a></h2><ul><li><a href="#motion_driver_612%E5%AE%98%E6%96%B9dmp%E5%BA%93%E7%9A%84%E7%A7%BB%E6%A4%8D%E5%92%8Cmpu6050%E9%A9%B1%E5%8A%A8%E7%9A%84%E5%AE%9E%E7%8E%B0">motion_driver_6.12(官方DMP库)的移植和MPU6050驱动的实现</a><ul><li><a href="#%E7%9B%AE%E5%BD%95">目录</a></li><li><a href="#motion-driver_612">motion driver_6.12</a><ul><li><a href="#motion_driver_612%E7%9A%84%E4%B8%89%E4%B8%AA%E4%B8%BB%E8%A6%81%E7%9B%AE%E5%BD%95">motion_driver_6.12的三个主要目录</a></li><li><a href="#motion_driver_612%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84">motion_driver_6.12目录结构</a></li></ul></li><li><a href="#dmp">DMP</a></li><li><a href="#mpl%E7%AE%97%E6%B3%95">MPL算法</a></li><li><a href="#motion_driver_612%E7%9A%84%E7%A7%BB%E6%A4%8D">motion_driver_6.12的移植</a></li><li><a href="#%E5%9F%BA%E4%BA%8Emotion_driver_612%E5%AE%9E%E7%8E%B0mpu6050%E7%9A%84%E9%A9%B1%E5%8A%A8">基于motion_driver_6.12实现MPU6050的驱动</a></li></ul></li></ul><h2 id="motion-driver-6-12" tabindex="-1"><a class="header-anchor" href="#motion-driver-6-12"><span>motion driver_6.12</span></a></h2><ul><li>motion driver_6.12 是从invensense网站上下载的最新的DMP库。</li><li>Motion Driver是传感器驱动程序层的嵌入式软件堆栈，可轻松配置和利用InvenSense运动跟踪解决方案的许多功能。</li><li>支持的运动设备为MPU6050 / MPU6500 / MPU9150 / MPU9250。</li><li>硬件和板载数字运动处理器（DMP）的许多功能都封装在可以使用和引用的模块化API中。</li><li>Motion Driver设计为一种可轻松移植到大多数MCU的解决方案。</li><li>Motion Driver 6.0包括一个用于ARM MCU和TI-MSP430的9轴解决方案。</li><li>仅6轴解决方案应继续参考运动驱动程序5.1.2，以便更容易理解软件。</li></ul><h3 id="motion-driver-6-12的三个主要目录" tabindex="-1"><a class="header-anchor" href="#motion-driver-6-12的三个主要目录"><span>motion_driver_6.12的三个主要目录</span></a></h3><ul><li><code>driver/</code><ul><li>包含了与 MPU 传感器通信和控制相关的底层驱动程序和库文件。</li><li>实现了对MPU寄存器读写的函数(inv_mpu.c)</li><li>基于对MPU寄存器读写的函数（inv_mpu.c），实现了：写入DMP固件、操作DMP的一些函数（inv_mpu_dmp_motion_driver.c）。</li><li><blockquote><p><strong>只需要对这部分代码做修改就能实现移植，主要为：</strong></p></blockquote><ul><li>修改宏定义，提供通信接口</li><li>修改宏定义，提供获取时间的接口</li><li>修改宏定义，提供延时函数接口</li></ul></li></ul></li><li><code>mllite/</code><ul><li>应该就是轻量级版本的Motion Processing Library (MPL)</li><li>简化版的数据处理和传感器融合功能</li></ul></li><li><code>mpl/</code> : <ul><li>完整的 Motion Processing Library</li><li>提供了更高级的数据处理和传感器融合功能，包括姿态估计、传感器数据融合等。</li><li>但只包含一些头文件，和一个<code>libmpllib.a</code>的静态库文件，没有源代码。</li></ul></li></ul><h3 id="motion-driver-6-12目录结构" tabindex="-1"><a class="header-anchor" href="#motion-driver-6-12目录结构"><span>motion_driver_6.12目录结构</span></a></h3><p>motion_driver_6.12/</p><ul><li>driver/ <ul><li>eMPL/ <ul><li><code>inv_mpu.c</code> 实现了与MPU交互的基本功能，如读写寄存器</li><li><code>inv_mpu_dmp_motion_driver.c</code>: 实现了与DMP交互的功能，包括：写入DMP固件到MPU、初始化、数据处理。</li><li><code>dmpmap.h</code> DMP寄存器映射的定义</li><li><code>dmpKey.h</code> DMP 寄存器映射和键值定义</li><li><code>inv_mpu.h</code> 头文件</li><li><code>inv_mpu_dmp_motion_driver.h</code>: 头文件</li></ul></li><li>include/ <ul><li><code>log.h</code>: 日志记录功能的头文件。</li><li><code>mlinclude.h</code>: 包含了其他头文件的汇总文件。</li><li><code>mlmath.h</code>: 数学函数库的头文件。</li><li><code>mlos.h</code>: 操作系统相关功能的头文件。</li><li><code>mltypes.h</code>: 数据类型定义的头文件。</li><li><code>stdint_invensense.h</code>: 固定宽度整数类型的定义文件。</li></ul></li></ul></li><li>mllite/ <ul><li><code>data_builder.c</code>: 构建数据结构的实现文件。</li><li><code>data_builder.h</code>: 构建数据结构的头文件。</li><li><code>hal_outputs.c</code>: 实现了硬件抽象层的输出功能。</li><li><code>hal_outputs.h</code>: 定义了硬件抽象层的输出接口。</li><li><code>invensense.h</code>: InvenSense 库的主头文件。</li><li><code>message_layer.c</code>: 实现了消息层的功能。</li><li><code>message_layer.h</code>: 定义了消息层的接口。</li><li><code>mlmath.c</code>: 数学函数库的实现文件。</li><li><code>ml_math_func.c</code>: 数学函数的具体实现。</li><li><code>ml_math_func.h</code>: 数学函数的声明。</li><li><code>mpl.c</code>: 实现了 Motion Processing Library 的核心功能。</li><li><code>mpl.h</code>: 提供了 Motion Processing Library 的函数声明。</li><li><code>results_holder.c</code>: 保存结果数据的实现文件。</li><li><code>results_holder.h</code>: 定义了保存结果数据的接口。</li><li><code>start_manager.c</code>: 管理启动过程的实现文件。</li><li><code>start_manager.h</code>: 定义了管理启动过程的接口。</li><li><code>storage_manager.c</code>: 管理数据存储的实现文件。</li><li><code>storage_manager.h</code>: 定义了数据存储的接口。</li></ul></li><li>mpl/ <ul><li><code>accel_auto_cal.h</code>: 加速度计自动校准的头文件。</li><li><code>compass_vec_cal.h</code>: 罗盘向量校准的头文件。</li><li><code>fast_no_motion.h</code>: 快速静止检测的头文件。</li><li><code>fusion_9axis.h</code>: 九轴传感器融合的头文件。</li><li><code>gyro_tc.h</code>: 陀螺仪温度补偿的头文件。</li><li><code>heading_from_gyro.h</code>: 从陀螺仪计算航向的头文件。</li><li><code>invensense_adv.h</code>: InvenSense 高级功能的头文件。</li><li><code>inv_math.h</code>: InvenSense 数学函数库的头文件。</li><li><code>libmpllib.a</code>: Motion Processing Library 的静态库文件。</li><li><code>mag_disturb.h</code>: 磁场扰动检测的头文件。</li><li><code>motion_no_motion.h</code>: 运动和静止检测的头文件。</li><li><code>no_gyro_fusion.h</code>: 无陀螺仪传感器融合的头文件。</li><li><code>quaternion_supervisor.h</code>: 四元数监督的头文件。</li></ul></li></ul><h2 id="dmp" tabindex="-1"><a class="header-anchor" href="#dmp"><span>DMP</span></a></h2><blockquote><p>简单来说，</p><ul><li>DMP 是 MPU-6050 内部的一个硬件加速器，</li><li>可以执行复杂的运动处理任务，如传感器数据融合、姿态估计等，无需主处理器的干预。</li><li>可以直接输出四元数等姿态信息。</li></ul></blockquote><hr><ul><li>DMP是MPU设备中的快速，低功耗，可编程，嵌入式轻量级处理器。</li><li>设计是从MCU卸载功能，如传感器融合和手势识别，以节省系统中的总体功率。</li><li>DMP具有许多功能，可以在运行时动态关闭和打开。</li><li>也可以禁用个别功能，同时让其他功能运行。</li><li>除计步器外，所有DMP数据都输出到FIFO。</li><li>DMP还可以编程为通过手势或数据就绪生成中断。</li><li>功能 <ul><li>①3轴低功率四元数 --- 仅陀螺四元数。启用此功能后，将以200Hz的频率整合陀螺仪数据，同时以用户请求的速率将传感器融合数据输出到FIFO。200Hz集成将允许更准确的传感器融合数据。在MD6中，如果启用此功能，驱动程序会将3轴四元数推入MPL库，MPL将处理加速度和罗盘集成。</li><li>②6轴低功率四元数 --- 陀螺仪和加速四元数。与3轴LPQ类似，以200Hz采样速率集成加速度和陀螺仪将以用户请求的速率输出到FIFO。3轴LPQ和6轴LPQ是互斥的，不应同时运行。如果启用，则可以将6轴四元数推入MPL库，MPL将处理9轴的罗盘集成。</li><li>③方向手势识别 ---使用传感器数据检测设备方向是否有纵向，横向，反向纵向和反向方向的变化。非常依赖于方向矩阵。</li><li>④点击手势识别 --- 设备上的多方向点击检测。此功能将让用户知道检测到哪个轴位置或负值。它可以检测多达4个多抽头.PSP可用于配置此功能的阈值，死区时间和分接头数。</li><li>⑤计步器手势识别 --- 简单的计步器提供步数和时间戳。此功能会自动启用，但在检测到连续5秒的步骤后才会触发。5秒钟后，计数和时间戳将开始，数据可以从DMP存储器中读出。</li><li>⑥DMP中断 --- 可以将中断配置为在传感器数据就绪（FIFO输出速率）或检测到抽头或方向手势时生成。</li></ul></li></ul><h2 id="mpl算法" tabindex="-1"><a class="header-anchor" href="#mpl算法"><span>MPL算法</span></a></h2><ul><li>Motion Driver 6.12包含一个二进制库，其中包含用于传感器融合和动态校准的InvenSense专有算法。</li><li>MD 6.12驱动程序将传感器数据推入MPL，MPL将处理包括罗盘集成在内的9轴传感器融合。</li><li>在启用MPL库之前配置MPL功能。它们可以通过API调用动态关闭和打开到MPL中。</li></ul><table><thead><tr><th style="text-align:left;">MPL 算法</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:left;">陀螺仪校准（快速无动作）</td><td style="text-align:left;">运行时间校准例程。一旦检测到无运动状态，陀螺校准将被触发。在无运动状态检测5秒内完成校准。</td></tr><tr><td style="text-align:left;">陀螺仪温度补偿</td><td style="text-align:left;">在每个陀螺仪校准之后，MPL将记录内部温度。在多个数据点之后，MPL将能够为陀螺仪建立多点温度斜率，并将其应用于校准偏差。这将补偿陀螺仪由于温度造成的漂移。</td></tr><tr><td style="text-align:left;">指南针校准</td><td style="text-align:left;">用于MPU9150和MPU9250的运行时间硬铁罗盘校准。MPL读取并建立设备周围的磁场环境。一旦存在足够的数据，可以应用罗盘偏移，并且可以生成9轴四元数。如果你处于一个磁场不稳定的环境，指南针就不会被校准。如果罗盘没有校准，四元数只使用6轴。图8在装置上的运动将加快校准。</td></tr><tr><td style="text-align:left;">Mag干扰拒绝</td><td style="text-align:left;">校准后，MPL库将跟踪磁场，如果有异常检测，MPL库将拒绝指南针数据，并切换回6轴融合。在检测到磁干扰之后，MPL库将继续每隔5秒检查指南针数据。在每次检查中，如果干扰不再存在，它将切换回9轴融合，否则它将继续拒绝数据。</td></tr><tr><td style="text-align:left;">3轴融合</td><td style="text-align:left;">陀螺角四元数</td></tr><tr><td style="text-align:left;">6轴融合</td><td style="text-align:left;">陀螺与加速度传感器的四元数</td></tr><tr><td style="text-align:left;">9轴融合</td><td style="text-align:left;">陀螺仪、AccEL和罗盘四元数</td></tr></tbody></table><h2 id="motion-driver-6-12的移植" tabindex="-1"><a class="header-anchor" href="#motion-driver-6-12的移植"><span>motion_driver_6.12的移植</span></a></h2><blockquote><p>只需要修改<code>inv_mpu.c</code> 和 <code>inv_mpu_dmp_motion_driver.c</code> 文件，添加一些宏定义，即可完成移植</p></blockquote><p><code>inv_mpu.c</code></p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp" data-title="cpp"><pre><code><span class="line"><span class="token comment">// start ################# 添加的代码 #################</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">defined EMPL_TARGET_STM32F1</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;Soft_I2C.h&quot;</span> </span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;Delay.h&quot;</span> </span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;RTC_Time.h&quot;</span> </span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;OLED_Printf.h&quot;</span> </span></span>
<span class="line"><span class="token comment">// 提供通信接口 注意这里要求函数当执行成功时返回值0</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">i2c_write</span><span class="token expression"><span class="token punctuation">(</span>slave_addr<span class="token punctuation">,</span>reg_addr<span class="token punctuation">,</span>length<span class="token punctuation">,</span>p_data<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">Soft_I2C_Write_Device_Register_Datas</span><span class="token punctuation">(</span>slave_addr<span class="token punctuation">,</span>reg_addr<span class="token punctuation">,</span>p_data<span class="token punctuation">,</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">i2c_read</span><span class="token expression"><span class="token punctuation">(</span>slave_addr<span class="token punctuation">,</span>reg_addr<span class="token punctuation">,</span>length<span class="token punctuation">,</span>p_data<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">Soft_I2C_Read_Device_Register_Datas</span><span class="token punctuation">(</span>slave_addr<span class="token punctuation">,</span>reg_addr<span class="token punctuation">,</span>p_data<span class="token punctuation">,</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span></span>
<span class="line"><span class="token comment">// 提供延时接口</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">delay_ms</span>    <span class="token expression">Delay_ms</span></span></span>
<span class="line"><span class="token comment">// 提供获取时间的接口</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">get_ms</span>      <span class="token expression">RTC_Time_GetTime_MS</span></span></span>
<span class="line"><span class="token comment">// 提供打印输出的接口</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">log_i</span>       <span class="token expression">OLED_Printf</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">log_e</span>       <span class="token expression">OLED_Printf</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">min</span><span class="token expression"><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token operator">&lt;</span>b<span class="token punctuation">)</span><span class="token operator">?</span>a<span class="token operator">:</span>b<span class="token punctuation">)</span></span></span></span>
<span class="line"><span class="token comment">// end ###############################################</span></span>
<span class="line"></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">elif</span> <span class="token expression">defined EMPL_TARGET_STM32F4</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;i2c.h&quot;</span>   </span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;main.h&quot;</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;log.h&quot;</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;board-st_discovery.h&quot;</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">i2c_write</span>   <span class="token expression">Sensors_I2C_WriteRegister</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">i2c_read</span>    <span class="token expression">Sensors_I2C_ReadRegister </span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">delay_ms</span>    <span class="token expression">mdelay</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">get_ms</span>      <span class="token expression">get_tick_count</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">log_i</span>       <span class="token expression">MPL_LOGI</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">log_e</span>       <span class="token expression">MPL_LOGE</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">min</span><span class="token expression"><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token operator">&lt;</span>b<span class="token punctuation">)</span><span class="token operator">?</span>a<span class="token operator">:</span>b<span class="token punctuation">)</span></span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>inv_mpu_dmp_motion_driver.c</code></p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp" data-title="cpp"><pre><code><span class="line"><span class="token comment">// start ################# 添加的代码 #################</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">defined EMPL_TARGET_STM32F1</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;Soft_I2C.h&quot;</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;RTC_Time.h&quot;</span></span></span>
<span class="line"><span class="token comment">// 提供通信接口</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">i2c_write</span><span class="token expression"><span class="token punctuation">(</span>slave_addr<span class="token punctuation">,</span>reg_addr<span class="token punctuation">,</span>length<span class="token punctuation">,</span>p_data<span class="token punctuation">)</span> <span class="token function">Soft_I2C_Write_Device_Register_Datas</span><span class="token punctuation">(</span>slave_addr<span class="token punctuation">,</span>reg_addr<span class="token punctuation">,</span>p_data<span class="token punctuation">,</span>length<span class="token punctuation">)</span></span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">i2c_read</span><span class="token expression"><span class="token punctuation">(</span>slave_addr<span class="token punctuation">,</span>reg_addr<span class="token punctuation">,</span>length<span class="token punctuation">,</span>p_data<span class="token punctuation">)</span> <span class="token function">Soft_I2C_Read_Device_Register_Datas</span><span class="token punctuation">(</span>slave_addr<span class="token punctuation">,</span>reg_addr<span class="token punctuation">,</span>p_data<span class="token punctuation">,</span>length<span class="token punctuation">)</span></span></span></span>
<span class="line"><span class="token comment">// 提供获取时间的接口</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">get_ms</span>      <span class="token expression">RTC_Time_GetTime_MS</span></span></span>
<span class="line"><span class="token comment">// end ###############################################</span></span>
<span class="line"></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">elif</span> <span class="token expression">defined EMPL_TARGET_STM32F4</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;i2c.h&quot;</span>   </span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;main.h&quot;</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;board-st_discovery.h&quot;</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">i2c_write</span>   <span class="token expression">Sensors_I2C_WriteRegister</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">i2c_read</span>    <span class="token expression">Sensors_I2C_ReadRegister</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">get_ms</span>      <span class="token expression">get_tick_count</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="基于motion-driver-6-12实现mpu6050的驱动" tabindex="-1"><a class="header-anchor" href="#基于motion-driver-6-12实现mpu6050的驱动"><span>基于motion_driver_6.12实现MPU6050的驱动</span></a></h2>`,24),m=n("code",null,"/Drivers/mpu6050.h",-1),v=n("code",null,"/Drivers/mpu6050.c",-1),b=n("div",{class:"language-cpp line-numbers-mode","data-highlighter":"prismjs","data-ext":"cpp","data-title":"cpp"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"ifndef"),s(),n("span",{class:"token expression"},"_MPU_6050_H_")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"_MPU_6050_H_")])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"motion_driver_6.12/driver/eMPL/inv_mpu.h"'),s("                   "),n("span",{class:"token comment"},"// 操作MPU")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"motion_driver_6.12/driver/eMPL/inv_mpu_dmp_motion_driver.h"'),s(),n("span",{class:"token comment"},"// 操作DMP")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"motion_driver_6.12/mllite/ml_math_func.h"'),s("                   "),n("span",{class:"token comment"},"// 数学计算")])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"OLED_Printf.h"')])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"math.h"')])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"log"),s(),n("span",{class:"token expression"},"OLED_Printf")])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"ifdef"),s(),n("span",{class:"token expression"},"__cplusplus")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"extern"),s(),n("span",{class:"token string"},'"C"')]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"endif")])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"int"),s(),n("span",{class:"token function"},"MPU6050_DMP_Init"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"int"),s(),n("span",{class:"token function"},"MPU6050_DMP_Get_Data"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"float"),s(),n("span",{class:"token operator"},"*"),s("pitch"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(),n("span",{class:"token operator"},"*"),s("roll"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(),n("span",{class:"token operator"},"*"),s("yaw"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"ifdef"),s(),n("span",{class:"token expression"},"__cplusplus")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"endif")])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"endif")])]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),_=n("div",{class:"language-cpp line-numbers-mode","data-highlighter":"prismjs","data-ext":"cpp","data-title":"cpp"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"mpu6050.h"')])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"COMPASS_ENABLED"),s(),n("span",{class:"token expression"},[n("span",{class:"token number"},"0")])])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"/* Data read from MPL. */")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"PRINT_ACCEL"),s(),n("span",{class:"token expression"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0x01"),n("span",{class:"token punctuation"},")")])])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"PRINT_GYRO"),s(),n("span",{class:"token expression"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0x02"),n("span",{class:"token punctuation"},")")])])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"PRINT_QUAT"),s(),n("span",{class:"token expression"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0x04"),n("span",{class:"token punctuation"},")")])])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"PRINT_COMPASS"),s(),n("span",{class:"token expression"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0x08"),n("span",{class:"token punctuation"},")")])])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"PRINT_EULER"),s(),n("span",{class:"token expression"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0x10"),n("span",{class:"token punctuation"},")")])])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"PRINT_ROT_MAT"),s(),n("span",{class:"token expression"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0x20"),n("span",{class:"token punctuation"},")")])])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"PRINT_HEADING"),s(),n("span",{class:"token expression"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0x40"),n("span",{class:"token punctuation"},")")])])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"PRINT_PEDO"),s(),n("span",{class:"token expression"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0x80"),n("span",{class:"token punctuation"},")")])])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"PRINT_LINEAR_ACCEL"),s(),n("span",{class:"token expression"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0x100"),n("span",{class:"token punctuation"},")")])])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"PRINT_GRAVITY_VECTOR"),s(),n("span",{class:"token expression"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0x200"),n("span",{class:"token punctuation"},")")])])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"ACCEL_ON"),s(),n("span",{class:"token expression"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0x01"),n("span",{class:"token punctuation"},")")])])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"GYRO_ON"),s(),n("span",{class:"token expression"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0x02"),n("span",{class:"token punctuation"},")")])])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"COMPASS_ON"),s(),n("span",{class:"token expression"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0x04"),n("span",{class:"token punctuation"},")")])])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"MOTION"),s(),n("span",{class:"token expression"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},")")])])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"NO_MOTION"),s(),n("span",{class:"token expression"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")")])])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"/* Starting sampling rate. */")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"DEFAULT_MPU_HZ"),s(),n("span",{class:"token expression"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"20"),n("span",{class:"token punctuation"},")")])])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"FLASH_SIZE"),s(),n("span",{class:"token expression"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"512"),n("span",{class:"token punctuation"},")")])])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"FLASH_MEM_START"),s(),n("span",{class:"token expression"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token operator"},"*"),n("span",{class:"token punctuation"},")"),n("span",{class:"token number"},"0x1800"),n("span",{class:"token punctuation"},")")])])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"PEDO_READ_MS"),s(),n("span",{class:"token expression"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1000"),n("span",{class:"token punctuation"},")")])])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"TEMP_READ_MS"),s(),n("span",{class:"token expression"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"500"),n("span",{class:"token punctuation"},")")])])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"COMPASS_READ_MS"),s(),n("span",{class:"token expression"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"100"),n("span",{class:"token punctuation"},")")])])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"/* Every time new gyro data is available, this function is called in an"),s(`
`),n("span",{class:"line"}," * ISR context."),s(`
`),n("span",{class:"line"}," */")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"static"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"gyro_data_ready_cb"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"void"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"/* Platform-specific information. Kinda like a boardfile. */")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"struct"),s(),n("span",{class:"token class-name"},"platform_data_s")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"signed"),s(),n("span",{class:"token keyword"},"char"),s(" orientation"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"9"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"/* The sensors can be mounted onto the board in any orientation. The mounting"),s(`
`),n("span",{class:"line"}," * matrix seen below tells the MPL how to rotate the raw data from the"),s(`
`),n("span",{class:"line"}," * driver(s)."),s(`
`),n("span",{class:"line"}," * TODO: The following matrices refer to the configuration on internal test"),s(`
`),n("span",{class:"line"}," * boards at Invensense. If needed, please modify the matrices to match the"),s(`
`),n("span",{class:"line"}," * chip-to-body matrix for your particular set up."),s(`
`),n("span",{class:"line"}," */")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"static"),s(),n("span",{class:"token keyword"},"int8_t"),s(" orientation"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"8"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("                                "),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("                                "),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"int"),s(),n("span",{class:"token function"},"run_self_test"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"int"),s(),n("span",{class:"token function"},"MPU6050_DMP_Init"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"int"),s(" result"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"unsigned"),s(),n("span",{class:"token keyword"},"char"),s(" accel_fsr"),n("span",{class:"token punctuation"},","),s(" new_temp "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"unsigned"),s(),n("span",{class:"token keyword"},"short"),s(" gyro_rate"),n("span",{class:"token punctuation"},","),s(" gyro_fsr"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"unsigned"),s(),n("span",{class:"token keyword"},"long"),s(" timestamp"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"struct"),s(),n("span",{class:"token class-name"},"int_param_s"),s(" int_param"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    int_param"),n("span",{class:"token punctuation"},"."),s("cb "),n("span",{class:"token operator"},"="),s(" gyro_data_ready_cb"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"if"),s(),n("span",{class:"token expression"},"COMPASS_ENABLED")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"unsigned"),s(),n("span",{class:"token keyword"},"char"),s(" new_compass "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"unsigned"),s(),n("span",{class:"token keyword"},"short"),s(" compass_fsr"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"endif")])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"mpu_init"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("int_param"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// mpu6050初始化")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"/* Get/set hardware configuration. Start gyro. */")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"/* Wake up all sensors. */")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"if"),s(),n("span",{class:"token expression"},"COMPASS_ENABLED")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"mpu_set_sensors"),n("span",{class:"token punctuation"},"("),s("INV_XYZ_GYRO "),n("span",{class:"token operator"},"|"),s(" INV_XYZ_ACCEL "),n("span",{class:"token operator"},"|"),s(" INV_XYZ_COMPASS"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// 设置所有传感器")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"else")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"mpu_set_sensors"),n("span",{class:"token punctuation"},"("),s("INV_XYZ_GYRO "),n("span",{class:"token operator"},"|"),s(" INV_XYZ_ACCEL"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// 设置传感器")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"endif")])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"/* Push both gyro and accel data into the FIFO. */")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"mpu_configure_fifo"),n("span",{class:"token punctuation"},"("),s("INV_XYZ_GYRO "),n("span",{class:"token operator"},"|"),s(" INV_XYZ_ACCEL"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// 配置fifo")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"4"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"mpu_set_sample_rate"),n("span",{class:"token punctuation"},"("),s("DEFAULT_MPU_HZ"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// 设置采样率")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"5"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"if"),s(),n("span",{class:"token expression"},"COMPASS_ENABLED")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"/* The compass sampling rate can be less than the gyro/accel sampling rate."),s(`
`),n("span",{class:"line"},"     * Use this function for proper power management."),s(`
`),n("span",{class:"line"},"     */")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"mpu_set_compass_sample_rate"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1000"),s(),n("span",{class:"token operator"},"/"),s(" COMPASS_READ_MS"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// 设置罗盘采样率")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"6"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"endif")])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"/* Read back configuration in case it was set improperly. */")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"mpu_get_sample_rate"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("gyro_rate"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// 获取采样率")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"7"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"mpu_get_gyro_fsr"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("gyro_fsr"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// 获取满量程范围")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"8"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"mpu_get_accel_fsr"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("accel_fsr"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// 获取满量程范围")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"9"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"if"),s(),n("span",{class:"token expression"},"COMPASS_ENABLED")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"mpu_get_compass_fsr"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("compass_fsr"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// 获取满量程范围")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"endif")])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"dmp_load_motion_driver_firmware"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// 加载DMP固件")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Could not download DMP.\\n"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"11"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"dmp_set_orientation"),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"inv_orientation_matrix_to_scalar"),n("span",{class:"token punctuation"},"("),s("orientation"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// 设置陀螺仪方向")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"12"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"/*"),s(`
`),n("span",{class:"line"},"     * Known Bug -"),s(`
`),n("span",{class:"line"},"     * DMP when enabled will sample sensor data at 200Hz and output to FIFO at the rate"),s(`
`),n("span",{class:"line"},"     * specified in the dmp_set_fifo_rate API. The DMP will then sent an interrupt once"),s(`
`),n("span",{class:"line"},"     * a sample has been put into the FIFO. Therefore if the dmp_set_fifo_rate is at 25Hz"),s(`
`),n("span",{class:"line"},"     * there will be a 25Hz interrupt from the MPU device."),s(`
`),n("span",{class:"line"},"     *"),s(`
`),n("span",{class:"line"},"     * There is a known issue in which if you do not enable DMP_FEATURE_TAP"),s(`
`),n("span",{class:"line"},"     * then the interrupts will be at 200Hz even if fifo rate"),s(`
`),n("span",{class:"line"},"     * is set at a different rate. To avoid this issue include the DMP_FEATURE_TAP"),s(`
`),n("span",{class:"line"},"     *"),s(`
`),n("span",{class:"line"},"     * DMP sensor fusion works only with gyro at +-2000dps and accel +-2G"),s(`
`),n("span",{class:"line"},"     */")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"dmp_enable_feature"),n("span",{class:"token punctuation"},"("),s("DMP_FEATURE_6X_LP_QUAT "),n("span",{class:"token operator"},"|"),s(" DMP_FEATURE_TAP "),n("span",{class:"token operator"},"|")]),s(`
`),n("span",{class:"line"},[s("                           DMP_FEATURE_ANDROID_ORIENT "),n("span",{class:"token operator"},"|"),s(" DMP_FEATURE_SEND_RAW_ACCEL "),n("span",{class:"token operator"},"|")]),s(`
`),n("span",{class:"line"},[s("                           DMP_FEATURE_SEND_CAL_GYRO "),n("span",{class:"token operator"},"|"),s(" DMP_FEATURE_GYRO_CAL"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// 设置DMP功能")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"13"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"dmp_set_fifo_rate"),n("span",{class:"token punctuation"},"("),s("DEFAULT_MPU_HZ"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// 设置输出速率")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"14"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"run_self_test"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// 自检")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"15"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"mpu_set_dmp_state"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// 使能DMP")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"16"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"// 2^30")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"Q30"),s(),n("span",{class:"token expression"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1073741824.0f"),n("span",{class:"token punctuation"},")")])])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"/**"),s(`
`),n("span",{class:"line"}," *  @brief      run_self_test"),s(`
`),n("span",{class:"line"}," *  @return     0 if successful."),s(`
`),n("span",{class:"line"}," */")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"int"),s(),n("span",{class:"token function"},"MPU6050_DMP_Get_Data"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"float"),s(),n("span",{class:"token operator"},"*"),s("pitch"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(),n("span",{class:"token operator"},"*"),s("roll"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(),n("span",{class:"token operator"},"*"),s("yaw"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"short"),s(" gyro"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s("  "),n("span",{class:"token comment"},"// 重力加速度")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"short"),s(" accel"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 角加速度")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"long"),s(" quat"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"4"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s("   "),n("span",{class:"token comment"},"// Q30格式四元数")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" q"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"4"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s("     "),n("span",{class:"token comment"},"// float格式四元数")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"unsigned"),s(),n("span",{class:"token keyword"},"long"),s(" timestamp"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"short"),s(" sensors"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"unsigned"),s(),n("span",{class:"token keyword"},"char"),s(" more"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"dmp_read_fifo"),n("span",{class:"token punctuation"},"("),s("gyro"),n("span",{class:"token punctuation"},","),s(" accel"),n("span",{class:"token punctuation"},","),s(" quat"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),s("timestamp"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),s("sensors"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),s("more"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("sensors "),n("span",{class:"token operator"},"&"),s(" INV_WXYZ_QUAT"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        q"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(" quat"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"/"),s(" Q30"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        q"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(" quat"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"/"),s(" Q30"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        q"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(" quat"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"/"),s(" Q30"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        q"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(" quat"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"/"),s(" Q30"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// 四元数转欧拉角")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// 1rad = 57.3 degree")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token operator"},"*"),s("roll "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"atan2"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"2"),s(),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token punctuation"},"("),s("q"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"*"),s(" q"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"+"),s(" q"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"*"),s(" q"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"1"),s(),n("span",{class:"token operator"},"-"),s(),n("span",{class:"token number"},"2"),s(),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token punctuation"},"("),s("q"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"*"),s(" q"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"+"),s(" q"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"*"),s(" q"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token number"},"57.3"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token operator"},"*"),s("pitch "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"asin"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"2"),s(),n("span",{class:"token operator"},"*"),s(" q"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"*"),s(" q"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"-"),s(),n("span",{class:"token number"},"2"),s(),n("span",{class:"token operator"},"*"),s(" q"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"*"),s(" q"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token number"},"57.3"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token operator"},"*"),s("yaw "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"atan2"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"2"),s(),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token punctuation"},"("),s("q"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"*"),s(" q"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"+"),s(" q"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"*"),s(" q"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"1"),s(),n("span",{class:"token operator"},"-"),s(),n("span",{class:"token number"},"2"),s(),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token punctuation"},"("),s("q"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"*"),s(" q"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"+"),s(" q"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"*"),s(" q"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token number"},"57.3"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"/**"),s(`
`),n("span",{class:"line"}," *  @brief      run_self_test"),s(`
`),n("span",{class:"line"}," *  @return     0 if successful."),s(`
`),n("span",{class:"line"}," */")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"int"),s(),n("span",{class:"token function"},"run_self_test"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"int"),s(" result"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"long"),s(" gyro"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(" accel"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"if"),s(),n("span",{class:"token expression"},[n("span",{class:"token function"},"defined"),n("span",{class:"token punctuation"},"("),s("MPU6500"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"||"),s(),n("span",{class:"token function"},"defined"),n("span",{class:"token punctuation"},"("),s("MPU9250"),n("span",{class:"token punctuation"},")")])])]),s(`
`),n("span",{class:"line"},[s("    result "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"mpu_run_6500_self_test"),n("span",{class:"token punctuation"},"("),s("gyro"),n("span",{class:"token punctuation"},","),s(" accel"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"elif"),s(),n("span",{class:"token expression"},[n("span",{class:"token function"},"defined"),n("span",{class:"token punctuation"},"("),s("MPU6050"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"||"),s(),n("span",{class:"token function"},"defined"),n("span",{class:"token punctuation"},"("),s("MPU9150"),n("span",{class:"token punctuation"},")")])])]),s(`
`),n("span",{class:"line"},[s("    result "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"mpu_run_self_test"),n("span",{class:"token punctuation"},"("),s("gyro"),n("span",{class:"token punctuation"},","),s(" accel"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"endif")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("result "),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token number"},"0x07"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Passed!\\n"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"accel: %7.4f %7.4f %7.4f\\n"'),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("            accel"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"65536.f"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("            accel"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"65536.f"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("            accel"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"65536.f"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"gyro: %7.4f %7.4f %7.4f\\n"'),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("            gyro"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"65536.f"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("            gyro"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"65536.f"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("            gyro"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"65536.f"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"/* Test passed. We can trust the gyro data here, so now we need to update calibrated data*/")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"ifdef"),s(),n("span",{class:"token expression"},"USE_CAL_HW_REGISTERS")])]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"/*"),s(`
`),n("span",{class:"line"},"         * This portion of the code uses the HW offset registers that are in the MPUxxxx devices"),s(`
`),n("span",{class:"line"},"         * instead of pushing the cal data to the MPL software library"),s(`
`),n("span",{class:"line"},"         */")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"unsigned"),s(),n("span",{class:"token keyword"},"char"),s(" i "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token punctuation"},"("),s("i "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";"),s(" i "),n("span",{class:"token operator"},"<"),s(),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},";"),s(" i"),n("span",{class:"token operator"},"++"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("            gyro"),n("span",{class:"token punctuation"},"["),s("i"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"long"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"("),s("gyro"),n("span",{class:"token punctuation"},"["),s("i"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token number"},"32.8f"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// convert to +-1000dps")]),s(`
`),n("span",{class:"line"},[s("            accel"),n("span",{class:"token punctuation"},"["),s("i"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"*="),s(),n("span",{class:"token number"},"2048.f"),n("span",{class:"token punctuation"},";"),s("                "),n("span",{class:"token comment"},"// convert to +-16G (bug fix from +-8G)")]),s(`
`),n("span",{class:"line"},[s("            accel"),n("span",{class:"token punctuation"},"["),s("i"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(" accel"),n("span",{class:"token punctuation"},"["),s("i"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},">>"),s(),n("span",{class:"token number"},"16"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("            gyro"),n("span",{class:"token punctuation"},"["),s("i"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"long"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"("),s("gyro"),n("span",{class:"token punctuation"},"["),s("i"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},">>"),s(),n("span",{class:"token number"},"16"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token function"},"mpu_set_gyro_bias_reg"),n("span",{class:"token punctuation"},"("),s("gyro"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"if"),s(),n("span",{class:"token expression"},[n("span",{class:"token function"},"defined"),n("span",{class:"token punctuation"},"("),s("MPU6500"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"||"),s(),n("span",{class:"token function"},"defined"),n("span",{class:"token punctuation"},"("),s("MPU9250"),n("span",{class:"token punctuation"},")")])])]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token function"},"mpu_set_accel_bias_6500_reg"),n("span",{class:"token punctuation"},"("),s("accel"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"elif"),s(),n("span",{class:"token expression"},[n("span",{class:"token function"},"defined"),n("span",{class:"token punctuation"},"("),s("MPU6050"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"||"),s(),n("span",{class:"token function"},"defined"),n("span",{class:"token punctuation"},"("),s("MPU9150"),n("span",{class:"token punctuation"},")")])])]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token function"},"mpu_set_accel_bias_6050_reg"),n("span",{class:"token punctuation"},"("),s("accel"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"endif")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"else")])]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"/* Push the calibrated data to the MPL library."),s(`
`),n("span",{class:"line"},"         *"),s(`
`),n("span",{class:"line"},"         * MPL expects biases in hardware units << 16, but self test returns"),s(`
`),n("span",{class:"line"},"         * biases in g's << 16."),s(`
`),n("span",{class:"line"},"         */")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"unsigned"),s(),n("span",{class:"token keyword"},"short"),s(" accel_sens"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" gyro_sens"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token function"},"mpu_get_accel_sens"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("accel_sens"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        accel"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"*="),s(" accel_sens"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        accel"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"*="),s(" accel_sens"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        accel"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"*="),s(" accel_sens"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token function"},"inv_set_accel_bias"),n("span",{class:"token punctuation"},"("),s("accel"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token function"},"mpu_get_gyro_sens"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("gyro_sens"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gyro"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"long"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"("),s("gyro"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"*"),s(" gyro_sens"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gyro"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"long"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"("),s("gyro"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"*"),s(" gyro_sens"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gyro"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"long"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"("),s("gyro"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"*"),s(" gyro_sens"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token function"},"inv_set_gyro_bias"),n("span",{class:"token punctuation"},"("),s("gyro"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"endif")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"else")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),n("span",{class:"token punctuation"},"("),s("result "),n("span",{class:"token operator"},"&"),s(),n("span",{class:"token number"},"0x1"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("            "),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Gyro failed.\\n"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),n("span",{class:"token punctuation"},"("),s("result "),n("span",{class:"token operator"},"&"),s(),n("span",{class:"token number"},"0x2"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("            "),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Accel failed.\\n"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),n("span",{class:"token punctuation"},"("),s("result "),n("span",{class:"token operator"},"&"),s(),n("span",{class:"token number"},"0x4"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("            "),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Compass failed.\\n"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1);function h(y,f){const o=r("CodeTabs");return u(),l("div",null,[d,p(o,{id:"649",data:[{id:"<code v-pre>/Drivers/mpu6050.h</code>"},{id:"<code v-pre>/Drivers/mpu6050.c</code>"}]},{title0:a(({value:e,isActive:t})=>[m]),title1:a(({value:e,isActive:t})=>[v]),tab0:a(({value:e,isActive:t})=>[b]),tab1:a(({value:e,isActive:t})=>[_]),_:1})])}const w=c(k,[["render",h],["__file","index.html.vue"]]),P=JSON.parse('{"path":"/%E7%94%B5%E5%AD%90/motion_driver_6.12(%E5%AE%98%E6%96%B9DMP%E5%BA%93)%E7%9A%84%E7%A7%BB%E6%A4%8D%E5%92%8CMPU6050%E9%A9%B1%E5%8A%A8%E7%9A%84%E5%AE%9E%E7%8E%B0/","title":"motion_driver_6.12(官方DMP库)的移植和MPU6050驱动的实现","lang":"zh-CN","frontmatter":{"title":"motion_driver_6.12(官方DMP库)的移植和MPU6050驱动的实现","date":"2024-07-26T01:57:00.000Z","description":"motion_driver_6.12(官方DMP库)的移植和MPU6050驱动的实现 目录 motion_driver_6.12(官方DMP库)的移植和MPU6050驱动的实现 目录 motion driver_6.12 motion_driver_6.12的三个主要目录 motion_driver_6.12目录结构 DMP MPL算法 motion_...","head":[["meta",{"property":"og:url","content":"https://dingdingdang.online/%E7%94%B5%E5%AD%90/motion_driver_6.12(%E5%AE%98%E6%96%B9DMP%E5%BA%93)%E7%9A%84%E7%A7%BB%E6%A4%8D%E5%92%8CMPU6050%E9%A9%B1%E5%8A%A8%E7%9A%84%E5%AE%9E%E7%8E%B0/"}],["meta",{"property":"og:site_name","content":"YiguiDing的Blog小站"}],["meta",{"property":"og:title","content":"motion_driver_6.12(官方DMP库)的移植和MPU6050驱动的实现"}],["meta",{"property":"og:description","content":"motion_driver_6.12(官方DMP库)的移植和MPU6050驱动的实现 目录 motion_driver_6.12(官方DMP库)的移植和MPU6050驱动的实现 目录 motion driver_6.12 motion_driver_6.12的三个主要目录 motion_driver_6.12目录结构 DMP MPL算法 motion_..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-07-25T17:58:27.000Z"}],["meta",{"property":"article:author","content":"丁毅桂"}],["meta",{"property":"article:published_time","content":"2024-07-26T01:57:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-07-25T17:58:27.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"motion_driver_6.12(官方DMP库)的移植和MPU6050驱动的实现\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2024-07-26T01:57:00.000Z\\",\\"dateModified\\":\\"2024-07-25T17:58:27.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"丁毅桂\\",\\"email\\":\\"2449695354@qq.com\\"}]}"],["meta",{"name":"baidu-site-verification","content":"codeva-PwE9Ts6nMl"}]]},"headers":[{"level":2,"title":"目录","slug":"目录","link":"#目录","children":[]},{"level":2,"title":"motion driver_6.12","slug":"motion-driver-6-12","link":"#motion-driver-6-12","children":[{"level":3,"title":"motion_driver_6.12的三个主要目录","slug":"motion-driver-6-12的三个主要目录","link":"#motion-driver-6-12的三个主要目录","children":[]},{"level":3,"title":"motion_driver_6.12目录结构","slug":"motion-driver-6-12目录结构","link":"#motion-driver-6-12目录结构","children":[]}]},{"level":2,"title":"DMP","slug":"dmp","link":"#dmp","children":[]},{"level":2,"title":"MPL算法","slug":"mpl算法","link":"#mpl算法","children":[]},{"level":2,"title":"motion_driver_6.12的移植","slug":"motion-driver-6-12的移植","link":"#motion-driver-6-12的移植","children":[]},{"level":2,"title":"基于motion_driver_6.12实现MPU6050的驱动","slug":"基于motion-driver-6-12实现mpu6050的驱动","link":"#基于motion-driver-6-12实现mpu6050的驱动","children":[]}],"git":{"createdTime":1721930307000,"updatedTime":1721930307000,"contributors":[{"name":"YiguiDing","email":"2449695354@qq.com","commits":1}]},"readingTime":{"minutes":8.26,"words":2478},"filePathRelative":"电子/motion_driver_6.12(官方DMP库)的移植和MPU6050驱动的实现/index.md","localizedDate":"2024年7月26日","excerpt":"","autoDesc":true}');export{w as comp,P as data};
