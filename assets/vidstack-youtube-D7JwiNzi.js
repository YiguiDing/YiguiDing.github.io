var N=Object.defineProperty;var _=r=>{throw TypeError(r)};var q=(r,n,e)=>n in r?N(r,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[n]=e;var P=(r,n,e)=>q(r,typeof n!="symbol"?n+"":n,e),C=(r,n,e)=>n.has(r)||_("Cannot "+e);var t=(r,n,e)=>(C(r,n,"read from private field"),e?e.call(r):n.get(r)),p=(r,n,e)=>n.has(r)?_("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(r):n.set(r,e),c=(r,n,e,i)=>(C(r,n,"write to private field"),i?i.call(r,e):n.set(r,e),e),o=(r,n,e)=>(C(r,n,"access private method"),e);import{v as z,w as A,p as G,j as H,g as J,y as K,x as R,B as Q,a as S,C as W}from"./app-XtR3JOoW.js";import{E as X}from"./vidstack-DDXt6fpN-BnkaMWg-.js";import{resolveYouTubeVideoId as Z}from"./vidstack-Dm1xEU9Q-DDN5V1NO.js";const g={Ended:0,Playing:1,Paused:2,Buffering:3,Cued:5};var a,b,v,w,k,m,y,s,ee,te,j,f,D,O,Y,M,E,x,F,I,$,L;class re extends X{constructor(e,i){super(e);p(this,s);P(this,"$$PROVIDER_TYPE","YOUTUBE");P(this,"scope",z());p(this,a);p(this,b,A(""));p(this,v,-1);p(this,w,null);p(this,k,-1);p(this,m,!1);p(this,y,new Map);P(this,"language","en");P(this,"color","red");P(this,"cookies",!1);c(this,a,i)}get currentSrc(){return t(this,w)}get type(){return"youtube"}get videoId(){return t(this,b).call(this)}preconnect(){G(this.getOrigin())}setup(){super.setup(),H(o(this,s,j).bind(this)),t(this,a).notify("provider-setup",this)}destroy(){o(this,s,I).call(this);const e="provider destroyed";for(const i of t(this,y).values())for(const{reject:d}of i)d(e);t(this,y).clear()}async play(){return o(this,s,f).call(this,"playVideo")}async pause(){return o(this,s,f).call(this,"pauseVideo")}setMuted(e){e?o(this,s,f).call(this,"mute"):o(this,s,f).call(this,"unMute")}setCurrentTime(e){o(this,s,f).call(this,"seekTo",e),t(this,a).notify("seeking",e)}setVolume(e){o(this,s,f).call(this,"setVolume",e*100)}setPlaybackRate(e){o(this,s,f).call(this,"setPlaybackRate",e)}async loadSource(e){if(!J(e.src)){c(this,w,null),t(this,b).set("");return}const i=Z(e.src);t(this,b).set(i??""),c(this,w,e)}getOrigin(){return this.cookies?"https://www.youtube.com":"https://www.youtube-nocookie.com"}buildParams(){const{keyDisabled:e}=t(this,a).$props,{muted:i,playsInline:d,nativeControls:u}=t(this,a).$state,h=u();return{rel:0,autoplay:0,cc_lang_pref:this.language,cc_load_policy:h?1:void 0,color:this.color,controls:h?1:0,disablekb:!h||e()?1:0,enablejsapi:1,fs:1,hl:this.language,iv_load_policy:h?1:3,mute:i()?1:0,playsinline:d()?1:0}}onLoad(){window.setTimeout(()=>this.postMessage({event:"listening"}),100)}onMessage({info:e},i){if(!e)return;const{title:d,intrinsicDuration:u,playbackRate:h}=t(this,a).$state;if(Q(e.videoData)&&e.videoData.title!==d()&&t(this,a).notify("title-change",e.videoData.title,i),S(e.duration)&&e.duration!==u()){if(S(e.videoLoadedFraction)){const l=e.progressState?.loaded??e.videoLoadedFraction*e.duration,T=new R(0,e.duration);o(this,s,M).call(this,l,T,i)}t(this,a).notify("duration-change",e.duration,i)}if(S(e.playbackRate)&&e.playbackRate!==h()&&t(this,a).notify("rate-change",e.playbackRate,i),e.progressState){const{current:l,seekableStart:T,seekableEnd:V,loaded:U,duration:B}=e.progressState;o(this,s,Y).call(this,l,i),o(this,s,M).call(this,U,new R(T,V),i),B!==u()&&t(this,a).notify("duration-change",B,i)}if(S(e.volume)&&W(e.muted)&&!t(this,m)){const l={muted:e.muted,volume:e.volume/100};t(this,a).notify("volume-change",l,i)}S(e.playerState)&&e.playerState!==t(this,v)&&o(this,s,F).call(this,e.playerState,i)}}a=new WeakMap,b=new WeakMap,v=new WeakMap,w=new WeakMap,k=new WeakMap,m=new WeakMap,y=new WeakMap,s=new WeakSet,ee=function(e){o(this,s,$).call(this,"playVideo")?.reject(e)},te=function(e){o(this,s,$).call(this,"pauseVideo")?.reject(e)},j=function(){o(this,s,I).call(this);const e=t(this,b).call(this);if(!e){this.src.set("");return}this.src.set(`${this.getOrigin()}/embed/${e}`),t(this,a).notify("load-start")},f=function(e,i){let d=K(),u=t(this,y).get(e);return u||t(this,y).set(e,u=[]),u.push(d),this.postMessage({event:"command",func:e,args:i?[i]:void 0}),d.promise},D=function(e){t(this,a).notify("loaded-metadata"),t(this,a).notify("loaded-data"),t(this,a).delegate.ready(void 0,e)},O=function(e){o(this,s,$).call(this,"pauseVideo")?.resolve(),t(this,a).notify("pause",void 0,e)},Y=function(e,i){const{duration:d,realCurrentTime:u}=t(this,a).$state,h=t(this,v)===g.Ended,l=h?d():e;t(this,a).notify("time-change",l,i),!h&&Math.abs(l-u())>1&&t(this,a).notify("seeking",l,i)},M=function(e,i,d){const u={buffered:new R(0,e),seekable:i};t(this,a).notify("progress",u,d);const{seeking:h,realCurrentTime:l}=t(this,a).$state;h()&&e>l()&&o(this,s,E).call(this,d)},E=function(e){const{paused:i,realCurrentTime:d}=t(this,a).$state;window.clearTimeout(t(this,k)),c(this,k,window.setTimeout(()=>{t(this,a).notify("seeked",d(),e),c(this,k,-1)},i()?100:0))},x=function(e){const{seeking:i}=t(this,a).$state;i()&&o(this,s,E).call(this,e),t(this,a).notify("pause",void 0,e),t(this,a).notify("end",void 0,e)},F=function(e,i){const{paused:d,seeking:u}=t(this,a).$state,h=e===g.Playing,l=e===g.Buffering,T=o(this,s,L).call(this,"playVideo"),V=d()&&(l||h);if(l&&t(this,a).notify("waiting",void 0,i),u()&&h&&o(this,s,E).call(this,i),t(this,m)&&h){this.pause(),c(this,m,!1),this.setMuted(t(this,a).$state.muted());return}if(!T&&V){c(this,m,!0),this.setMuted(!0);return}switch(V&&(o(this,s,$).call(this,"playVideo")?.resolve(),t(this,a).notify("play",void 0,i)),e){case g.Cued:o(this,s,D).call(this,i);break;case g.Playing:t(this,a).notify("playing",void 0,i);break;case g.Paused:o(this,s,O).call(this,i);break;case g.Ended:o(this,s,x).call(this,i);break}c(this,v,e)},I=function(){c(this,v,-1),c(this,k,-1),c(this,m,!1)},$=function(e){return t(this,y).get(e)?.shift()},L=function(e){return!!t(this,y).get(e)?.length};export{re as YouTubeProvider};
