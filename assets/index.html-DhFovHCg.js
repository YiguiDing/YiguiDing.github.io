import{_ as s,c as a,a as h,o as t}from"./app-B7CD2T1r.js";const n={};function l(k,i){return t(),a("div",null,i[0]||(i[0]=[h(`<h2 id="backtrader学习笔记" tabindex="-1"><a class="header-anchor" href="#backtrader学习笔记"><span>backtrader学习笔记</span></a></h2><h3 id="安装环境" tabindex="-1"><a class="header-anchor" href="#安装环境"><span>安装环境</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#4c4f69;--shiki-dark:#E6E6E6;--shiki-light-bg:#eff1f5;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes catppuccin-latte slack-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">conda</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> create</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> -n</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> trade</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> python=</span><span style="--shiki-light:#FE640B;--shiki-dark:#B5CEA8;">3.5</span></span>
<span class="line"><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">conda</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> activate</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> trade</span></span>
<span class="line"><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">pip</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> install</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> backtrader</span></span>
<span class="line"><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">pip</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> install</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> backtrader[plotting]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="quickstart" tabindex="-1"><a class="header-anchor" href="#quickstart"><span>quickstart</span></a></h3><p><strong>基本写法</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#4c4f69;--shiki-dark:#E6E6E6;--shiki-light-bg:#eff1f5;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes catppuccin-latte slack-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#C586C0;">import</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> backtrader </span><span style="--shiki-light:#8839EF;--shiki-dark:#C586C0;">as</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> bt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#C586C0;">if</span><span style="--shiki-light:#4C4F69;--shiki-dark:#9CDCFE;"> __name__</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;"> ==</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> &#39;__main__&#39;</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">:</span></span>
<span class="line"><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">    cerebro </span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> bt</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">Cerebro</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">()</span><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"> # # 创建Cerebro引擎（核心控制类）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#FE640B;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">    print</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">&#39;初始投资组合价值: </span><span style="--shiki-light:#EA76CB;--shiki-dark:#569CD6;">%.2f</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">&#39;</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;"> %</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> cerebro</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">broker</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">getvalue</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">())</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">    cerebro</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">run</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#FE640B;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">    print</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">&#39;最终投资组合价值: </span><span style="--shiki-light:#EA76CB;--shiki-dark:#569CD6;">%.2f</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">&#39;</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;"> %</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> cerebro</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">broker</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">getvalue</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">())</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>设置现金</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#4c4f69;--shiki-dark:#E6E6E6;--shiki-light-bg:#eff1f5;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes catppuccin-latte slack-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">cerebro </span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> bt</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">Cerebro</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">cerebro</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">broker</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">setcash</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#FE640B;--shiki-dark:#B5CEA8;">100000.0</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>添加数据</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#4c4f69;--shiki-dark:#E6E6E6;--shiki-light-bg:#eff1f5;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes catppuccin-latte slack-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#C586C0;">import</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> datetime</span></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#C586C0;">import</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> os</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">path </span></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#C586C0;">import</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> sys</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">cerebro </span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> bt</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">Cerebro</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"># 获取当前路径</span></span>
<span class="line"><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">modpath </span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> os</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">path</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">dirname</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">os</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">path</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">abspath</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">sys</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#E6E6E6;--shiki-dark-font-style:inherit;">argv</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#FE640B;--shiki-light-font-style:italic;--shiki-dark:#B5CEA8;--shiki-dark-font-style:inherit;">0</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">]))</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"># 拼接文件路径</span></span>
<span class="line"><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">datapath </span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> os</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">path</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">join</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">modpath</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> &#39;../../datas/orcl-1995-2014.txt&#39;</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"># 创建数据馈送（Data Feed）</span></span>
<span class="line"><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">data </span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> bt</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">feeds</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">YahooFinanceCSVData</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span></span>
<span class="line"><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;">        dataname</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">datapath</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;">        fromdate</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">datetime</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">datetime</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#FE640B;--shiki-dark:#B5CEA8;">2000</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FE640B;--shiki-dark:#B5CEA8;"> 1</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FE640B;--shiki-dark:#B5CEA8;"> 1</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">),</span></span>
<span class="line"><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;">        todate</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">datetime</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">datetime</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#FE640B;--shiki-dark:#B5CEA8;">2000</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FE640B;--shiki-dark:#B5CEA8;"> 12</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FE640B;--shiki-dark:#B5CEA8;"> 31</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">),</span></span>
<span class="line"><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;">        reverse</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#FE640B;--shiki-dark:#569CD6;">False</span><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"> # 预期的CSV排序是日期升序</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">    )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"># 添加</span></span>
<span class="line"><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">cerebro</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">adddata</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">data</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>指标</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#4c4f69;--shiki-dark:#E6E6E6;--shiki-light-bg:#eff1f5;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes catppuccin-latte slack-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"># Import the backtrader platform</span></span>
<span class="line"><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">import</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> backtrader</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> as</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> bt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"># Create a Data Feed</span></span>
<span class="line"><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">data</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> =</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> bt.feeds.YahooFinanceCSVData</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span></span>
<span class="line"><span style="--shiki-light:#4C4F69;--shiki-dark:#9CDCFE;">        dataname</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">&#39;...&#39;,</span></span>
<span class="line"><span style="--shiki-light:#4C4F69;--shiki-dark:#9CDCFE;">        fromdate</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">datetime.datetime</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">2000,</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> 1,</span><span style="--shiki-light:#FE640B;--shiki-dark:#B5CEA8;"> 1</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">,</span></span>
<span class="line"><span style="--shiki-light:#4C4F69;--shiki-dark:#9CDCFE;">        todate</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">datetime.datetime</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">2000,</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> 12,</span><span style="--shiki-light:#FE640B;--shiki-dark:#B5CEA8;"> 31</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">,</span></span>
<span class="line"><span style="--shiki-light:#4C4F69;--shiki-dark:#9CDCFE;">        reverse</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">False</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">    )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"># 简单移动平均线（SMA）</span></span>
<span class="line"><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">sma</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> =</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> bt.indicators.SimpleMovingAverage</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">data,</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> period=</span><span style="--shiki-light:#FE640B;--shiki-dark:#B5CEA8;">20</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"># 指数移动平均线（EMA）</span></span>
<span class="line"><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">ema</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> =</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> bt.indicators.ExponentialMovingAverage</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">data,</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> period=</span><span style="--shiki-light:#FE640B;--shiki-dark:#B5CEA8;">25</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"># 加权移动平均线（WMA）</span></span>
<span class="line"><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">wma</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> =</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> bt.indicators.WeightedMovingAverage</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">data,</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> period=25,</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> subplot=True</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"> # subplot在子图中绘制</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"># MACD柱状图指标</span></span>
<span class="line"><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">macd</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> =</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> bt.indicators.MACDHisto</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">data</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>创建策略</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#4c4f69;--shiki-dark:#E6E6E6;--shiki-light-bg:#eff1f5;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes catppuccin-latte slack-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#569CD6;">class</span><span style="--shiki-light:#DF8E1D;--shiki-light-font-style:italic;--shiki-dark:#4EC9B0;--shiki-dark-font-style:inherit;"> TestStrategy</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#DF8E1D;--shiki-light-font-style:italic;--shiki-dark:#4EC9B0;--shiki-dark-font-style:inherit;">bt</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#DF8E1D;--shiki-light-font-style:italic;--shiki-dark:#4EC9B0;--shiki-dark-font-style:inherit;">Strategy</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">):</span></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#569CD6;">    def</span><span style="--shiki-light:#04A5E5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;"> __init__</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;">self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">):</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;">        # datas[0]就是上面创建的数据馈送（Data Feed）</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;">        # close是一个DataSeries，包含每天的收盘价</span></span>
<span class="line"><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;">        self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">dataclose </span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;"> self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#E6E6E6;--shiki-dark-font-style:inherit;">datas</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#FE640B;--shiki-light-font-style:italic;--shiki-dark:#B5CEA8;--shiki-dark-font-style:inherit;">0</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">].</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">close</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#569CD6;">    def</span><span style="--shiki-light:#FE640B;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;"> next</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;">self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">):</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;">        # dataclose[0]是当前收盘价格 -1是前一天的收盘价格</span></span>
<span class="line"><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;">        self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">log</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">&#39;Close, </span><span style="--shiki-light:#EA76CB;--shiki-dark:#569CD6;">%.2f</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">&#39;</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;"> %</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;"> self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#E6E6E6;--shiki-dark-font-style:inherit;">dataclose</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#FE640B;--shiki-light-font-style:italic;--shiki-dark:#B5CEA8;--shiki-dark-font-style:inherit;">0</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">])</span></span>
<span class="line"><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">    </span></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#569CD6;">    def</span><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;"> log</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;">self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;"> txt</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;"> dt</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#FE640B;--shiki-dark:#569CD6;">None</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">):</span></span>
<span class="line"><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">        &#39;&#39;&#39; Logging function for this strategy&#39;&#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">        dt </span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> dt </span><span style="--shiki-light:#8839EF;--shiki-dark:#569CD6;">or</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;"> self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#E6E6E6;--shiki-dark-font-style:inherit;">datas</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#FE640B;--shiki-light-font-style:italic;--shiki-dark:#B5CEA8;--shiki-dark-font-style:inherit;">0</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">].</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">datetime</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">date</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#FE640B;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#FE640B;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">        print</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">&#39;</span><span style="--shiki-light:#EA76CB;--shiki-dark:#569CD6;">%s</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">, </span><span style="--shiki-light:#EA76CB;--shiki-dark:#569CD6;">%s</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">&#39;</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;"> %</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">dt</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">isoformat</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(),</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> txt</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#C586C0;">if</span><span style="--shiki-light:#4C4F69;--shiki-dark:#9CDCFE;"> __name__</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;"> ==</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> &#39;__main__&#39;</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">:</span></span>
<span class="line"><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">    cerebro </span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> bt</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">Cerebro</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">    cerebro</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">addstrategy</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">TestStrategy</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>为策略添加买入卖出逻辑/管理订单状态</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#4c4f69;--shiki-dark:#E6E6E6;--shiki-light-bg:#eff1f5;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes catppuccin-latte slack-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#569CD6;">class</span><span style="--shiki-light:#DF8E1D;--shiki-light-font-style:italic;--shiki-dark:#4EC9B0;--shiki-dark-font-style:inherit;"> TestStrategy</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#DF8E1D;--shiki-light-font-style:italic;--shiki-dark:#4EC9B0;--shiki-dark-font-style:inherit;">bt</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#DF8E1D;--shiki-light-font-style:italic;--shiki-dark:#4EC9B0;--shiki-dark-font-style:inherit;">Strategy</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">):</span></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#569CD6;">    def</span><span style="--shiki-light:#04A5E5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;"> __init__</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;">self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">):</span></span>
<span class="line"><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;">        self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">order </span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#FE640B;--shiki-dark:#569CD6;"> None</span><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;">  # 记录当前订单状态</span></span>
<span class="line"><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;">        self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">dataclose </span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;"> self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#E6E6E6;--shiki-dark-font-style:inherit;">datas</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#FE640B;--shiki-light-font-style:italic;--shiki-dark:#B5CEA8;--shiki-dark-font-style:inherit;">0</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">].</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">close</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;">        # 简单移动平均线（SMA）</span></span>
<span class="line"><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;">        self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">sma </span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> bt</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">indicators</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">SimpleMovingAverage</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;">self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#E6E6E6;--shiki-dark-font-style:inherit;">datas</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#FE640B;--shiki-light-font-style:italic;--shiki-dark:#B5CEA8;--shiki-dark-font-style:inherit;">0</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">],</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;"> period</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;">self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">params</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">sma_period</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#569CD6;">    def</span><span style="--shiki-light:#FE640B;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;"> next</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;">self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">):</span></span>
<span class="line"><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">        &#39;&#39;&#39; </span></span>
<span class="line"><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">            每个K线周期调用的策略逻辑</span></span>
<span class="line"><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">        &#39;&#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;">        # 记录当前收盘价</span></span>
<span class="line"><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;">        self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">log</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">&#39;Close, </span><span style="--shiki-light:#EA76CB;--shiki-dark:#569CD6;">%.2f</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">&#39;</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;"> %</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;"> self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#E6E6E6;--shiki-dark-font-style:inherit;">dataclose</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#FE640B;--shiki-light-font-style:italic;--shiki-dark:#B5CEA8;--shiki-dark-font-style:inherit;">0</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">])</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;">        # 存在挂单时禁止新订单</span></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#C586C0;">        if</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;"> self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">order</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">:</span></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#C586C0;">            return</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;">        # 检查当前持仓状态</span></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#C586C0;">        if</span><span style="--shiki-light:#8839EF;--shiki-dark:#569CD6;"> not</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;"> self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">position</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">:</span><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;">  # 无持仓</span></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#C586C0;">            if</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;"> self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#E6E6E6;--shiki-dark-font-style:inherit;">dataclose</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#FE640B;--shiki-light-font-style:italic;--shiki-dark:#B5CEA8;--shiki-dark-font-style:inherit;">0</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">]</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;"> &gt;</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;"> self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#E6E6E6;--shiki-dark-font-style:inherit;">sma</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#FE640B;--shiki-light-font-style:italic;--shiki-dark:#B5CEA8;--shiki-dark-font-style:inherit;">0</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">]:</span><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;">  # 收盘价上穿SMA时买入</span></span>
<span class="line"><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;">                self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">log</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">&#39;创建买入订单, </span><span style="--shiki-light:#EA76CB;--shiki-dark:#569CD6;">%.2f</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">&#39;</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;"> %</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;"> self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#E6E6E6;--shiki-dark-font-style:inherit;">dataclose</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#FE640B;--shiki-light-font-style:italic;--shiki-dark:#B5CEA8;--shiki-dark-font-style:inherit;">0</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">])</span></span>
<span class="line"><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;">                self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">order </span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;"> self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">buy</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">()</span><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;">  # 发送买入指令</span></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#C586C0;">        else</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">:</span><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;">  # 有持仓</span></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#C586C0;">            if</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;"> self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#E6E6E6;--shiki-dark-font-style:inherit;">dataclose</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#FE640B;--shiki-light-font-style:italic;--shiki-dark:#B5CEA8;--shiki-dark-font-style:inherit;">0</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">]</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;"> &lt;</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;"> self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#E6E6E6;--shiki-dark-font-style:inherit;">sma</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#FE640B;--shiki-light-font-style:italic;--shiki-dark:#B5CEA8;--shiki-dark-font-style:inherit;">0</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">]:</span><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;">  # 收盘价下穿SMA时卖出</span></span>
<span class="line"><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;">                self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">log</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">&#39;创建卖出订单, </span><span style="--shiki-light:#EA76CB;--shiki-dark:#569CD6;">%.2f</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">&#39;</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;"> %</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;"> self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#E6E6E6;--shiki-dark-font-style:inherit;">dataclose</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#FE640B;--shiki-light-font-style:italic;--shiki-dark:#B5CEA8;--shiki-dark-font-style:inherit;">0</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">])</span></span>
<span class="line"><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;">                self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">order </span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;"> self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">sell</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">()</span><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;">  # 发送卖出指令</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#569CD6;">    def</span><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;"> notify_order</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;">self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;"> order</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">):</span></span>
<span class="line"><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">        &#39;&#39;&#39; </span></span>
<span class="line"><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">            订单状态通知处理</span></span>
<span class="line"><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">        &#39;&#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#C586C0;">        if</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> order</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">status </span><span style="--shiki-light:#8839EF;--shiki-dark:#569CD6;">in</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;"> [</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">order</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">Submitted</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> order</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">Accepted</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">]:</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;">            # 订单已提交/接受，无需操作</span></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#C586C0;">            return</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;">        # 检查订单是否完成（注意：资金不足时经纪人可能拒绝）</span></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#C586C0;">        if</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> order</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">status </span><span style="--shiki-light:#8839EF;--shiki-dark:#569CD6;">in</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;"> [</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">order</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">Completed</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">]:</span></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#C586C0;">            if</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> order</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">isbuy</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">():</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;">                # 记录买入详情</span></span>
<span class="line"><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;">                self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">log</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">&#39;买入执行, 价格: </span><span style="--shiki-light:#EA76CB;--shiki-dark:#569CD6;">%.2f</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">, 成本: </span><span style="--shiki-light:#EA76CB;--shiki-dark:#569CD6;">%.2f</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">, 佣金 </span><span style="--shiki-light:#EA76CB;--shiki-dark:#569CD6;">%.2f</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">&#39;</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;"> %</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">order</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">executed</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">price</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> order</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">executed</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">value</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> order</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">executed</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">comm</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">))</span></span>
<span class="line"><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;">                self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">buyprice </span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> order</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">executed</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">price</span></span>
<span class="line"><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;">                self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">buycomm </span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> order</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">executed</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">comm</span></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#C586C0;">            else</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">:</span><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;">  # 卖出订单</span></span>
<span class="line"><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;">                self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">log</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">&#39;卖出执行, 价格: </span><span style="--shiki-light:#EA76CB;--shiki-dark:#569CD6;">%.2f</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">, 成本: </span><span style="--shiki-light:#EA76CB;--shiki-dark:#569CD6;">%.2f</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">, 佣金 </span><span style="--shiki-light:#EA76CB;--shiki-dark:#569CD6;">%.2f</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">&#39;</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;"> %</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">order</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">executed</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">price</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> order</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">executed</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">value</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> order</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">executed</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">comm</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">))</span></span>
<span class="line"><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;">            self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">bar_executed </span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#FE640B;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;"> len</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;">self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;">  # 记录订单执行时的K线位置</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#C586C0;">        elif</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> order</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">status </span><span style="--shiki-light:#8839EF;--shiki-dark:#569CD6;">in</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;"> [</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">order</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">Canceled</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> order</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">Margin</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> order</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">Rejected</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">]:</span></span>
<span class="line"><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;">            self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">log</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">&#39;订单取消/保证金不足/被拒绝&#39;</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;">        self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">order </span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#FE640B;--shiki-dark:#569CD6;"> None</span><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;">  # 重置当前订单状态</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#569CD6;">    def</span><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;"> notify_trade</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;">self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;"> trade</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">):</span></span>
<span class="line"><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">        &#39;&#39;&#39; </span></span>
<span class="line"><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">            交易结果通知（仅在交易关闭时触发）</span></span>
<span class="line"><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">        &#39;&#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#C586C0;">        if</span><span style="--shiki-light:#8839EF;--shiki-dark:#569CD6;"> not</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> trade</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">isclosed</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">:</span></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#C586C0;">            return</span></span>
<span class="line"><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;">        self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">log</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">&#39;交易利润, 毛利润 </span><span style="--shiki-light:#EA76CB;--shiki-dark:#569CD6;">%.2f</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">, 净利润 </span><span style="--shiki-light:#EA76CB;--shiki-dark:#569CD6;">%.2f</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">&#39;</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;"> %</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">trade</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">pnl</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> trade</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">pnlcomm</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">))</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#C586C0;">if</span><span style="--shiki-light:#4C4F69;--shiki-dark:#9CDCFE;"> __name__</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;"> ==</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> &#39;__main__&#39;</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">:</span></span>
<span class="line"><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">    cerebro </span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> bt</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">Cerebro</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">    cerebro</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">addstrategy</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">TestStrategy</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>交易佣金</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#4c4f69;--shiki-dark:#E6E6E6;--shiki-light-bg:#eff1f5;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes catppuccin-latte slack-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"># 0.1%</span></span>
<span class="line"><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">cerebro</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">broker</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">setcommission</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;">commission</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#FE640B;--shiki-dark:#B5CEA8;">0.001</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"># 万分之2.5</span></span>
<span class="line"><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">cerebro</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">broker</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">setcommission</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;">commission</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#FE640B;--shiki-dark:#B5CEA8;">2.5</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">/</span><span style="--shiki-light:#FE640B;--shiki-dark:#B5CEA8;">1e4</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>交易策略参数</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#4c4f69;--shiki-dark:#E6E6E6;--shiki-light-bg:#eff1f5;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes catppuccin-latte slack-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#569CD6;">class</span><span style="--shiki-light:#DF8E1D;--shiki-light-font-style:italic;--shiki-dark:#4EC9B0;--shiki-dark-font-style:inherit;"> TestStrategy</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#DF8E1D;--shiki-light-font-style:italic;--shiki-dark:#4EC9B0;--shiki-dark-font-style:inherit;">bt</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#DF8E1D;--shiki-light-font-style:italic;--shiki-dark:#4EC9B0;--shiki-dark-font-style:inherit;">Strategy</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">):</span></span>
<span class="line"><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">    params </span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;"> (</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">        (</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">&#39;myparam&#39;</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FE640B;--shiki-dark:#B5CEA8;"> 27</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">),</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">        (</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">&#39;sma_period&#39;</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FE640B;--shiki-dark:#B5CEA8;"> 15</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">),</span><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;">  # 可调整参数：移动平均周期（默认15）</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">    )</span></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#569CD6;">    def</span><span style="--shiki-light:#04A5E5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;"> __init__</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;">self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">):</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;">        # 简单移动平均线（SMA）</span></span>
<span class="line"><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;">        self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">sma </span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> bt</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">indicators</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">SimpleMovingAverage</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;">self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#E6E6E6;--shiki-dark-font-style:inherit;">datas</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#FE640B;--shiki-light-font-style:italic;--shiki-dark:#B5CEA8;--shiki-dark-font-style:inherit;">0</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">],</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;"> period</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;">self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">params</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">sma_period</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">cerebro</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">addstrategy</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">TestStrategy</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;"> sma_period</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#FE640B;--shiki-dark:#B5CEA8;">20</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;"> myparam</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#FE640B;--shiki-dark:#B5CEA8;">123456</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"> # 修改参数</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>交易策略参数优化</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#4c4f69;--shiki-dark:#E6E6E6;--shiki-light-bg:#eff1f5;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes catppuccin-latte slack-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#569CD6;">class</span><span style="--shiki-light:#DF8E1D;--shiki-light-font-style:italic;--shiki-dark:#4EC9B0;--shiki-dark-font-style:inherit;"> TestStrategy</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#DF8E1D;--shiki-light-font-style:italic;--shiki-dark:#4EC9B0;--shiki-dark-font-style:inherit;">bt</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#DF8E1D;--shiki-light-font-style:italic;--shiki-dark:#4EC9B0;--shiki-dark-font-style:inherit;">Strategy</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">):</span></span>
<span class="line"><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">    params </span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;"> (</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">        (</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">&#39;sma_period&#39;</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FE640B;--shiki-dark:#B5CEA8;"> 15</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">),</span><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;">  # 可调整参数：移动平均周期（默认15）</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">        (</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">&#39;opt_strategy&#39;</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FE640B;--shiki-dark:#569CD6;">True</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">    )</span></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#569CD6;">    def</span><span style="--shiki-light:#04A5E5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;"> __init__</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;">self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">):</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;">        # 简单移动平均线（SMA）</span></span>
<span class="line"><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;">        self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">sma </span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> bt</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">indicators</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">SimpleMovingAverage</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;">self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#E6E6E6;--shiki-dark-font-style:inherit;">datas</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#FE640B;--shiki-light-font-style:italic;--shiki-dark:#B5CEA8;--shiki-dark-font-style:inherit;">0</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">],</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;"> period</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;">self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">params</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">sma_period</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#569CD6;">    def</span><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;"> stop</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;">self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">):</span></span>
<span class="line"><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;">        self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">log</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">&#39;SMA周期:</span><span style="--shiki-light:#EA76CB;--shiki-dark:#569CD6;">%2d</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">, 最周投资组合价值: </span><span style="--shiki-light:#EA76CB;--shiki-dark:#569CD6;">%.2f</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> &#39;</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;"> %</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;">self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">params</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">sma_period</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;"> self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">broker</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">getvalue</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">()),</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;"> opt_log</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#FE640B;--shiki-dark:#569CD6;">True</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">        </span></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#569CD6;">    def</span><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;"> log</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;">self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;"> txt</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;"> dt</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#FE640B;--shiki-dark:#569CD6;">None</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;"> opt_log</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#FE640B;--shiki-dark:#569CD6;">False</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">):</span></span>
<span class="line"><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">        &#39;&#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">            策略的日志记录函数</span></span>
<span class="line"><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">        &#39;&#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#C586C0;">        if</span><span style="--shiki-light:#8839EF;--shiki-dark:#569CD6;"> not</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;"> self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">params</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">opt_strategy </span><span style="--shiki-light:#8839EF;--shiki-dark:#569CD6;">or</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> opt_log</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">:</span></span>
<span class="line"><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">            dt </span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> dt </span><span style="--shiki-light:#8839EF;--shiki-dark:#569CD6;">or</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#569CD6;--shiki-dark-font-style:inherit;"> self</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#E6E6E6;--shiki-dark-font-style:inherit;">datas</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#FE640B;--shiki-light-font-style:italic;--shiki-dark:#B5CEA8;--shiki-dark-font-style:inherit;">0</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">].</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">datetime</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">date</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#FE640B;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> </span></span>
<span class="line"><span style="--shiki-light:#FE640B;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">            print</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">&#39;</span><span style="--shiki-light:#EA76CB;--shiki-dark:#569CD6;">%s</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">, </span><span style="--shiki-light:#EA76CB;--shiki-dark:#569CD6;">%s</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">&#39;</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;"> %</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">dt</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">isoformat</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(),</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> txt</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">))</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">cerebro</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#1E66F5;--shiki-dark:#E6E6E6;">optstrategy</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">TestStrategy</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#E64553;--shiki-light-font-style:italic;--shiki-dark:#9CDCFE;--shiki-dark-font-style:inherit;"> sma_period</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#FE640B;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">range</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#FE640B;--shiki-dark:#B5CEA8;">5</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FE640B;--shiki-dark:#B5CEA8;"> 30</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">))</span><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"> # 优化参数</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,22)]))}const p=s(n,[["render",l]]),E=JSON.parse('{"path":"/%E4%BA%A4%E6%98%93/BackTrader%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","title":"","lang":"zh-CN","frontmatter":{"description":"backtrader学习笔记 安装环境 quickstart 基本写法 设置现金 添加数据 指标 创建策略 为策略添加买入卖出逻辑/管理订单状态 交易佣金 交易策略参数 交易策略参数优化","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-08-12T09:58:07.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"丁毅桂\\",\\"email\\":\\"2449695354@qq.com\\"}]}"],["meta",{"property":"og:url","content":"https://dingdingdang.online/%E4%BA%A4%E6%98%93/BackTrader%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"}],["meta",{"property":"og:site_name","content":"YiguiDing的Blog小站"}],["meta",{"property":"og:description","content":"backtrader学习笔记 安装环境 quickstart 基本写法 设置现金 添加数据 指标 创建策略 为策略添加买入卖出逻辑/管理订单状态 交易佣金 交易策略参数 交易策略参数优化"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-08-12T09:58:07.000Z"}],["meta",{"property":"article:modified_time","content":"2025-08-12T09:58:07.000Z"}],["meta",{"name":"baidu-site-verification","content":"codeva-PwE9Ts6nMl"}]]},"git":{"createdTime":1754992687000,"updatedTime":1754992687000,"contributors":[{"name":"YiguiDing","username":"YiguiDing","email":"2449695354@qq.com","commits":1,"url":"https://github.com/YiguiDing"}]},"readingTime":{"minutes":3.02,"words":905},"filePathRelative":"交易/BackTrader学习笔记/index.md","excerpt":"","autoDesc":true}');export{p as comp,E as data};
