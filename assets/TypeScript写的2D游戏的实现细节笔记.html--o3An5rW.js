import{_ as i,r as o,o as u,c as k,a as n,e as a,w as e,d as s,b as t}from"./app-CX2ta7kB.js";const r="/assets/TypeScript写的2D游戏的实现细节笔记-D27SzjIn.gif",d={},m=t('<h1 id="_1-typescript写的2d游戏的实现细节笔记" tabindex="-1"><a class="header-anchor" href="#_1-typescript写的2d游戏的实现细节笔记"><span>1. TypeScript写的2D游戏的实现细节笔记</span></a></h1><p><img src="'+r+'" alt=""></p><h2 id="_1-1-试玩版本" tabindex="-1"><a class="header-anchor" href="#_1-1-试玩版本"><span>1.1. 试玩版本</span></a></h2>',3),v=n("p",null,"URL 地址：",-1),b=n("h2",{id:"_1-2-源代码",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_1-2-源代码"},[n("span",null,"1.2. 源代码")])],-1),y=n("p",null,"源代码:",-1),w={href:"https://github.com/YiguiDing/shadowDog-Typescript",target:"_blank",rel:"noopener noreferrer"},h=t('<h2 id="_1-3-修改记录" tabindex="-1"><a class="header-anchor" href="#_1-3-修改记录"><span>1.3. 修改记录</span></a></h2><blockquote><ul><li><code>0.0.1</code>: 第一版</li><li><code>0.0.2</code>: 压缩游戏音乐，优化加载速度，修改粒子特效移动速度和透明度的衰减方式</li></ul></blockquote><blockquote><p><strong>操作</strong>：</p><ul><li><code>Enter</code> 键开始游戏</li><li><code>ESC</code> 键暂停游戏</li><li><code>Space</code> 键继续游戏</li><li><code>方向键上下左右</code>控制人物 跳、蹲、俯冲、前后移动</li><li>玩家在<strong>跳起后</strong><code>在空中时</code>按下<code>Space</code>键可释放人物技能</li><li>释放技能的<strong>过程中</strong>按下方向键<code>↓</code>可实现俯冲</li><li>人物在<strong>地面时</strong>按下方向键<code>↓</code>可蹲下</li><li><strong>蹲下后</strong>按下方向键<code>→</code> 会有音效</li></ul></blockquote><h2 id="_1-4-typescript写的2d游戏的实现细节笔记" tabindex="-1"><a class="header-anchor" href="#_1-4-typescript写的2d游戏的实现细节笔记"><span>1.4. TypeScript写的2D游戏的实现细节笔记</span></a></h2><h3 id="_1-4-1-笔记目录" tabindex="-1"><a class="header-anchor" href="#_1-4-1-笔记目录"><span>1.4.1. 笔记目录</span></a></h3><ul><li><a href="#1-typescript%E5%86%99%E7%9A%842d%E6%B8%B8%E6%88%8F%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82%E7%AC%94%E8%AE%B0">1. TypeScript写的2D游戏的实现细节笔记</a><ul><li><a href="#11-%E8%AF%95%E7%8E%A9%E7%89%88%E6%9C%AC">1.1. 试玩版本</a></li><li><a href="#12-%E6%BA%90%E4%BB%A3%E7%A0%81">1.2. 源代码</a></li><li><a href="#13-%E4%BF%AE%E6%94%B9%E8%AE%B0%E5%BD%95">1.3. 修改记录</a></li><li><a href="#14-typescript%E5%86%99%E7%9A%842d%E6%B8%B8%E6%88%8F%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82%E7%AC%94%E8%AE%B0">1.4. TypeScript写的2D游戏的实现细节笔记</a><ul><li><a href="#141-%E7%AC%94%E8%AE%B0%E7%9B%AE%E5%BD%95">1.4.1. 笔记目录</a></li><li><a href="#142-canvas-%E7%BB%98%E5%9B%BE%E5%9F%BA%E6%9C%AC%E6%AD%A5%E9%AA%A4">1.4.2. Canvas 绘图基本步骤</a><ul><li><a href="#1421-%E5%8E%9F%E7%90%86">1.4.2.1. 原理</a></li><li><a href="#1422-%E4%BC%98%E5%8C%96%E5%8F%8A%E6%B8%B2%E6%9F%93%E6%89%80%E6%9C%89%E5%8A%A8%E5%9B%BE">1.4.2.2. 优化及渲染所有动图</a></li><li><a href="#1423-%E5%B0%81%E8%A3%85%E5%92%8C%E6%8A%BD%E8%B1%A1">1.4.2.3. 封装和抽象</a></li><li><a href="#1424-%E5%AF%B9%E5%8A%A8%E7%94%BB%E5%AF%B9%E8%B1%A1-animater-%E7%9A%84%E5%B0%81%E8%A3%85">1.4.2.4. 对动画对象 Animater 的封装</a></li><li><a href="#1425-%E7%BB%A7%E7%BB%AD%E5%AE%9A%E4%B9%89%E4%B8%80%E4%BA%9B%E5%88%97%E6%8E%A5%E5%8F%A3%E5%B9%B6%E5%AE%9A%E4%B9%89-animal-%E7%B1%BB">1.4.2.5. 继续定义一些列接口并定义 Animal 类</a></li><li><a href="#1426-%E4%BD%BF%E7%94%A8">1.4.2.6. 使用</a></li></ul></li><li><a href="#143-%E6%95%8C%E4%BA%BA%E7%9A%84%E7%A7%BB%E5%8A%A8%E6%A8%A1%E5%BC%8F">1.4.3. 敌人的移动模式</a><ul><li><a href="#1431-%E5%8E%9F%E5%9C%B0%E9%9D%99%E6%AD%A2%E7%9A%84%E7%89%A9%E4%BD%93">1.4.3.1. 原地静止的物体</a></li><li><a href="#1432-%E6%B0%B4%E5%B9%B3%E7%9B%B4%E7%BA%BF%E8%BF%90%E5%8A%A8%E7%9A%84%E8%A0%95%E8%99%AB">1.4.3.2. 水平直线运动的蠕虫</a></li><li><a href="#1433-%E4%B8%8A%E4%B8%8B%E6%91%86%E5%8A%A8%E7%9A%84%E8%9D%99%E8%9D%A0">1.4.3.3. 上下摆动的蝙蝠</a></li><li><a href="#1434-%E9%9A%8F%E6%9C%BA%E6%97%A0%E8%A7%84%E5%BE%8B%E7%A7%BB%E5%8A%A8%E7%9A%84%E9%BD%BF%E8%BD%AE">1.4.3.4. 随机无规律移动的齿轮</a></li></ul></li><li><a href="#144-%E8%A7%86%E5%B7%AE%E8%83%8C%E6%99%AF%E5%8E%9F%E7%90%86">1.4.4. 视差背景原理</a><ul><li><a href="#1441-%E6%97%A0%E9%99%90%E6%BB%9A%E5%8A%A8%E7%9A%84%E8%83%8C%E6%99%AF%E5%8E%9F%E7%90%86">1.4.4.1. 无限滚动的背景原理</a></li><li><a href="#1442-%E8%A7%86%E5%B7%AE%E8%83%8C%E6%99%AF%E7%9A%84%E5%AE%9E%E7%8E%B0">1.4.4.2. 视差背景的实现</a></li><li><a href="#1443-%E6%9C%80%E7%BB%88%E7%9A%84%E6%8A%BD%E8%B1%A1%E5%B0%81%E8%A3%85%E5%AE%9E%E7%8E%B0">1.4.4.3. 最终的抽象、封装、实现</a></li><li><a href="#1444-%E4%BD%BF%E7%94%A8%E5%B0%81%E8%A3%85%E5%A5%BD%E7%9A%84%E7%B1%BB%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E8%A7%86%E5%B7%AE%E8%83%8C%E6%99%AF">1.4.4.4. 使用封装好的类实现一个视差背景</a></li></ul></li><li><a href="#145-%E7%A2%B0%E6%92%9E%E6%A3%80%E6%B5%8B">1.4.5. 碰撞检测</a><ul><li><a href="#1451-%E7%9F%A9%E5%BD%A2%E7%A2%B0%E6%92%9E%E6%A3%80%E6%B5%8B">1.4.5.1. 矩形碰撞检测</a></li><li><a href="#1452-%E5%9C%86%E5%BD%A2%E7%A2%B0%E6%92%9E%E6%A3%80%E6%B5%8B">1.4.5.2. 圆形碰撞检测</a></li><li><a href="#1453-%E5%83%8F%E7%B4%A0%E7%A2%B0%E6%92%9E%E6%A3%80%E6%B5%8B">1.4.5.3. 像素碰撞检测</a></li></ul></li><li><a href="#146-%E7%B2%92%E5%AD%90%E7%89%B9%E6%95%88">1.4.6. 粒子特效</a><ul><li><a href="#1461-%E5%AE%9A%E4%B9%89-particle-%E6%8A%BD%E8%B1%A1%E7%B1%BB">1.4.6.1. 定义 Particle 抽象类</a></li><li><a href="#1462-%E7%81%B0%E5%B0%98%E5%BD%B1%E5%AD%90%E7%9A%84%E5%AE%9E%E7%8E%B0">1.4.6.2. 灰尘影子的实现</a></li><li><a href="#1463-%E7%81%AB%E7%84%B0%E7%B2%92%E5%AD%90%E7%89%B9%E6%95%88">1.4.6.3. 火焰粒子特效</a></li><li><a href="#1464-%E8%90%BD%E5%9C%B0%E7%9A%84%E7%88%86%E7%82%B8%E7%81%AB%E8%8A%B1%E7%B2%92%E5%AD%90%E7%89%B9%E6%95%88">1.4.6.4. 落地的爆炸火花粒子特效</a></li><li><a href="#1465-%E7%88%86%E7%82%B8%E7%9A%84%E7%83%9F%E9%9B%BE%E7%B2%92%E5%AD%90%E7%89%B9%E6%95%88">1.4.6.5. 爆炸的烟雾粒子特效</a></li></ul></li><li><a href="#147-%E8%BE%93%E5%85%A5%E7%9B%91%E5%90%AC%E5%92%8C%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E7%9A%84%E5%AE%9E%E7%8E%B0">1.4.7. 输入监听和状态管理的实现</a><ul><li><a href="#1471-%E8%BE%93%E5%85%A5%E7%9B%91%E5%90%AC">1.4.7.1. 输入监听</a></li><li><a href="#1472-%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86">1.4.7.2. 状态管理</a></li><li><a href="#1473-%E4%BD%BF%E7%94%A8%E7%8A%B6%E6%80%81%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86-player-%E7%B1%BB%E7%9A%84%E9%83%A8%E5%88%86%E4%BB%A3%E7%A0%81">1.4.7.3. 使用状态设计模式实现状态管理 Player 类的部分代码</a></li><li><a href="#1474-%E4%BD%BF%E7%94%A8%E7%8A%B6%E6%80%81%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86-game-%E7%B1%BB%E7%9A%84%E9%83%A8%E5%88%86%E4%BB%A3%E7%A0%81">1.4.7.4. 使用状态设计模式实现状态管理 Game 类的部分代码</a></li></ul></li><li><a href="#148-scene-%E5%9C%BA%E6%99%AF">1.4.8. Scene 场景</a></li><li><a href="#149-ui">1.4.9. UI</a></li><li><a href="#1410-%E5%AD%97%E4%BD%93">1.4.10. 字体</a></li><li><a href="#1411-canvas-%E9%93%BA%E6%BB%A1%E9%A1%B5%E9%9D%A2%E5%B1%8F%E5%B9%95%E7%9A%84%E5%AE%9E%E7%8E%B0">1.4.11. Canvas 铺满页面屏幕的实现</a></li><li><a href="#1412-%E8%87%AA%E5%86%99%E5%B7%A5%E5%85%B7%E7%B1%BB">1.4.12. 自写工具类</a></li></ul></li></ul></li></ul><h3 id="_1-4-2-canvas-绘图基本步骤" tabindex="-1"><a class="header-anchor" href="#_1-4-2-canvas-绘图基本步骤"><span>1.4.2. Canvas 绘图基本步骤</span></a></h3><h4 id="_1-4-2-1-原理" tabindex="-1"><a class="header-anchor" href="#_1-4-2-1-原理"><span>1.4.2.1. 原理</span></a></h4>',8),g=t(`<div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">var</span> myCanvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#myCanvas&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> HTMLCanvasElement<span class="token punctuation">;</span>
<span class="token comment">// 获取2d的上下文环境对象，该对象包含画笔设置和一些方法</span>
<span class="token keyword">var</span> ctx <span class="token operator">=</span> myCanvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;2d&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> CanvasRenderingContext2D<span class="token punctuation">;</span>

<span class="token comment">// canvas的默认大小为300x150px 需手动修改</span>
<span class="token keyword">const</span> <span class="token constant">CANVAS_WIDTH</span> <span class="token operator">=</span> <span class="token punctuation">(</span>myCanvas<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">CANVAS_HEIGHT</span> <span class="token operator">=</span> <span class="token punctuation">(</span>myCanvas<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 单帧宽高</span>
<span class="token keyword">const</span> Sprite_WIDTH <span class="token operator">=</span> <span class="token number">575</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Sprite_HEIGHT <span class="token operator">=</span> <span class="token number">523</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> imgPlayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// image对象类型为 HTMLImageElement 可以附加到dom中</span>
imgPlayer<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;./shadow_dog.png&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> frameX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> frameY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> frameCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 第几帧</span>
<span class="token keyword">let</span> stageFrame <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 交错帧，每隔5帧 切换图片</span>

<span class="token keyword">function</span> <span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 计算当前要绘制的帧的index</span>
  frameCount <span class="token operator">=</span> <span class="token operator">++</span>frameCount <span class="token operator">%</span> stageFrame<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>frameCount<span class="token punctuation">)</span> frameX <span class="token operator">=</span> <span class="token operator">++</span>frameX <span class="token operator">%</span> <span class="token number">7</span><span class="token punctuation">;</span>

  <span class="token comment">//清除上一次绘图痕迹</span>
  ctx<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">CANVAS_WIDTH</span><span class="token punctuation">,</span> <span class="token constant">CANVAS_HEIGHT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>
    imgPlayer<span class="token punctuation">,</span> <span class="token comment">// img</span>
    frameX <span class="token operator">*</span> Sprite_WIDTH<span class="token punctuation">,</span> <span class="token comment">//源坐标x</span>
    frameY <span class="token operator">*</span> Sprite_HEIGHT<span class="token punctuation">,</span> <span class="token comment">//源坐标y</span>
    Sprite_WIDTH<span class="token punctuation">,</span> <span class="token comment">//源图像宽</span>
    Sprite_HEIGHT<span class="token punctuation">,</span> <span class="token comment">//源图像高</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 目的坐标x</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 目的坐标y</span>
    <span class="token constant">CANVAS_WIDTH</span><span class="token punctuation">,</span> <span class="token comment">// 绘制宽度w</span>
    <span class="token constant">CANVAS_HEIGHT</span> <span class="token comment">// 绘制高度h</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// requestAnimationFrame原理上相当于60fps的setInterval</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>animate<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-4-2-2-优化及渲染所有动图" tabindex="-1"><a class="header-anchor" href="#_1-4-2-2-优化及渲染所有动图"><span>1.4.2.2. 优化及渲染所有动图</span></a></h4>`,2),f=n("div",{class:"language-html line-numbers-mode","data-ext":"html","data-title":"html"},[n("pre",{class:"language-html"},[n("code",null,[n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("canvas")]),s(),n("span",{class:"token attr-name"},"id"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("myCanvas_2j0923ru48"),n("span",{class:"token punctuation"},'"')]),n("span",{class:"token punctuation"},">")]),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("canvas")]),n("span",{class:"token punctuation"},">")]),s(`
`),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("div")]),s(),n("span",{class:"token attr-name"},"class"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("animation-box"),n("span",{class:"token punctuation"},'"')]),n("span",{class:"token punctuation"},">")]),s(`
  `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("label")]),s(),n("span",{class:"token attr-name"},"for"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("animations"),n("span",{class:"token punctuation"},'"')]),n("span",{class:"token punctuation"},">")]),s("select animation:"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("label")]),n("span",{class:"token punctuation"},">")]),s(`
  `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("select")]),s(),n("span",{class:"token attr-name"},"name"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),n("span",{class:"token punctuation"},'"')]),s(),n("span",{class:"token attr-name"},"id"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("animations_djf9498"),n("span",{class:"token punctuation"},'"')]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("option")]),s(),n("span",{class:"token attr-name"},"value"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("idle"),n("span",{class:"token punctuation"},'"')]),n("span",{class:"token punctuation"},">")]),s("idle"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("option")]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("option")]),s(),n("span",{class:"token attr-name"},"value"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("jump"),n("span",{class:"token punctuation"},'"')]),n("span",{class:"token punctuation"},">")]),s("jump"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("option")]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("option")]),s(),n("span",{class:"token attr-name"},"value"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("fall"),n("span",{class:"token punctuation"},'"')]),n("span",{class:"token punctuation"},">")]),s("fall"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("option")]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("option")]),s(),n("span",{class:"token attr-name"},"value"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("run"),n("span",{class:"token punctuation"},'"')]),n("span",{class:"token punctuation"},">")]),s("run"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("option")]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("option")]),s(),n("span",{class:"token attr-name"},"value"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("dizzy"),n("span",{class:"token punctuation"},'"')]),n("span",{class:"token punctuation"},">")]),s("dizzy"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("option")]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("option")]),s(),n("span",{class:"token attr-name"},"value"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("sit"),n("span",{class:"token punctuation"},'"')]),n("span",{class:"token punctuation"},">")]),s("sit"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("option")]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("option")]),s(),n("span",{class:"token attr-name"},"value"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("roll"),n("span",{class:"token punctuation"},'"')]),n("span",{class:"token punctuation"},">")]),s("roll"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("option")]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("option")]),s(),n("span",{class:"token attr-name"},"value"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("bite"),n("span",{class:"token punctuation"},'"')]),n("span",{class:"token punctuation"},">")]),s("bite"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("option")]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("option")]),s(),n("span",{class:"token attr-name"},"value"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("ko"),n("span",{class:"token punctuation"},'"')]),n("span",{class:"token punctuation"},">")]),s("ko"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("option")]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("option")]),s(),n("span",{class:"token attr-name"},"value"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("gethit"),n("span",{class:"token punctuation"},'"')]),n("span",{class:"token punctuation"},">")]),s("gethit"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("option")]),n("span",{class:"token punctuation"},">")]),s(`
  `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("select")]),n("span",{class:"token punctuation"},">")]),s(`
`),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("div")]),n("span",{class:"token punctuation"},">")]),s(`
`),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("img")]),s(),n("span",{class:"token attr-name"},"src"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("./images/shadow_dog.png"),n("span",{class:"token punctuation"},'"')]),s(),n("span",{class:"token punctuation"},"/>")]),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),E=n("div",{class:"language-javascript line-numbers-mode","data-ext":"js","data-title":"js"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"var"),s(" myCanvas "),n("span",{class:"token operator"},"="),s(" document"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"querySelector"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"#myCanvas_2j0923ru48"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"var"),s(" ctx "),n("span",{class:"token operator"},"="),s(" myCanvas"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getContext"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"2d"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 获取2d的上下文环境对象，该对象包含画笔设置和一些方法"),s(`
`),n("span",{class:"token comment"},"// canvas的默认大小为300x150px 需手动修改"),s(`
`),n("span",{class:"token keyword"},"var"),s(),n("span",{class:"token constant"},"CANVAS_WIDTH"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),s("myCanvas"),n("span",{class:"token punctuation"},"."),s("width "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"250"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"var"),s(),n("span",{class:"token constant"},"CANVAS_HEIGHT"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),s("myCanvas"),n("span",{class:"token punctuation"},"."),s("height "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"250"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"var"),s(" Sprite_WIDTH "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"575"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"var"),s(" Sprite_HEIGHT "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"523"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"var"),s(" imgPlayer "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Image"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// image对象类型为 HTMLImageElement 可以附加到dom中"),s(`
imgPlayer`),n("span",{class:"token punctuation"},"."),s("src "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"./images/shadow_dog.png"'),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"var"),s(" playerState "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"idle"'),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"var"),s(" selector "),n("span",{class:"token operator"},"="),s(" document"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"querySelector"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"#animations_djf9498"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
selector`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"addEventListener"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"change"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  playerState `),n("span",{class:"token operator"},"="),s(" selector"),n("span",{class:"token punctuation"},"."),s("value"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"var"),s(" animations "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token literal-property property"},"idle"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"rows"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token literal-property property"},"cols"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"7"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token literal-property property"},"jump"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"rows"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token literal-property property"},"cols"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"7"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token literal-property property"},"fall"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"rows"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token literal-property property"},"cols"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"7"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token literal-property property"},"run"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"rows"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token literal-property property"},"cols"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"9"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token literal-property property"},"dizzy"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"rows"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"4"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token literal-property property"},"cols"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"11"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token literal-property property"},"sit"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"rows"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"5"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token literal-property property"},"cols"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"5"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token literal-property property"},"roll"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"rows"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"6"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token literal-property property"},"cols"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"7"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token literal-property property"},"bite"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"rows"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"7"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token literal-property property"},"cols"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"7"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token literal-property property"},"ko"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"rows"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"8"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token literal-property property"},"cols"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"12"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token literal-property property"},"gethit"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"rows"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"9"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token literal-property property"},"cols"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"4"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"var"),s(" animaIndex "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 动画索引"),s(`
`),n("span",{class:"token keyword"},"var"),s(" frameIndex "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 帧索引"),s(`
`),n("span",{class:"token keyword"},"var"),s(" frameCount "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 总的帧数"),s(`
`),n("span",{class:"token keyword"},"var"),s(" stageFrame "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"5"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 交错帧，每隔5帧 切换关键帧"),s(`
`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"animate"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  frameIndex `),n("span",{class:"token operator"},"="),s(`
    Math`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"floor"),n("span",{class:"token punctuation"},"("),s("frameCount"),n("span",{class:"token operator"},"++"),s(),n("span",{class:"token operator"},"/"),s(" stageFrame"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"%"),s(" animations"),n("span",{class:"token punctuation"},"["),s("playerState"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("cols"),n("span",{class:"token punctuation"},";"),s(`
  animaIndex `),n("span",{class:"token operator"},"="),s(" animations"),n("span",{class:"token punctuation"},"["),s("playerState"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("rows"),n("span",{class:"token punctuation"},";"),s(`
  ctx`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"clearRect"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token constant"},"CANVAS_WIDTH"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token constant"},"CANVAS_HEIGHT"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  ctx`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"drawImage"),n("span",{class:"token punctuation"},"("),s(`
    imgPlayer`),n("span",{class:"token punctuation"},","),s(`
    frameIndex `),n("span",{class:"token operator"},"*"),s(" Sprite_WIDTH"),n("span",{class:"token punctuation"},","),s(`
    animaIndex `),n("span",{class:"token operator"},"*"),s(" Sprite_HEIGHT"),n("span",{class:"token punctuation"},","),s(`
    Sprite_WIDTH`),n("span",{class:"token punctuation"},","),s(`
    Sprite_HEIGHT`),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token constant"},"CANVAS_WIDTH"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token constant"},"CANVAS_HEIGHT"),s(`
  `),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token comment"},"// requestAnimationFrame效果上相当于60fps的setInterval"),s(`
  `),n("span",{class:"token function"},"requestAnimationFrame"),n("span",{class:"token punctuation"},"("),s("animate"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token function"},"animate"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),A=t(`<h4 id="_1-4-2-3-封装和抽象" tabindex="-1"><a class="header-anchor" href="#_1-4-2-3-封装和抽象"><span>1.4.2.3. 封装和抽象</span></a></h4><h4 id="_1-4-2-4-对动画对象-animater-的封装" tabindex="-1"><a class="header-anchor" href="#_1-4-2-4-对动画对象-animater-的封装"><span>1.4.2.4. 对动画对象 Animater 的封装</span></a></h4><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> RandomRange <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./utils.js&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 动画对象</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Animater</span> <span class="token punctuation">{</span>
  posX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 位置x</span>
  posY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 位置y</span>
  drawWidth<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> <span class="token comment">// 实际绘制的宽度</span>
  drawHeight<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> <span class="token comment">// 实际绘制的高度</span>
  img<span class="token operator">:</span> HTMLImageElement<span class="token punctuation">;</span> <span class="token comment">// 图片</span>
  imgFrameWidth<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> <span class="token comment">// 一帧的宽度</span>
  imgFrameHeight<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> <span class="token comment">// 一帧的高度</span>
  animateFramesTotal<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// [动画1的总帧数,动画2的总帧数,动画3的...]</span>
  animateNameIndexMap<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// 数据结构：{动画名称:该动画是第几个动画}</span>
  animateFrameIndexX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 当前绘制的是第几帧</span>
  animateFrameIndexY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 当前绘制的是第几个动画</span>
  animateFrameTimer <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> _animateFrameFps <span class="token operator">=</span> <span class="token number">60</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> animateFrameChangeInterval <span class="token operator">=</span> <span class="token number">1000</span> <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">get</span> <span class="token function">animateFrameFps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_animateFrameFps<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">private</span> <span class="token keyword">set</span> <span class="token function">animateFrameFps</span><span class="token punctuation">(</span>fps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_animateFrameFps <span class="token operator">=</span> fps<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>animateFrameChangeInterval <span class="token operator">=</span> <span class="token number">1000</span> <span class="token operator">/</span> fps<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token function">setFps</span><span class="token punctuation">(</span>fps<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>animateFrameFps <span class="token operator">=</span> fps<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  stopAnimateAtLastFlag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  RewindAnimateFrameFlag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>
    imgSrc<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    imgFrameWidth<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    imgFrameHeight<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    size<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    animateFramesTotal<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    animateNameIndexMap<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>img<span class="token punctuation">.</span>src <span class="token operator">=</span> imgSrc<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>animateFramesTotal <span class="token operator">=</span> animateFramesTotal<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>animateNameIndexMap <span class="token operator">=</span> animateNameIndexMap<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>imgFrameWidth <span class="token operator">=</span> imgFrameWidth<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>imgFrameHeight <span class="token operator">=</span> imgFrameHeight<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>drawWidth <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imgFrameWidth <span class="token operator">*</span> size<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>drawHeight <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imgFrameHeight <span class="token operator">*</span> size<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFps</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 更新数据</span>
  <span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// 最后一帧则停止切换帧</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>stopAnimateAtLastFlag <span class="token operator">==</span> <span class="token boolean">true</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isLastAnimateFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token comment">// 计算下一帧</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>animateFrameTimer <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animateFrameChangeInterval<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>animateFrameTimer <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>animateFrameIndexX <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>animateFrameIndexX <span class="token operator">%=</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>animateFramesTotal<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>animateFrameIndexY<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animateFrameTimer <span class="token operator">+=</span> timeInterval<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 绘制帧</span>
  <span class="token function">draw</span><span class="token punctuation">(</span>Context2D<span class="token operator">:</span> CanvasRenderingContext2D<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    Context2D<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>img<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>animateFrameIndexX <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imgFrameWidth<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>animateFrameIndexY <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imgFrameHeight<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>imgFrameWidth<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>imgFrameHeight<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>posX<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>posY<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>drawWidth<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>drawHeight
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">changeAnimateByName</span><span class="token punctuation">(</span>animateName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 根据名称切换动画</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>animateNameIndexMap<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>animateName<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>animateFrameIndexY <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animateNameIndexMap<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>animateName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">animateName:&#39;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>animateName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&#39; is not exist.</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 判断是否为最后一帧</span>
  <span class="token function">isLastAnimateFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>animateFrameIndexX <span class="token operator">==</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>animateFramesTotal<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>animateFrameIndexY<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 判断是否为第一帧</span>
  <span class="token function">isFirstAnimateFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animateFrameIndexX <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 初始化状态</span>
  <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>animateFrameIndexX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 设置从第一帧开始</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 请求在渲染到最后一帧的时候停止更新动画</span>
  <span class="token function">requestStopAnimateFrameAtLastFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>stopAnimateAtLastFlag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">isOutOfLeftScreem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>posX <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawWidth <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-4-2-5-继续定义一些列接口并定义-animal-类" tabindex="-1"><a class="header-anchor" href="#_1-4-2-5-继续定义一些列接口并定义-animal-类"><span>1.4.2.5. 继续定义一些列接口并定义 Animal 类</span></a></h4><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Animater <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./Animater.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> transformAble <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./transformAble.js&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 可移动的</span>
<span class="token keyword">interface</span> <span class="token class-name">MoveAble</span> <span class="token punctuation">{</span>
  moveSpeedX<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> <span class="token comment">// x轴移动速度 单位：像素/毫秒</span>
  moveSpeedY<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> <span class="token comment">// x轴移动速度 单位：像素/毫秒</span>
  <span class="token function">move</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span> <span class="token comment">// 移动</span>
<span class="token punctuation">}</span>
<span class="token comment">// 活的</span>
<span class="token keyword">interface</span> <span class="token class-name">AliveAble</span> <span class="token punctuation">{</span>
  aliveFlag<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  <span class="token function">getAliveFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span> <span class="token comment">// 用于判断是否存活</span>
  <span class="token function">setAliveFlag</span><span class="token punctuation">(</span>newVal<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 圆形碰撞检测</span>
<span class="token keyword">interface</span> <span class="token class-name">CollisionCheckAble</span> <span class="token punctuation">{</span>
  collisionCheckPosX<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  collisionCheckPosY<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  collisionCheckWidth<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  collisionCheckHeight<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  collisionCheckRadius<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token function">collisionCheckUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token function">isCollision</span><span class="token punctuation">(</span>obj<span class="token operator">:</span> CollisionCheckAble<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span> <span class="token comment">// 碰撞检测</span>
<span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">NameAble</span> <span class="token punctuation">{</span>
  Name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 抽象类 Animal 继承动画类 实现Moveable AliveAble 接口</span>
<span class="token keyword">export</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Animal</span>
  <span class="token keyword">extends</span> <span class="token class-name">Animater</span>
  <span class="token keyword">implements</span> <span class="token class-name">MoveAble</span><span class="token punctuation">,</span> AliveAble<span class="token punctuation">,</span> CollisionCheckAble<span class="token punctuation">,</span> NameAble<span class="token punctuation">,</span> transformAble
<span class="token punctuation">{</span>
  <span class="token comment">// 移动</span>
  moveSpeedX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  moveSpeedY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">abstract</span> <span class="token function">move</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token comment">// 存活</span>
  aliveFlag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token function">setAliveFlag</span><span class="token punctuation">(</span>newVal<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>aliveFlag <span class="token operator">=</span> newVal<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">getAliveFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>aliveFlag<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 可碰撞检测</span>
  collisionCheckPosX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  collisionCheckPosY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  collisionCheckWidth <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  collisionCheckHeight <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  collisionCheckRadius <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token function">collisionCheckUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// 圆形碰撞检测</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>collisionCheckPosX <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>posX <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>collisionCheckPosY <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>posY <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>collisionCheckRadius <span class="token operator">=</span>
      <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawWidth<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawHeight<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.8</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">isCollision</span><span class="token punctuation">(</span>obj<span class="token operator">:</span> CollisionCheckAble<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">collisionCheckUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    obj<span class="token punctuation">.</span><span class="token function">collisionCheckUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> dX <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>collisionCheckPosX <span class="token operator">-</span> obj<span class="token punctuation">.</span>collisionCheckPosX<span class="token punctuation">;</span>
    <span class="token keyword">const</span> dY <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>collisionCheckPosY <span class="token operator">-</span> obj<span class="token punctuation">.</span>collisionCheckPosY<span class="token punctuation">;</span>
    <span class="token keyword">const</span> distance <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>dX <span class="token operator">*</span> dX <span class="token operator">+</span> dY <span class="token operator">*</span> dY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> distance <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>collisionCheckRadius <span class="token operator">+</span> obj<span class="token punctuation">.</span>collisionCheckRadius<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">collisionCheckUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">draw</span><span class="token punctuation">(</span>Context2D<span class="token operator">:</span> CanvasRenderingContext2D<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// Context2D.beginPath();</span>
    <span class="token comment">// Context2D.arc(this.collisionCheckPosX, this.collisionCheckPosY, this.collisionCheckRadius, 0, Math.PI * 2);</span>
    <span class="token comment">// Context2D.stroke();</span>
    <span class="token comment">// Context2D.strokeRect(this.posX, this.posY, this.drawWidth, this.drawHeight);</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>Context2D<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// put it on ground();</span>
  <span class="token function">setOnGround</span><span class="token punctuation">(</span>groundPosY<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> Animal <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posY <span class="token operator">=</span> groundPosY <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawHeight<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 水平和垂直平移</span>
  <span class="token function">transform</span><span class="token punctuation">(</span>stepX<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> stepY<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posX <span class="token operator">+=</span> stepX<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posY <span class="token operator">+=</span> stepY<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">abstract</span> Name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>Name<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-4-2-6-使用" tabindex="-1"><a class="header-anchor" href="#_1-4-2-6-使用"><span>1.4.2.6. 使用</span></a></h4><p>于是，定义一个游戏角色：蠕虫，就会变得如此简单</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Animal <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./Animal.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RandomRange <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./utils.js&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 蠕虫 继承 Animal 类</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Worm</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
  Name <span class="token operator">=</span> <span class="token string">&quot;Worm&quot;</span><span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>posX<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> posY<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token string">&quot;./imgs/Worm.png&quot;</span><span class="token punctuation">,</span> <span class="token number">229</span><span class="token punctuation">,</span> <span class="token number">171</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;idle&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posX <span class="token operator">=</span> posX<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posY <span class="token operator">=</span> posY<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>moveSpeedX <span class="token operator">=</span> <span class="token function">RandomRange</span><span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">move</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posX <span class="token operator">-=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>moveSpeedX <span class="token operator">*</span> timeInterval<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span>timeInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-4-3-敌人的移动模式" tabindex="-1"><a class="header-anchor" href="#_1-4-3-敌人的移动模式"><span>1.4.3. 敌人的移动模式</span></a></h3><h4 id="_1-4-3-1-原地静止的物体" tabindex="-1"><a class="header-anchor" href="#_1-4-3-1-原地静止的物体"><span>1.4.3.1. 原地静止的物体</span></a></h4><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Animal <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./Animal.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RandomRange <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./utils.js&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 鬼</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Plant</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
  Name <span class="token operator">=</span> <span class="token string">&quot;Plant&quot;</span><span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>posX<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> posY<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token string">&quot;./imgs/enemy_plant.png&quot;</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posX <span class="token operator">=</span> posX<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posY <span class="token operator">=</span> posY<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFps</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">move</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-4-3-2-水平直线运动的蠕虫" tabindex="-1"><a class="header-anchor" href="#_1-4-3-2-水平直线运动的蠕虫"><span>1.4.3.2. 水平直线运动的蠕虫</span></a></h4><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Animal <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./Animal.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RandomRange <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./utils.js&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 蠕虫 继承 Animal 类</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Worm</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
  Name <span class="token operator">=</span> <span class="token string">&quot;Worm&quot;</span><span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>posX<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> posY<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token string">&quot;./imgs/Worm.png&quot;</span><span class="token punctuation">,</span> <span class="token number">229</span><span class="token punctuation">,</span> <span class="token number">171</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;idle&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posX <span class="token operator">=</span> posX<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posY <span class="token operator">=</span> posY<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>moveSpeedX <span class="token operator">=</span> <span class="token function">RandomRange</span><span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">move</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posX <span class="token operator">-=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>moveSpeedX <span class="token operator">*</span> timeInterval<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span>timeInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-4-3-3-上下摆动的蝙蝠" tabindex="-1"><a class="header-anchor" href="#_1-4-3-3-上下摆动的蝙蝠"><span>1.4.3.3. 上下摆动的蝙蝠</span></a></h4><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Animal <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./Animal.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RandomRange <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./utils.js&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 蠕虫 继承 Animal 类</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Bat</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
  Name <span class="token operator">=</span> <span class="token string">&quot;Bat&quot;</span><span class="token punctuation">;</span>
  shakeAngle <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 摆动角度,初始摆动角度 单位: 弧度</span>
  shakeDeltaAngle<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> <span class="token comment">// 摆动增量 单位:弧度/毫秒</span>
  shakeGapRadius<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> <span class="token comment">// 摆动范围半径 单位：像素</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>posX<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> posY<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token string">&quot;./imgs/Bat.png&quot;</span><span class="token punctuation">,</span> <span class="token number">266</span><span class="token punctuation">,</span> <span class="token number">188</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;idle&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posX <span class="token operator">=</span> posX<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posY <span class="token operator">=</span> posY<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>moveSpeedX <span class="token operator">=</span> <span class="token function">RandomRange</span><span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>shakeAngle <span class="token operator">=</span> <span class="token function">RandomRange</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">asin</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">asin</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>shakeDeltaAngle <span class="token operator">=</span> <span class="token function">RandomRange</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">asin</span><span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">asin</span><span class="token punctuation">(</span><span class="token number">0.003</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>shakeGapRadius <span class="token operator">=</span> <span class="token function">RandomRange</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">shake</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posY <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>shakeGapRadius <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>shakeAngle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>shakeAngle <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>shakeDeltaAngle <span class="token operator">*</span> timeInterval<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">move</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posX <span class="token operator">-=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>moveSpeedX <span class="token operator">*</span> timeInterval<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span>timeInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">shake</span><span class="token punctuation">(</span>timeInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>周期线性运动的蝙蝠</strong></p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Animal <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./Animal.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RandomRange <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./utils.js&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 蠕虫 继承 Animal 类</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">GhostBird</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
  Name <span class="token operator">=</span> <span class="token string">&quot;GhostBird&quot;</span><span class="token punctuation">;</span>

  asline<span class="token operator">:</span> <span class="token punctuation">{</span>
    angle<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    angleIncreaseSpeed<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    factorX<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    factorY<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    angle<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    angleIncreaseSpeed<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    factorX<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    factorY<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token constant">CANVAS_WIDTH</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token constant">CANVAS_HEIGHT</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  offsetY<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  offsetX<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span>
    posX<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    posY<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    <span class="token constant">CANVAS_WIDTH</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    <span class="token constant">CANVAS_HEIGHT</span><span class="token operator">:</span> <span class="token builtin">number</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token string">&quot;./imgs/GhostBird.png&quot;</span><span class="token punctuation">,</span> <span class="token number">218</span><span class="token punctuation">,</span> <span class="token number">177</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;idle&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posX <span class="token operator">=</span> posX<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posY <span class="token operator">=</span> posY<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CANVAS_WIDTH</span> <span class="token operator">=</span> <span class="token constant">CANVAS_WIDTH</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CANVAS_HEIGHT</span> <span class="token operator">=</span> <span class="token constant">CANVAS_HEIGHT</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>moveSpeedX <span class="token operator">=</span> <span class="token function">RandomRange</span><span class="token punctuation">(</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// for asline</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>offsetX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 相对于屏幕右上角0，0位置的偏移量</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>offsetY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>asline<span class="token punctuation">.</span>angle <span class="token operator">=</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">365</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">RandomRange</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">365</span><span class="token punctuation">,</span> <span class="token number">365</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 初相角 -1 ~ 1</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>asline<span class="token punctuation">.</span>angleIncreaseSpeed <span class="token operator">=</span>
      <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">365</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">RandomRange</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token function">RandomRange</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 移动周期 30~90 感觉不错</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>asline<span class="token punctuation">.</span>factorX <span class="token operator">=</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">365</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.45</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>asline<span class="token punctuation">.</span>factorY <span class="token operator">=</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">365</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.35</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">transform</span><span class="token punctuation">(</span>stepX<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> stepY<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// this.offsetX += stepX;</span>
    <span class="token comment">// this.offsetY += stepY;</span>
  <span class="token punctuation">}</span>
  <span class="token function">move_asline</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 线性运动</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posX <span class="token operator">=</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>offsetX <span class="token operator">+</span>
      <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CANVAS_WIDTH</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span>
        Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>asline<span class="token punctuation">.</span>angle <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>asline<span class="token punctuation">.</span>factorX<span class="token punctuation">)</span> <span class="token operator">+</span>
      <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CANVAS_WIDTH</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posY <span class="token operator">=</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>offsetY <span class="token operator">+</span>
      <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CANVAS_HEIGHT</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span>
        Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>asline<span class="token punctuation">.</span>angle <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>asline<span class="token punctuation">.</span>factorY<span class="token punctuation">)</span> <span class="token operator">+</span>
      <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CANVAS_HEIGHT</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> angleStep <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>asline<span class="token punctuation">.</span>angleIncreaseSpeed <span class="token operator">*</span> timeInterval<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>asline<span class="token punctuation">.</span>angle <span class="token operator">+=</span> angleStep<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">move</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posX <span class="token operator">-=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>moveSpeedX <span class="token operator">*</span> timeInterval<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">move_asline</span><span class="token punctuation">(</span>timeInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-4-3-4-随机无规律移动的齿轮" tabindex="-1"><a class="header-anchor" href="#_1-4-3-4-随机无规律移动的齿轮"><span>1.4.3.4. 随机无规律移动的齿轮</span></a></h4><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Animal <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./Animal.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RandomRange <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./utils.js&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 蠕虫 继承 Animal 类</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Gear</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
  Name <span class="token operator">=</span> <span class="token string">&quot;Gear&quot;</span><span class="token punctuation">;</span>
  reArrange_NewPosX<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  reArrange_NewPosY<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  reArrange_MoveSpeed<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> <span class="token comment">// 移动速度</span>
  reArrange_Timer <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  reArrange_TimeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token constant">CANVAS_WIDTH</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token constant">CANVAS_HEIGHT</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span>
    posX<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    posY<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    <span class="token constant">CANVAS_WIDTH</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    <span class="token constant">CANVAS_HEIGHT</span><span class="token operator">:</span> <span class="token builtin">number</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token string">&quot;./imgs/Gear.png&quot;</span><span class="token punctuation">,</span> <span class="token number">213</span><span class="token punctuation">,</span> <span class="token number">212</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;idle&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posX <span class="token operator">=</span> posX<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posY <span class="token operator">=</span> posY<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CANVAS_WIDTH</span> <span class="token operator">=</span> <span class="token constant">CANVAS_WIDTH</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CANVAS_HEIGHT</span> <span class="token operator">=</span> <span class="token constant">CANVAS_HEIGHT</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>moveSpeedX <span class="token operator">=</span> <span class="token function">RandomRange</span><span class="token punctuation">(</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// randomReArrange_ment</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>reArrange_NewPosX <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>posX<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>reArrange_NewPosY <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>posY<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>reArrange_TimeInterval <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token function">RandomRange</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0.5 ~ 2 秒</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>reArrange_MoveSpeed <span class="token operator">=</span> <span class="token function">RandomRange</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 平移</span>
  <span class="token function">transform</span><span class="token punctuation">(</span>stepX<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> stepY<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token comment">// 决定其是否跟随场景移动的代码</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posX <span class="token operator">+=</span> stepX<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posY <span class="token operator">+=</span> stepY<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>reArrange_NewPosX <span class="token operator">+=</span> stepX<span class="token punctuation">;</span> <span class="token comment">// dx要根据这个来计算，所以也要平移</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>reArrange_NewPosY <span class="token operator">+=</span> stepY<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">reArrange</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 重新排列</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reArrange_Timer <span class="token operator">+=</span> timeInterval<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>reArrange_TimeInterval<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>reArrange_Timer <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token comment">// 随机位置，注意其范围区间</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>reArrange_NewPosX <span class="token operator">=</span> <span class="token function">RandomRange</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CANVAS_WIDTH</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>reArrange_NewPosY <span class="token operator">=</span> <span class="token function">RandomRange</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CANVAS_HEIGHT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reArrange_NewPosX<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reArrange_NewPosY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> dx <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reArrange_NewPosX <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>posX<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> dy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reArrange_NewPosY <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>posY<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> moveStep <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>reArrange_MoveSpeed <span class="token operator">*</span> timeInterval<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posX <span class="token operator">+=</span> dx <span class="token operator">*</span> moveStep<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posY <span class="token operator">+=</span> dy <span class="token operator">*</span> moveStep<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">move</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posX <span class="token operator">-=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>moveSpeedX <span class="token operator">*</span> timeInterval<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reArrange</span><span class="token punctuation">(</span>timeInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// this.move(timeInterval);</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-4-4-视差背景原理" tabindex="-1"><a class="header-anchor" href="#_1-4-4-视差背景原理"><span>1.4.4. 视差背景原理</span></a></h3><h4 id="_1-4-4-1-无限滚动的背景原理" tabindex="-1"><a class="header-anchor" href="#_1-4-4-1-无限滚动的背景原理"><span>1.4.4.1. 无限滚动的背景原理</span></a></h4>`,21),S=t(`<div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">var</span> myCanvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#myCanvas&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> HTMLCanvasElement<span class="token punctuation">;</span>
<span class="token comment">// 获取2d的上下文环境对象，该对象包含画笔设置和一些方法</span>
<span class="token keyword">var</span> ctx <span class="token operator">=</span> myCanvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;2d&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> CanvasRenderingContext2D<span class="token punctuation">;</span>

<span class="token comment">// canvas的默认大小为300x150px 需手动修改</span>
<span class="token keyword">const</span> <span class="token constant">CANVAS_WIDTH</span> <span class="token operator">=</span> <span class="token punctuation">(</span>myCanvas<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">CANVAS_HEIGHT</span> <span class="token operator">=</span> <span class="token punctuation">(</span>myCanvas<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">700</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> gameScrollSpeed <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token comment">// 层</span>
<span class="token keyword">const</span> backgroundLayer1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
backgroundLayer1<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;./imgs/layer-1.png&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> backgroundLayer2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
backgroundLayer2<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;./imgs/layer-2.png&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> backgroundLayer3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
backgroundLayer3<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;./imgs/layer-3.png&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> backgroundLayer4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
backgroundLayer4<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;./imgs/layer-4.png&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> backgroundLayer5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
backgroundLayer5<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;./imgs/layer-5.png&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> Layer4offsetX1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> Layer4offsetX2 <span class="token operator">=</span> <span class="token number">2400</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">CANVAS_WIDTH</span><span class="token punctuation">,</span> <span class="token constant">CANVAS_HEIGHT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>backgroundLayer4<span class="token punctuation">,</span> Layer4offsetX1<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>backgroundLayer5<span class="token punctuation">,</span> Layer4offsetX2<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 如果第一张图滚动展示完毕，就将其放到第二张图的后面</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Layer4offsetX1 <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">2400</span><span class="token punctuation">)</span> Layer4offsetX1 <span class="token operator">=</span> Layer4offsetX2 <span class="token operator">+</span> <span class="token number">2400</span><span class="token punctuation">;</span>
  <span class="token comment">// 如果第二张图滚动展示完毕，就将其放到第一张图的后面</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Layer4offsetX2 <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">2400</span><span class="token punctuation">)</span> Layer4offsetX2 <span class="token operator">=</span> Layer4offsetX1 <span class="token operator">+</span> <span class="token number">2400</span><span class="token punctuation">;</span>
  Layer4offsetX1 <span class="token operator">-=</span> gameScrollSpeed<span class="token punctuation">;</span> <span class="token comment">// 更新位置</span>
  Layer4offsetX2 <span class="token operator">-=</span> gameScrollSpeed<span class="token punctuation">;</span> <span class="token comment">// 更新位置</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>animate<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 刷新</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-4-4-2-视差背景的实现" tabindex="-1"><a class="header-anchor" href="#_1-4-4-2-视差背景的实现"><span>1.4.4.2. 视差背景的实现</span></a></h4>`,2),I=t(`<div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">var</span> myCanvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#myCanvas&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> HTMLCanvasElement<span class="token punctuation">;</span>
<span class="token keyword">var</span> ctx <span class="token operator">=</span> myCanvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;2d&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> CanvasRenderingContext2D<span class="token punctuation">;</span> <span class="token comment">// 获取2d的上下文环境对象，该对象包含画笔设置和一些方法</span>

<span class="token comment">// canvas的默认大小为300x150px 需手动修改</span>
<span class="token keyword">const</span> <span class="token constant">CANVAS_WIDTH</span> <span class="token operator">=</span> <span class="token punctuation">(</span>myCanvas<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">1080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">CANVAS_HEIGHT</span> <span class="token operator">=</span> <span class="token punctuation">(</span>myCanvas<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">720</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> gameScrollSpeed <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> backgroundLayer1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
backgroundLayer1<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;./imgs/layer-1.png&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> backgroundLayer2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
backgroundLayer2<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;./imgs/layer-2.png&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> backgroundLayer3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
backgroundLayer3<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;./imgs/layer-3.png&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> backgroundLayer4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
backgroundLayer4<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;./imgs/layer-4.png&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> backgroundLayer5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
backgroundLayer5<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;./imgs/layer-5.png&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> baclkgroundlayers <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;layer1&quot;</span><span class="token punctuation">,</span>
    img<span class="token operator">:</span> backgroundLayer1<span class="token punctuation">,</span>
    imgWidth<span class="token operator">:</span> <span class="token number">2400</span><span class="token punctuation">,</span>
    Xoffset1<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    Xoffset2<span class="token operator">:</span> <span class="token number">2400</span><span class="token punctuation">,</span>
    speedModify<span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;layer2&quot;</span><span class="token punctuation">,</span>
    img<span class="token operator">:</span> backgroundLayer2<span class="token punctuation">,</span>
    imgWidth<span class="token operator">:</span> <span class="token number">2400</span><span class="token punctuation">,</span>
    Xoffset1<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    Xoffset2<span class="token operator">:</span> <span class="token number">2400</span><span class="token punctuation">,</span>
    speedModify<span class="token operator">:</span> <span class="token number">0.3</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;layer3-cloud&quot;</span><span class="token punctuation">,</span>
    img<span class="token operator">:</span> backgroundLayer3<span class="token punctuation">,</span>
    imgWidth<span class="token operator">:</span> <span class="token number">2400</span><span class="token punctuation">,</span>
    Xoffset1<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    Xoffset2<span class="token operator">:</span> <span class="token number">2400</span><span class="token punctuation">,</span>
    speedModify<span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;layer4&quot;</span><span class="token punctuation">,</span>
    img<span class="token operator">:</span> backgroundLayer4<span class="token punctuation">,</span>
    imgWidth<span class="token operator">:</span> <span class="token number">2400</span><span class="token punctuation">,</span>
    Xoffset1<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    Xoffset2<span class="token operator">:</span> <span class="token number">2400</span><span class="token punctuation">,</span>
    speedModify<span class="token operator">:</span> <span class="token number">0.65</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;layer5-floor&quot;</span><span class="token punctuation">,</span>
    img<span class="token operator">:</span> backgroundLayer5<span class="token punctuation">,</span>
    imgWidth<span class="token operator">:</span> <span class="token number">2400</span><span class="token punctuation">,</span>
    Xoffset1<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    Xoffset2<span class="token operator">:</span> <span class="token number">2400</span><span class="token punctuation">,</span>
    speedModify<span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">refreshBackgroundLayers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 渲染背景</span>
  baclkgroundlayers<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>layerItem<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 逐层渲染背景</span>
    ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>layerItem<span class="token punctuation">.</span>img<span class="token punctuation">,</span> layerItem<span class="token punctuation">.</span>Xoffset1<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>layerItem<span class="token punctuation">.</span>img<span class="token punctuation">,</span> layerItem<span class="token punctuation">.</span>Xoffset2<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>layerItem<span class="token punctuation">.</span>Xoffset1 <span class="token operator">&lt;</span> <span class="token operator">-</span>layerItem<span class="token punctuation">.</span>imgWidth<span class="token punctuation">)</span>
      layerItem<span class="token punctuation">.</span>Xoffset1 <span class="token operator">=</span> layerItem<span class="token punctuation">.</span>Xoffset2 <span class="token operator">+</span> layerItem<span class="token punctuation">.</span>imgWidth<span class="token punctuation">;</span> <span class="token comment">// 如果第一张图滚动展示完毕，就将其放到第二张图的后面</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>layerItem<span class="token punctuation">.</span>Xoffset2 <span class="token operator">&lt;</span> <span class="token operator">-</span>layerItem<span class="token punctuation">.</span>imgWidth<span class="token punctuation">)</span>
      layerItem<span class="token punctuation">.</span>Xoffset2 <span class="token operator">=</span> layerItem<span class="token punctuation">.</span>Xoffset1 <span class="token operator">+</span> layerItem<span class="token punctuation">.</span>imgWidth<span class="token punctuation">;</span> <span class="token comment">// 如果第二张图滚动展示完毕，就将其放到第一张图的后面</span>
    layerItem<span class="token punctuation">.</span>Xoffset1 <span class="token operator">-=</span> gameScrollSpeed <span class="token operator">*</span> layerItem<span class="token punctuation">.</span>speedModify<span class="token punctuation">;</span> <span class="token comment">// 更新位置</span>
    layerItem<span class="token punctuation">.</span>Xoffset2 <span class="token operator">-=</span> gameScrollSpeed <span class="token operator">*</span> layerItem<span class="token punctuation">.</span>speedModify<span class="token punctuation">;</span> <span class="token comment">// 更新位置</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">CANVAS_WIDTH</span><span class="token punctuation">,</span> <span class="token constant">CANVAS_HEIGHT</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 清除</span>
  <span class="token function">refreshBackgroundLayers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 渲染背景</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>animate<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 刷新</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-4-4-3-最终的抽象、封装、实现" tabindex="-1"><a class="header-anchor" href="#_1-4-4-3-最终的抽象、封装、实现"><span>1.4.4.3. 最终的抽象、封装、实现</span></a></h4><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token comment">// 可滚动的背景层</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Layer</span> <span class="token punctuation">{</span>
  <span class="token keyword">readonly</span> <span class="token constant">CANVAS_WIDTH</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token keyword">readonly</span> <span class="token constant">CANVAS_HEIGHT</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  img<span class="token operator">:</span> HTMLImageElement<span class="token punctuation">;</span>
  imgWidth<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  imgHeight<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  pos1_X<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  pox1_Y<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  pos2_X<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  pox2_Y<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> layerMoveSpeedX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 层的移动速度,一个背景的所有层的移动速度应当是一致的</span>
  <span class="token keyword">private</span> layerMoveSpeedFactor <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span> <span class="token comment">// 层的移动速度的系数，一个背景有多个层，多个层的移动速度一致，但移动速度的系数可能不一致</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>
    <span class="token constant">CANVAS_WIDTH</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    <span class="token constant">CANVAS_HEIGHT</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    imgSrc<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    imgWidth<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    imgHeight<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    layerMoveSpeedFactor<span class="token operator">:</span> <span class="token builtin">number</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CANVAS_WIDTH</span> <span class="token operator">=</span> <span class="token constant">CANVAS_WIDTH</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CANVAS_HEIGHT</span> <span class="token operator">=</span> <span class="token constant">CANVAS_HEIGHT</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>img<span class="token punctuation">.</span>src <span class="token operator">=</span> imgSrc<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>imgWidth <span class="token operator">=</span> imgWidth<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>imgHeight <span class="token operator">=</span> imgHeight<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>layerMoveSpeedFactor <span class="token operator">=</span> layerMoveSpeedFactor<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>pos1_X <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>pox1_Y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>pos2_X <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imgWidth<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>pox2_Y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>pos1_X <span class="token operator">+=</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>layerMoveSpeedX <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>layerMoveSpeedFactor <span class="token operator">*</span> timeInterval<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>pos2_X <span class="token operator">+=</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>layerMoveSpeedX <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>layerMoveSpeedFactor <span class="token operator">*</span> timeInterval<span class="token punctuation">;</span>
    <span class="token comment">// 图层向左移动，图层出界，向后添加新图层</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>layerMoveSpeedX <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pos1_X <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imgWidth <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>pos1_X <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pos2_X <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imgWidth<span class="token punctuation">;</span> <span class="token comment">// 图1出界就将其放置到图2之后</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>layerMoveSpeedX <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pos2_X <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imgWidth <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>pos2_X <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pos1_X <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imgWidth<span class="token punctuation">;</span> <span class="token comment">// 图2出界就将其放置到图1之后</span>
    <span class="token comment">// 图层向右移动，图层出界，向前添加新图层</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>layerMoveSpeedX <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pos1_X <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>pos2_X <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pos1_X <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imgWidth<span class="token punctuation">;</span> <span class="token comment">// 图1出界就将其放置到图2之后</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>layerMoveSpeedX <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pos2_X <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>pos1_X <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pos2_X <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imgWidth<span class="token punctuation">;</span> <span class="token comment">// 图2出界就将其放置到图1之后</span>
  <span class="token punctuation">}</span>
  <span class="token function">draw</span><span class="token punctuation">(</span>Context2D<span class="token operator">:</span> CanvasRenderingContext2D<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Context2D<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>img<span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>imgWidth<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>imgHeight<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>pos1_X<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>pox1_Y<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>imgWidth<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CANVAS_HEIGHT</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    Context2D<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>img<span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>imgWidth<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>imgHeight<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>pos2_X<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>pox2_Y<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>imgWidth<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CANVAS_HEIGHT</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">setSpeed</span><span class="token punctuation">(</span>newSpeed<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>layerMoveSpeedX <span class="token operator">=</span> newSpeed<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 可滚动的背景，该背景包含多个层</span>
<span class="token keyword">export</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Background</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> _backgroundMoveSpeedX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 背景移动速度</span>
  layers<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>Layer<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 背景</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setSpeed</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>layers<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>layer<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> layer<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">draw</span><span class="token punctuation">(</span>Context2D<span class="token operator">:</span> CanvasRenderingContext2D<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>layers<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>layer<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> layer<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>Context2D<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">getSpeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_backgroundMoveSpeedX<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 修改背景的速度就是修改要所有层的移动速度，这里做等值判断是防止for循环浪费性能</span>
  <span class="token function">setSpeed</span><span class="token punctuation">(</span>newSpeed<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_backgroundMoveSpeedX <span class="token operator">!=</span> newSpeed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>layers<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span><span class="token function">setSpeed</span><span class="token punctuation">(</span>newSpeed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 更新所有层的速度</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_backgroundMoveSpeedX <span class="token operator">=</span> newSpeed<span class="token punctuation">;</span> <span class="token comment">// 更新背景速度</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">abstract</span> <span class="token function">getGroundPosY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-4-4-4-使用封装好的类实现一个视差背景" tabindex="-1"><a class="header-anchor" href="#_1-4-4-4-使用封装好的类实现一个视差背景"><span>1.4.4.4. 使用封装好的类实现一个视差背景</span></a></h4><p>现在实现一张视差背景只需要几行最关键的代码</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Background<span class="token punctuation">,</span> Layer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./Background.js&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 背景city，由1层构成</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">BackgroundCity</span> <span class="token keyword">extends</span> <span class="token class-name">Background</span> <span class="token punctuation">{</span>
  <span class="token constant">CANVAS_WIDTH</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token constant">CANVAS_HEIGHT</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token constant">CANVAS_WIDTH</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token constant">CANVAS_HEIGHT</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>layers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
      <span class="token keyword">new</span> <span class="token class-name">Layer</span><span class="token punctuation">(</span>
        <span class="token constant">CANVAS_WIDTH</span><span class="token punctuation">,</span>
        <span class="token constant">CANVAS_HEIGHT</span><span class="token punctuation">,</span>
        <span class="token string">&quot;./imgs/cityLayers/layer-1.png&quot;</span><span class="token punctuation">,</span>
        <span class="token number">2400</span><span class="token punctuation">,</span>
        <span class="token number">720</span><span class="token punctuation">,</span>
        <span class="token number">0.0</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>layers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
      <span class="token keyword">new</span> <span class="token class-name">Layer</span><span class="token punctuation">(</span>
        <span class="token constant">CANVAS_WIDTH</span><span class="token punctuation">,</span>
        <span class="token constant">CANVAS_HEIGHT</span><span class="token punctuation">,</span>
        <span class="token string">&quot;./imgs/cityLayers/layer-2.png&quot;</span><span class="token punctuation">,</span>
        <span class="token number">2400</span><span class="token punctuation">,</span>
        <span class="token number">720</span><span class="token punctuation">,</span>
        <span class="token number">0.1</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>layers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
      <span class="token keyword">new</span> <span class="token class-name">Layer</span><span class="token punctuation">(</span>
        <span class="token constant">CANVAS_WIDTH</span><span class="token punctuation">,</span>
        <span class="token constant">CANVAS_HEIGHT</span><span class="token punctuation">,</span>
        <span class="token string">&quot;./imgs/cityLayers/layer-3.png&quot;</span><span class="token punctuation">,</span>
        <span class="token number">2400</span><span class="token punctuation">,</span>
        <span class="token number">720</span><span class="token punctuation">,</span>
        <span class="token number">0.3</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>layers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
      <span class="token keyword">new</span> <span class="token class-name">Layer</span><span class="token punctuation">(</span>
        <span class="token constant">CANVAS_WIDTH</span><span class="token punctuation">,</span>
        <span class="token constant">CANVAS_HEIGHT</span><span class="token punctuation">,</span>
        <span class="token string">&quot;./imgs/cityLayers/layer-4.png&quot;</span><span class="token punctuation">,</span>
        <span class="token number">2400</span><span class="token punctuation">,</span>
        <span class="token number">720</span><span class="token punctuation">,</span>
        <span class="token number">0.5</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>layers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
      <span class="token keyword">new</span> <span class="token class-name">Layer</span><span class="token punctuation">(</span>
        <span class="token constant">CANVAS_WIDTH</span><span class="token punctuation">,</span>
        <span class="token constant">CANVAS_HEIGHT</span><span class="token punctuation">,</span>
        <span class="token string">&quot;./imgs/cityLayers/layer-5.png&quot;</span><span class="token punctuation">,</span>
        <span class="token number">2400</span><span class="token punctuation">,</span>
        <span class="token number">720</span><span class="token punctuation">,</span>
        <span class="token number">1.0</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CANVAS_WIDTH</span> <span class="token operator">=</span> <span class="token constant">CANVAS_WIDTH</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CANVAS_HEIGHT</span> <span class="token operator">=</span> <span class="token constant">CANVAS_HEIGHT</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">getGroundPosY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CANVAS_HEIGHT</span> <span class="token operator">-</span> <span class="token number">120</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-4-5-碰撞检测" tabindex="-1"><a class="header-anchor" href="#_1-4-5-碰撞检测"><span>1.4.5. 碰撞检测</span></a></h3><h4 id="_1-4-5-1-矩形碰撞检测" tabindex="-1"><a class="header-anchor" href="#_1-4-5-1-矩形碰撞检测"><span>1.4.5.1. 矩形碰撞检测</span></a></h4><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">Rect</span> <span class="token punctuation">{</span>
  x<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  y<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  w<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  h<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">RectColisionDetector</span><span class="token punctuation">(</span>reactA<span class="token operator">:</span> Rect<span class="token punctuation">,</span> reactB<span class="token operator">:</span> Rect<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    reactA<span class="token punctuation">.</span>x <span class="token operator">&lt;</span> reactB<span class="token punctuation">.</span>x <span class="token operator">+</span> reactB<span class="token punctuation">.</span>w <span class="token operator">&amp;&amp;</span>
    reactA<span class="token punctuation">.</span>x <span class="token operator">+</span> reactA<span class="token punctuation">.</span>w <span class="token operator">&gt;</span> reactB<span class="token punctuation">.</span>x <span class="token operator">&amp;&amp;</span>
    reactA<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> reactB<span class="token punctuation">.</span>y <span class="token operator">+</span> reactB<span class="token punctuation">.</span>h <span class="token operator">&amp;&amp;</span>
    reactA<span class="token punctuation">.</span>y <span class="token operator">+</span> reactA<span class="token punctuation">.</span>h <span class="token operator">&gt;</span> reactB<span class="token punctuation">.</span>y
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-4-5-2-圆形碰撞检测" tabindex="-1"><a class="header-anchor" href="#_1-4-5-2-圆形碰撞检测"><span>1.4.5.2. 圆形碰撞检测</span></a></h4><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">Cycle</span> <span class="token punctuation">{</span>
  x<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  y<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  radius<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">CycleColisionDetector</span><span class="token punctuation">(</span>cycleA<span class="token operator">:</span> Cycle<span class="token punctuation">,</span> cycleB<span class="token operator">:</span> Cycle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> distance <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>
    Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>cycleA<span class="token punctuation">.</span>x <span class="token operator">-</span> cycleB<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>cycleA<span class="token punctuation">.</span>y <span class="token operator">-</span> cycleB<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 求两坐标间距离公式</span>
  <span class="token keyword">return</span> distance <span class="token operator">&lt;</span> cycleA<span class="token punctuation">.</span>radius <span class="token operator">+</span> cycleB<span class="token punctuation">.</span>radius<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-4-5-3-像素碰撞检测" tabindex="-1"><a class="header-anchor" href="#_1-4-5-3-像素碰撞检测"><span>1.4.5.3. 像素碰撞检测</span></a></h4><p>像素碰撞检测依赖于两个 Canvas 图层，绘制对象时，将对象的轮廓和实际图像分开绘制。</p><p>对象轮廓图层中的对象填充有颜色，可以认为这个颜色是该对象的唯一标识，</p><p>当鼠标点击轮廓图层时可以通过点击事件的坐标获取到点击处的像素值</p><p>通过像素值，遍历所有对象，匹配对象的颜色属性值，</p><p>就能判断用户是否点击到该对象</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token comment">// 像素碰撞检测</span>
<span class="token keyword">function</span> <span class="token function">pixelCollsionDetection</span><span class="token punctuation">(</span>
  pixelA<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  pixelB<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    pixelA<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> pixelB<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> pixelA<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> pixelB<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> pixelA<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> pixelB<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 鼠标点击事件监听，获取点击处的像素点</span>
myCanvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;mousedown&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> pos<span class="token operator">:</span> Position <span class="token operator">=</span> <span class="token punctuation">{</span> x<span class="token operator">:</span> event<span class="token punctuation">.</span>offsetX<span class="token punctuation">,</span> y<span class="token operator">:</span> event<span class="token punctuation">.</span>offsetY <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> imgdata <span class="token operator">=</span> ctxCollision<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取一个像素颜色</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> enemys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> item <span class="token operator">=</span> enemys<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">pixelCollsionDetection</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>collisionColor<span class="token punctuation">,</span> imgdata<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 像素碰撞检测</span>

      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-4-6-粒子特效" tabindex="-1"><a class="header-anchor" href="#_1-4-6-粒子特效"><span>1.4.6. 粒子特效</span></a></h3><h4 id="_1-4-6-1-定义-particle-抽象类" tabindex="-1"><a class="header-anchor" href="#_1-4-6-1-定义-particle-抽象类"><span>1.4.6.1. 定义 Particle 抽象类</span></a></h4><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Animater <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./Animater.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RandomRange <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./utils.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Particle</span> <span class="token punctuation">{</span>
  posX<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  posY<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  movespeedX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>posX<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> posY<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posX <span class="token operator">=</span> posX<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posY <span class="token operator">=</span> posY<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">abstract</span> <span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token keyword">abstract</span> <span class="token function">draw</span><span class="token punctuation">(</span>Context2D<span class="token operator">:</span> CanvasRenderingContext2D<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token function">setSpeedX</span><span class="token punctuation">(</span>newSpeed<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>movespeedX <span class="token operator">=</span> newSpeed<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-4-6-2-灰尘影子的实现" tabindex="-1"><a class="header-anchor" href="#_1-4-6-2-灰尘影子的实现"><span>1.4.6.2. 灰尘影子的实现</span></a></h4><p>该特效的实现的关键点是透明度的衰减速度和圆形半径的衰减速度，</p><p>需要一点一点尝试出来，另外这个地方应该使用全局透明度，而不是字符串拼接<code>rgba()</code></p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token comment">// 灰尘</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Dust</span> <span class="token keyword">extends</span> <span class="token class-name">Particle</span> <span class="token punctuation">{</span>
  radius<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  fillStyleAlpha<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  fillStyle<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  radiusStep<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  fillStyleAlphaStep<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>posX<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> posY<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token function">RandomRange</span><span class="token punctuation">(</span>posX <span class="token operator">-</span> <span class="token number">50</span><span class="token punctuation">,</span> posX <span class="token operator">+</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">RandomRange</span><span class="token punctuation">(</span>posY <span class="token operator">-</span> <span class="token number">20</span><span class="token punctuation">,</span> posY <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>radius <span class="token operator">=</span> <span class="token function">RandomRange</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>radiusStep <span class="token operator">=</span> <span class="token function">RandomRange</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>fillStyleAlpha <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>fillStyleAlphaStep <span class="token operator">=</span> <span class="token number">0.01</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">rgba(0,0,0,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token keyword">this</span><span class="token punctuation">.</span>fillStyleAlpha<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fillStyleAlpha <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fillStyleAlphaStep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>fillStyleAlpha <span class="token operator">-=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fillStyleAlphaStep<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">rgba(0,0,0,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token keyword">this</span><span class="token punctuation">.</span>fillStyleAlpha<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>radius <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>radiusStep<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>radius <span class="token operator">-=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>radiusStep<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">draw</span><span class="token punctuation">(</span>Context2D<span class="token operator">:</span> CanvasRenderingContext2D<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    Context2D<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Context2D<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fillStyle<span class="token punctuation">;</span>
    Context2D<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Context2D<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>posX<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>posY<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>radius<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Context2D<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Context2D<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-4-6-3-火焰粒子特效" tabindex="-1"><a class="header-anchor" href="#_1-4-6-3-火焰粒子特效"><span>1.4.6.3. 火焰粒子特效</span></a></h4><p>关键点同上，</p><p>另外代码中似乎应该不需要移动速度，因为火焰的粒子特效是放在场景中的，场景会带着粒子特效移动</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">FireImg</span> <span class="token keyword">extends</span> <span class="token class-name">Particle</span> <span class="token punctuation">{</span>
  img<span class="token operator">:</span> HTMLImageElement<span class="token punctuation">;</span>
  movespeedX<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  imgHeight<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  imgWidth<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  drawHeight<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  drawWidth<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  globalAlpha<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  globalAlphaStep<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  drawSize<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  drawSizeStep<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>posX<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> posY<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> movespeedX<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token function">RandomRange</span><span class="token punctuation">(</span>posX <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">,</span> posX <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">RandomRange</span><span class="token punctuation">(</span>posY <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">,</span> posY <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>movespeedX <span class="token operator">=</span> movespeedX<span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;./imgs/fire.png&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>imgWidth <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>imgHeight <span class="token operator">=</span> <span class="token number">90</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>drawSize <span class="token operator">=</span> <span class="token function">RandomRange</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>drawSizeStep <span class="token operator">=</span> <span class="token function">RandomRange</span><span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>drawWidth <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imgWidth <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawSize<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>drawHeight <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imgHeight <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawSize<span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>globalAlpha <span class="token operator">=</span> <span class="token function">RandomRange</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>globalAlphaStep <span class="token operator">=</span> <span class="token function">RandomRange</span><span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>globalAlpha <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>globalAlphaStep<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>globalAlpha <span class="token operator">-=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>globalAlphaStep<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawSize <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawSizeStep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>drawSize <span class="token operator">-=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawSizeStep<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>drawWidth <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imgWidth <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawSize<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>drawHeight <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imgHeight <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawSize<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posX <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>movespeedX <span class="token operator">*</span> timeInterval<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">draw</span><span class="token punctuation">(</span>Context2D<span class="token operator">:</span> CanvasRenderingContext2D<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    Context2D<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Context2D<span class="token punctuation">.</span>globalAlpha <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>globalAlpha<span class="token punctuation">;</span>
    Context2D<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>img<span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>imgWidth<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>imgHeight<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>posX <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>posY <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>drawWidth<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>drawHeight
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    Context2D<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-4-6-4-落地的爆炸火花粒子特效" tabindex="-1"><a class="header-anchor" href="#_1-4-6-4-落地的爆炸火花粒子特效"><span>1.4.6.4. 落地的爆炸火花粒子特效</span></a></h4><p>这个地方的关键点比较多，除了衰减半径和衰减透明度，还需要考虑火花飞溅的方向，速度，重力影响。</p><p>首先水平方向上，火花可以左右飞溅，所以粒子的水平方向的移动速度<code>movespeedY</code>的正负性应当是随机的。</p><p>另外还需要一个和飞溅速度相反的阻力<code>movespeedX_f</code>，来使得火花飞溅速度衰减。</p><p>其次考虑垂直方向，由于是撞向地面导致产生的火花粒子，所以粒子的垂直方向的速度<code>movespeedY</code>应当是负，</p><p>另外重力的方向<code>movespeedY_weight</code>应当是正的，用于使得粒子向上移动的速度衰减。</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">FireImgSpak</span> <span class="token keyword">extends</span> <span class="token class-name">Particle</span> <span class="token punctuation">{</span>
  img<span class="token operator">:</span> HTMLImageElement<span class="token punctuation">;</span>
  movespeedX<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  imgHeight<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  imgWidth<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  drawHeight<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  drawWidth<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  globalAlpha<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  globalAlphaStep<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  drawSize<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  drawSizeStep<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  movespeedY<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  movespeedX_f<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  movespeedY_weight<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>posX<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> posY<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token function">RandomRange</span><span class="token punctuation">(</span>posX<span class="token punctuation">,</span> posX<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">RandomRange</span><span class="token punctuation">(</span>posY<span class="token punctuation">,</span> posY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>movespeedX <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token function">RandomRange</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">RandomRange</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>movespeedY <span class="token operator">=</span> <span class="token operator">-</span><span class="token function">RandomRange</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>movespeedX_f <span class="token operator">=</span> <span class="token operator">-</span>Math<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>movespeedX<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.1</span><span class="token punctuation">;</span> <span class="token comment">// 水平方向阻力,方向和移动方向相反</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>movespeedY_weight <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">;</span> <span class="token comment">//垂直方向的重力,和重力方向一致</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;./imgs/fire.png&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>imgWidth <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>imgHeight <span class="token operator">=</span> <span class="token number">90</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>drawSize <span class="token operator">=</span> <span class="token function">RandomRange</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>drawSizeStep <span class="token operator">=</span> <span class="token function">RandomRange</span><span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>drawWidth <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imgWidth <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawSize<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>drawHeight <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imgHeight <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawSize<span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>globalAlpha <span class="token operator">=</span> <span class="token function">RandomRange</span><span class="token punctuation">(</span><span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>globalAlphaStep <span class="token operator">=</span> <span class="token function">RandomRange</span><span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// 透明度衰减</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>globalAlpha <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>globalAlphaStep<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>globalAlpha <span class="token operator">-=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>globalAlphaStep<span class="token punctuation">;</span>
    <span class="token comment">// 绘制大小衰减</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawSize <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawSizeStep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>drawSize <span class="token operator">-=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawSizeStep<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>drawWidth <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imgWidth <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawSize<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>drawHeight <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imgHeight <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawSize<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 水平方向的移动速度根据阻力衰减，由于这两个速度始终方向相反，所以只需要按照衰减速度的方式理解就行，移动速度和摩擦力相加即可</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>movespeedX<span class="token punctuation">)</span> <span class="token operator">&gt;</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>movespeedX_f<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>movespeedX <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>movespeedX_f<span class="token punctuation">;</span> <span class="token comment">// 摩擦力和移动方向相反，所以直接相加</span>
    <span class="token keyword">else</span> <span class="token keyword">this</span><span class="token punctuation">.</span>movespeedX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 步长衰减到最小值，直接设置为0</span>

    <span class="token comment">// 垂直方向</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>movespeedY <span class="token operator">&lt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>movespeedY_weight<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>movespeedY <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>movespeedY_weight<span class="token punctuation">;</span> <span class="token comment">// 重力始终向下，所以相减</span>
    <span class="token keyword">else</span> <span class="token keyword">this</span><span class="token punctuation">.</span>movespeedY <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>movespeedY_weight<span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>posX <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>movespeedX <span class="token operator">*</span> timeInterval<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posY <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>movespeedY <span class="token operator">*</span> timeInterval<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">draw</span><span class="token punctuation">(</span>Context2D<span class="token operator">:</span> CanvasRenderingContext2D<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    Context2D<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Context2D<span class="token punctuation">.</span>globalAlpha <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>globalAlpha<span class="token punctuation">;</span>
    Context2D<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>img<span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>imgWidth<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>imgHeight<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>posX <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>posY <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>drawWidth<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>drawHeight
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    Context2D<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-4-6-5-爆炸的烟雾粒子特效" tabindex="-1"><a class="header-anchor" href="#_1-4-6-5-爆炸的烟雾粒子特效"><span>1.4.6.5. 爆炸的烟雾粒子特效</span></a></h4><p>这里值得一说的是，旋转的实现方法，具体看注释</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Explosion</span> <span class="token keyword">extends</span> <span class="token class-name">Animater</span> <span class="token punctuation">{</span>
  sound<span class="token operator">:</span> HTMLAudioElement<span class="token punctuation">;</span>
  rotateAngleStep<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  rotateAngle <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>posX<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> posY<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token string">&quot;./imgs/boom.png&quot;</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">179</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posX <span class="token operator">=</span> posX<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posY <span class="token operator">=</span> posY<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>sound <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Audio</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>sound<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;./sounds/Ice attack 2.wav&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>rotateAngleStep <span class="token operator">=</span>
      Math<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token function">RandomRange</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">360</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">RandomRange</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// +/-(15° ~ 30°)</span>
    <span class="token comment">// 动画本身只有五帧，但传入的参数表示有6帧，这里再请求在最后一帧停止渲染，则会渲染空白帧</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">requestStopAnimateFrameAtLastFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFps</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isFirstAnimateFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sound<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 如果是第一帧 播放音效</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>rotateAngle <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rotateAngleStep<span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">draw</span><span class="token punctuation">(</span>Context2D<span class="token operator">:</span> CanvasRenderingContext2D<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    Context2D<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 换新笔，旧笔context入栈</span>
    Context2D<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>posX <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>posY <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawHeight <span class="token operator">/</span> <span class="token number">2</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//改变原点坐标</span>
    Context2D<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rotateAngle<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 旋转画布某角度</span>
    <span class="token keyword">const</span> oldValX <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>posX<span class="token punctuation">;</span> <span class="token comment">// 记录旧值</span>
    <span class="token keyword">const</span> oldValY <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>posY<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posX <span class="token operator">=</span> <span class="token operator">-</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 因为坐标系变了 ，原来的坐标也要变</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posY <span class="token operator">=</span> <span class="token operator">-</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>Context2D<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posX <span class="token operator">=</span> oldValX<span class="token punctuation">;</span> <span class="token comment">// 恢复旧值</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>posY <span class="token operator">=</span> oldValY<span class="token punctuation">;</span>
    Context2D<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 换回原来的笔，出栈context</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-4-7-输入监听和状态管理的实现" tabindex="-1"><a class="header-anchor" href="#_1-4-7-输入监听和状态管理的实现"><span>1.4.7. 输入监听和状态管理的实现</span></a></h3><p>原本写的很复杂，最终优化后就成这样了，把状态管理和输入监听解耦了，目前来看还是写的比较精简的</p><h4 id="_1-4-7-1-输入监听" tabindex="-1"><a class="header-anchor" href="#_1-4-7-1-输入监听"><span>1.4.7.1. 输入监听</span></a></h4><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ValueOf <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./utils.js&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">KeyMapsValues</span> <span class="token operator">=</span> ValueOf<span class="token operator">&lt;</span><span class="token keyword">typeof</span> InputListener<span class="token punctuation">.</span>KeyMaps<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">InputListener</span> <span class="token punctuation">{</span>
  <span class="token comment">// 定义一些静态常量</span>
  <span class="token keyword">static</span> KeyMaps <span class="token operator">=</span> <span class="token punctuation">{</span>
    PressRight<span class="token operator">:</span> <span class="token string">&quot;ArrowRight&quot;</span><span class="token punctuation">,</span>
    PressLeft<span class="token operator">:</span> <span class="token string">&quot;ArrowLeft&quot;</span><span class="token punctuation">,</span>
    PressUp<span class="token operator">:</span> <span class="token string">&quot;ArrowUp&quot;</span><span class="token punctuation">,</span>
    PressDown<span class="token operator">:</span> <span class="token string">&quot;ArrowDown&quot;</span><span class="token punctuation">,</span>
    PressSpase<span class="token operator">:</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">,</span>
    Enter<span class="token operator">:</span> <span class="token string">&quot;Enter&quot;</span><span class="token punctuation">,</span>
    Escape<span class="token operator">:</span> <span class="token string">&quot;Escape&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token keyword">const</span><span class="token punctuation">;</span> <span class="token comment">// const 可以保证ValueOf能起作用</span>
  inputs<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>KeyMapsValues<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">listenning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">listenning</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;keydown&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>
        Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>InputListener<span class="token punctuation">.</span>KeyMaps<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>
          event<span class="token punctuation">.</span>key <span class="token keyword">as</span> KeyMapsValues
        <span class="token punctuation">)</span>
      <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>inputs<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>key <span class="token keyword">as</span> KeyMapsValues<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 放到开头</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;keyup&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>inputs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-4-7-2-状态管理" tabindex="-1"><a class="header-anchor" href="#_1-4-7-2-状态管理"><span>1.4.7.2. 状态管理</span></a></h4><p>状态管理指的是一种设计模式，是一个比较宽泛的概念，这里是我用 ts 写的，目前来看比较满意的一种写法</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> InputListener <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./InputListener.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ValueOf <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./utils.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>
  stateName<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">symbol</span><span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>stateName<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">symbol</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>stateName <span class="token operator">=</span> stateName<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">abstract</span> <span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token keyword">abstract</span> <span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token keyword">abstract</span> <span class="token function">inputsHandler</span><span class="token punctuation">(</span>
    inputs<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>ValueOf<span class="token operator">&lt;</span><span class="token keyword">typeof</span> InputListener<span class="token punctuation">.</span>KeyMaps<span class="token operator">&gt;&gt;</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-4-7-3-使用状态设计模式实现状态管理-player-类的部分代码" tabindex="-1"><a class="header-anchor" href="#_1-4-7-3-使用状态设计模式实现状态管理-player-类的部分代码"><span>1.4.7.3. 使用状态设计模式实现状态管理 Player 类的部分代码</span></a></h4><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ShadowDog</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
  Name <span class="token operator">=</span> <span class="token string">&quot;ShadowDog&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// 静态属性 状态枚举</span>
  <span class="token keyword">static</span> StateNamesEnum <span class="token operator">=</span> <span class="token punctuation">{</span>
    Running<span class="token operator">:</span> <span class="token string">&quot;Running&quot;</span><span class="token punctuation">,</span>
    Jumping<span class="token operator">:</span> <span class="token string">&quot;Jumping&quot;</span><span class="token punctuation">,</span>
    GetHit<span class="token operator">:</span> <span class="token string">&quot;GetHit&quot;</span><span class="token punctuation">,</span>
    PreDizzy<span class="token operator">:</span> <span class="token string">&quot;PreDizzy&quot;</span><span class="token punctuation">,</span>
    Dizzy<span class="token operator">:</span> <span class="token string">&quot;Dizzy&quot;</span><span class="token punctuation">,</span>
    Diving<span class="token operator">:</span> <span class="token string">&quot;Falling&quot;</span><span class="token punctuation">,</span>
    Sitting<span class="token operator">:</span> <span class="token string">&quot;Sitting&quot;</span><span class="token punctuation">,</span>
    Barkting<span class="token operator">:</span> <span class="token string">&quot;Barkting&quot;</span><span class="token punctuation">,</span>
    Dying<span class="token operator">:</span> <span class="token string">&quot;Dying&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
  <span class="token comment">// 状态map</span>
  StateMap<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>value <span class="token keyword">in</span> ValueOf<span class="token operator">&lt;</span><span class="token keyword">typeof</span> ShadowDog<span class="token punctuation">.</span>StateNamesEnum<span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token operator">:</span> State <span class="token punctuation">}</span> <span class="token operator">=</span>
    <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// 当前状态</span>
  currentState<span class="token operator">!</span><span class="token operator">:</span> State<span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>StateMap<span class="token punctuation">[</span>ShadowDog<span class="token punctuation">.</span>StateNamesEnum<span class="token punctuation">.</span>Running<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RunningState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>StateMap<span class="token punctuation">[</span>ShadowDog<span class="token punctuation">.</span>StateNamesEnum<span class="token punctuation">.</span>Jumping<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JumpingState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>StateMap<span class="token punctuation">[</span>ShadowDog<span class="token punctuation">.</span>StateNamesEnum<span class="token punctuation">.</span>Diving<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DivingState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>StateMap<span class="token punctuation">[</span>ShadowDog<span class="token punctuation">.</span>StateNamesEnum<span class="token punctuation">.</span>Sitting<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SittingState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>StateMap<span class="token punctuation">[</span>ShadowDog<span class="token punctuation">.</span>StateNamesEnum<span class="token punctuation">.</span>Barkting<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BarktingState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>StateMap<span class="token punctuation">[</span>ShadowDog<span class="token punctuation">.</span>StateNamesEnum<span class="token punctuation">.</span>GetHit<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GetHitState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>StateMap<span class="token punctuation">[</span>ShadowDog<span class="token punctuation">.</span>StateNamesEnum<span class="token punctuation">.</span>PreDizzy<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PreDizzyState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>StateMap<span class="token punctuation">[</span>ShadowDog<span class="token punctuation">.</span>StateNamesEnum<span class="token punctuation">.</span>Dizzy<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DizzyState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>StateMap<span class="token punctuation">[</span>ShadowDog<span class="token punctuation">.</span>StateNamesEnum<span class="token punctuation">.</span>Dying<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DyingState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// setState 要放到最后</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>ShadowDog<span class="token punctuation">.</span>StateNamesEnum<span class="token punctuation">.</span>Running<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 改变状态</span>
  <span class="token function">setState</span><span class="token punctuation">(</span>stateName<span class="token operator">:</span> ValueOf<span class="token operator">&lt;</span><span class="token keyword">typeof</span> ShadowDog<span class="token punctuation">.</span>StateNamesEnum<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>currentState <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>StateMap<span class="token punctuation">[</span>stateName<span class="token punctuation">]</span> <span class="token keyword">as</span> State<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>currentState<span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 更新</span>
  <span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// 处理输入</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>currentState<span class="token punctuation">.</span><span class="token function">inputsHandler</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Game<span class="token punctuation">.</span>InputListener<span class="token punctuation">.</span>inputs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 更新</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>currentState<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 基类的更新</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">RunningState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>
  shadowDog<span class="token operator">:</span> ShadowDog<span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>shadowDog<span class="token operator">:</span> ShadowDog<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>ShadowDog<span class="token punctuation">.</span>StateNamesEnum<span class="token punctuation">.</span>Running<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>shadowDog <span class="token operator">=</span> shadowDog<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// 进入该状态，初始化到该状态</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>shadowDog<span class="token punctuation">.</span>moveSpeedX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>shadowDog<span class="token punctuation">.</span>moveSpeedY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>shadowDog<span class="token punctuation">.</span><span class="token function">setOnGround</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>shadowDog<span class="token punctuation">.</span><span class="token function">changeAnimateByName</span><span class="token punctuation">(</span><span class="token string">&quot;run&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 场景移动速度</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>shadowDog<span class="token punctuation">.</span>Game<span class="token punctuation">.</span>Scene<span class="token punctuation">.</span><span class="token function">setSceneSpeed</span><span class="token punctuation">(</span>
      <span class="token operator">-</span><span class="token keyword">this</span><span class="token punctuation">.</span>shadowDog<span class="token punctuation">.</span>maxMoveSpeedX <span class="token operator">*</span> <span class="token number">0.5</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 状态的更新</span>
  <span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// 添加粒子特效</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>shadowDog<span class="token punctuation">.</span>Game<span class="token punctuation">.</span>Scene<span class="token punctuation">.</span>particles<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>
      <span class="token keyword">new</span> <span class="token class-name">Dust</span><span class="token punctuation">(</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>shadowDog<span class="token punctuation">.</span>posX <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>shadowDog<span class="token punctuation">.</span>drawWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>shadowDog<span class="token punctuation">.</span>posY <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>shadowDog<span class="token punctuation">.</span>drawHeight
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 检测是否收到伤害</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>shadowDog<span class="token punctuation">.</span><span class="token function">isGetHit</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>shadowDog<span class="token punctuation">.</span>Game<span class="token punctuation">.</span>Scene<span class="token punctuation">.</span>enemys<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>shadowDog<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>ShadowDog<span class="token punctuation">.</span>StateNamesEnum<span class="token punctuation">.</span>GetHit<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>shadowDog<span class="token punctuation">.</span>Game<span class="token punctuation">.</span>lives<span class="token operator">--</span><span class="token punctuation">;</span> <span class="token comment">// 生命值减一</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 输入处理</span>
  <span class="token function">inputsHandler</span><span class="token punctuation">(</span>inputs<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>ValueOf<span class="token operator">&lt;</span><span class="token keyword">typeof</span> InputListener<span class="token punctuation">.</span>KeyMaps<span class="token operator">&gt;&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果按下右键，改变速度等的值</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>inputs<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>InputListener<span class="token punctuation">.</span>KeyMaps<span class="token punctuation">.</span>PressRight<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>shadowDog<span class="token punctuation">.</span>moveSpeedX <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>shadowDog<span class="token punctuation">.</span>maxMoveSpeedX <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>shadowDog<span class="token punctuation">.</span>Game<span class="token punctuation">.</span>Scene<span class="token punctuation">.</span><span class="token function">setSceneSpeed</span><span class="token punctuation">(</span>
        <span class="token operator">-</span><span class="token keyword">this</span><span class="token punctuation">.</span>shadowDog<span class="token punctuation">.</span>maxMoveSpeedX <span class="token operator">*</span> <span class="token number">1.0</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>inputs<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>InputListener<span class="token punctuation">.</span>KeyMaps<span class="token punctuation">.</span>PressLeft<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>shadowDog<span class="token punctuation">.</span>moveSpeedX <span class="token operator">=</span> <span class="token operator">-</span><span class="token keyword">this</span><span class="token punctuation">.</span>shadowDog<span class="token punctuation">.</span>maxMoveSpeedX <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>shadowDog<span class="token punctuation">.</span>Game<span class="token punctuation">.</span>Scene<span class="token punctuation">.</span><span class="token function">setSceneSpeed</span><span class="token punctuation">(</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>shadowDog<span class="token punctuation">.</span>maxMoveSpeedX <span class="token operator">*</span> <span class="token number">0.5</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 按下上键，进入jump状态</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>inputs<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>InputListener<span class="token punctuation">.</span>KeyMaps<span class="token punctuation">.</span>PressUp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>shadowDog<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>ShadowDog<span class="token punctuation">.</span>StateNamesEnum<span class="token punctuation">.</span>Jumping<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 按下上键，进入sitting状态</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>inputs<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>InputListener<span class="token punctuation">.</span>KeyMaps<span class="token punctuation">.</span>PressDown<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>shadowDog<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>ShadowDog<span class="token punctuation">.</span>StateNamesEnum<span class="token punctuation">.</span>Sitting<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 松开左右按键，恢复速度等的值</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>shadowDog<span class="token punctuation">.</span>moveSpeedX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>shadowDog<span class="token punctuation">.</span>Game<span class="token punctuation">.</span>Scene<span class="token punctuation">.</span><span class="token function">setSceneSpeed</span><span class="token punctuation">(</span>
        <span class="token operator">-</span><span class="token keyword">this</span><span class="token punctuation">.</span>shadowDog<span class="token punctuation">.</span>maxMoveSpeedX <span class="token operator">*</span> <span class="token number">0.5</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-4-7-4-使用状态设计模式实现状态管理-game-类的部分代码" tabindex="-1"><a class="header-anchor" href="#_1-4-7-4-使用状态设计模式实现状态管理-game-类的部分代码"><span>1.4.7.4. 使用状态设计模式实现状态管理 Game 类的部分代码</span></a></h4><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">type</span> <span class="token class-name">GameStateEnum</span> <span class="token operator">=</span> ValueOf<span class="token operator">&lt;</span><span class="token keyword">typeof</span> Game<span class="token punctuation">.</span>StateEnum<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Game</span> <span class="token punctuation">{</span>
  <span class="token comment">// 定义一些静态常量表示状态</span>
  <span class="token keyword">static</span> StateEnum <span class="token operator">=</span> <span class="token punctuation">{</span>
    Preview<span class="token operator">:</span> <span class="token string">&quot;Preview&quot;</span><span class="token punctuation">,</span>
    BeforeRunning<span class="token operator">:</span> <span class="token string">&quot;BeforeRunning&quot;</span><span class="token punctuation">,</span>
    Running<span class="token operator">:</span> <span class="token string">&quot;Running&quot;</span><span class="token punctuation">,</span>
    Stop<span class="token operator">:</span> <span class="token string">&quot;Stop&quot;</span><span class="token punctuation">,</span>
    GameOver<span class="token operator">:</span> <span class="token string">&quot;GameOver&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
  allStates<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>key <span class="token keyword">in</span> GameStateEnum<span class="token punctuation">]</span><span class="token operator">?</span><span class="token operator">:</span> State <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  currentState<span class="token operator">!</span><span class="token operator">:</span> State<span class="token punctuation">;</span>
  InputListener<span class="token operator">:</span> InputListener<span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>
    Context2D<span class="token operator">:</span> CanvasRenderingContext2D<span class="token punctuation">,</span>
    <span class="token constant">CANVAS_WIDTH</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    <span class="token constant">CANVAS_HEIGHT</span><span class="token operator">:</span> <span class="token builtin">number</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>InputListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InputListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">UI</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">UI</span></span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>allStates<span class="token punctuation">[</span>Game<span class="token punctuation">.</span>StateEnum<span class="token punctuation">.</span>Preview<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PreviewStatus</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>allStates<span class="token punctuation">[</span>Game<span class="token punctuation">.</span>StateEnum<span class="token punctuation">.</span>BeforeRunning<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BeforeRunning</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>allStates<span class="token punctuation">[</span>Game<span class="token punctuation">.</span>StateEnum<span class="token punctuation">.</span>Running<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RunningStatus</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>allStates<span class="token punctuation">[</span>Game<span class="token punctuation">.</span>StateEnum<span class="token punctuation">.</span>Stop<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StopStatus</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>allStates<span class="token punctuation">[</span>Game<span class="token punctuation">.</span>StateEnum<span class="token punctuation">.</span>GameOver<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GameOverStatus</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>Game<span class="token punctuation">.</span>StateEnum<span class="token punctuation">.</span>Preview<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 改变状态</span>
  <span class="token function">setState</span><span class="token punctuation">(</span>StateName<span class="token operator">:</span> ValueOf<span class="token operator">&lt;</span><span class="token keyword">typeof</span> Game<span class="token punctuation">.</span>StateEnum<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;current:&quot;</span> <span class="token operator">+</span> StateName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>currentState <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>allStates<span class="token punctuation">[</span>StateName<span class="token punctuation">]</span> <span class="token keyword">as</span> State<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>currentState<span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 当前状态对输入的处理</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>currentState<span class="token punctuation">.</span><span class="token function">inputsHandler</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>InputListener<span class="token punctuation">.</span>inputs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 当前状态的更新</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>currentState<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">UI</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">draw</span><span class="token punctuation">(</span>Context2D<span class="token operator">:</span> CanvasRenderingContext2D<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>Scene<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>Context2D<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>player<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>Context2D<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">UI</span><span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>Context2D<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> lastTimeStampFromStart <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">refreshDisplay</span> <span class="token operator">=</span> <span class="token punctuation">(</span>currentTimeStampFromStart<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> timeInterval <span class="token operator">=</span> currentTimeStampFromStart <span class="token operator">-</span> lastTimeStampFromStart<span class="token punctuation">;</span> <span class="token comment">// 计算时间间隔</span>
      lastTimeStampFromStart <span class="token operator">=</span> currentTimeStampFromStart<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Context2D<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>refreshDisplay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">refreshDisplay</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;game is started.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">PreviewStatus</span> <span class="token keyword">extends</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>
  Game<span class="token operator">:</span> Game<span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>game<span class="token operator">:</span> Game<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>Game<span class="token punctuation">.</span>StateEnum<span class="token punctuation">.</span>Preview<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>Game <span class="token operator">=</span> game<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// 进入该状态</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>Game<span class="token punctuation">.</span>Music<span class="token punctuation">.</span>currentTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 从头开始播放</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>Game<span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>Game<span class="token punctuation">.</span>lives <span class="token operator">=</span> <span class="token number">1000000000</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>Game<span class="token punctuation">.</span>player<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>ShadowDog<span class="token punctuation">.</span>StateNamesEnum<span class="token punctuation">.</span>Running<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>Game<span class="token punctuation">.</span><span class="token constant">UI</span><span class="token punctuation">.</span>addScoreInfos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>Game<span class="token punctuation">.</span>Scene<span class="token punctuation">.</span>enemys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>Game<span class="token punctuation">.</span>Scene<span class="token punctuation">.</span>particles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>Game<span class="token punctuation">.</span>Scene<span class="token punctuation">.</span>explosions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>Game<span class="token punctuation">.</span>Scene<span class="token punctuation">.</span>spakParticles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// 该状态需要更新的信息，如在stopGame状态，则以下两个信息都不更新就好了</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>Game<span class="token punctuation">.</span>Scene<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>Game<span class="token punctuation">.</span>player<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">inputsHandler</span><span class="token punctuation">(</span>inputs<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>ValueOf<span class="token operator">&lt;</span><span class="token keyword">typeof</span> InputListener<span class="token punctuation">.</span>KeyMaps<span class="token operator">&gt;&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 输入处理，按下enter开始游戏</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>inputs<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>InputListener<span class="token punctuation">.</span>KeyMaps<span class="token punctuation">.</span>Enter<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>Game<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>Game<span class="token punctuation">.</span>StateEnum<span class="token punctuation">.</span>BeforeRunning<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-4-8-scene-场景" tabindex="-1"><a class="header-anchor" href="#_1-4-8-scene-场景"><span>1.4.8. Scene 场景</span></a></h3><p>主要是用来处理当背景移动，游戏中敌人应当随着背景一起移动的问题，</p><p>这里我写了一个场景类，把需要跟随场景移动的东西都放进去，</p><p>由该类来处理场景的移动速度和场景中物体坐标更新的问题</p><p>以下是部分代码</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Scene</span> <span class="token punctuation">{</span>
  Game<span class="token operator">:</span> Game<span class="token punctuation">;</span>
  <span class="token keyword">private</span> SceneSpeed <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  background<span class="token operator">:</span> Background<span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>Game<span class="token operator">:</span> Game<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>Game <span class="token operator">=</span> Game<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BackgroundCity</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>Game<span class="token punctuation">.</span><span class="token constant">GAME_WIDTH</span><span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>Game<span class="token punctuation">.</span><span class="token constant">GAME_HEIGHT</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 这一步最关键，处理死亡的敌人，</span>
  <span class="token comment">// 另外还要更具场景移动速度，重新计算场景中敌人的位置</span>
  <span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// handles</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">enemysHandle</span><span class="token punctuation">(</span>timeInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 最值处理，限制粒子特效的数量</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>particles<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>particlesMaxLength<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>particles<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>particlesMaxLength<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>spakParticles<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>spakParticlesMaxLength<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>spakParticles<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>spakParticlesMaxLength<span class="token punctuation">;</span>
    <span class="token comment">// 更新</span>
    <span class="token comment">// 更新背景的移动速度</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>background<span class="token punctuation">.</span><span class="token function">setSpeed</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>SceneSpeed<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>background<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 移除死亡和超出屏幕的敌人</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>enemys <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>enemys<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">!</span>item<span class="token punctuation">.</span><span class="token function">isOutOfLeftScreem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span><span class="token function">getAliveFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 更新和重新计算敌人的坐标</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>enemys<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      item<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
      item<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>SceneSpeed <span class="token operator">*</span> timeInterval<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 更新和重新计算粒子特效的坐标</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>particles<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      item<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
      item<span class="token punctuation">.</span>posX <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>SceneSpeed <span class="token operator">*</span> timeInterval<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>explosions <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>explosions<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      item<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
      item<span class="token punctuation">.</span>posX <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>SceneSpeed <span class="token operator">*</span> timeInterval<span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token operator">!</span>item<span class="token punctuation">.</span><span class="token function">isLastAnimateFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>spakParticles<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      item<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
      item<span class="token punctuation">.</span>posX <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>SceneSpeed <span class="token operator">*</span> timeInterval<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 绘制场景中的物体</span>
  <span class="token function">draw</span><span class="token punctuation">(</span>Context2D<span class="token operator">:</span> CanvasRenderingContext2D<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>background<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>Context2D<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>enemys<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>Context2D<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>explosions<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>Context2D<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>particles<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>Context2D<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>spakParticles<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>Context2D<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 设置场景移动速度</span>
  <span class="token function">setSceneSpeed</span><span class="token punctuation">(</span>newSpeed<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>SceneSpeed <span class="token operator">=</span> newSpeed<span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">enemysHandle</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 周期添加敌人</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>addEnemyTimer <span class="token operator">+=</span> timeInterval<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>addEnemyIntermval<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>addEnemyTimer <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">switch</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token function">RandomRange</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span> <span class="token comment">// 略</span>
        <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-4-9-ui" tabindex="-1"><a class="header-anchor" href="#_1-4-9-ui"><span>1.4.9. UI</span></a></h3><p>UI 这部分代码写的又长又丑，只看结构</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Game <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./Game.js&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">addScoreInfo</span> <span class="token operator">=</span> <span class="token punctuation">{</span> posX<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> posY<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> score<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token constant">UI</span></span> <span class="token punctuation">{</span>
  Game<span class="token operator">:</span> Game<span class="token punctuation">;</span>
  livesImg<span class="token operator">:</span> HTMLImageElement<span class="token punctuation">;</span>
  imgWidth<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  imgHeight<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  imgDrawWidth<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  imgDrawHeight<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  addScoreInfos<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>addScoreInfo<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span>Game<span class="token operator">:</span> Game<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>Game <span class="token operator">=</span> Game<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>livesImg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>livesImg<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;./imgs/heart.png&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>imgWidth <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>imgHeight <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>imgDrawWidth <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span> <span class="token comment">//this.imgWidth * 0.5;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>imgDrawHeight <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span> <span class="token comment">// this.imgHeight * 0.5;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 对漂浮的分数的坐标的计算</span>
  <span class="token function">update</span><span class="token punctuation">(</span>timeInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> targetPosX <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> moveSpeedX <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> targetPosY <span class="token operator">=</span> <span class="token number">80</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> moveSpeedY <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">;</span>
    <span class="token comment">// 这里做的操作是更新数组中的坐标，使其朝着 targetPos 所在的坐标移动</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>addScoreInfos <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>addScoreInfos
      <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> stepX <span class="token operator">=</span> moveSpeedX <span class="token operator">*</span> timeInterval<span class="token punctuation">;</span>
        <span class="token keyword">const</span> stepY <span class="token operator">=</span> moveSpeedY <span class="token operator">*</span> timeInterval<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>posX <span class="token operator">-</span> targetPosX <span class="token operator">&gt;=</span> stepX<span class="token punctuation">)</span> item<span class="token punctuation">.</span>posX <span class="token operator">-=</span> stepX<span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>posY <span class="token operator">-</span> targetPosY <span class="token operator">&lt;=</span> stepX<span class="token punctuation">)</span> item<span class="token punctuation">.</span>posX <span class="token operator">+=</span> stepX<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>posY <span class="token operator">-</span> targetPosY <span class="token operator">&gt;=</span> stepY<span class="token punctuation">)</span> item<span class="token punctuation">.</span>posY <span class="token operator">-=</span> stepY<span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>posY <span class="token operator">-</span> targetPosY <span class="token operator">&lt;=</span> stepY<span class="token punctuation">)</span> item<span class="token punctuation">.</span>posY <span class="token operator">+=</span> stepY<span class="token punctuation">;</span>

        <span class="token keyword">const</span> gapX <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>posX <span class="token operator">-</span> targetPosX<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> gapY <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>posY <span class="token operator">-</span> targetPosY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>gapX <span class="token operator">&lt;</span> stepY <span class="token operator">&amp;&amp;</span> gapY <span class="token operator">&lt;</span> stepX<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 当前坐标和目标坐标之间的距离小于步长，则移除该项</span>
          <span class="token keyword">return</span> <span class="token keyword">null</span> <span class="token keyword">as</span> <span class="token builtin">unknown</span> <span class="token keyword">as</span> addScoreInfo<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> item<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">draw</span><span class="token punctuation">(</span>Context2D<span class="token operator">:</span> CanvasRenderingContext2D<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Context2D<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> txtSize <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> ShadowWidth <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    Context2D<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>txtSize<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px HanaleiFill</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Game<span class="token punctuation">.</span>currentState<span class="token punctuation">.</span>stateName <span class="token operator">==</span> Game<span class="token punctuation">.</span>StateEnum<span class="token punctuation">.</span>Preview<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 预览界面：显示按下什么键开始游戏</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Game<span class="token punctuation">.</span>currentState<span class="token punctuation">.</span>stateName <span class="token operator">==</span> Game<span class="token punctuation">.</span>StateEnum<span class="token punctuation">.</span>Running<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 游戏运行界面</span>
      <span class="token comment">// 绘制剩余的生命</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Game<span class="token punctuation">.</span>lives<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Context2D<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>livesImg<span class="token punctuation">,</span>
          <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>imgWidth<span class="token punctuation">,</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>imgHeight<span class="token punctuation">,</span>
          index <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>imgDrawWidth <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">,</span>
          <span class="token number">5</span><span class="token punctuation">,</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>imgDrawWidth<span class="token punctuation">,</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>imgDrawHeight
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 绘制漂浮的得分数字</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>addScoreInfos<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        Context2D<span class="token punctuation">.</span>textAlign <span class="token operator">=</span> <span class="token string">&quot;left&quot;</span><span class="token punctuation">;</span>
        Context2D<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&quot;white&quot;</span><span class="token punctuation">;</span>
        Context2D<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>score<span class="token punctuation">,</span> item<span class="token punctuation">.</span>posX<span class="token punctuation">,</span> item<span class="token punctuation">.</span>posY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Context2D<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&quot;black&quot;</span><span class="token punctuation">;</span>
        Context2D<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>
          item<span class="token punctuation">.</span>score<span class="token punctuation">,</span>
          item<span class="token punctuation">.</span>posX <span class="token operator">+</span> ShadowWidth<span class="token punctuation">,</span>
          item<span class="token punctuation">.</span>posY <span class="token operator">+</span> ShadowWidth
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Game<span class="token punctuation">.</span>currentState<span class="token punctuation">.</span>stateName <span class="token operator">==</span> Game<span class="token punctuation">.</span>StateEnum<span class="token punctuation">.</span>Stop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 游戏暂停界面</span>
      <span class="token comment">// 显示按下什么键继续游戏</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Game<span class="token punctuation">.</span>currentState<span class="token punctuation">.</span>stateName <span class="token operator">==</span> Game<span class="token punctuation">.</span>StateEnum<span class="token punctuation">.</span>GameOver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 游戏结束界面，显示分数</span>
    <span class="token punctuation">}</span>
    Context2D<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-4-10-字体" tabindex="-1"><a class="header-anchor" href="#_1-4-10-字体"><span>1.4.10. 字体</span></a></h3><div class="language-css line-numbers-mode" data-ext="css" data-title="css"><pre class="language-css"><code>// 这一步相当于是注册了一个字体，而后页面中就可以使用 \`HanaleiFill\` 这个字体
<span class="token atrule"><span class="token rule">@font-face</span></span> <span class="token punctuation">{</span>
  <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">&quot;HanaleiFill&quot;</span><span class="token punctuation">;</span>
  <span class="token property">src</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>../font/HanaleiFill-Regular.ttf<span class="token punctuation">)</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>如</strong></p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code>Context2D<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>txtSize<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px HanaleiFill</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>监听页面加载完毕事件和字体加载事件</strong></p><p><code>document.fonts</code> 的值是文档的 FontFaceSet 接口。FontFaceSet 接口 用于 对 加载新字体、检查已加载字体的加载状态。</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;load&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token comment">// 字体加载完成后的逻辑</span>
 document<span class="token punctuation">.</span>fonts<span class="token punctuation">.</span>ready<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 此时DOM中的资源和字体就以加载完毕了</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-4-11-canvas-铺满页面屏幕的实现" tabindex="-1"><a class="header-anchor" href="#_1-4-11-canvas-铺满页面屏幕的实现"><span>1.4.11. Canvas 铺满页面屏幕的实现</span></a></h3><div class="language-less line-numbers-mode" data-ext="less" data-title="less"><pre class="language-less"><code><span class="token selector">*</span> <span class="token punctuation">{</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">box-sizing</span><span class="token punctuation">:</span> border<span class="token operator">-</span>box<span class="token punctuation">;</span>
  <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">html,
body</span> <span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 100vw<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 100vh<span class="token punctuation">;</span>
  <span class="token selector">#myCanvas,
  #loading</span> <span class="token punctuation">{</span>
    <span class="token comment">// 居中</span>
    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
    <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
    <span class="token property">top</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span><span class="token operator">-</span>50%<span class="token punctuation">,</span> <span class="token operator">-</span>50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 关键：设置最大宽度为屏幕宽高的100%</span>
    <span class="token property">max-width</span><span class="token punctuation">:</span> 100vw<span class="token punctuation">;</span>
    <span class="token property">max-height</span><span class="token punctuation">:</span> 100vh<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-4-12-自写工具类" tabindex="-1"><a class="header-anchor" href="#_1-4-12-自写工具类"><span>1.4.12. 自写工具类</span></a></h3><p>没什么好讲的，主要看注释和用例</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">RandomRange</span><span class="token punctuation">(</span>from<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> to<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>to <span class="token operator">-</span> from<span class="token punctuation">)</span> <span class="token operator">+</span> from<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 注意传入的T需用as const修饰，否则被当做字符串</span>
<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">ValueOf<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,71);function _(x,B){const p=o("RouteLink"),c=o("ExternalLinkIcon"),l=o("CodeDemo");return u(),k("div",null,[m,n("blockquote",null,[v,n("p",null,[n("u",null,[a(p,{to:"/%E9%A1%B9%E7%9B%AE/TypeScript%E5%86%99%E7%9A%842D%E6%B8%B8%E6%88%8F%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82%E7%AC%94%E8%AE%B0/demo_shadowDog/"},{default:e(()=>[s("ShadowDog:0.0.2")]),_:1})])])]),b,n("blockquote",null,[y,n("p",null,[n("u",null,[n("a",w,[s("https://github.com/YiguiDing/shadowDog-Typescript"),a(c)])])])]),h,n("p",null,[a(p,{to:"/%E9%A1%B9%E7%9B%AE/TypeScript%E5%86%99%E7%9A%842D%E6%B8%B8%E6%88%8F%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82%E7%AC%94%E8%AE%B0/practices/1.canvas%EF%BC%9A%E5%8E%9F%E7%90%86/"},{default:e(()=>[s("原理.html")]),_:1})]),g,n("p",null,[a(p,{to:"/%E9%A1%B9%E7%9B%AE/TypeScript%E5%86%99%E7%9A%842D%E6%B8%B8%E6%88%8F%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82%E7%AC%94%E8%AE%B0/practices/2.animate%EF%BC%9A%E4%BC%98%E5%8C%96/"},{default:e(()=>[s("优化.html")]),_:1})]),a(l,{id:"code-demo-347",type:"normal",title:"%E4%BC%98%E5%8C%96%E5%8F%8A%E6%B8%B2%E6%9F%93%E6%89%80%E6%9C%89%E5%8A%A8%E5%9B%BE",code:"eJyFlf1P20YYx/+VU6ZJYWVxCKQUllZCjI1I7TQNtP0wT8jYl8Tg2Jl9eaEoEtJalQGDaQtofVG1IapO2pZQddICabd/xnaSn/Yv9Lk7v8RpaCTE2ff9PHePn7dsxwqkqMXmYxlZ0iuShVTlphgrbi2yt7XURnIuNW2WZ26IsVsZgTO3RD2jqBUka5JlAS3palEiqqF/uG7UgBN1hDKatI41lDPMQcAC1cIalgkK9uYzAmO5mafqUhGDoRjj/oQHrCkbubmZOeoO5cHCKFEBVSStTE1URcMg0iUjcO0KcqNcLAFJlzFkTtI0IOkyhjTLOoDwfwynqHfvbgHJ1jGspRIaNpWMu9tgXtJlDLmuEhojuowhNw3gNo0xVB6TAnOSP0TojMBTSotGgKqhq1rMI8uUwTIhQGLz2BKsgqQY1TXFyCdKeh7yLgAYm4xtWFCbFclEfkmim0gx5HIR6yTxbRmbWyvseMOMi7H3RtbtxEci7JlIJjUw9pEE+Lpo6ATXCFimFMohQUC9w3+co5OU0n10z27v2e199+RB97DlnH7ntC56L377/9VBr/WMPzsH950f/+g2Ot0/G73mv93XTeenA7u9Y18+dk8u3JfHog4n8qaB8/qdX3rNM+fsuXN+ZLcvp5PJ2lQ6Waqh/pMd9/t9Z+93+7+m27jg7i4ufPblwsraV9mPV5fB73jgeFVVSAF2Uumk/2keu7yU/XR5NQIXsJovkCi9UjIh88HJ6dl0VAiOSaemPQUy9rkmbWETdnVcRVmatTiPGMsgD0j3Rcd5ug/fhpZX79xm0JKGaa6Qc9SyO8/6D+85e786u+eKUbTbf4nQ197BCSgIOPwdJeG5UmL4CpEIZjxveE/ktWZQN6+uklHThMbGN05IirJUAdPbqkWwjqmRXJD0PNwziXJlXWbVH59A27TCow4Fh7DmgFPrftjDawFjltT1ebSNTKNqzaPkJJINDR5mUX2SynQyhfLUsEzHUSinhmUYQqE67atznsoGT6jP+PrUlAfAvAnltC+n/cNhyITy9eG76WQJ5dlhedMIxRvBzSlP5UMkJOZ8YoYB9cFwZnUF065OskqEDqLN+Pep8wpaj0I5E35IhqD287eIRaMMJeoT7k4HuhU49/jcKysCFfkJJWlXMMi+POs3HgIEA8FtHfUfNdLwgpzdB+4Pp879l/1GE95FPSgXnn5oGp77Qc/4VL0jkUIipxlQpKFT164hYeD6CfT+QB19PVB63yRokCA2KBqZq2gaW0bDWEzIGpbML6Bu41CE8Dc4e4I3PhZoNXMjxZSqfA5w/4NWZlmMfOEHkZnj6QNuBjq/wwNG2IzCkkNrxPnIFjejW/wrII0mhvFgkQU/SizK7vGu+/QJjP/u47bz+mf78vB6MleiI9zCJAu/GSY0N2uDUdZxL9P0jrqoB3mH11j9DSVKeWY="},{default:e(()=>[f,E]),_:1}),A,n("p",null,[a(p,{to:"/%E9%A1%B9%E7%9B%AE/TypeScript%E5%86%99%E7%9A%842D%E6%B8%B8%E6%88%8F%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82%E7%AC%94%E8%AE%B0/practices/3.%E8%A7%86%E5%B7%AE%E8%83%8C%E6%99%AF%EF%BC%9A%E5%8E%9F%E7%90%86/"})]),S,n("p",null,[a(p,{to:"/%E9%A1%B9%E7%9B%AE/TypeScript%E5%86%99%E7%9A%842D%E6%B8%B8%E6%88%8F%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82%E7%AC%94%E8%AE%B0/practices/4.%E8%A7%86%E5%B7%AE%E8%83%8C%E6%99%AF%EF%BC%9A%E4%BC%98%E5%8C%96/"},{default:e(()=>[s("视差背景.html")]),_:1})]),I])}const D=i(d,[["render",_],["__file","TypeScript写的2D游戏的实现细节笔记.html.vue"]]),q=JSON.parse('{"path":"/%E9%A1%B9%E7%9B%AE/TypeScript%E5%86%99%E7%9A%842D%E6%B8%B8%E6%88%8F%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82%E7%AC%94%E8%AE%B0/TypeScript%E5%86%99%E7%9A%842D%E6%B8%B8%E6%88%8F%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82%E7%AC%94%E8%AE%B0.html","title":"TypeScript写的2D游戏的实现细节笔记","lang":"zh-CN","frontmatter":{"title":"TypeScript写的2D游戏的实现细节笔记","date":"2023-01-10T05:57:00.000Z","cover":"./cover/TypeScript写的2D游戏的实现细节笔记.gif","tag":["笔记"],"category":"笔记","description":"1. TypeScript写的2D游戏的实现细节笔记 1.1. 试玩版本 URL 地址： 1.2. 源代码 源代码: https://github.com/YiguiDing/shadowDog-Typescript 1.3. 修改记录 0.0.1: 第一版 0.0.2: 压缩游戏音乐，优化加载速度，修改粒子特效移动速度和透明度的衰减方式 操作： En...","head":[["meta",{"property":"og:url","content":"https://dingdingdang.online/%E9%A1%B9%E7%9B%AE/TypeScript%E5%86%99%E7%9A%842D%E6%B8%B8%E6%88%8F%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82%E7%AC%94%E8%AE%B0/TypeScript%E5%86%99%E7%9A%842D%E6%B8%B8%E6%88%8F%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82%E7%AC%94%E8%AE%B0.html"}],["meta",{"property":"og:site_name","content":"Yigui-Ding的Blog小站"}],["meta",{"property":"og:title","content":"TypeScript写的2D游戏的实现细节笔记"}],["meta",{"property":"og:description","content":"1. TypeScript写的2D游戏的实现细节笔记 1.1. 试玩版本 URL 地址： 1.2. 源代码 源代码: https://github.com/YiguiDing/shadowDog-Typescript 1.3. 修改记录 0.0.1: 第一版 0.0.2: 压缩游戏音乐，优化加载速度，修改粒子特效移动速度和透明度的衰减方式 操作： En..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-03-18T08:31:16.000Z"}],["meta",{"property":"article:author","content":"丁毅桂"}],["meta",{"property":"article:tag","content":"笔记"}],["meta",{"property":"article:published_time","content":"2023-01-10T05:57:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-03-18T08:31:16.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"TypeScript写的2D游戏的实现细节笔记\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-01-10T05:57:00.000Z\\",\\"dateModified\\":\\"2024-03-18T08:31:16.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"丁毅桂\\",\\"email\\":\\"2449695354@qq.com\\"}]}"],["meta",{"name":"baidu-site-verification","content":"codeva-PwE9Ts6nMl"}]]},"headers":[{"level":2,"title":"1.1. 试玩版本","slug":"_1-1-试玩版本","link":"#_1-1-试玩版本","children":[]},{"level":2,"title":"1.2. 源代码","slug":"_1-2-源代码","link":"#_1-2-源代码","children":[]},{"level":2,"title":"1.3. 修改记录","slug":"_1-3-修改记录","link":"#_1-3-修改记录","children":[]},{"level":2,"title":"1.4. TypeScript写的2D游戏的实现细节笔记","slug":"_1-4-typescript写的2d游戏的实现细节笔记","link":"#_1-4-typescript写的2d游戏的实现细节笔记","children":[{"level":3,"title":"1.4.1. 笔记目录","slug":"_1-4-1-笔记目录","link":"#_1-4-1-笔记目录","children":[]},{"level":3,"title":"1.4.2. Canvas 绘图基本步骤","slug":"_1-4-2-canvas-绘图基本步骤","link":"#_1-4-2-canvas-绘图基本步骤","children":[]},{"level":3,"title":"1.4.3. 敌人的移动模式","slug":"_1-4-3-敌人的移动模式","link":"#_1-4-3-敌人的移动模式","children":[]},{"level":3,"title":"1.4.4. 视差背景原理","slug":"_1-4-4-视差背景原理","link":"#_1-4-4-视差背景原理","children":[]},{"level":3,"title":"1.4.5. 碰撞检测","slug":"_1-4-5-碰撞检测","link":"#_1-4-5-碰撞检测","children":[]},{"level":3,"title":"1.4.6. 粒子特效","slug":"_1-4-6-粒子特效","link":"#_1-4-6-粒子特效","children":[]},{"level":3,"title":"1.4.7. 输入监听和状态管理的实现","slug":"_1-4-7-输入监听和状态管理的实现","link":"#_1-4-7-输入监听和状态管理的实现","children":[]},{"level":3,"title":"1.4.8. Scene 场景","slug":"_1-4-8-scene-场景","link":"#_1-4-8-scene-场景","children":[]},{"level":3,"title":"1.4.9. UI","slug":"_1-4-9-ui","link":"#_1-4-9-ui","children":[]},{"level":3,"title":"1.4.10. 字体","slug":"_1-4-10-字体","link":"#_1-4-10-字体","children":[]},{"level":3,"title":"1.4.11. Canvas 铺满页面屏幕的实现","slug":"_1-4-11-canvas-铺满页面屏幕的实现","link":"#_1-4-11-canvas-铺满页面屏幕的实现","children":[]},{"level":3,"title":"1.4.12. 自写工具类","slug":"_1-4-12-自写工具类","link":"#_1-4-12-自写工具类","children":[]}]}],"git":{"createdTime":1710750676000,"updatedTime":1710750676000,"contributors":[{"name":"YiguiDing","email":"2449695354@qq.com","commits":1}]},"readingTime":{"minutes":25.15,"words":7544},"filePathRelative":"项目/TypeScript写的2D游戏的实现细节笔记/TypeScript写的2D游戏的实现细节笔记.md","localizedDate":"2023年1月10日","excerpt":"","autoDesc":true}');export{D as comp,q as data};
