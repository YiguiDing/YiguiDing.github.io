import{_ as l,c as p,d as c,w as a,a as n,r as i,o as u,e as s}from"./app-DjDtDPYL.js";const r={},k=n("h1",{id:"foc算法实现过程记录-v2-01-电压开环实现",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#foc算法实现过程记录-v2-01-电压开环实现"},[n("span",null,"FOC算法实现过程记录(v2):01.电压开环实现")])],-1),m=n("h2",{id:"电压开环实现",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#电压开环实现"},[n("span",null,"电压开环实现")])],-1),d=n("code",null,"motor.h",-1),_=n("code",null,"motor.c",-1),b=n("div",{class:"language-cpp line-numbers-mode","data-highlighter":"prismjs","data-ext":"cpp","data-title":"cpp"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"ifndef"),s(),n("span",{class:"token expression"},"__Motor_H__")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"__Motor_H__")])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},"<Arduino.h>")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},"<stdint.h>")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"foc_math.h"')])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"pid_controller.h"')])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"pll.h"')])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"ifdef"),s(),n("span",{class:"token expression"},"__cplusplus")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"extern"),s(),n("span",{class:"token string"},'"C"')]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"endif")])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 状态")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"typedef"),s(),n("span",{class:"token keyword"},"enum")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        Align "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("        Running "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("        Stop "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}"),s(" State"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 控制模式")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"typedef"),s(),n("span",{class:"token keyword"},"enum")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        OPEN_VOLTAGE_LOOP "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("        CLOSE_CURRENT_LOOP "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("        CLOSE_VELOCITY_LOOP "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}"),s(" ControlMode"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 调制模式")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"typedef"),s(),n("span",{class:"token keyword"},"enum")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        SPWM "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("        SVPWM "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}"),s(" Modulation"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"typedef"),s(),n("span",{class:"token keyword"},"struct")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// 极对数")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"uint8_t"),s(" pole_pairs"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// ########################################")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" power_supply"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// ########################################")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" target"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 目标值")]),s(`
`),n("span",{class:"line"},[s("        State state"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        ControlMode controlMode"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 控制模式")]),s(`
`),n("span",{class:"line"},[s("        Modulation modulation"),n("span",{class:"token punctuation"},";"),s("   "),n("span",{class:"token comment"},"// 调制模式")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// ########################################")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// clsoe_current_loop")]),s(`
`),n("span",{class:"line"},[s("        PidController pid_id_controller"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        PidController pid_iq_controller"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" Id_target"),n("span",{class:"token punctuation"},","),s(" Iq_target"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" Id"),n("span",{class:"token punctuation"},","),s(" Iq"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" Ia"),n("span",{class:"token punctuation"},","),s(" Ib"),n("span",{class:"token punctuation"},","),s(" Ic"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" Ialpha"),n("span",{class:"token punctuation"},","),s(" Ibeta"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// open_volatage_loop")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" Ud_target"),n("span",{class:"token punctuation"},","),s(" Uq_target"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" Ud"),n("span",{class:"token punctuation"},","),s(" Uq"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" Uahpha"),n("span",{class:"token punctuation"},","),s(" Ubeta"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" Ua"),n("span",{class:"token punctuation"},","),s(" Ub"),n("span",{class:"token punctuation"},","),s(" Uc"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// ########################################")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" theta_mes"),n("span",{class:"token punctuation"},";"),s("            "),n("span",{class:"token comment"},"//  测量角度 measurement")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" theta_mes_offset"),n("span",{class:"token punctuation"},";"),s("     "),n("span",{class:"token comment"},"//  测量角度误差 measurement")]),s(`
`),n("span",{class:"line"},[s("        PLL pll_theta"),n("span",{class:"token punctuation"},";"),s("              "),n("span",{class:"token comment"},"// 角度锁相环")]),s(`
`),n("span",{class:"line"},[s("        LowpassFilter theta_filter"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 估计角度滤波器")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" theta_est"),n("span",{class:"token punctuation"},";"),s("            "),n("span",{class:"token comment"},"// 估计角度 estimate")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" theta_pdt"),n("span",{class:"token punctuation"},";"),s("            "),n("span",{class:"token comment"},"// 预测角度 prediect")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" e_theta"),n("span",{class:"token punctuation"},";"),s("              "),n("span",{class:"token comment"},"// 电角度")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" omega"),n("span",{class:"token punctuation"},";"),s("                "),n("span",{class:"token comment"},"// 角速度")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" e_omega"),n("span",{class:"token punctuation"},";"),s("              "),n("span",{class:"token comment"},"//  电角速度")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" sin_e_theta"),n("span",{class:"token punctuation"},";"),s("          "),n("span",{class:"token comment"},"// sin(e_theta)")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" cos_e_theta"),n("span",{class:"token punctuation"},";"),s("          "),n("span",{class:"token comment"},"// cos(e_theta)")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// ########################################")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}"),s(" Motor"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"motor_init"),n("span",{class:"token punctuation"},"("),s("Motor "),n("span",{class:"token operator"},"*"),s("motor"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"uint8_t"),s(" pole_pairs"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" power_supply"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"motor_foc_loop"),n("span",{class:"token punctuation"},"("),s("Motor "),n("span",{class:"token operator"},"*"),s("motor"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" dt"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"motor_set_phrase_voltage"),n("span",{class:"token punctuation"},"("),s("Motor "),n("span",{class:"token operator"},"*"),s("motor"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"ifdef"),s(),n("span",{class:"token expression"},"__cplusplus")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"endif")])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"endif")])]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),v=n("div",{class:"language-cpp line-numbers-mode","data-highlighter":"prismjs","data-ext":"cpp","data-title":"cpp"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"motor.h"')])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"hardware.h"')])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"motor_init"),n("span",{class:"token punctuation"},"("),s("Motor "),n("span",{class:"token operator"},"*"),s("motor"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"uint8_t"),s(" pole_pairs"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" power_supply"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 初始化")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("pole_pairs "),n("span",{class:"token operator"},"="),s(" pole_pairs"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("power_supply "),n("span",{class:"token operator"},"="),s(" power_supply"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 初始化")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("target "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"5"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("controlMode "),n("span",{class:"token operator"},"="),s(" OPEN_VOLTAGE_LOOP"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("modulation "),n("span",{class:"token operator"},"="),s(" SPWM"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"pid_controller_init"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("motor"),n("span",{class:"token operator"},"->"),s("pid_id_controller"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"30"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"12"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"pid_controller_init"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("motor"),n("span",{class:"token operator"},"->"),s("pid_iq_controller"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"30"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"12"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 初始化")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("theta_mes "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("theta_mes_offset "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("theta_est "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("theta_pdt "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"pll_init"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("motor"),n("span",{class:"token operator"},"->"),s("pll_theta"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0.000050"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"500"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"lowpass_filter_init"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("motor"),n("span",{class:"token operator"},"->"),s("theta_filter"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0.000010"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("e_theta "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("omega "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0.1f"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("e_omega "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("sin_e_theta "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("cos_e_theta "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 初始化硬件")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// analogWriteResolution(12);")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// analogReadResolution(14);")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// pinMode(A5, INPUT);    // sensor-analog")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// pinMode(5, OUTPUT);    // pwmA")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// pinMode(9, OUTPUT);    // pwmB")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// pinMode(6, OUTPUT);    // pwmC")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"pinMode"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"8"),n("span",{class:"token punctuation"},","),s(" OUTPUT"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s("    "),n("span",{class:"token comment"},"// pwm_EN")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"digitalWrite"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"8"),n("span",{class:"token punctuation"},","),s(" HIGH"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// driver enable")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"sensor_align"),n("span",{class:"token punctuation"},"("),s("motor"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"sensor_align"),n("span",{class:"token punctuation"},"("),s("Motor "),n("span",{class:"token operator"},"*"),s("motor"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 等效为在 dq轴 -90°方向 注入电压。")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"hardware_set_pwm_duty"),n("span",{class:"token punctuation"},"(")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0.5"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token comment"},"// Ua = 0")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0.0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token comment"},"// Ub = 1")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0.0"),s("  "),n("span",{class:"token comment"},"// Uc = 1")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"delay"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1000"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 1s")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" x "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"uint8_t"),s(" n "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s(" n "),n("span",{class:"token operator"},"<="),s(),n("span",{class:"token number"},"100"),n("span",{class:"token punctuation"},";"),s(" n"),n("span",{class:"token operator"},"++"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" z "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"hardware_get_adc_value"),n("span",{class:"token punctuation"},"("),s("ADC_CHANNEL_22"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"*"),s(" M_TWOPI"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// 递归求均值")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// X[n] = X[n-1] + 1/n * (Z[n] - X[n-1])")]),s(`
`),n("span",{class:"line"},[s("        x "),n("span",{class:"token operator"},"="),s(" x "),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token punctuation"},"("),s("z "),n("span",{class:"token operator"},"-"),s(" x"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"/"),s(" n"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token function"},"delay"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"5"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("theta_mes_offset "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token operator"},"-"),s("x"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"hardware_set_pwm_duty"),n("span",{class:"token punctuation"},"(")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0.0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token comment"},"// Ua = 0")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0.0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token comment"},"// Ub = 0")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0.0"),s("  "),n("span",{class:"token comment"},"// Uc = 0")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"motor_state_update"),n("span",{class:"token punctuation"},"("),s("Motor "),n("span",{class:"token operator"},"*"),s("motor"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" dt"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"motor_foc_loop"),n("span",{class:"token punctuation"},"("),s("Motor "),n("span",{class:"token operator"},"*"),s("motor"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" dt"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// ########################################################")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// float angle = analogRead(A5) * M_TWOPI / 0x03fff; // [0,0x03fff] => [0,2*pi] 耗时50us")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("theta_mes "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"_normalizeAngle"),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"hardware_get_adc_value"),n("span",{class:"token punctuation"},"("),s("ADC_CHANNEL_22"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"*"),s(" M_TWOPI "),n("span",{class:"token operator"},"+"),s(" motor"),n("span",{class:"token operator"},"->"),s("theta_mes_offset"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 测量角度")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"pll_update"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("motor"),n("span",{class:"token operator"},"->"),s("pll_theta"),n("span",{class:"token punctuation"},","),s(" motor"),n("span",{class:"token operator"},"->"),s("theta_mes"),n("span",{class:"token punctuation"},","),s(" dt"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s("                                                            "),n("span",{class:"token comment"},"//  锁相环更新")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// motor->theta_est = lowpass_filter_update(&motor->theta_filter, motor->pll_theta.theta, dt);                     // 估计角度  滤波")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// ########################################################")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("theta_est "),n("span",{class:"token operator"},"="),s(" motor"),n("span",{class:"token operator"},"->"),s("theta_mes"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// motor->theta_est = motor->pll_theta.theta;")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("omega "),n("span",{class:"token operator"},"="),s(" motor"),n("span",{class:"token operator"},"->"),s("pll_theta"),n("span",{class:"token punctuation"},"."),s("omega"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// ########################################################")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("e_theta "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"_normalizeAngle"),n("span",{class:"token punctuation"},"("),s("motor"),n("span",{class:"token operator"},"->"),s("theta_est "),n("span",{class:"token operator"},"*"),s(" motor"),n("span",{class:"token operator"},"->"),s("pole_pairs"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("e_omega "),n("span",{class:"token operator"},"="),s(" motor"),n("span",{class:"token operator"},"->"),s("omega "),n("span",{class:"token operator"},"*"),s(" motor"),n("span",{class:"token operator"},"->"),s("pole_pairs"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("sin_e_theta "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"sinf"),n("span",{class:"token punctuation"},"("),s("motor"),n("span",{class:"token operator"},"->"),s("e_theta"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// Arduino UNO R4（带FPU） 最省时 sinf+cosf  耗时10us")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("cos_e_theta "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"cosf"),n("span",{class:"token punctuation"},"("),s("motor"),n("span",{class:"token operator"},"->"),s("e_theta"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// ########################################################")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// motor->sin_e_theta = _sin(motor->e_theta); // 查表法 _sin+_cos 耗时46us")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// motor->cos_e_theta = _cos(motor->e_theta);")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// ########################################################")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// motor->sin_e_theta = sin(motor->e_theta); // 双精度 耗时严重 sin+cos 100us~129us")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// motor->cos_e_theta = cos(motor->e_theta);")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// ########################################################")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"//")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"switch"),s(),n("span",{class:"token punctuation"},"("),s("motor"),n("span",{class:"token operator"},"->"),s("controlMode"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"case"),s(" CLOSE_VELOCITY_LOOP"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"break"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"case"),s(" CLOSE_CURRENT_LOOP"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("        motor"),n("span",{class:"token operator"},"->"),s("Id_target "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        motor"),n("span",{class:"token operator"},"->"),s("Iq_target "),n("span",{class:"token operator"},"="),s(" motor"),n("span",{class:"token operator"},"->"),s("target"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token function"},"motor_close_current_loop"),n("span",{class:"token punctuation"},"("),s("motor"),n("span",{class:"token punctuation"},","),s(" dt"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"break"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"case"),s(" OPEN_VOLTAGE_LOOP"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("        motor"),n("span",{class:"token operator"},"->"),s("Ud_target "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        motor"),n("span",{class:"token operator"},"->"),s("Uq_target "),n("span",{class:"token operator"},"="),s(" motor"),n("span",{class:"token operator"},"->"),s("target"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token function"},"motor_open_voltage_loop"),n("span",{class:"token punctuation"},"("),s("motor"),n("span",{class:"token punctuation"},","),s(" dt"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"break"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"default"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"break"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"//")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"motor_open_voltage_loop"),n("span",{class:"token punctuation"},"("),s("Motor "),n("span",{class:"token operator"},"*"),s("motor"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" dt"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("Ud "),n("span",{class:"token operator"},"="),s(" motor"),n("span",{class:"token operator"},"->"),s("Ud_target"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("Uq "),n("span",{class:"token operator"},"="),s(" motor"),n("span",{class:"token operator"},"->"),s("Uq_target"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"switch"),s(),n("span",{class:"token punctuation"},"("),s("motor"),n("span",{class:"token operator"},"->"),s("modulation"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"case"),s(" SPWM"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token comment"},"// 帕克逆变换+克拉克逆变换 耗时13us")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"M_SQRT3_2"),s(),n("span",{class:"token expression"},[n("span",{class:"token number"},"0.866025403785"),s()]),n("span",{class:"token comment"},"// sqrt(3)/2")])]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// 帕克逆变换")]),s(`
`),n("span",{class:"line"},[s("        motor"),n("span",{class:"token operator"},"->"),s("Uahpha "),n("span",{class:"token operator"},"="),s(" motor"),n("span",{class:"token operator"},"->"),s("cos_e_theta "),n("span",{class:"token operator"},"*"),s(" motor"),n("span",{class:"token operator"},"->"),s("Ud "),n("span",{class:"token operator"},"-"),s(" motor"),n("span",{class:"token operator"},"->"),s("sin_e_theta "),n("span",{class:"token operator"},"*"),s(" motor"),n("span",{class:"token operator"},"->"),s("Uq"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        motor"),n("span",{class:"token operator"},"->"),s("Ubeta "),n("span",{class:"token operator"},"="),s(" motor"),n("span",{class:"token operator"},"->"),s("sin_e_theta "),n("span",{class:"token operator"},"*"),s(" motor"),n("span",{class:"token operator"},"->"),s("Ud "),n("span",{class:"token operator"},"+"),s(" motor"),n("span",{class:"token operator"},"->"),s("cos_e_theta "),n("span",{class:"token operator"},"*"),s(" motor"),n("span",{class:"token operator"},"->"),s("Uq"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// 克拉克逆变换")]),s(`
`),n("span",{class:"line"},[s("        motor"),n("span",{class:"token operator"},"->"),s("Ua "),n("span",{class:"token operator"},"="),s(" motor"),n("span",{class:"token operator"},"->"),s("Uahpha"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 等赋值形式")]),s(`
`),n("span",{class:"line"},[s("        motor"),n("span",{class:"token operator"},"->"),s("Ub "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"0.5f"),s(),n("span",{class:"token operator"},"*"),s(" motor"),n("span",{class:"token operator"},"->"),s("Uahpha "),n("span",{class:"token operator"},"+"),s(" M_SQRT3_2 "),n("span",{class:"token operator"},"*"),s(" motor"),n("span",{class:"token operator"},"->"),s("Ubeta"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        motor"),n("span",{class:"token operator"},"->"),s("Uc "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token punctuation"},"("),s("motor"),n("span",{class:"token operator"},"->"),s("Ua "),n("span",{class:"token operator"},"+"),s(" motor"),n("span",{class:"token operator"},"->"),s("Ub"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 基尔霍夫电压电流定律")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"break"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"case"),s(" SVPWM"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"M_PI_3"),s(),n("span",{class:"token expression"},[n("span",{class:"token number"},"1.0471975512"),s("   ")]),n("span",{class:"token comment"},"// pi/3")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"M_SQRT3"),s(),n("span",{class:"token expression"},[n("span",{class:"token number"},"1.73205080757"),s()]),n("span",{class:"token comment"},"// sqrt(3)")])]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"int"),s(" sector "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"floor"),n("span",{class:"token punctuation"},"("),s("motor"),n("span",{class:"token operator"},"->"),s("e_theta "),n("span",{class:"token operator"},"/"),s(" M_PI_3"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" T1 "),n("span",{class:"token operator"},"="),s(" M_SQRT3 "),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token function"},"sinf"),n("span",{class:"token punctuation"},"("),s("sector "),n("span",{class:"token operator"},"*"),s(" M_PI_3 "),n("span",{class:"token operator"},"-"),s(" motor"),n("span",{class:"token operator"},"->"),s("e_theta"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"*"),s(" motor"),n("span",{class:"token operator"},"->"),s("Uq "),n("span",{class:"token operator"},"/"),s(" motor"),n("span",{class:"token operator"},"->"),s("power_supply"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" T2 "),n("span",{class:"token operator"},"="),s(" M_SQRT3 "),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token function"},"sinf"),n("span",{class:"token punctuation"},"("),s("motor"),n("span",{class:"token operator"},"->"),s("e_theta "),n("span",{class:"token operator"},"-"),s(),n("span",{class:"token punctuation"},"("),s("sector "),n("span",{class:"token operator"},"-"),s(),n("span",{class:"token number"},"1.0f"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"*"),s(" M_PI_3"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"*"),s(" motor"),n("span",{class:"token operator"},"->"),s("Uq "),n("span",{class:"token operator"},"/"),s(" motor"),n("span",{class:"token operator"},"->"),s("power_supply"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" T0 "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1"),s(),n("span",{class:"token operator"},"-"),s(" T1 "),n("span",{class:"token operator"},"-"),s(" T2"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" Ta"),n("span",{class:"token punctuation"},","),s(" Tb"),n("span",{class:"token punctuation"},","),s(" Tc"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"switch"),s(),n("span",{class:"token punctuation"},"("),s("sector"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"case"),s(),n("span",{class:"token number"},"1"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("            Ta "),n("span",{class:"token operator"},"="),s(" T1 "),n("span",{class:"token operator"},"+"),s(" T2 "),n("span",{class:"token operator"},"+"),s(" T0 "),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("            Tb "),n("span",{class:"token operator"},"="),s(" T2 "),n("span",{class:"token operator"},"+"),s(" T0 "),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("            Tc "),n("span",{class:"token operator"},"="),s(" T0 "),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("            "),n("span",{class:"token keyword"},"break"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"case"),s(),n("span",{class:"token number"},"2"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("            Ta "),n("span",{class:"token operator"},"="),s(" T1 "),n("span",{class:"token operator"},"+"),s(" T0 "),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("            Tb "),n("span",{class:"token operator"},"="),s(" T1 "),n("span",{class:"token operator"},"+"),s(" T2 "),n("span",{class:"token operator"},"+"),s(" T0 "),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("            Tc "),n("span",{class:"token operator"},"="),s(" T0 "),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("            "),n("span",{class:"token keyword"},"break"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"case"),s(),n("span",{class:"token number"},"3"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("            Ta "),n("span",{class:"token operator"},"="),s(" T0 "),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("            Tb "),n("span",{class:"token operator"},"="),s(" T1 "),n("span",{class:"token operator"},"+"),s(" T2 "),n("span",{class:"token operator"},"+"),s(" T0 "),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("            Tc "),n("span",{class:"token operator"},"="),s(" T2 "),n("span",{class:"token operator"},"+"),s(" T0 "),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("            "),n("span",{class:"token keyword"},"break"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"case"),s(),n("span",{class:"token number"},"4"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("            Ta "),n("span",{class:"token operator"},"="),s(" T0 "),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("            Tb "),n("span",{class:"token operator"},"="),s(" T1 "),n("span",{class:"token operator"},"+"),s(" T0 "),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("            Tc "),n("span",{class:"token operator"},"="),s(" T1 "),n("span",{class:"token operator"},"+"),s(" T2 "),n("span",{class:"token operator"},"+"),s(" T0 "),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("            "),n("span",{class:"token keyword"},"break"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"case"),s(),n("span",{class:"token number"},"5"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("            Ta "),n("span",{class:"token operator"},"="),s(" T2 "),n("span",{class:"token operator"},"+"),s(" T0 "),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("            Tb "),n("span",{class:"token operator"},"="),s(" T0 "),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("            Tc "),n("span",{class:"token operator"},"="),s(" T1 "),n("span",{class:"token operator"},"+"),s(" T2 "),n("span",{class:"token operator"},"+"),s(" T0 "),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("            "),n("span",{class:"token keyword"},"break"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"case"),s(),n("span",{class:"token number"},"6"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("            Ta "),n("span",{class:"token operator"},"="),s(" T1 "),n("span",{class:"token operator"},"+"),s(" T2 "),n("span",{class:"token operator"},"+"),s(" T0 "),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("            Tb "),n("span",{class:"token operator"},"="),s(" T0 "),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("            Tc "),n("span",{class:"token operator"},"="),s(" T1 "),n("span",{class:"token operator"},"+"),s(" T0 "),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("            "),n("span",{class:"token keyword"},"break"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"default"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("            Ta "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("            Tb "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("            Tc "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("            motor"),n("span",{class:"token operator"},"->"),s("Ua "),n("span",{class:"token operator"},"="),s(" Ta "),n("span",{class:"token operator"},"*"),s(" motor"),n("span",{class:"token operator"},"->"),s("power_supply"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("            motor"),n("span",{class:"token operator"},"->"),s("Ub "),n("span",{class:"token operator"},"="),s(" Tb "),n("span",{class:"token operator"},"*"),s(" motor"),n("span",{class:"token operator"},"->"),s("power_supply"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("            motor"),n("span",{class:"token operator"},"->"),s("Uc "),n("span",{class:"token operator"},"="),s(" Tc "),n("span",{class:"token operator"},"*"),s(" motor"),n("span",{class:"token operator"},"->"),s("power_supply"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"break"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"default"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"break"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 耗时38~46us:")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// [-1,+1] -> [-0.5,+0.5] -> [0,1] -> [0,0x0fff]")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// analogWrite(5, (motor->Ua / motor->power_supply * 0.5 + 0.5f) * 0x0fff);")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// analogWrite(9, (motor->Ub / motor->power_supply * 0.5 + 0.5f) * 0x0fff);")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// analogWrite(6, (motor->Uc / motor->power_supply * 0.5 + 0.5f) * 0x0fff);")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 耗时：")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"hardware_set_pwm_duty"),n("span",{class:"token punctuation"},"(")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),s("motor"),n("span",{class:"token operator"},"->"),s("Ua "),n("span",{class:"token operator"},"/"),s(" motor"),n("span",{class:"token operator"},"->"),s("power_supply "),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token number"},"0.5"),s(),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token number"},"0.5f"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),s("motor"),n("span",{class:"token operator"},"->"),s("Ub "),n("span",{class:"token operator"},"/"),s(" motor"),n("span",{class:"token operator"},"->"),s("power_supply "),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token number"},"0.5"),s(),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token number"},"0.5f"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),s("motor"),n("span",{class:"token operator"},"->"),s("Uc "),n("span",{class:"token operator"},"/"),s(" motor"),n("span",{class:"token operator"},"->"),s("power_supply "),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token number"},"0.5"),s(),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token number"},"0.5f"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"motor_close_current_loop"),n("span",{class:"token punctuation"},"("),s("Motor "),n("span",{class:"token operator"},"*"),s("motor"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" dt"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 电流采样")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// close_current_loop")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// motor->Ia = (analogRead(A0) * 5.0f / 0x03fff) - 2.5f; // [0,0x03fff] => [-2.5,+2.5] 耗时50us")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// motor->Ib = (analogRead(A2) * 5.0f / 0x03fff) - 2.5f; // [0,0x03fff] => [-2.5,+2.5] 耗时50us")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// motor->Ic = -(motor->Ia + motor->Ib);")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 电流采样")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("Ia "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"hardware_get_adc_value"),n("span",{class:"token punctuation"},"("),s("CHANNEL_9"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),s(),n("span",{class:"token number"},"0.5"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"0.01"),s(),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token number"},"50"),n("span",{class:"token punctuation"},";"),s("  "),n("span",{class:"token comment"},"// [0,1] -> [-0.5,0.5] -> 0.01Ω 50倍 i=u/r")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("Ib "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"hardware_get_adc_value"),n("span",{class:"token punctuation"},"("),s("CHANNEL_1"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),s(),n("span",{class:"token number"},"0.5"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"0.01"),s(),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token number"},"50"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// [0,1] -> [-0.5,0.5] -> 0.01Ω 50倍 i=u/r")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("Ic "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token punctuation"},"("),s("motor"),n("span",{class:"token operator"},"->"),s("Ia "),n("span",{class:"token operator"},"+"),s(" motor"),n("span",{class:"token operator"},"->"),s("Ib"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 克拉克变换")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("Ialpha "),n("span",{class:"token operator"},"="),s(" motor"),n("span",{class:"token operator"},"->"),s("Ia"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 等幅值形式")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("Ibeta "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"sqrtf"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"3"),s(),n("span",{class:"token operator"},"*"),s(" motor"),n("span",{class:"token operator"},"->"),s("Ia "),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token number"},"2"),s(),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token function"},"sqrtf"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"3"),s(),n("span",{class:"token operator"},"*"),s(" motor"),n("span",{class:"token operator"},"->"),s("Ib"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 帕克变换")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("Id "),n("span",{class:"token operator"},"="),s(" motor"),n("span",{class:"token operator"},"->"),s("cos_e_theta "),n("span",{class:"token operator"},"*"),s(" motor"),n("span",{class:"token operator"},"->"),s("Ialpha "),n("span",{class:"token operator"},"+"),s(" motor"),n("span",{class:"token operator"},"->"),s("sin_e_theta "),n("span",{class:"token operator"},"*"),s(" motor"),n("span",{class:"token operator"},"->"),s("Ibeta"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("Ia "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token operator"},"-"),s("motor"),n("span",{class:"token operator"},"->"),s("sin_e_theta "),n("span",{class:"token operator"},"*"),s(" motor"),n("span",{class:"token operator"},"->"),s("Ialpha "),n("span",{class:"token operator"},"+"),s(" motor"),n("span",{class:"token operator"},"->"),s("cos_e_theta "),n("span",{class:"token operator"},"*"),s(" motor"),n("span",{class:"token operator"},"->"),s("Ibeta"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 电流环pid")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("Ud_target "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"pid_controller_update"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("motor"),n("span",{class:"token operator"},"->"),s("pid_id_controller"),n("span",{class:"token punctuation"},","),s(" motor"),n("span",{class:"token operator"},"->"),s("Id "),n("span",{class:"token operator"},"-"),s(" motor"),n("span",{class:"token operator"},"->"),s("Id_target"),n("span",{class:"token punctuation"},","),s(" dt"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    motor"),n("span",{class:"token operator"},"->"),s("Uq_target "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"pid_controller_update"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("motor"),n("span",{class:"token operator"},"->"),s("pid_iq_controller"),n("span",{class:"token punctuation"},","),s(" motor"),n("span",{class:"token operator"},"->"),s("Iq "),n("span",{class:"token operator"},"-"),s(" motor"),n("span",{class:"token operator"},"->"),s("Iq_target"),n("span",{class:"token punctuation"},","),s(" dt"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 电压环")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"motor_open_voltage_loop"),n("span",{class:"token punctuation"},"("),s("motor"),n("span",{class:"token punctuation"},","),s(" dt"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),f=n("code",null,"hardware.h",-1),h=n("code",null,"hardware.c",-1),g=n("div",{class:"language-cpp line-numbers-mode","data-highlighter":"prismjs","data-ext":"cpp","data-title":"cpp"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"ifndef"),s(),n("span",{class:"token expression"},"__HARDWARE_H__")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"__HARDWARE_H__")])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},"<common_data.h>")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},"<r_cgc.h>")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},"<r_adc.h>")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},"<r_gpt.h>")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},"<r_ioport.h>")])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"ifdef"),s(),n("span",{class:"token expression"},"__cplusplus")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"extern"),s(),n("span",{class:"token string"},'"C"')]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"endif")])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"hardware_init"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(),n("span",{class:"token function"},"hardware_get_adc_value"),n("span",{class:"token punctuation"},"("),s("adc_channel_t channel"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"hardware_set_pwm_duty"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"uint8_t"),s(" chA"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" dutyA"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"uint8_t"),s(" chB"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" dutyB"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"uint8_t"),s(" chC"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" dutyC"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"ifdef"),s(),n("span",{class:"token expression"},"__cplusplus")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"endif")])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"endif")])]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),y=n("div",{class:"language-cpp line-numbers-mode","data-highlighter":"prismjs","data-ext":"cpp","data-title":"cpp"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"hardware.h"')])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"/**"),s(`
`),n("span",{class:"line"}," * Current Sensor"),s(`
`),n("span",{class:"line"}," * i_a A0 P014  AN09"),s(`
`),n("span",{class:"line"}," * i_b A2 P001  AN01"),s(`
`),n("span",{class:"line"}," *"),s(`
`),n("span",{class:"line"}," * Position Sensor"),s(`
`),n("span",{class:"line"}," * theta A5 P100 AN022"),s(`
`),n("span",{class:"line"}," *"),s(`
`),n("span",{class:"line"}," * PWM"),s(`
`),n("span",{class:"line"}," * A D5 P103 GPT2_A"),s(`
`),n("span",{class:"line"}," * B D9 P304 GPT7_A"),s(`
`),n("span",{class:"line"}," * C D6 P102 GPT2_B"),s(`
`),n("span",{class:"line"}," *"),s(`
`),n("span",{class:"line"}," * A D5-GPT2_A or D3-GPT1_B"),s(`
`),n("span",{class:"line"}," * B D9-GPT7_A or D10-GPT3_B"),s(`
`),n("span",{class:"line"}," * C D6-GPT2_B or D11-NULL"),s(`
`),n("span",{class:"line"}," * EN 8"),s(`
`),n("span",{class:"line"}," */")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"//")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"//")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"//")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"//")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"// 产品页：https://store.arduino.cc/products/uno-r4-minima")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"// 电路图：https://docs.arduino.cc/resources/schematics/ABX00080-schematics.pdf")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"// 芯片手册：https://www.renesas.com/en/document/dst/ra4m1-group-datasheet")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"// Renesas Flexible Software Package (FSP)库函数手册: https://renesas.github.io/fsp/")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("adc_instance_ctrl_t adc_ctrl"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("adc_cfg_t adc_cfg"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("adc_extended_cfg_t adc_cfg_extend"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("adc_channel_cfg_t adc_channel_cfg"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"uint16_t"),s(),n("span",{class:"token operator"},"*"),s("adc_channel "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"uint16_t"),s(),n("span",{class:"token operator"},"*"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"("),s("R_ADC0"),n("span",{class:"token operator"},"->"),s("ADDR"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"adc_callback"),n("span",{class:"token punctuation"},"("),s("adc_callback_args_t "),n("span",{class:"token operator"},"*"),s("p_args"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"adc_init"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    adc_cfg"),n("span",{class:"token punctuation"},"."),s("unit "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    adc_cfg"),n("span",{class:"token punctuation"},"."),s("mode "),n("span",{class:"token operator"},"="),s(" ADC_MODE_CONTINUOUS_SCAN"),n("span",{class:"token punctuation"},";"),s("    "),n("span",{class:"token comment"},"// 连续采样")]),s(`
`),n("span",{class:"line"},[s("    adc_cfg"),n("span",{class:"token punctuation"},"."),s("resolution "),n("span",{class:"token operator"},"="),s(" ADC_RESOLUTION_14_BIT"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 14bit")]),s(`
`),n("span",{class:"line"},[s("    adc_cfg"),n("span",{class:"token punctuation"},"."),s("alignment "),n("span",{class:"token operator"},"="),s(" ADC_ALIGNMENT_RIGHT"),n("span",{class:"token punctuation"},";"),s("    "),n("span",{class:"token comment"},"// 右对齐")]),s(`
`),n("span",{class:"line"},[s("    adc_cfg"),n("span",{class:"token punctuation"},"."),s("trigger "),n("span",{class:"token operator"},"="),s(" ADC_TRIGGER_SOFTWARE"),n("span",{class:"token punctuation"},";"),s("     "),n("span",{class:"token comment"},"// 软件触发")]),s(`
`),n("span",{class:"line"},[s("    adc_cfg"),n("span",{class:"token punctuation"},"."),s("p_callback "),n("span",{class:"token operator"},"="),s(" adc_callback"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    adc_cfg"),n("span",{class:"token punctuation"},"."),s("p_context "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token constant"},"NULL"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    adc_cfg"),n("span",{class:"token punctuation"},"."),s("scan_end_irq "),n("span",{class:"token operator"},"="),s(" FSP_INVALID_VECTOR"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 未定义的中断向量")]),s(`
`),n("span",{class:"line"},[s("    adc_cfg"),n("span",{class:"token punctuation"},"."),s("scan_end_ipl "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"12"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s("               "),n("span",{class:"token comment"},"// 中断优先级")]),s(`
`),n("span",{class:"line"},[s("    adc_cfg"),n("span",{class:"token punctuation"},"."),s("scan_end_b_irq "),n("span",{class:"token operator"},"="),s(" FSP_INVALID_VECTOR"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    adc_cfg"),n("span",{class:"token punctuation"},"."),s("scan_end_b_ipl "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"12"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    adc_cfg"),n("span",{class:"token punctuation"},"."),s("p_extend "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token operator"},"&"),s("adc_cfg_extend"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    adc_cfg_extend"),n("span",{class:"token punctuation"},"."),s("add_average_count "),n("span",{class:"token operator"},"="),s(" ADC_ADD_OFF"),n("span",{class:"token punctuation"},";"),s("     "),n("span",{class:"token comment"},"// 不使用均值采样")]),s(`
`),n("span",{class:"line"},[s("    adc_cfg_extend"),n("span",{class:"token punctuation"},"."),s("clearing "),n("span",{class:"token operator"},"="),s(" ADC_CLEAR_AFTER_READ_OFF"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 读取后不清零")]),s(`
`),n("span",{class:"line"},[s("    adc_cfg_extend"),n("span",{class:"token punctuation"},"."),s("trigger_group_b "),n("span",{class:"token operator"},"="),s(" ADC_TRIGGER_SOFTWARE"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    adc_cfg_extend"),n("span",{class:"token punctuation"},"."),s("double_trigger_mode "),n("span",{class:"token operator"},"="),s(" ADC_DOUBLE_TRIGGER_DISABLED"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"//")]),s(`
`),n("span",{class:"line"},[s("    adc_cfg_extend"),n("span",{class:"token punctuation"},"."),s("adc_vref_control "),n("span",{class:"token operator"},"="),s(" ADC_VREF_CONTROL_AVCC0_AVSS0"),n("span",{class:"token punctuation"},";"),s("   "),n("span",{class:"token comment"},"// 参考电压为AVCC AVSS")]),s(`
`),n("span",{class:"line"},[s("    adc_cfg_extend"),n("span",{class:"token punctuation"},"."),s("enable_adbuf "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    adc_cfg_extend"),n("span",{class:"token punctuation"},"."),s("window_a_irq "),n("span",{class:"token operator"},"="),s(" FSP_INVALID_VECTOR"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 未定义的中断向量")]),s(`
`),n("span",{class:"line"},[s("    adc_cfg_extend"),n("span",{class:"token punctuation"},"."),s("window_a_ipl "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"12"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s("               "),n("span",{class:"token comment"},"// 中断优先级")]),s(`
`),n("span",{class:"line"},[s("    adc_cfg_extend"),n("span",{class:"token punctuation"},"."),s("window_b_irq "),n("span",{class:"token operator"},"="),s(" FSP_INVALID_VECTOR"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    adc_cfg_extend"),n("span",{class:"token punctuation"},"."),s("window_b_ipl "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"12"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    adc_channel_cfg"),n("span",{class:"token punctuation"},"."),s("sample_hold_states "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"24"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    adc_channel_cfg"),n("span",{class:"token punctuation"},"."),s("scan_mask "),n("span",{class:"token operator"},"="),s(" ADC_MASK_CHANNEL_9 "),n("span",{class:"token operator"},"|"),s(" ADC_MASK_CHANNEL_1 "),n("span",{class:"token operator"},"|"),s(" ADC_MASK_CHANNEL_22"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    adc_channel_cfg"),n("span",{class:"token punctuation"},"."),s("scan_mask_group_b "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    adc_channel_cfg"),n("span",{class:"token punctuation"},"."),s("add_mask "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    adc_channel_cfg"),n("span",{class:"token punctuation"},"."),s("p_window_cfg "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token constant"},"NULL"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    adc_channel_cfg"),n("span",{class:"token punctuation"},"."),s("priority_group_a "),n("span",{class:"token operator"},"="),s(" ADC_GROUP_A_PRIORITY_OFF"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    adc_channel_cfg"),n("span",{class:"token punctuation"},"."),s("sample_hold_mask "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"R_ADC_Open"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("adc_ctrl"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),s("adc_cfg"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"R_ADC_ScanCfg"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("adc_ctrl"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),s("adc_channel_cfg"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"R_ADC_ScanStart"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("adc_ctrl"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"float"),s(),n("span",{class:"token function"},"hardware_get_adc_value"),n("span",{class:"token punctuation"},"("),s("adc_channel_t channel"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// return R_ADC0->ADDR[channel];")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"uint16_t"),s(" result"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"R_ADC_Read"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("adc_ctrl"),n("span",{class:"token punctuation"},","),s(" channel"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),s("result"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"return"),s(" result "),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"16383.0f"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"// pwmA D5 P107_GPT0_A")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"// pwmB D9 P303_GPT7_B")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"// pwmC D6 P111_GPT3_A")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"uint8_t"),s(" timer_ch"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"7"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("gpt_io_pin_t pwm_ch"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),s("GPT_IO_PIN_GTIOCA"),n("span",{class:"token punctuation"},","),s(" GPT_IO_PIN_GTIOCB"),n("span",{class:"token punctuation"},","),s(" GPT_IO_PIN_GTIOCA"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("bsp_io_port_pin_t io_port"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),s("BSP_IO_PORT_01_PIN_07"),n("span",{class:"token punctuation"},","),s(" BSP_IO_PORT_03_PIN_03"),n("span",{class:"token punctuation"},","),s(" BSP_IO_PORT_01_PIN_11"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("gpt_instance_ctrl_t gpt_ctrls"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("timer_cfg_t gpt_timer_cfgs"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("gpt_extended_cfg_t gpt_ext_cfgs"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("gpt_extended_pwm_cfg_t gpt_pwm_cfgs"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"gpt_init"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"uint32_t"),s(" start_mask "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"int8_t"),s(" idx "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";"),s(" idx "),n("span",{class:"token operator"},"<="),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},";"),s(" idx"),n("span",{class:"token operator"},"++"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token function"},"R_IOPORT_PinCfg"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("g_ioport_ctrl"),n("span",{class:"token punctuation"},","),s(" io_port"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"uint32_t"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"("),s("IOPORT_CFG_PORT_DIRECTION_OUTPUT "),n("span",{class:"token operator"},"|"),s(" IOPORT_CFG_PERIPHERAL_PIN "),n("span",{class:"token operator"},"|"),s(" IOPORT_PERIPHERAL_GPT1"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// port_config")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// timer_config")]),s(`
`),n("span",{class:"line"},[s("        gpt_timer_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("channel "),n("span",{class:"token operator"},"="),s(" timer_ch"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_timer_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("mode "),n("span",{class:"token operator"},"="),s(" TIMER_MODE_PWM"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// 48Mhz dev1 cnt=1000 => 48khz")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// 48Mhz dev2 cnt=1000 => 24khz")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// 48Mhz dev4 cnt=1000 => 12khz")]),s(`
`),n("span",{class:"line"},[s("        gpt_timer_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("source_div "),n("span",{class:"token operator"},"="),s(" TIMER_SOURCE_DIV_2"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// // uint32_t pclkd_freq_hz = R_FSP_SystemClockHzGet(FSP_PRIV_CLOCK_PCLKD)")]),s(`
`),n("span",{class:"line"},[s("        gpt_timer_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("period_counts "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1000"),n("span",{class:"token punctuation"},";"),s("            "),n("span",{class:"token comment"},"// pwm分辨率")]),s(`
`),n("span",{class:"line"},[s("        gpt_timer_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("duty_cycle_counts "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"500"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_timer_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("p_callback "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token constant"},"NULL"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_timer_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("p_context "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token constant"},"NULL"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_timer_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("p_extend "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token operator"},"&"),s("gpt_ext_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_timer_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("cycle_end_ipl "),n("span",{class:"token operator"},"="),s(" BSP_IRQ_DISABLED"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_timer_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("cycle_end_irq "),n("span",{class:"token operator"},"="),s(" FSP_INVALID_VECTOR"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// // gpt_cfg")]),s(`
`),n("span",{class:"line"},[s("        gpt_ext_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("gtioca"),n("span",{class:"token punctuation"},"."),s("output_enabled "),n("span",{class:"token operator"},"="),s(" pwm_ch"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"=="),s(" GPT_IO_PIN_GTIOCA"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_ext_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("gtioca"),n("span",{class:"token punctuation"},"."),s("stop_level "),n("span",{class:"token operator"},"="),s(" GPT_PIN_LEVEL_LOW"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_ext_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("gtiocb"),n("span",{class:"token punctuation"},"."),s("output_enabled "),n("span",{class:"token operator"},"="),s(" pwm_ch"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"=="),s(" GPT_IO_PIN_GTIOCB"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_ext_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("gtiocb"),n("span",{class:"token punctuation"},"."),s("stop_level "),n("span",{class:"token operator"},"="),s(" GPT_PIN_LEVEL_LOW"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_ext_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("start_source "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),s("gpt_source_t"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"("),s("GPT_SOURCE_NONE"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_ext_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("stop_source "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),s("gpt_source_t"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"("),s("GPT_SOURCE_NONE"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_ext_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("clear_source "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),s("gpt_source_t"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"("),s("GPT_SOURCE_NONE"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_ext_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("count_up_source "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),s("gpt_source_t"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"("),s("GPT_SOURCE_NONE"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_ext_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("count_down_source "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),s("gpt_source_t"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"("),s("GPT_SOURCE_NONE"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_ext_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("capture_a_source "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),s("gpt_source_t"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"("),s("GPT_SOURCE_NONE"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_ext_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("capture_b_source "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),s("gpt_source_t"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"("),s("GPT_SOURCE_NONE"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_ext_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("capture_a_ipl "),n("span",{class:"token operator"},"="),s(" BSP_IRQ_DISABLED"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_ext_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("capture_b_ipl "),n("span",{class:"token operator"},"="),s(" BSP_IRQ_DISABLED"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_ext_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("capture_a_irq "),n("span",{class:"token operator"},"="),s(" FSP_INVALID_VECTOR"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_ext_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("capture_b_irq "),n("span",{class:"token operator"},"="),s(" FSP_INVALID_VECTOR"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_ext_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("capture_filter_gtioca "),n("span",{class:"token operator"},"="),s(" GPT_CAPTURE_FILTER_NONE"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_ext_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("capture_filter_gtiocb "),n("span",{class:"token operator"},"="),s(" GPT_CAPTURE_FILTER_NONE"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_ext_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("p_pwm_cfg "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token operator"},"&"),s("gpt_pwm_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_ext_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("gtior_setting"),n("span",{class:"token punctuation"},"."),s("gtior "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0U"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// // pwm_cfg")]),s(`
`),n("span",{class:"line"},[s("        gpt_pwm_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("trough_ipl "),n("span",{class:"token operator"},"="),s(" BSP_IRQ_DISABLED"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_pwm_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("trough_irq "),n("span",{class:"token operator"},"="),s(" FSP_INVALID_VECTOR"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_pwm_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("poeg_link "),n("span",{class:"token operator"},"="),s(" GPT_POEG_LINK_POEG0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_pwm_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("output_disable "),n("span",{class:"token operator"},"="),s(" GPT_OUTPUT_DISABLE_NONE"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_pwm_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("adc_trigger "),n("span",{class:"token operator"},"="),s(" GPT_ADC_TRIGGER_NONE"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_pwm_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("dead_time_count_up "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_pwm_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("dead_time_count_down "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_pwm_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("adc_a_compare_match "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_pwm_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("adc_b_compare_match "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_pwm_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("interrupt_skip_source "),n("span",{class:"token operator"},"="),s(" GPT_INTERRUPT_SKIP_SOURCE_NONE"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_pwm_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("interrupt_skip_count "),n("span",{class:"token operator"},"="),s(" GPT_INTERRUPT_SKIP_COUNT_0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_pwm_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("interrupt_skip_adc "),n("span",{class:"token operator"},"="),s(" GPT_INTERRUPT_SKIP_ADC_NONE"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_pwm_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("gtioca_disable_setting "),n("span",{class:"token operator"},"="),s(" GPT_GTIOC_DISABLE_PROHIBITED"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        gpt_pwm_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("gtiocb_disable_setting "),n("span",{class:"token operator"},"="),s(" GPT_GTIOC_DISABLE_PROHIBITED"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// memset(&gpt_ctrl[idx], 0, sizeof(gpt_instance_ctrl_t));")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("        fsp_err_t err "),n("span",{class:"token operator"},"="),s(" FSP_SUCCESS"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// Initializes the timer module and applies configurations.")]),s(`
`),n("span",{class:"line"},[s("        err "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"R_GPT_Open"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("gpt_ctrls"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),s("gpt_timer_cfgs"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token function"},"assert"),n("span",{class:"token punctuation"},"("),s("FSP_SUCCESS "),n("span",{class:"token operator"},"=="),s(" err"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// Enables external event triggers that start, stop, clear, or capture the counter.")]),s(`
`),n("span",{class:"line"},[s("        err "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"R_GPT_Enable"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("gpt_ctrls"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token function"},"assert"),n("span",{class:"token punctuation"},"("),s("FSP_SUCCESS "),n("span",{class:"token operator"},"=="),s(" err"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// // Enable output for GTIOCA and/or GTIOCB")]),s(`
`),n("span",{class:"line"},[s("        err "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"R_GPT_OutputEnable"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("gpt_ctrls"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(" pwm_ch"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token function"},"assert"),n("span",{class:"token punctuation"},"("),s("FSP_SUCCESS "),n("span",{class:"token operator"},"=="),s(" err"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// Starts timer.")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// err = R_GPT_Start(&gpt_ctrls[idx]);")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// assert(FSP_SUCCESS == err);")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("        start_mask "),n("span",{class:"token operator"},"|="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1"),s(),n("span",{class:"token operator"},"<<"),s(" timer_ch"),n("span",{class:"token punctuation"},"["),s("idx"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// Starts timer at the same time")]),s(`
`),n("span",{class:"line"},[s("    gpt_ctrls"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("p_reg"),n("span",{class:"token operator"},"->"),s("GTSTR "),n("span",{class:"token operator"},"|="),s(" start_mask"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"/**"),s(`
`),n("span",{class:"line"}," * dutyA [0.0,1.0]"),s(`
`),n("span",{class:"line"}," */")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"hardware_set_pwm_duty"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"uint8_t"),s(" chA"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" dutyA"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"uint8_t"),s(" chB"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" dutyB"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"uint8_t"),s(" chC"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" dutyC"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"R_GPT_DutyCycleSet"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("gpt_ctrls"),n("span",{class:"token punctuation"},"["),s("chA"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(" dutyA "),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token number"},"1000"),n("span",{class:"token punctuation"},","),s(" pwm_ch"),n("span",{class:"token punctuation"},"["),s("chA"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"R_GPT_DutyCycleSet"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("gpt_ctrls"),n("span",{class:"token punctuation"},"["),s("chB"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(" dutyB "),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token number"},"1000"),n("span",{class:"token punctuation"},","),s(" pwm_ch"),n("span",{class:"token punctuation"},"["),s("chB"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"R_GPT_DutyCycleSet"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("gpt_ctrls"),n("span",{class:"token punctuation"},"["),s("chC"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(" dutyC "),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token number"},"1000"),n("span",{class:"token punctuation"},","),s(" pwm_ch"),n("span",{class:"token punctuation"},"["),s("chC"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"hardware_init"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"adc_init"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"gpt_init"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),w=n("code",null,"pll.h",-1),T=n("code",null,"pll.c",-1),P=n("div",{class:"language-cpp line-numbers-mode","data-highlighter":"prismjs","data-ext":"cpp","data-title":"cpp"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"ifndef"),s(),n("span",{class:"token expression"},"__PLL_H__")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"__PLL_H__")])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"foc_math.h"')])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"lowpass_filter.h"')])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"pid_controller.h"')])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"ifdef"),s(),n("span",{class:"token expression"},"__cplusplus")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"extern"),s(),n("span",{class:"token string"},'"C"')]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"endif")])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"typedef"),s(),n("span",{class:"token keyword"},"struct")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" theta"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 角度")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" omega"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 角速度")]),s(`
`),n("span",{class:"line"},[s("        LowpassFilter filter"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        PidController pid"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}"),s(" PLL"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"pll_init"),n("span",{class:"token punctuation"},"("),s("PLL "),n("span",{class:"token operator"},"*"),s("pll"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" Ts"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" Kp"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" Ki"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(),n("span",{class:"token function"},"pll_update"),n("span",{class:"token punctuation"},"("),s("PLL "),n("span",{class:"token operator"},"*"),s("pll"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" theta"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" dt"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"ifdef"),s(),n("span",{class:"token expression"},"__cplusplus")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"endif")])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"endif")])]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),E=n("div",{class:"language-cpp line-numbers-mode","data-highlighter":"prismjs","data-ext":"cpp","data-title":"cpp"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"pll.h"')])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"pll_init"),n("span",{class:"token punctuation"},"("),s("PLL "),n("span",{class:"token operator"},"*"),s("pll"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" Ts"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" Kp"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" Ki"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    pll"),n("span",{class:"token operator"},"->"),s("theta "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    pll"),n("span",{class:"token operator"},"->"),s("omega "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"lowpass_filter_init"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("pll"),n("span",{class:"token operator"},"->"),s("filter"),n("span",{class:"token punctuation"},","),s(" Ts"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"pid_controller_init"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("pll"),n("span",{class:"token operator"},"->"),s("pid"),n("span",{class:"token punctuation"},","),s(" Kp"),n("span",{class:"token punctuation"},","),s(" Ki"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"1e10f"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"1e10f"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"float"),s(),n("span",{class:"token function"},"pll_update"),n("span",{class:"token punctuation"},"("),s("PLL "),n("span",{class:"token operator"},"*"),s("pll"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" theta"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" dt"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 相位差 = sin(theta)*cos(target) - cos(theta)*sin(target) ≈ sin(theta - target) ≈ PI - normalizeAngle(theta - target)")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 角速度 = PI控制器(lpf低通滤波器(鉴相器))")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 角度 = 角速度 * dt")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// float phase_diff = cosf(pll->theta) * sinf(theta) - sinf(pll->theta) * cosf(theta);")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" phase_diff "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"sinf"),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"_normalizeAngle"),n("span",{class:"token punctuation"},"("),s("pll"),n("span",{class:"token operator"},"->"),s("theta "),n("span",{class:"token operator"},"-"),s(" theta"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// float phase_diff = _normalizeAngle(pll->theta - theta) - M_PI;")]),s(`
`),n("span",{class:"line"},[s("    pll"),n("span",{class:"token operator"},"->"),s("omega "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"pid_controller_update"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("pll"),n("span",{class:"token operator"},"->"),s("pid"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token function"},"lowpass_filter_update"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("pll"),n("span",{class:"token operator"},"->"),s("filter"),n("span",{class:"token punctuation"},","),s(" phase_diff"),n("span",{class:"token punctuation"},","),s(" dt"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(" dt"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    pll"),n("span",{class:"token operator"},"->"),s("theta "),n("span",{class:"token operator"},"+="),s(" pll"),n("span",{class:"token operator"},"->"),s("omega "),n("span",{class:"token operator"},"*"),s(" dt"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"return"),s(" pll"),n("span",{class:"token operator"},"->"),s("theta"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1);function x(I,A){const o=i("CodeTabs");return u(),p("div",null,[k,m,c(o,{id:"6",data:[{id:"<code v-pre>motor.h</code>"},{id:"<code v-pre>motor.c</code>"}]},{title0:a(({value:e,isActive:t})=>[d]),title1:a(({value:e,isActive:t})=>[_]),tab0:a(({value:e,isActive:t})=>[b]),tab1:a(({value:e,isActive:t})=>[v]),_:1}),c(o,{id:"14",data:[{id:"<code v-pre>hardware.h</code>"},{id:"<code v-pre>hardware.c</code>"}]},{title0:a(({value:e,isActive:t})=>[f]),title1:a(({value:e,isActive:t})=>[h]),tab0:a(({value:e,isActive:t})=>[g]),tab1:a(({value:e,isActive:t})=>[y]),_:1}),c(o,{id:"22",data:[{id:"<code v-pre>pll.h</code>"},{id:"<code v-pre>pll.c</code>"}]},{title0:a(({value:e,isActive:t})=>[w]),title1:a(({value:e,isActive:t})=>[T]),tab0:a(({value:e,isActive:t})=>[P]),tab1:a(({value:e,isActive:t})=>[E]),_:1})])}const O=l(r,[["render",x],["__file","01.电压开环实现.html.vue"]]),R=JSON.parse('{"path":"/%E7%94%B5%E5%AD%90/FOC%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B%E8%AE%B0%E5%BD%95v2/01.%E7%94%B5%E5%8E%8B%E5%BC%80%E7%8E%AF%E5%AE%9E%E7%8E%B0.html","title":"FOC算法实现过程记录(v2):01.电压开环实现","lang":"zh-CN","frontmatter":{"title":"FOC算法实现过程记录(v2):01.电压开环实现","shortTitle":"电压开环实现","date":"2025-01-05T18:17:00.000Z","index":true,"article":false,"order":1,"description":"FOC算法实现过程记录(v2):01.电压开环实现 电压开环实现","head":[["meta",{"property":"og:url","content":"https://dingdingdang.online/%E7%94%B5%E5%AD%90/FOC%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B%E8%AE%B0%E5%BD%95v2/01.%E7%94%B5%E5%8E%8B%E5%BC%80%E7%8E%AF%E5%AE%9E%E7%8E%B0.html"}],["meta",{"property":"og:site_name","content":"YiguiDing的Blog小站"}],["meta",{"property":"og:title","content":"FOC算法实现过程记录(v2):01.电压开环实现"}],["meta",{"property":"og:description","content":"FOC算法实现过程记录(v2):01.电压开环实现 电压开环实现"}],["meta",{"property":"og:type","content":"website"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-01-07T02:23:32.000Z"}],["meta",{"property":"article:author","content":"丁毅桂"}],["meta",{"property":"article:published_time","content":"2025-01-05T18:17:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-01-07T02:23:32.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"WebPage\\",\\"name\\":\\"FOC算法实现过程记录(v2):01.电压开环实现\\",\\"description\\":\\"FOC算法实现过程记录(v2):01.电压开环实现 电压开环实现\\"}"],["meta",{"name":"baidu-site-verification","content":"codeva-PwE9Ts6nMl"}]]},"headers":[{"level":2,"title":"电压开环实现","slug":"电压开环实现","link":"#电压开环实现","children":[]}],"git":{"createdTime":1736216612000,"updatedTime":1736216612000,"contributors":[{"name":"YiguiDing","email":"2449695354@qq.com","commits":1}]},"readingTime":{"minutes":0.34,"words":102},"filePathRelative":"电子/FOC算法实现过程记录v2/01.电压开环实现.md","localizedDate":"2025年1月5日","excerpt":"","autoDesc":true}');export{O as comp,R as data};
