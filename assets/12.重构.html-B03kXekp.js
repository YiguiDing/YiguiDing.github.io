import{_ as i,c as r,d as o,w as a,a as n,r as c,o as u,e as s}from"./app-4Pz6rAek.js";const k={},d=n("h2",{id:"_12-重构",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_12-重构"},[n("span",null,"12.重构")])],-1),m=n("h3",{id:"实现效果",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#实现效果"},[n("span",null,"实现效果")])],-1),v=n("h3",{id:"具体实现",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#具体实现"},[n("span",null,"具体实现")])],-1),b=n("code",null,"12.refactor_all.ino",-1),y=n("div",{class:"language-cpp line-numbers-mode","data-highlighter":"prismjs","data-ext":"cpp","data-title":"cpp"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},"<Arduino.h>")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},"<Wire.h>")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"BLDCMotor.hpp"')])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"BLDCDriver.hpp"')])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"Sensor.hpp"')])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"foc_utils.h"')])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"arduino/ArduinoBLDCDriver.hpp"')])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"arduino/ArduinoCurrentSensor.hpp"')])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"arduino/ArduinoCommand.hpp"')])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"arduino/AS5600Sensor.hpp"')])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"Command.hpp"')])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"Ua"),s(),n("span",{class:"token expression"},[n("span",{class:"token number"},"5")])])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"Ub"),s(),n("span",{class:"token expression"},[n("span",{class:"token number"},"9")])])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"Uc"),s(),n("span",{class:"token expression"},[n("span",{class:"token number"},"6")])])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"En"),s(),n("span",{class:"token expression"},[n("span",{class:"token number"},"8")])])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"Ia"),s(),n("span",{class:"token expression"},"A0")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"Ib"),s(),n("span",{class:"token expression"},"A2")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"I_R"),s(),n("span",{class:"token expression"},[n("span",{class:"token number"},"0.01f"),s()]),n("span",{class:"token comment"},"// 10mΩ")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"I_A"),s(),n("span",{class:"token expression"},[n("span",{class:"token number"},"50"),s("    ")]),n("span",{class:"token comment"},"// 50倍")])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("BLDCMotor motor "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"BLDCMotor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"7"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"12"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("Sensor "),n("span",{class:"token operator"},"*"),s("sensor "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token function"},"AS5600Sensor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("BLDCDriver "),n("span",{class:"token operator"},"*"),s("driver "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token function"},"ArduinoBLDCDriver"),n("span",{class:"token punctuation"},"("),s("Ua"),n("span",{class:"token punctuation"},","),s(" Ub"),n("span",{class:"token punctuation"},","),s(" Uc"),n("span",{class:"token punctuation"},","),s(" En"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("CurrentSensor "),n("span",{class:"token operator"},"*"),s("currentSensor "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token function"},"ArduinoCurrentSensor"),n("span",{class:"token punctuation"},"("),s("Ia"),n("span",{class:"token punctuation"},","),s(" Ib"),n("span",{class:"token punctuation"},","),s(" I_R"),n("span",{class:"token punctuation"},","),s(" I_A"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("ArduinoCommand command"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"setup"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  Serial"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"begin"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"115200"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("  motor"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"connectDriver"),n("span",{class:"token punctuation"},"("),s("driver"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("  motor"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"connectSensor"),n("span",{class:"token punctuation"},"("),s("sensor"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("  motor"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"connectCurrentSensor"),n("span",{class:"token punctuation"},"("),s("currentSensor"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("  command"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"connectMotor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("motor"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("  command"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"connectSerial"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("Serial"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("  motor"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"connectCommand"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("command"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("  motor"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"initFOC"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("  motor"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setMode"),n("span",{class:"token punctuation"},"("),s("BLDCControlMode"),n("span",{class:"token double-colon punctuation"},"::"),s("Current"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"loop"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  motor"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"loopFOC"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("  command"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"update"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),w=n("code",null,"BLDCMotor.hpp",-1),_=n("code",null,"BLDCMotor.cpp",-1),h=n("div",{class:"language-cpp line-numbers-mode","data-highlighter":"prismjs","data-ext":"cpp","data-title":"cpp"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"ifndef"),s(),n("span",{class:"token expression"},"__BLDCMotor_H__")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"__BLDCMotor_H__")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},"<stdint.h>")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"foc_utils.h"')])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"BLDCDriver.hpp"')])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"Sensor.hpp"')])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"CurrentSensor.hpp"')])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"Command.hpp"')])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"PIDControler.hpp"')])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"LowPassFilter.hpp"')])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"enum"),s(),n("span",{class:"token class-name"},"BLDCControlMode"),s(),n("span",{class:"token operator"},":"),s(),n("span",{class:"token keyword"},"uint8_t")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    Unknow "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("    Voltage "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("    Current "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("    VelocityCurrent "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("    PositionCurrent "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"4"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("    PositionVelocityCurrent "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"5"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"enum"),s(),n("span",{class:"token class-name"},"MotorDirectrion"),s(),n("span",{class:"token operator"},":"),s(),n("span",{class:"token keyword"},"int8_t")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    UNKNOW "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("    ANTI_CLOCK_WISE "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("    CLOCK_WISE "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"BLDCMotor")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"public"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// ####################################################################################")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"uint8_t"),s(" pole_pairs"),n("span",{class:"token punctuation"},";"),s("                 "),n("span",{class:"token comment"},"// 极对数")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" power_supply_voltage "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"12.0f"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 供电电压")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// ####################################################################################")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" limit_voltage "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"12.0f"),n("span",{class:"token punctuation"},";"),s("   "),n("span",{class:"token comment"},"// 限制电压")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" limit_current "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"10.0f"),n("span",{class:"token punctuation"},";"),s("   "),n("span",{class:"token comment"},"// 限制电流")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" limit_velocity "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"130.0f"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 限制速度")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// ####################################################################################")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" target "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";"),s("                                               "),n("span",{class:"token comment"},"// taget")]),s(`
`),n("span",{class:"line"},[s("    BLDCControlMode controlMode "),n("span",{class:"token operator"},"="),s(" BLDCControlMode"),n("span",{class:"token double-colon punctuation"},"::"),s("VelocityCurrent"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// mode")]),s(`
`),n("span",{class:"line"},[s("    MotorDirectrion direction "),n("span",{class:"token operator"},"="),s(" MotorDirectrion"),n("span",{class:"token double-colon punctuation"},"::"),s("ANTI_CLOCK_WISE"),n("span",{class:"token punctuation"},";"),s("   "),n("span",{class:"token comment"},"// directron")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// ####################################################################################")]),s(`
`),n("span",{class:"line"},[s("    LowPassFilter current_q_filter"),n("span",{class:"token punctuation"},"{"),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    LowPassFilter current_d_filter"),n("span",{class:"token punctuation"},"{"),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    LowPassFilter shaft_velocity_filter"),n("span",{class:"token punctuation"},"{"),n("span",{class:"token number"},"50"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    LowPassFilter shaft_angle_filter"),n("span",{class:"token punctuation"},"{"),n("span",{class:"token number"},"100"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// ####################################################################################")]),s(`
`),n("span",{class:"line"},[s("    PIDControler pid_iq_controller"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    PIDControler pid_id_controller"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    PIDControler pid_velocity_controller"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    PIDControler pid_position_controller"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// ####################################################################################")]),s(`
`),n("span",{class:"line"},[s("    BLDCDriver "),n("span",{class:"token operator"},"*"),s("driver "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"nullptr"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    Sensor "),n("span",{class:"token operator"},"*"),s("sensor "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"nullptr"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    CurrentSensor "),n("span",{class:"token operator"},"*"),s("currentSensor "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"nullptr"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    Command "),n("span",{class:"token operator"},"*"),s("command "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"nullptr"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"public"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// ####################################################################################")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"BLDCMotor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"uint8_t"),s(" pole_pairs"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" power_supply_voltage"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// ####################################################################################")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"connectDriver"),n("span",{class:"token punctuation"},"("),s("BLDCDriver "),n("span",{class:"token operator"},"*"),s("driver"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"connectSensor"),n("span",{class:"token punctuation"},"("),s("Sensor "),n("span",{class:"token operator"},"*"),s("sensor"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"connectCurrentSensor"),n("span",{class:"token punctuation"},"("),s("CurrentSensor "),n("span",{class:"token operator"},"*"),s("currentSensor"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"connectCommand"),n("span",{class:"token punctuation"},"("),s("Command "),n("span",{class:"token operator"},"*"),s("command"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// ####################################################################################")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"initFOC"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"loopFOC"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// ####################################################################################")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"/**"),s(`
`),n("span",{class:"line"},"     * 设置控制模式"),s(`
`),n("span",{class:"line"},"     */")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"setMode"),n("span",{class:"token punctuation"},"("),s("BLDCControlMode mode"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"/**"),s(`
`),n("span",{class:"line"},"     * 设置目标值（电压/力矩/速度/位置）"),s(`
`),n("span",{class:"line"},"     */")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"setTarget"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"float"),s(" target"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"/**"),s(`
`),n("span",{class:"line"},"     * 设置旋转方向"),s(`
`),n("span",{class:"line"},"     */")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"setDirection"),n("span",{class:"token punctuation"},"("),s("MotorDirectrion direction"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// ####################################################################################")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"/**"),s(`
`),n("span",{class:"line"},"     * 获取电角度"),s(`
`),n("span",{class:"line"},"     */")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(),n("span",{class:"token function"},"electricalAngle"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"/**"),s(`
`),n("span",{class:"line"},"     * 设置相电压"),s(`
`),n("span",{class:"line"},"     * @param u_d float [-1,1]"),s(`
`),n("span",{class:"line"},"     * @param u_q float [-1,1]"),s(`
`),n("span",{class:"line"},"     * @param e_angle float [0,2PI]"),s(`
`),n("span",{class:"line"},"     */")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"setPhraseVoltage"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"float"),s(" u_d"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" u_q"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" e_angle"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"/**"),s(`
`),n("span",{class:"line"},"     * 开环电压控制"),s(`
`),n("span",{class:"line"},"     */")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"open_loop_voltage_control"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"float"),s(" target_ud"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" target_uq"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// ####################################################################################")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"/**"),s(`
`),n("span",{class:"line"},"     * 获取dq轴电流"),s(`
`),n("span",{class:"line"},"     */")]),s(`
`),n("span",{class:"line"},[s("    CurrentDQ "),n("span",{class:"token function"},"getCurrentDQ"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"/**"),s(`
`),n("span",{class:"line"},"     * 闭环电流控制"),s(`
`),n("span",{class:"line"},"     */")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"close_loop_current_control"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"float"),s(" target"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// ####################################################################################")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"/**"),s(`
`),n("span",{class:"line"},"     * 获取速度"),s(`
`),n("span",{class:"line"},"     */")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(),n("span",{class:"token function"},"shaftVelocity"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"/**"),s(`
`),n("span",{class:"line"},"     * 闭环速度控制"),s(`
`),n("span",{class:"line"},"     */")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"close_loop_velocity_current_control"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"float"),s(" target"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// ####################################################################################")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"/**"),s(`
`),n("span",{class:"line"},"     * 获取位置"),s(`
`),n("span",{class:"line"},"     */")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(),n("span",{class:"token function"},"shaftAngle"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"/**"),s(`
`),n("span",{class:"line"},"     * 闭环位置控制: 位置-力矩-闭环控制"),s(`
`),n("span",{class:"line"},"     */")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"close_loop_position_current_control"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"float"),s(" target"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"/**"),s(`
`),n("span",{class:"line"},"     * 闭环位置控制: 位置-速度-力矩-闭环控制"),s(`
`),n("span",{class:"line"},"     */")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"close_loop_position_velocity_current_control"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"float"),s(" target"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// ####################################################################################")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"endif")])]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),f=n("div",{class:"language-cpp line-numbers-mode","data-highlighter":"prismjs","data-ext":"cpp","data-title":"cpp"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"BLDCMotor.hpp"')])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"Sensor.hpp"')])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"CurrentSensor.hpp"')])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"Command.hpp"')])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token class-name"},"BLDCMotor"),n("span",{class:"token double-colon punctuation"},"::"),n("span",{class:"token function"},"BLDCMotor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"uint8_t"),s(" pole_pairs"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" power_supply_voltage"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("pole_pairs "),n("span",{class:"token operator"},"="),s(" pole_pairs"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("power_supply_voltage "),n("span",{class:"token operator"},"="),s(" power_supply_voltage"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token class-name"},"BLDCMotor"),n("span",{class:"token double-colon punctuation"},"::"),n("span",{class:"token function"},"connectDriver"),n("span",{class:"token punctuation"},"("),s("BLDCDriver "),n("span",{class:"token operator"},"*"),s("driver"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("driver "),n("span",{class:"token operator"},"="),s(" driver"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token class-name"},"BLDCMotor"),n("span",{class:"token double-colon punctuation"},"::"),n("span",{class:"token function"},"connectSensor"),n("span",{class:"token punctuation"},"("),s("Sensor "),n("span",{class:"token operator"},"*"),s("sensor"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("sensor "),n("span",{class:"token operator"},"="),s(" sensor"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token class-name"},"BLDCMotor"),n("span",{class:"token double-colon punctuation"},"::"),n("span",{class:"token function"},"connectCurrentSensor"),n("span",{class:"token punctuation"},"("),s("CurrentSensor "),n("span",{class:"token operator"},"*"),s("currentSensor"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("currentSensor "),n("span",{class:"token operator"},"="),s(" currentSensor"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token class-name"},"BLDCMotor"),n("span",{class:"token double-colon punctuation"},"::"),n("span",{class:"token function"},"connectCommand"),n("span",{class:"token punctuation"},"("),s("Command "),n("span",{class:"token operator"},"*"),s("command"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("command "),n("span",{class:"token operator"},"="),s(" command"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token class-name"},"BLDCMotor"),n("span",{class:"token double-colon punctuation"},"::"),n("span",{class:"token function"},"initFOC"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("currentSensor"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("currentSensor"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"initSensor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("currentSensor"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"alignSensor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("driver"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("driver"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"initDriver"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("driver"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"enableDriver"),n("span",{class:"token punctuation"},"("),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("driver"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"setPhraseVoltage"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token function"},"delay"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("sensor"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("sensor"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"initSensor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("sensor"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"connectMotor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("sensor"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"align"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("sensor"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"update"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token class-name"},"BLDCMotor"),n("span",{class:"token double-colon punctuation"},"::"),n("span",{class:"token function"},"loopFOC"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("sensor"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("sensor"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"update"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("currentSensor"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("currentSensor"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"update"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"switch"),s(),n("span",{class:"token punctuation"},"("),s("controlMode"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"case"),s(" BLDCControlMode"),n("span",{class:"token double-colon punctuation"},"::"),s("Voltage"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"open_loop_voltage_control"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(" target"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"break"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"case"),s(" BLDCControlMode"),n("span",{class:"token double-colon punctuation"},"::"),s("Current"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"close_loop_current_control"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"break"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"case"),s(" BLDCControlMode"),n("span",{class:"token double-colon punctuation"},"::"),s("VelocityCurrent"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"close_loop_velocity_current_control"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"break"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"case"),s(" BLDCControlMode"),n("span",{class:"token double-colon punctuation"},"::"),s("PositionCurrent"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"close_loop_position_current_control"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"break"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"case"),s(" BLDCControlMode"),n("span",{class:"token double-colon punctuation"},"::"),s("PositionVelocityCurrent"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"close_loop_position_velocity_current_control"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"break"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"default"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"break"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"/**"),s(`
`),n("span",{class:"line"}," * 设置控制模式"),s(`
`),n("span",{class:"line"}," */")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token class-name"},"BLDCMotor"),n("span",{class:"token double-colon punctuation"},"::"),n("span",{class:"token function"},"setMode"),n("span",{class:"token punctuation"},"("),s("BLDCControlMode controlMode"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"switch"),s(),n("span",{class:"token punctuation"},"("),s("controlMode"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"case"),s(" BLDCControlMode"),n("span",{class:"token double-colon punctuation"},"::"),s("Unknow"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"break"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"case"),s(" BLDCControlMode"),n("span",{class:"token double-colon punctuation"},"::"),s("Voltage"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"break"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"case"),s(" BLDCControlMode"),n("span",{class:"token double-colon punctuation"},"::"),s("Current"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// 官方 Simple FOC Shield v2.0.4 开发板 with 2804-100kv 云台电机")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("limit_voltage "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"12.0"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 电机额定电压")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("limit_current "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s("    "),n("span",{class:"token comment"},"// 额定电流")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// kp=35 时目标电流1 实际电流0.9 精确度90%")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// roc=600电机在快速正反转时抖动失控，所以取500")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("pid_id_controller "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"PIDControler"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"35"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("limit_voltage"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"500"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("pid_iq_controller "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"PIDControler"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"35"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("limit_voltage"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"500"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"break"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"case"),s(" BLDCControlMode"),n("span",{class:"token double-colon punctuation"},"::"),s("VelocityCurrent"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// 官方 Simple FOC Shield v2.0.4 开发板 with 2804-100kv 云台电机")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("limit_voltage "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"12.0"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 电机额定电压")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("limit_current "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s("    "),n("span",{class:"token comment"},"// 额定电流")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("limit_velocity "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"100"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 最大速度")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("pid_id_controller "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"PIDControler"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"35"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("limit_voltage"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"500"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("pid_iq_controller "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"PIDControler"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"35"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("limit_voltage"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"500"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// kp=0.05 时 目标速度100 实际速度90 精确度90%")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// ki=0.5 时 电机目标速度从100降到0时，电机有两次过冲抖动，ki=0.25 时 电机目标速度从100降到0时，电机有一次过冲抖动，遂取ki=0.1")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("pid_velocity_controller "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"PIDControler"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0.05"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0.1"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("limit_current"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"break"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"case"),s(" BLDCControlMode"),n("span",{class:"token double-colon punctuation"},"::"),s("PositionCurrent"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token comment"},"// 力位控制")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// 官方 Simple FOC Shield v2.0.4 开发板 with 2804-100kv 云台电机")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("limit_voltage "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"12.0"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 电机额定电压")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("limit_current "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s("    "),n("span",{class:"token comment"},"// 额定电流")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("pid_id_controller "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"PIDControler"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"35"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("limit_voltage"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"500"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("pid_iq_controller "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"PIDControler"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"35"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("limit_voltage"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"500"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("pid_position_controller "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"PIDControler"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0.5"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0.025"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("limit_current"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"break"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"case"),s(" BLDCControlMode"),n("span",{class:"token double-colon punctuation"},"::"),s("PositionVelocityCurrent"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token comment"},"// 力矩-速度-位置控制")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("limit_voltage "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"12.0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("limit_current "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("limit_velocity "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"100"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 最大速度")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("pid_id_controller "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"PIDControler"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"35"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("limit_voltage"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"500"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("pid_iq_controller "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"PIDControler"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"35"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("limit_voltage"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"500"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("pid_velocity_controller "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"PIDControler"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0.05"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("limit_current"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("pid_position_controller "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"PIDControler"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0.1"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("limit_velocity"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"break"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"default"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"break"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("controlMode "),n("span",{class:"token operator"},"="),s(" controlMode"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token class-name"},"BLDCMotor"),n("span",{class:"token double-colon punctuation"},"::"),n("span",{class:"token function"},"setTarget"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"float"),s(" target"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("target "),n("span",{class:"token operator"},"="),s(" target"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token class-name"},"BLDCMotor"),n("span",{class:"token double-colon punctuation"},"::"),n("span",{class:"token function"},"setDirection"),n("span",{class:"token punctuation"},"("),s("MotorDirectrion dir"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("direction "),n("span",{class:"token operator"},"="),s(" dir"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"/**"),s(`
`),n("span",{class:"line"}," * @details"),s(`
`),n("span",{class:"line"}," *  电角度 = 机械角度 * 极对数"),s(`
`),n("span",{class:"line"}," *  @return [0,2PI]"),s(`
`),n("span",{class:"line"}," */")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"float"),s(),n("span",{class:"token class-name"},"BLDCMotor"),n("span",{class:"token double-colon punctuation"},"::"),n("span",{class:"token function"},"electricalAngle"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token function"},"_normalizeAngle"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("sensor"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"getPositon"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"*"),s(" pole_pairs"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"/**"),s(`
`),n("span",{class:"line"}," * 设置相电压"),s(`
`),n("span",{class:"line"}," * @param u_d float [-1,1]"),s(`
`),n("span",{class:"line"}," * @param u_q float [-1,1]"),s(`
`),n("span",{class:"line"}," * @param e_angle float [0,2PI]"),s(`
`),n("span",{class:"line"}," */")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token class-name"},"BLDCMotor"),n("span",{class:"token double-colon punctuation"},"::"),n("span",{class:"token function"},"setPhraseVoltage"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"float"),s(" u_d"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" u_q"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" e_angle"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" sin"),n("span",{class:"token punctuation"},","),s(" cos"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 计算三角函数")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"_sincos"),n("span",{class:"token punctuation"},"("),s("e_angle"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),s("sin"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),s("cos"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 帕克逆变换")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" u_alpha "),n("span",{class:"token operator"},"="),s(" cos "),n("span",{class:"token operator"},"*"),s(" u_d "),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token operator"},"-"),s("sin "),n("span",{class:"token operator"},"*"),s(" u_q"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" u_beta "),n("span",{class:"token operator"},"="),s(" sin "),n("span",{class:"token operator"},"*"),s(" u_d "),n("span",{class:"token operator"},"+"),s(" cos "),n("span",{class:"token operator"},"*"),s(" u_q"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 克拉克逆变换(等幅值形式)")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" u_a "),n("span",{class:"token operator"},"="),s(" u_alpha"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" u_b "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),s(),n("span",{class:"token operator"},"*"),s(" u_alpha "),n("span",{class:"token operator"},"+"),s(" M_SQRT3 "),n("span",{class:"token operator"},"*"),s(" u_beta"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" u_c "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token punctuation"},"("),s("u_a "),n("span",{class:"token operator"},"+"),s(" u_b"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// 设置相电压")]),s(`
`),n("span",{class:"line"},[s("    driver"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"setPhraseVoltage"),n("span",{class:"token punctuation"},"("),s("u_a"),n("span",{class:"token punctuation"},","),s(" u_b"),n("span",{class:"token punctuation"},","),s(" u_c"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token class-name"},"BLDCMotor"),n("span",{class:"token double-colon punctuation"},"::"),n("span",{class:"token function"},"open_loop_voltage_control"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"float"),s(" target_ud"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" target_uq"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" e_angle "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"electricalAngle"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" voltage_ud "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"_constrain"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"-"),s("limit_voltage"),n("span",{class:"token punctuation"},","),s(" target_ud"),n("span",{class:"token punctuation"},","),s(" limit_voltage"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" voltage_uq "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"_constrain"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"-"),s("limit_voltage"),n("span",{class:"token punctuation"},","),s(" target_uq"),n("span",{class:"token punctuation"},","),s(" limit_voltage"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" u_d "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"_constrain"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(" voltage_ud "),n("span",{class:"token operator"},"/"),s(" power_supply_voltage"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" u_q "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"_constrain"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(" voltage_uq "),n("span",{class:"token operator"},"/"),s(" power_supply_voltage"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"setPhraseVoltage"),n("span",{class:"token punctuation"},"("),s("u_d"),n("span",{class:"token punctuation"},","),s(" u_q"),n("span",{class:"token punctuation"},","),s(" e_angle"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"/**"),s(`
`),n("span",{class:"line"}," * 获取Q轴电流"),s(`
`),n("span",{class:"line"}," */")]),s(`
`),n("span",{class:"line"},[s("CurrentDQ "),n("span",{class:"token class-name"},"BLDCMotor"),n("span",{class:"token double-colon punctuation"},"::"),n("span",{class:"token function"},"getCurrentDQ"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    CurrentDQ i "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("currentSensor"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"getCurrentDQ"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"electricalAngle"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token punctuation"},"."),s("d "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"current_d_filter"),n("span",{class:"token punctuation"},"("),s("i"),n("span",{class:"token punctuation"},"."),s("d"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token comment"},"// TODO: 测试新旧滤波器差异")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token punctuation"},"."),s("q "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"current_q_filter"),n("span",{class:"token punctuation"},"("),s("i"),n("span",{class:"token punctuation"},"."),s("q"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"/**"),s(`
`),n("span",{class:"line"}," * 电流闭环控制"),s(`
`),n("span",{class:"line"}," */")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token class-name"},"BLDCMotor"),n("span",{class:"token double-colon punctuation"},"::"),n("span",{class:"token function"},"close_loop_current_control"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"float"),s(" target"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" target_i_d "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" target_i_q "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"_constrain"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"-"),s("limit_current"),n("span",{class:"token punctuation"},","),s(" target"),n("span",{class:"token punctuation"},","),s(" limit_current"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    CurrentDQ current "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"getCurrentDQ"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" error_d "),n("span",{class:"token operator"},"="),s(" target_i_d "),n("span",{class:"token operator"},"-"),s(" current"),n("span",{class:"token punctuation"},"."),s("d"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" error_q "),n("span",{class:"token operator"},"="),s(" target_i_q "),n("span",{class:"token operator"},"-"),s(" current"),n("span",{class:"token punctuation"},"."),s("q"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" u_d "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"pid_id_controller"),n("span",{class:"token punctuation"},"("),s("error_d"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" u_q "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"pid_iq_controller"),n("span",{class:"token punctuation"},"("),s("error_q"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"open_loop_voltage_control"),n("span",{class:"token punctuation"},"("),s("u_d"),n("span",{class:"token punctuation"},","),s(" u_q"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// ######################################################################")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"static"),s(),n("span",{class:"token keyword"},"uint8_t"),s(" idx "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("command "),n("span",{class:"token operator"},"&&"),s(),n("span",{class:"token operator"},"++"),s("idx "),n("span",{class:"token operator"},"%"),s(),n("span",{class:"token number"},"61"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        idx "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("command"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"drawDragram"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(" target_i_q"),n("span",{class:"token punctuation"},","),s(" current"),n("span",{class:"token punctuation"},"."),s("q"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"/**"),s(`
`),n("span",{class:"line"}," * 获取机械角度"),s(`
`),n("span",{class:"line"}," */")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"float"),s(),n("span",{class:"token class-name"},"BLDCMotor"),n("span",{class:"token double-colon punctuation"},"::"),n("span",{class:"token function"},"shaftVelocity"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token function"},"shaft_velocity_filter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("sensor"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"getVelocity"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token class-name"},"BLDCMotor"),n("span",{class:"token double-colon punctuation"},"::"),n("span",{class:"token function"},"close_loop_velocity_current_control"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"float"),s(" target"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" target_velocity "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"_constrain"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"-"),s("limit_velocity"),n("span",{class:"token punctuation"},","),s(" target"),n("span",{class:"token punctuation"},","),s(" limit_velocity"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" current_velocity "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"shaftVelocity"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" error "),n("span",{class:"token operator"},"="),s(" target_velocity "),n("span",{class:"token operator"},"-"),s(" current_velocity"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" i_q "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("direction "),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"pid_velocity_controller"),n("span",{class:"token punctuation"},"("),s("error"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"close_loop_current_control"),n("span",{class:"token punctuation"},"("),s("i_q"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// ######################################################################")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"static"),s(),n("span",{class:"token keyword"},"uint8_t"),s(" idx "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("command "),n("span",{class:"token operator"},"&&"),s(),n("span",{class:"token operator"},"++"),s("idx "),n("span",{class:"token operator"},"%"),s(),n("span",{class:"token number"},"62"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        idx "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("command"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"drawDragram"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},","),s(" target_velocity"),n("span",{class:"token punctuation"},","),s(" current_velocity"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"/**"),s(`
`),n("span",{class:"line"}," * 获取机械角度"),s(`
`),n("span",{class:"line"}," */")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"float"),s(),n("span",{class:"token class-name"},"BLDCMotor"),n("span",{class:"token double-colon punctuation"},"::"),n("span",{class:"token function"},"shaftAngle"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token function"},"shaft_angle_filter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("sensor"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"getPositons"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token class-name"},"BLDCMotor"),n("span",{class:"token double-colon punctuation"},"::"),n("span",{class:"token function"},"close_loop_position_current_control"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"float"),s(" target"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" target_position "),n("span",{class:"token operator"},"="),s(" target"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" current_position "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"shaftAngle"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" error "),n("span",{class:"token operator"},"="),s(" target_position "),n("span",{class:"token operator"},"-"),s(" current_position"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" i_q "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("direction "),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"pid_position_controller"),n("span",{class:"token punctuation"},"("),s("error"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"close_loop_current_control"),n("span",{class:"token punctuation"},"("),s("i_q"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// ######################################################################")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"static"),s(),n("span",{class:"token keyword"},"uint8_t"),s(" idx "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("command "),n("span",{class:"token operator"},"&&"),s(),n("span",{class:"token operator"},"++"),s("idx "),n("span",{class:"token operator"},"%"),s(),n("span",{class:"token number"},"63"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        idx "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("command"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"drawDragram"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},","),s(" target_position"),n("span",{class:"token punctuation"},","),s(" current_position"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token class-name"},"BLDCMotor"),n("span",{class:"token double-colon punctuation"},"::"),n("span",{class:"token function"},"close_loop_position_velocity_current_control"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"float"),s(" target"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" target_position "),n("span",{class:"token operator"},"="),s(" target"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" current_position "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"shaftAngle"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" error "),n("span",{class:"token operator"},"="),s(" target_position "),n("span",{class:"token operator"},"-"),s(" current_position"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" velocity "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("direction "),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"pid_position_controller"),n("span",{class:"token punctuation"},"("),s("error"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"close_loop_velocity_current_control"),n("span",{class:"token punctuation"},"("),s("velocity"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"// ######################################################################")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"static"),s(),n("span",{class:"token keyword"},"uint8_t"),s(" idx "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("command "),n("span",{class:"token operator"},"&&"),s(),n("span",{class:"token operator"},"++"),s("idx "),n("span",{class:"token operator"},"%"),s(),n("span",{class:"token number"},"64"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        idx "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("command"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"drawDragram"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"4"),n("span",{class:"token punctuation"},","),s(" target_position"),n("span",{class:"token punctuation"},","),s(" current_position"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),C=n("code",null,"Sensor.hpp",-1),g=n("code",null,"arduino/AS5600Sensor.hpp",-1),D=n("div",{class:"language-cpp line-numbers-mode","data-highlighter":"prismjs","data-ext":"cpp","data-title":"cpp"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"ifndef"),s(),n("span",{class:"token expression"},"_Sensor_H_")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"_Sensor_H_")])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},"<stdint.h>")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"Timer.hpp"')])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"config.h"')])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"BLDCMotor"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"Sensor")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"friend"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"BLDCMotor"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"public"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token comment"},"/**"),s(`
`),n("span",{class:"line"},"   * @return void"),s(`
`),n("span",{class:"line"},"   */")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"virtual"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"initSensor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token comment"},"/**"),s(`
`),n("span",{class:"line"},"   * @return [0,2PI]"),s(`
`),n("span",{class:"line"},"   */")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"virtual"),s(),n("span",{class:"token keyword"},"float"),s(),n("span",{class:"token function"},"readSensor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"connectMotor"),n("span",{class:"token punctuation"},"("),s("BLDCMotor "),n("span",{class:"token operator"},"*"),s("motor"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"alignSensor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"alignDirectron"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"align"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"update"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"float"),s(),n("span",{class:"token function"},"getPositon"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"float"),s(),n("span",{class:"token function"},"getPositons"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"float"),s(),n("span",{class:"token function"},"getVelocity"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"enum"),s(),n("span",{class:"token class-name"},"SensorDirectrion"),s(),n("span",{class:"token operator"},":"),s(),n("span",{class:"token keyword"},"int8_t")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    UNKNOW "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("    CLOCK_WISE "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("    ANTI_CLOCK_WISE "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"private"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("  BLDCMotor "),n("span",{class:"token operator"},"*"),s("motor "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"nullptr"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("  Timer "),n("span",{class:"token operator"},"*"),s("timer "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token function"},"ConcreteTimer"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("  SensorDirectrion directron "),n("span",{class:"token operator"},"="),s(" SensorDirectrion"),n("span",{class:"token double-colon punctuation"},"::"),s("UNKNOW"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"float"),s(" offset "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"float"),s(" position_pre"),n("span",{class:"token punctuation"},","),s(" position_now "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(" d_position"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"float"),s(" rotations_pre"),n("span",{class:"token punctuation"},","),s(" rotation_now "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(" d_rotation"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"float"),s(" positions_pre"),n("span",{class:"token punctuation"},","),s(" positions_now "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(" d_positions"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"float"),s(" velocity "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"endif")])]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),S=n("div",{class:"language-cpp line-numbers-mode","data-highlighter":"prismjs","data-ext":"cpp","data-title":"cpp"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"ifndef"),s(),n("span",{class:"token expression"},"__AS5600Sensor_H__")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"__AS5600Sensor_H__")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"../Sensor.hpp"')])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"../foc_utils.h"')])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"Arduino.h"')])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"AS5600_ADDR"),s(),n("span",{class:"token expression"},[n("span",{class:"token number"},"0x36")])])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"AS5600_RAW_ANGLE"),s(),n("span",{class:"token expression"},[n("span",{class:"token number"},"0x0c")])])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"AS5600_ANGLE"),s(),n("span",{class:"token expression"},[n("span",{class:"token number"},"0x0e")])])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"AS5600Sensor"),s(),n("span",{class:"token operator"},":"),s(),n("span",{class:"token base-clause"},[n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token class-name"},"Sensor")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"public"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"initSensor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"override")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// AS5600 最高支持1Mhz 1000000")]),s(`
`),n("span",{class:"line"},[s("        Wire"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setClock"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1000000"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"//  100000 (standard mode)  400000 (fast mode) 1000000 (fast mode plus)")]),s(`
`),n("span",{class:"line"},[s("        Wire"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"begin"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(),n("span",{class:"token function"},"readSensor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"override")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        Wire"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"beginTransmission"),n("span",{class:"token punctuation"},"("),s("AS5600_ADDR"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        Wire"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"write"),n("span",{class:"token punctuation"},"("),s("AS5600_ANGLE"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"uint8_t"),s(" error "),n("span",{class:"token operator"},"="),s(" Wire"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"endTransmission"),n("span",{class:"token punctuation"},"("),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),n("span",{class:"token operator"},"!"),s("error"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("            "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        Wire"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"requestFrom"),n("span",{class:"token punctuation"},"("),s("AS5600_ADDR"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"uint16_t"),s(" data "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token operator"},"*"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"uint8_t"),s(),n("span",{class:"token operator"},"*"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},"&"),s("data "),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"="),s(" Wire"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"read"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token operator"},"*"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"uint8_t"),s(),n("span",{class:"token operator"},"*"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},"&"),s("data "),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"="),s(" Wire"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"read"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        error "),n("span",{class:"token operator"},"="),s(" Wire"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"endTransmission"),n("span",{class:"token punctuation"},"("),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),n("span",{class:"token operator"},"!"),s("error"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("            "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token function"},"delay"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// as5600 12bit精度，左移4位变成16位")]),s(`
`),n("span",{class:"line"},[s("        data "),n("span",{class:"token operator"},"<<="),s(),n("span",{class:"token number"},"4"),n("span",{class:"token punctuation"},";"),s("                                "),n("span",{class:"token comment"},"// [0,0x0fff] -> [0,0xffff]")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"return"),s(" data "),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"float"),n("span",{class:"token punctuation"},")"),s("UINT16_MAX "),n("span",{class:"token operator"},"*"),s(" M_TWOPI"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// [0,0xffff] -> [0,2PI]")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"endif")])]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),A=n("code",null,"CurrentSensor.hpp",-1),B=n("code",null,"arduino/CurrentSensor.hpp",-1),M=n("div",{class:"language-cpp line-numbers-mode","data-highlighter":"prismjs","data-ext":"cpp","data-title":"cpp"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"ifndef"),s(),n("span",{class:"token expression"},"__CurrentSensor_H__")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"__CurrentSensor_H__")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},"<stdint.h>")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"foc_utils.h"')])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},"<math.h>")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"BLDCMotor.hpp"')])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"M_SQRT3"),s(),n("span",{class:"token expression"},[n("span",{class:"token number"},"1.73205080756887719000")])])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"// CurrentABC")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"typedef"),s(),n("span",{class:"token keyword"},"struct")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" a"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" b"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" c"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}"),s(" CurrentABC"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"// CurrentAB")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"typedef"),s(),n("span",{class:"token keyword"},"struct")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" alpha"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" beta"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}"),s(" CurrentAB"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"// CurrentDQ")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"typedef"),s(),n("span",{class:"token keyword"},"struct")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" d"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" q"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}"),s(" CurrentDQ"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"// CurrentDC")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"typedef"),s(),n("span",{class:"token keyword"},"float"),s(" CurrentDC"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"CurrentSensor")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"public"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"virtual"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"initSensor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"virtual"),s(" CurrentABC "),n("span",{class:"token function"},"readSensor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"friend"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"BLDCMotor"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"private"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"public"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("    CurrentABC offset "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    CurrentABC cache "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"alignSensor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"uint16_t"),s(" times "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1000"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        CurrentABC average "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"uint16_t"),s(" n "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s(" n "),n("span",{class:"token operator"},"<="),s(" times"),n("span",{class:"token punctuation"},";"),s(" n"),n("span",{class:"token operator"},"++"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("            CurrentABC current "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"readSensor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("            average"),n("span",{class:"token punctuation"},"."),s("a "),n("span",{class:"token operator"},"+="),s(" current"),n("span",{class:"token punctuation"},"."),s("a"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("            average"),n("span",{class:"token punctuation"},"."),s("b "),n("span",{class:"token operator"},"+="),s(" current"),n("span",{class:"token punctuation"},"."),s("b"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("            average"),n("span",{class:"token punctuation"},"."),s("c "),n("span",{class:"token operator"},"+="),s(" current"),n("span",{class:"token punctuation"},"."),s("c"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("            "),n("span",{class:"token function"},"delay"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("        average"),n("span",{class:"token punctuation"},"."),s("a "),n("span",{class:"token operator"},"/="),s(" times"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        average"),n("span",{class:"token punctuation"},"."),s("b "),n("span",{class:"token operator"},"/="),s(" times"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        average"),n("span",{class:"token punctuation"},"."),s("c "),n("span",{class:"token operator"},"/="),s(" times"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("offset "),n("span",{class:"token operator"},"="),s(" average"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"public"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"update"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        cache "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"readSensor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    CurrentABC "),n("span",{class:"token function"},"getCurrentABC"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("            "),n("span",{class:"token punctuation"},"."),s("a "),n("span",{class:"token operator"},"="),s(" cache"),n("span",{class:"token punctuation"},"."),s("a "),n("span",{class:"token operator"},"-"),s(" offset"),n("span",{class:"token punctuation"},"."),s("a"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("            "),n("span",{class:"token punctuation"},"."),s("b "),n("span",{class:"token operator"},"="),s(" cache"),n("span",{class:"token punctuation"},"."),s("b "),n("span",{class:"token operator"},"-"),s(" offset"),n("span",{class:"token punctuation"},"."),s("b"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("            "),n("span",{class:"token punctuation"},"."),s("c "),n("span",{class:"token operator"},"="),s(" cache"),n("span",{class:"token punctuation"},"."),s("c "),n("span",{class:"token operator"},"-"),s(" offset"),n("span",{class:"token punctuation"},"."),s("c"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    CurrentAB "),n("span",{class:"token function"},"getCurrentAB"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        CurrentABC i "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"getCurrentABC"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// 克拉克变换，等赋值形式")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("            "),n("span",{class:"token punctuation"},"."),s("alpha "),n("span",{class:"token operator"},"="),s(" i"),n("span",{class:"token punctuation"},"."),s("a"),n("span",{class:"token punctuation"},","),s("                      "),n("span",{class:"token comment"},"// i_alpha = 1 * i_a + 0 * i_b")]),s(`
`),n("span",{class:"line"},[s("            "),n("span",{class:"token punctuation"},"."),s("beta "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),s("i"),n("span",{class:"token punctuation"},"."),s("a "),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token number"},"2"),s(),n("span",{class:"token operator"},"*"),s(" i"),n("span",{class:"token punctuation"},"."),s("b"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"/"),s(" M_SQRT3"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token comment"},"// i_beta = 1/sqrt(3) * i_a + 2 / sqrt(3) * i_b = (i_a + 2 * i_b)/sqrt(3)")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[s("    CurrentDC "),n("span",{class:"token function"},"getCurrentDC"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        CurrentAB i "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"getCurrentAB"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token function"},"sqrtf"),n("span",{class:"token punctuation"},"("),s("i"),n("span",{class:"token punctuation"},"."),s("alpha "),n("span",{class:"token operator"},"*"),s(" i"),n("span",{class:"token punctuation"},"."),s("alpha "),n("span",{class:"token operator"},"+"),s(" i"),n("span",{class:"token punctuation"},"."),s("beta "),n("span",{class:"token operator"},"*"),s(" i"),n("span",{class:"token punctuation"},"."),s("beta"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 向量模长")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token comment"},"/**"),s(`
`),n("span",{class:"line"},"     * @param e_theta [0,2PI]"),s(`
`),n("span",{class:"line"},"     */")]),s(`
`),n("span",{class:"line"},[s("    CurrentDQ "),n("span",{class:"token function"},"getCurrentDQ"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"float"),s(" e_theta"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" sin"),n("span",{class:"token punctuation"},","),s(" cos"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token function"},"_sincos"),n("span",{class:"token punctuation"},"("),s("e_theta"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),s("sin"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),s("cos"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        CurrentAB i "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),n("span",{class:"token function"},"getCurrentAB"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("            "),n("span",{class:"token punctuation"},"."),s("d "),n("span",{class:"token operator"},"="),s(" cos "),n("span",{class:"token operator"},"*"),s(" i"),n("span",{class:"token punctuation"},"."),s("alpha "),n("span",{class:"token operator"},"+"),s(" sin "),n("span",{class:"token operator"},"*"),s(" i"),n("span",{class:"token punctuation"},"."),s("beta"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("            "),n("span",{class:"token punctuation"},"."),s("q "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token operator"},"-"),s("sin "),n("span",{class:"token operator"},"*"),s(" i"),n("span",{class:"token punctuation"},"."),s("alpha "),n("span",{class:"token operator"},"+"),s(" cos "),n("span",{class:"token operator"},"*"),s(" i"),n("span",{class:"token punctuation"},"."),s("beta"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"endif")])]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),L=n("div",{class:"language-cpp line-numbers-mode","data-highlighter":"prismjs","data-ext":"cpp","data-title":"cpp"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"ifndef"),s(),n("span",{class:"token expression"},"__ArduinoCurrentSensor_H__")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"define"),s(),n("span",{class:"token macro-name"},"__ArduinoCurrentSensor_H__")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"../CurrentSensor.hpp"')])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"include"),s(),n("span",{class:"token string"},'"Arduino.h"')])]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"ArduinoCurrentSensor"),s(),n("span",{class:"token operator"},":"),s(),n("span",{class:"token base-clause"},[n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token class-name"},"CurrentSensor")])]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"int"),s(" Ia"),n("span",{class:"token punctuation"},","),s(" Ib"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"float"),s(" R"),n("span",{class:"token punctuation"},";"),s("   "),n("span",{class:"token comment"},"// 检流电阻")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"uint8_t"),s(" A"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 放大倍数")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"public"),n("span",{class:"token operator"},":")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token function"},"ArduinoCurrentSensor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"int"),s(" Ia"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"int"),s(" Ib"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"float"),s(" R"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"uint8_t"),s(" A"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("Ia "),n("span",{class:"token operator"},"="),s(" Ia"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("Ib "),n("span",{class:"token operator"},"="),s(" Ib"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("R "),n("span",{class:"token operator"},"="),s(" R"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("A "),n("span",{class:"token operator"},"="),s(" A"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"initSensor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"override")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token function"},"pinMode"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("Ia"),n("span",{class:"token punctuation"},","),s(" INPUT"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token function"},"pinMode"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("Ib"),n("span",{class:"token punctuation"},","),s(" INPUT"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// Arduino 板上的标准分辨率为 10 位 (0-1023)")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token function"},"analogReadResolution"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"14"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// UNO R4 支持高达 14 位(0-16383)的分辨率")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// 默认参考电压 5 V")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token function"},"analogReference"),n("span",{class:"token punctuation"},"("),s("AR_DEFAULT"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// analogReference(AR_INTERNAL); // 内置参考电压 1.5 V")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[s("    CurrentABC "),n("span",{class:"token function"},"readSensor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"override")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token comment"},"// [0,16383] => [0,5] => [-2.5,2.5]")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" i_a "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"analogRead"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("Ia"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"16383.0f"),s(),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token number"},"5.0f"),s(),n("span",{class:"token operator"},"-"),s(),n("span",{class:"token number"},"2.5f"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("R "),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("A"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" i_b "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"analogRead"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("Ib"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"16383.0f"),s(),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token number"},"5.0f"),s(),n("span",{class:"token operator"},"-"),s(),n("span",{class:"token number"},"2.5f"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("R "),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token operator"},"->"),s("A"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// b电路接反了 加符号")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"float"),s(" i_c "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token punctuation"},"("),s("i_a "),n("span",{class:"token operator"},"+"),s(" i_b"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("        "),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token punctuation"},"{"),s("i_a"),n("span",{class:"token punctuation"},","),s(" i_b"),n("span",{class:"token punctuation"},","),s(" i_c"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token macro property"},[n("span",{class:"token directive-hash"},"#"),n("span",{class:"token directive keyword"},"endif")])]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1);function I(x,E){const p=c("BiliBili"),l=c("CodeTabs");return u(),r("div",null,[d,m,o(p,{bvid:"BV1EMzZYwEai"}),v,o(l,{id:"11",data:[{id:"<code v-pre>12.refactor_all.ino</code>"}]},{title0:a(({value:e,isActive:t})=>[b]),tab0:a(({value:e,isActive:t})=>[y]),_:1}),o(l,{id:"16",data:[{id:"<code v-pre>BLDCMotor.hpp</code>"},{id:"<code v-pre>BLDCMotor.cpp</code>"}]},{title0:a(({value:e,isActive:t})=>[w]),title1:a(({value:e,isActive:t})=>[_]),tab0:a(({value:e,isActive:t})=>[h]),tab1:a(({value:e,isActive:t})=>[f]),_:1}),o(l,{id:"24",data:[{id:"<code v-pre>Sensor.hpp</code>"},{id:"<code v-pre>arduino/AS5600Sensor.hpp</code>"}]},{title0:a(({value:e,isActive:t})=>[C]),title1:a(({value:e,isActive:t})=>[g]),tab0:a(({value:e,isActive:t})=>[D]),tab1:a(({value:e,isActive:t})=>[S]),_:1}),o(l,{id:"32",data:[{id:"<code v-pre>CurrentSensor.hpp</code>"},{id:"<code v-pre>arduino/CurrentSensor.hpp</code>"}]},{title0:a(({value:e,isActive:t})=>[A]),title1:a(({value:e,isActive:t})=>[B]),tab0:a(({value:e,isActive:t})=>[M]),tab1:a(({value:e,isActive:t})=>[L]),_:1})])}const q=i(k,[["render",I],["__file","12.重构.html.vue"]]),T=JSON.parse('{"path":"/%E7%94%B5%E5%AD%90/FOC%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B%E8%AE%B0%E5%BD%95/12.%E9%87%8D%E6%9E%84.html","title":"FOC算法实现过程记录:12.重构:有感FOC驱动完整实现","lang":"zh-CN","frontmatter":{"title":"FOC算法实现过程记录:12.重构:有感FOC驱动完整实现","shortTitle":"重构:有感FOC驱动完整实现","date":"2024-12-02T21:31:00.000Z","index":true,"article":true,"order":12,"description":"12.重构 实现效果","head":[["meta",{"property":"og:url","content":"https://dingdingdang.online/%E7%94%B5%E5%AD%90/FOC%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B%E8%AE%B0%E5%BD%95/12.%E9%87%8D%E6%9E%84.html"}],["meta",{"property":"og:site_name","content":"YiguiDing的Blog小站"}],["meta",{"property":"og:title","content":"FOC算法实现过程记录:12.重构:有感FOC驱动完整实现"}],["meta",{"property":"og:description","content":"12.重构 实现效果"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-01-07T02:25:20.000Z"}],["meta",{"property":"article:author","content":"丁毅桂"}],["meta",{"property":"article:published_time","content":"2024-12-02T21:31:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-01-07T02:25:20.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"FOC算法实现过程记录:12.重构:有感FOC驱动完整实现\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2024-12-02T21:31:00.000Z\\",\\"dateModified\\":\\"2025-01-07T02:25:20.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"丁毅桂\\",\\"email\\":\\"2449695354@qq.com\\"}]}"],["meta",{"name":"baidu-site-verification","content":"codeva-PwE9Ts6nMl"}]]},"headers":[{"level":2,"title":"12.重构","slug":"_12-重构","link":"#_12-重构","children":[{"level":3,"title":"实现效果","slug":"实现效果","link":"#实现效果","children":[]},{"level":3,"title":"具体实现","slug":"具体实现","link":"#具体实现","children":[]}]}],"git":{"createdTime":1733146528000,"updatedTime":1736216720000,"contributors":[{"name":"YiguiDing","email":"2449695354@qq.com","commits":4}]},"readingTime":{"minutes":0.37,"words":111},"filePathRelative":"电子/FOC算法实现过程记录/12.重构.md","localizedDate":"2024年12月2日","excerpt":"","autoDesc":true}');export{q as comp,T as data};
