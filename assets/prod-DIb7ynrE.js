const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/srt-parser-CBNu8bqF.js","assets/app-g68kNjG4.js","assets/ssa-parser-BTmGoGoL.js","assets/errors-BJKP31NC.js"])))=>i.map(i=>d[i]);
var Z=Object.defineProperty;var U=(i,t,e)=>t in i?Z(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var l=(i,t,e)=>U(i,typeof t!="symbol"?t+"":t,e);import{_ as N}from"./app-g68kNjG4.js";const tt={LoadFail:0,BadSignature:1,BadTimestamp:2,BadSettingValue:3,BadFormat:4,UnknownSetting:5};class et extends Error{constructor(e){super(e.reason);l(this,"code");l(this,"line");this.code=e.code,this.line=e.line}}const $=/\r?\n|\r/gm;class it{constructor(t){l(this,"writable");l(this,"readable");const e=new st(t);this.writable=new WritableStream({write(s){e.transform(s)},close(){e.close()}}),this.readable=new ReadableStream({start(s){e.onLine=n=>s.enqueue(n),e.onClose=()=>s.close()}})}}class st{constructor(t){l(this,"a","");l(this,"b");l(this,"onLine");l(this,"onClose");this.b=new TextDecoder(t)}transform(t){this.a+=this.b.decode(t,{stream:!0});const e=this.a.split($);this.a=e.pop()||"";for(let s=0;s<e.length;s++)this.onLine(e[s].trim())}close(){this.a&&this.onLine(this.a.trim()),this.a="",this.onClose()}}async function rt(i,t){const e=new ReadableStream({start(s){const n=i.split($);for(const r of n)s.enqueue(r);s.close()}});return R(e,t)}async function R(i,t){const e=t?.type??"vtt";let s;if(typeof e=="string")switch(e){case"srt":s=(await N(async()=>{const{default:c}=await import("./srt-parser-CBNu8bqF.js");return{default:c}},__vite__mapDeps([0,1]))).default;break;case"ssa":case"ass":s=(await N(async()=>{const{default:c}=await import("./ssa-parser-BTmGoGoL.js");return{default:c}},__vite__mapDeps([2,1]))).default;break;default:s=(await Promise.resolve().then(function(){return At})).default}else s=e;let n;const r=i.getReader(),a=s(),o=!!t?.strict||!!t?.errors;await a.init({strict:!1,...t,errors:o,type:e,cancel(){r.cancel(),n=a.done(!0)}});let h=1;for(;;){const{value:c,done:u}=await r.read();if(u){a.parse("",h),n=a.done(!1);break}a.parse(c,h),h++}return n}async function nt(i,t){const e=await i;if(!e.ok||!e.body)return{metadata:{},cues:[],regions:[],errors:[void 0]};const s=e.headers.get("content-type")||"",n=s.match(/text\/(.*?)(?:;|$)/)?.[1],r=s.match(/charset=(.*?)(?:;|$)/)?.[1];return V(e.body,{type:n,encoding:r,...t})}async function V(i,{encoding:t="utf-8",...e}={}){const s=i.pipeThrough(new it(t));return R(s,e)}class j extends EventTarget{constructor(e,s,n){super();l(this,"id","");l(this,"startTime");l(this,"endTime");l(this,"text");l(this,"pauseOnExit",!1);this.startTime=e,this.endTime=s,this.text=n}addEventListener(e,s,n){super.addEventListener(e,s,n)}removeEventListener(e,s,n){super.removeEventListener(e,s,n)}}const C=typeof document>"u",at=C?j:window.VTTCue;class G extends at{constructor(){super(...arguments);l(this,"region",null);l(this,"vertical","");l(this,"snapToLines",!0);l(this,"line","auto");l(this,"lineAlign","start");l(this,"position","auto");l(this,"positionAlign","auto");l(this,"size",100);l(this,"align","center");l(this,"style")}}class H{constructor(){l(this,"id","");l(this,"width",100);l(this,"lines",3);l(this,"regionAnchorX",0);l(this,"regionAnchorY",100);l(this,"viewportAnchorX",0);l(this,"viewportAnchorY",100);l(this,"scroll","")}}const O=",",ot="%";function lt(i){const t=parseInt(i,10);return Number.isNaN(t)?null:t}function v(i){const t=parseInt(i.replace(ot,""),10);return!Number.isNaN(t)&&t>=0&&t<=100?t:null}function x(i){if(!i.includes(O))return null;const[t,e]=i.split(O).map(v);return t!==null&&e!==null?[t,e]:null}function ht(i){const t=parseFloat(i);return Number.isNaN(t)?null:t}const ct="WEBVTT",B=",",ut="%",m=/[:=]/,ft=/^[\s\t]*(region|vertical|line|position|size|align)[:=]/,dt="NOTE",pt="REGION",gt=/^REGION:?[\s\t]+/,w=/[\s\t]+/,mt="-->",Tt=/[\s\t]*-->[\s\t]+/,wt=/start|center|end|left|right/,vt=/start|center|end/,yt=/line-(?:left|right)|center|auto/,bt=/^(?:(\d{1,2}):)?(\d{2}):(\d{2})(?:\.(\d{1,3}))?$/;var D=(i=>(i[i.None=0]="None",i[i.Header=1]="Header",i[i.Cue=2]="Cue",i[i.Region=3]="Region",i[i.Note=4]="Note",i))(D||{});class F{constructor(){l(this,"h");l(this,"e",0);l(this,"i",{});l(this,"j",{});l(this,"l",[]);l(this,"c",null);l(this,"d",null);l(this,"m",[]);l(this,"f");l(this,"n","")}async init(t){this.h=t,t.strict&&(this.e=1),t.errors&&(this.f=(await N(async()=>{const{ParseErrorBuilder:e}=await import("./errors-BJKP31NC.js");return{ParseErrorBuilder:e}},__vite__mapDeps([3,1]))).ParseErrorBuilder)}parse(t,e){if(t==="")this.c?(this.l.push(this.c),this.h.onCue?.(this.c),this.c=null):this.d?(this.j[this.d.id]=this.d,this.h.onRegion?.(this.d),this.d=null):this.e===1&&(this.k(t,e),this.h.onHeaderMetadata?.(this.i)),this.e=0;else if(this.e)switch(this.e){case 1:this.k(t,e);break;case 2:if(this.c){const s=this.c.text.length>0;!s&&ft.test(t)?this.o(t.split(w),e):this.c.text+=(s?`
`:"")+t}break;case 3:this.p(t.split(w),e);break}else if(t.startsWith(dt))this.e=4;else if(t.startsWith(pt))this.e=3,this.d=new H,this.p(t.replace(gt,"").split(w),e);else if(t.includes(mt)){const s=this.q(t,e);s&&(this.c=new G(s[0],s[1],""),this.c.id=this.n,this.o(s[2],e)),this.e=2}else e===1&&this.k(t,e);this.n=t}done(){return{metadata:this.i,cues:this.l,regions:Object.values(this.j),errors:this.m}}k(t,e){if(e>1){if(m.test(t)){const[s,n]=t.split(m);s&&(this.i[s]=(n||"").replace(w,""))}}else t.startsWith(ct)?this.e=1:this.g(this.f?.r())}q(t,e){const[s,n=""]=t.split(Tt),[r,...a]=n.split(w),o=b(s),h=b(r);if(o!==null&&h!==null&&h>o)return[o,h,a];o===null&&this.g(this.f?.s(s,e)),h===null&&this.g(this.f?.t(r,e)),o!=null&&h!==null&&h>o&&this.g(this.f?.u(o,h,e))}p(t,e){let s;for(let n=0;n<t.length;n++)if(m.test(t[n])){s=!1;const[r,a]=t[n].split(m);switch(r){case"id":this.d.id=a;break;case"width":const o=v(a);o!==null?this.d.width=o:s=!0;break;case"lines":const h=lt(a);h!==null?this.d.lines=h:s=!0;break;case"regionanchor":const c=x(a);c!==null?(this.d.regionAnchorX=c[0],this.d.regionAnchorY=c[1]):s=!0;break;case"viewportanchor":const u=x(a);u!==null?(this.d.viewportAnchorX=u[0],this.d.viewportAnchorY=u[1]):s=!0;break;case"scroll":a==="up"?this.d.scroll="up":s=!0;break;default:this.g(this.f?.v(r,a,e))}s&&this.g(this.f?.w(r,a,e))}}o(t,e){let s;for(let n=0;n<t.length;n++)if(s=!1,m.test(t[n])){const[r,a]=t[n].split(m);switch(r){case"region":const o=this.j[a];o&&(this.c.region=o);break;case"vertical":a==="lr"||a==="rl"?(this.c.vertical=a,this.c.region=null):s=!0;break;case"line":const[h,c]=a.split(B);if(h.includes(ut)){const T=v(h);T!==null?(this.c.line=T,this.c.snapToLines=!1):s=!0}else{const T=ht(h);T!==null?this.c.line=T:s=!0}vt.test(c)?this.c.lineAlign=c:c&&(s=!0),this.c.line!=="auto"&&(this.c.region=null);break;case"position":const[u,d]=a.split(B),_=v(u);_!==null?this.c.position=_:s=!0,d&&yt.test(d)?this.c.positionAlign=d:d&&(s=!0);break;case"size":const S=v(a);S!==null?(this.c.size=S,S<100&&(this.c.region=null)):s=!0;break;case"align":wt.test(a)?this.c.align=a:s=!0;break;default:this.g(this.f?.x(r,a,e))}s&&this.g(this.f?.y(r,a,e))}}g(t){if(t){if(this.m.push(t),this.h.strict)throw this.h.cancel(),t;this.h.onError?.(t)}}}function b(i){const t=i.match(bt);if(!t)return null;const e=t[1]?parseInt(t[1],10):0,s=parseInt(t[2],10),n=parseInt(t[3],10),r=t[4]?parseInt(t[4].padEnd(3,"0"),10):0,a=e*3600+s*60+n+r/1e3;return e<0||s<0||n<0||r<0||s>59||n>59?null:a}function _t(){return new F}var At=Object.freeze({__proto__:null,VTTBlock:D,VTTParser:F,default:_t,parseVTTTimestamp:b});const Et=/[0-9]/,St=/[\s\t]+/,W={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span",timestamp:"span"},kt={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&nbsp;":" ","&lrm;":"‎","&rlm;":"‏"},Nt=/&(?:amp|lt|gt|quot|#(0+)?39|nbsp|lrm|rlm);/g,Rt=new Set(["white","lime","cyan","red","yellow","magenta","blue","black"]),Ct=new Set(Object.keys(W));function q(i){let t="",e=1,s=[],n=[],r;for(let c=0;c<i.text.length;c++){const u=i.text[c];switch(e){case 1:u==="<"?(h(),e=2):t+=u;break;case 2:switch(u){case`
`:case"	":case" ":a(),e=4;break;case".":a(),e=3;break;case"/":e=5;break;case">":a(),e=1;break;default:!t&&Et.test(u)&&(e=6),t+=u;break}break;case 3:switch(u){case"	":case" ":case`
`:o(),r&&r.class?.trim(),e=4;break;case".":o();break;case">":o(),r&&r.class?.trim(),e=1;break;default:t+=u}break;case 4:u===">"?(t=t.replace(St," "),r?.type==="v"?r.voice=k(t):r?.type==="lang"&&(r.lang=k(t)),t="",e=1):t+=u;break;case 5:u===">"&&(t="",r=n.pop(),e=1);break;case 6:if(u===">"){const d=b(t);d!==null&&d>=i.startTime&&d<=i.endTime&&(t="timestamp",a(),r.time=d),t="",e=1}else t+=u;break}}function a(){if(Ct.has(t)){const c=r;r=It(t),c?(n[n.length-1]!==c&&n.push(c),c.children.push(r)):s.push(r)}t="",e=1}function o(){if(r&&t){const c=t.replace("bg_","");Rt.has(c)?r[t.startsWith("bg_")?"bgColor":"color"]=c:r.class=r.class?r.class+" "+t:t}t=""}function h(){if(!t)return;const c={type:"text",data:k(t)};r?r.children.push(c):s.push(c),t=""}return e===1&&h(),s}function It(i){return{tagName:W[i],type:i,children:[]}}function k(i){return i.replace(Nt,t=>kt[t]||"'")}function f(i,t,e){i.style.setProperty(`--${t}`,e+"")}function p(i,t,e=!0){i.setAttribute(`data-${t}`,e===!0?"":e+"")}function A(i,t){i.setAttribute("data-part",t)}function Lt(i){return parseFloat(getComputedStyle(i).lineHeight)||0}function Pt(i){if(C)throw Error("[media-captions] called `createVTTCueTemplate` on the server - use `renderVTTCueString`");const t=document.createElement("template");return t.innerHTML=I(i),{cue:i,content:t.content}}function I(i,t=0){return L(q(i),t)}function L(i,t=0){let e,s="";for(const n of i)if(n.type==="text")s+=n.data;else{const r=n.type==="timestamp";e={},e.class=n.class,e.title=n.type==="v"&&n.voice,e.lang=n.type==="lang"&&n.lang,e["data-part"]=n.type==="v"&&"voice",r&&(e["data-part"]="timed",e["data-time"]=n.time,e["data-future"]=n.time>t,e["data-past"]=n.time<t),e.style=`${n.color?`color: ${n.color};`:""}${n.bgColor?`background-color: ${n.bgColor};`:""}`;const a=Object.entries(e).filter(o=>o[1]).map(o=>`${o[0]}="${o[1]===!0?"":o[1]}"`).join(" ");s+=`<${n.tagName}${a?" "+a:""}>${L(n.children)}</${n.tagName}>`}return s}function X(i,t){if(!C)for(const e of i.querySelectorAll('[data-part="timed"]')){const s=Number(e.getAttribute("data-time"));Number.isNaN(s)||(s>t?p(e,"future"):e.removeAttribute("data-future"),s<t?p(e,"past"):e.removeAttribute("data-past"))}}function Mt(i,t){let e=null,s;function n(){r(),i(...s),s=void 0}function r(){clearTimeout(e),e=null}function a(){s=[].slice.call(arguments),r(),e=setTimeout(n,t)}return a}const g=Symbol(0);function P(i){return i instanceof HTMLElement?{top:i.offsetTop,width:i.clientWidth,height:i.clientHeight,left:i.offsetLeft,right:i.offsetLeft+i.clientWidth,bottom:i.offsetTop+i.clientHeight}:{...i}}function E(i,t,e){switch(t){case"+x":i.left+=e,i.right+=e;break;case"-x":i.left-=e,i.right-=e;break;case"+y":i.top+=e,i.bottom+=e;break;case"-y":i.top-=e,i.bottom-=e;break}}function Ot(i,t){return i.left<=t.right&&i.right>=t.left&&i.top<=t.bottom&&i.bottom>=t.top}function xt(i,t){for(let e=0;e<t.length;e++)if(Ot(i,t[e]))return t[e];return null}function z(i,t){return t.top>=0&&t.bottom<=i.height&&t.left>=0&&t.right<=i.width}function Bt(i,t,e){switch(e){case"+x":return t.left<0;case"-x":return t.right>i.width;case"+y":return t.top<0;case"-y":return t.bottom>i.height}}function zt(i,t){const e=Math.max(0,Math.min(i.width,t.right)-Math.max(0,t.left)),s=Math.max(0,Math.min(i.height,t.bottom)-Math.max(0,t.top));return e*s/(i.height*i.width)}function M(i,t){return{top:t.top/i.height,left:t.left/i.width,right:(i.width-t.right)/i.width,bottom:(i.height-t.bottom)/i.height}}function Y(i,t){return t.top=t.top*i.height,t.left=t.left*i.width,t.right=i.width-t.right*i.width,t.bottom=i.height-t.bottom*i.height,t}const K=["top","left","right","bottom"];function J(i,t,e,s){const n=M(t,e);for(const r of K)f(i,`${s}-${r}`,n[r]*100+"%")}function Q(i,t,e,s){let n=1,r,a={...t};for(let o=0;o<s.length;o++){for(;Bt(i,t,s[o])||z(i,t)&&xt(t,e);)E(t,s[o],1);if(z(i,t))return t;const h=zt(i,t);n>h&&(r={...t},n=h),t={...a}}return r||a}const y=Symbol(0);function $t(i,t,e,s){let n=e.firstElementChild,r=Gt(t),a,o=[];if(e[g]||(e[g]=Vt(i,e)),a=Y(i,{...e[g]}),e[y])o=[e[y]==="top"?"+y":"-y","+x","-x"];else if(t.snapToLines){let h;switch(t.vertical){case"":o=["+y","-y"],h="height";break;case"rl":o=["+x","-x"],h="width";break;case"lr":o=["-x","+x"],h="width";break}let c=Lt(n),u=c*Math.round(r),d=i[h]+c,_=o[0];Math.abs(u)>d&&(u=u<0?-1:1,u*=Math.ceil(d/c)*c),r<0&&(u+=t.vertical===""?i.height:i.width,o=o.reverse()),E(a,_,u)}else{const h=t.vertical==="",c=h?"+y":"+x",u=h?a.height:a.width;E(a,c,(h?i.height:i.width)*r/100),E(a,c,t.lineAlign==="center"?u/2:t.lineAlign==="end"?u:0),o=h?["-y","+y","-x","+x"]:["-x","+x","-y","+y"]}return a=Q(i,a,s,o),J(e,i,a,"cue"),a}function Vt(i,t){const e=P(t),s=jt(t);if(t[y]=!1,s.top&&(e.top=s.top,e.bottom=s.top+e.height,t[y]="top"),s.bottom){const n=i.height-s.bottom;e.top=n-e.height,e.bottom=n,t[y]="bottom"}return s.left&&(e.left=s.left),s.right&&(e.right=i.width-s.right),M(i,e)}function jt(i){const t={};for(const e of K)t[e]=parseFloat(i.style.getPropertyValue(`--cue-${e}`));return t}function Gt(i){return i.line==="auto"?i.snapToLines?-1:100:i.line}function Ht(i){if(i.position==="auto")switch(i.align){case"start":case"left":return 0;case"right":case"end":return 100;default:return 50}return i.position}function Dt(i,t){if(i.positionAlign==="auto")switch(i.align){case"start":return t==="ltr"?"line-left":"line-right";case"end":return t==="ltr"?"line-right":"line-left";case"center":return"center";default:return`line-${i.align}`}return i.positionAlign}const Ft=["-y","+y","-x","+x"];function Wt(i,t,e,s){let n=Array.from(e.querySelectorAll('[data-part="cue-display"]')),r=0,a=Math.max(0,n.length-t.lines);for(let h=n.length-1;h>=a;h--)r+=n[h].offsetHeight;f(e,"region-height",r+"px"),e[g]||(e[g]=M(i,P(e)));let o={...e[g]};return o=Y(i,o),o.width=e.clientWidth,o.height=r,o.right=o.left+o.width,o.bottom=o.top+r,o=Q(i,o,s,Ft),J(e,i,o,"region"),o}class qt{constructor(t,e){l(this,"overlay");l(this,"z");l(this,"A",0);l(this,"C","ltr");l(this,"B",[]);l(this,"D",!1);l(this,"E");l(this,"j",new Map);l(this,"l",new Map);l(this,"K",Mt(()=>{this.D=!1,this.G();for(const t of this.j.values())t[g]=null;for(const t of this.l.values())t&&(t[g]=null);this.H(!0)},50));this.overlay=t,this.dir=e?.dir??"ltr",t.setAttribute("translate","yes"),t.setAttribute("aria-live","off"),t.setAttribute("aria-atomic","true"),A(t,"captions"),this.G(),this.E=new ResizeObserver(this.I.bind(this)),this.E.observe(t)}get dir(){return this.C}set dir(t){this.C=t,p(this.overlay,"dir",t)}get currentTime(){return this.A}set currentTime(t){this.A=t,this.update()}changeTrack({regions:t,cues:e}){this.reset(),this.J(t);for(const s of e)this.l.set(s,null);this.update()}addCue(t){this.l.set(t,null),this.update()}removeCue(t){this.l.delete(t),this.update()}update(t=!1){this.H(t)}reset(){this.l.clear(),this.j.clear(),this.B=[],this.overlay.textContent=""}destroy(){this.reset(),this.E.disconnect()}I(){this.D=!0,this.K()}G(){this.z=P(this.overlay),f(this.overlay,"overlay-width",this.z.width+"px"),f(this.overlay,"overlay-height",this.z.height+"px")}H(t=!1){if(!this.l.size||this.D)return;let e,s=[...this.l.keys()].filter(r=>this.A>=r.startTime&&this.A<=r.endTime).sort((r,a)=>r.startTime!==a.startTime?r.startTime-a.startTime:r.endTime-a.endTime),n=s.map(r=>r.region);for(let r=0;r<this.B.length;r++){if(e=this.B[r],s[r]===e)continue;if(e.region&&!n.includes(e.region)){const o=this.j.get(e.region.id);o&&(o.removeAttribute("data-active"),t=!0)}const a=this.l.get(e);a&&(a.remove(),t=!0)}for(let r=0;r<s.length;r++){e=s[r];let a=this.l.get(e);a||this.l.set(e,a=this.L(e));const o=this.F(e)&&this.j.get(e.region.id);o&&!o.hasAttribute("data-active")&&(requestAnimationFrame(()=>p(o,"active")),t=!0),a.isConnected||((o||this.overlay).append(a),t=!0)}if(t){const r=[],a=new Set;for(let o=s.length-1;o>=0;o--){if(e=s[o],a.has(e.region||e))continue;const h=this.F(e),c=h?this.j.get(e.region.id):this.l.get(e);h?r.push(Wt(this.z,e.region,c,r)):r.push($t(this.z,e,c,r)),a.add(h?e.region:e)}}X(this.overlay,this.A),this.B=s}J(t){if(t)for(const e of t){const s=this.M(e);this.j.set(e.id,s),this.overlay.append(s)}}M(t){const e=document.createElement("div");return A(e,"region"),p(e,"id",t.id),p(e,"scroll",t.scroll),f(e,"region-width",t.width+"%"),f(e,"region-anchor-x",t.regionAnchorX),f(e,"region-anchor-y",t.regionAnchorY),f(e,"region-viewport-anchor-x",t.viewportAnchorX),f(e,"region-viewport-anchor-y",t.viewportAnchorY),f(e,"region-lines",t.lines),e}L(t){const e=document.createElement("div"),s=Ht(t),n=Dt(t,this.C);if(A(e,"cue-display"),t.vertical!==""&&p(e,"vertical"),f(e,"cue-text-align",t.align),t.style)for(const a of Object.keys(t.style))e.style.setProperty(a,t.style[a]);if(this.F(t))f(e,"cue-offset",`${s-(n==="line-right"?100:n==="center"?50:0)}%`);else if(f(e,"cue-writing-mode",t.vertical===""?"horizontal-tb":t.vertical==="lr"?"vertical-lr":"vertical-rl"),!t.style?.["--cue-width"]){let a=s;n==="line-left"?a=100-s:n==="center"&&s<=50?a=s*2:n==="center"&&s>50&&(a=(100-s)*2);const o=t.size<a?t.size:a;t.vertical===""?f(e,"cue-width",o+"%"):f(e,"cue-height",o+"%")}const r=document.createElement("div");return A(r,"cue"),t.id&&p(r,"id",t.id),r.innerHTML=I(t),e.append(r),e}F(t){return t.region&&t.size===100&&t.vertical===""&&t.line==="auto"}}const Kt=Object.freeze(Object.defineProperty({__proto__:null,CaptionsRenderer:qt,ParseError:et,ParseErrorCode:tt,TextCue:j,VTTCue:G,VTTRegion:H,createVTTCueTemplate:Pt,parseByteStream:V,parseResponse:nt,parseText:rt,parseTextStream:R,parseVTTTimestamp:b,renderVTTCueString:I,renderVTTTokensString:L,tokenizeVTTCue:q,updateTimedVTTCueNodes:X},Symbol.toStringTag,{value:"Module"}));export{et as P,F as V,D as a,G as b,tt as c,Kt as d,b as p};
