const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/errors-aP9OPUd3.js","assets/prod-CfCFoxra.js","assets/app-BU6DmzXc.js"])))=>i.map(i=>d[i]);
var F=Object.defineProperty;var A=(c,t,a)=>t in c?F(c,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[t]=a;var h=(c,t,a)=>A(c,typeof t!="symbol"?t+"":t,a);import{_ as P}from"./app-BU6DmzXc.js";import{b as L,p as R}from"./prod-CfCFoxra.js";const d=/^Format:[\s\t]*/,y=/^Style:[\s\t]*/,O=/^Dialogue:[\s\t]*/,S=/[\s\t]*,[\s\t]*/,w=/\{[^}]+\}/g,I=/\\N/g,x=/^\[(.*)[\s\t]?Styles\]$/,k=/^\[(.*)[\s\t]?Events\]$/;class V{constructor(){h(this,"h");h(this,"O",0);h(this,"c",null);h(this,"l",[]);h(this,"m",[]);h(this,"N",null);h(this,"f");h(this,"P",{})}async init(t){this.h=t,t.errors&&(this.f=(await P(async()=>{const{ParseErrorBuilder:a}=await import("./errors-aP9OPUd3.js");return{ParseErrorBuilder:a}},__vite__mapDeps([0,1,2]))).ParseErrorBuilder)}parse(t,a){if(this.O)switch(this.O){case 1:if(t==="")this.O=0;else if(y.test(t))if(this.N){const e=t.replace(y,"").split(S);this.S(e)}else this.g(this.f?.T("Style",a));else d.test(t)?this.N=t.replace(d,"").split(S):k.test(t)&&(this.N=null,this.O=2);break;case 2:if(t==="")this.Q();else if(O.test(t))if(this.Q(),this.N){const e=t.replace(O,"").split(S),s=this.U(e,a);s&&(this.c=s)}else this.g(this.f?.T("Dialogue",a));else this.c?this.c.text+=`
`+t.replace(w,"").replace(I,`
`):d.test(t)?this.N=t.replace(d,"").split(S):x.test(t)?(this.N=null,this.O=1):k.test(t)&&(this.N=null)}else t===""||(x.test(t)?(this.N=null,this.O=1):k.test(t)&&(this.N=null,this.O=2))}done(){return{metadata:{},cues:this.l,regions:[],errors:this.m}}Q(){this.c&&(this.l.push(this.c),this.h.onCue?.(this.c),this.c=null)}S(t){let a="Default",e={},s,i="center",l="bottom",b,u=1.2,n,f,o=3,g=[];for(let p=0;p<this.N.length;p++){const M=this.N[p],r=t[p];switch(M){case"Name":a=r;break;case"Fontname":e["font-family"]=r;break;case"Fontsize":e["font-size"]=`calc(${r} / var(--overlay-height))`;break;case"PrimaryColour":const N=T(r);N&&(e["--cue-color"]=N);break;case"BorderStyle":o=parseInt(r,10);break;case"BackColour":f=T(r);break;case"OutlineColour":const E=T(r);E&&(n=E);break;case"Bold":parseInt(r)&&(e["font-weight"]="bold");break;case"Italic":parseInt(r)&&(e["font-style"]="italic");break;case"Underline":parseInt(r)&&(e["text-decoration"]="underline");break;case"StrikeOut":parseInt(r)&&(e["text-decoration"]="line-through");break;case"Spacing":e["letter-spacing"]=r+"px";break;case"AlphaLevel":e.opacity=parseFloat(r);break;case"ScaleX":g.push(`scaleX(${parseFloat(r)/100})`);break;case"ScaleY":g.push(`scaleY(${parseFloat(r)/100})`);break;case"Angle":g.push(`rotate(${r}deg)`);break;case"Shadow":u=parseInt(r,10)*1.2;break;case"MarginL":e["--cue-width"]="auto",e["--cue-left"]=parseFloat(r)+"px";break;case"MarginR":e["--cue-width"]="auto",e["--cue-right"]=parseFloat(r)+"px";break;case"MarginV":b=parseFloat(r);break;case"Outline":s=parseInt(r,10);break;case"Alignment":const m=parseInt(r,10);switch(m>=4&&(l=m>=7?"top":"center"),m%3){case 1:i="start";break;case 2:i="center";break;case 3:i="end";break}}}if(e.R=l,e["--cue-white-space"]="normal",e["--cue-line-height"]="normal",e["--cue-text-align"]=i,l==="center"?(e["--cue-top"]="50%",g.push("translateY(-50%)")):e[`--cue-${l}`]=(b||0)+"px",o===1&&(e["--cue-padding-y"]="0"),(o===1||f)&&(e["--cue-bg-color"]=o===1?"none":f),o===3&&n&&(e["--cue-outline"]=`${s}px solid ${n}`),o===1&&typeof s=="number"){const p=f??"#000";e["--cue-text-shadow"]=[n&&_(s*1.2,u*1.2,n),n?_(s*(s/2),u*(s/2),p):_(s,u,p)].filter(Boolean).join(", ")}g.length&&(e["--cue-transform"]=g.join(" ")),this.P[a]=e}U(t,a){const e=this.V(t),s=this.q(e.Start,e.End,a);if(!s)return;const i=new L(s[0],s[1],""),l={...this.P[e.Style]||{}},b=e.Name?`<v ${e.Name}>`:"",u=l.R,n=e.MarginL&&parseFloat(e.MarginL),f=e.MarginR&&parseFloat(e.MarginR),o=e.MarginV&&parseFloat(e.MarginV);return n&&(l["--cue-width"]="auto",l["--cue-left"]=n+"px"),f&&(l["--cue-width"]="auto",l["--cue-right"]=f+"px"),o&&u!=="center"&&(l[`--cue-${u}`]=o+"px"),i.text=b+t.slice(this.N.length-1).join(", ").replace(w,"").replace(I,`
`),delete l.R,Object.keys(l).length&&(i.style=l),i}V(t){const a={};for(let e=0;e<this.N.length;e++)a[this.N[e]]=t[e];return a}q(t,a,e){const s=R(t),i=R(a);if(s!==null&&i!==null&&i>s)return[s,i];s===null&&this.g(this.f?.s(t,e)),i===null&&this.g(this.f?.t(a,e)),s!=null&&i!==null&&i>s&&this.g(this.f?.u(s,i,e))}g(t){if(t){if(this.m.push(t),this.h.strict)throw this.h.cancel(),t;this.h.onError?.(t)}}}function T(c){const t=parseInt(c.replace("&H",""),16);if(t>=0){const e=(t>>24&255^255)/255,s=t>>16&255,i=t>>8&255;return"rgba("+[t&255,i,s,e].join(",")+")"}return null}function _(c,t,a){const e=Math.ceil(2*Math.PI*c);let s="";for(let i=0;i<e;i++){const l=2*Math.PI*i/e;s+=c*Math.cos(l)+"px "+t*Math.sin(l)+"px 0 "+a+(i==e-1?"":",")}return s}function Y(){return new V}export{V as SSAParser,Y as default};
