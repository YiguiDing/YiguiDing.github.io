import{ah as s,ai as l,ap as n,aj as a}from"./app-CMKR-Zwd.js";const t="/assets/image-BBY8ATH2.png",e="/assets/image-1-CYKY3h9m.png",h={};function r(k,i){return a(),l("div",null,i[0]||(i[0]=[n('<h1 id="嵌入式linux系统移植学习笔记" tabindex="-1"><a class="header-anchor" href="#嵌入式linux系统移植学习笔记"><span>嵌入式Linux系统移植学习笔记</span></a></h1><h2 id="嵌入式linux系统移植概述" tabindex="-1"><a class="header-anchor" href="#嵌入式linux系统移植概述"><span>嵌入式Linux系统移植概述</span></a></h2><h3 id="嵌入式linux系统构成" tabindex="-1"><a class="header-anchor" href="#嵌入式linux系统构成"><span>嵌入式Linux系统构成</span></a></h3><p><strong>典型嵌入式Linux系统的组成部分</strong></p><ul><li><code>bootloder</code> 引导程序</li><li><code>kernel</code> Linux内核</li><li><code>fs</code> 文件系统 <ul><li>存放用户态的可执行程序和数据</li><li><code>rootfs</code> 系统级可执行程序</li><li><code>datafs/userfs</code> 用户数据</li></ul></li></ul><p><strong>什么是移植？</strong></p><ul><li>修改<code>bootloder</code>源代码</li><li>修改<code>kernel</code>源代码</li><li>修改文件系统中用户态<code>可执行程序</code>源代码</li><li><strong>目的：使其能够在目标硬件平台运行</strong></li></ul><h3 id="bootloder" tabindex="-1"><a class="header-anchor" href="#bootloder"><span>Bootloder</span></a></h3><p><strong>Bootloder的作用</strong></p><blockquote><p>在PC电脑上，操作系统的引导工作通常由 <strong>BIOS引导程序</strong> 和 <strong><code>MBR分区表的第一个扇区</code>或<code>GPT分区表的EFI分区</code></strong> 配合完成；<br> 而嵌入式系统通常没有BIOS固件程序，因此整个系统的引导工作由bootloder来完成</p></blockquote><ul><li>负责初始化硬件设备</li><li>建立内存空间映射图</li><li>准备好合适的软硬件环境</li><li>以便最终调用操作系统内核程序</li></ul><p><strong>Bootloder的特点</strong></p><ul><li>Bootloder不是操作系统内核代码</li><li>Bootloder代码是针对特点CPU架构的汇编代码，不可移植。</li><li>Bootloder代码依赖CPU架构 同时依赖嵌入式系统板级配置</li></ul><p><strong>Bootloder程序的基本流程</strong></p><ul><li>初始化硬件</li><li>将操作系统内核从Flash（存储器）拷贝到SDRAM（内存）中；</li><li>改写系统的内存映射 <ul><li>由Flash起始地址为0 改为SDRAM起始地址为0</li></ul></li><li>设置堆栈指针 清零BSS段 <ul><li>执行C程序和调用子函数要用到。</li></ul></li><li>提供Linux内核启动参数</li><li>启动Linux内核</li><li>改变PC寄存器的值，使得CPU开始执行真正的操作系统内核。</li></ul><h3 id="kernel" tabindex="-1"><a class="header-anchor" href="#kernel"><span>Kernel</span></a></h3><p><strong>Linux内核功能</strong></p><ul><li>内存管理： <ul><li>裸板开发操作物理地址</li><li>linux软件开发可以<code>malloc()</code>获取虚拟地址</li></ul></li><li>进程管理/进程通信 <ul><li>裸板开发通过RTOS实现多任务</li><li>linux软件开发通过<code>fork()</code>实现多任务</li></ul></li><li>文件系统 <ul><li>裸板开发需要手动管理数据，精确到字节，需考虑存储地址、偏移、写入字节数</li><li>linux软件开发通过文件系统管理数据，精确到文件</li></ul></li><li>设备管理</li><li>网络协议 <ul><li>linux是对网络协议支持最全的操作系统</li><li>TCP/UDP/IP 协议都在linux源代码中有实现</li></ul></li></ul><p><strong>内核的本质</strong></p><ul><li>从C语言角度看内核：c语言函数的集合。</li><li>从硬件角度看内核：硬件的管理者和维护者。</li><li>从应用程序角度看内核：服务提供者。</li></ul><h3 id="fs文件系统" tabindex="-1"><a class="header-anchor" href="#fs文件系统"><span>fs文件系统</span></a></h3><p><strong>嵌入式文件系统</strong></p><ul><li>是一种对存储设备上的数据进行组织管理的控制机制</li><li>是操作系统的一部分，负责管理和存储文件。</li></ul><p><strong>嵌入式Linux系统中典型的存储子系统层次化架构</strong></p><ul><li><strong>用户层 (User Layer)</strong><ul><li><strong>目录树</strong>：为用户和应用程序提供统一的文件访问视图。用户通过路径（如 <code>/home/data/file.txt</code>）来操作文件，完全无需关心文件实际存储在哪种介质上。</li></ul></li><li><strong>内核层 (Kernel Layer)</strong><ul><li><strong>虚拟文件系统 (VFS)</strong>：这是整个架构的<strong>核心抽象层</strong>。它定义了一组标准的文件操作接口（如 <code>open</code>, <code>read</code>, <code>write</code>, <code>close</code>）。上层应用只需与VFS交互，而VFS负责将这些通用调用“翻译”并路由到下层的具体文件系统。</li><li><strong>具体文件系统</strong>：VFS之下是各种针对不同存储介质优化的文件系统实现： <ul><li><strong>JFFS2, YAFFS</strong>：专为<strong>Nand Flash</strong>设计的日志闪存文件系统，处理了闪存特有的擦除、读写均衡、坏块管理等问题。</li><li><strong>Cramfs, Romfs</strong>：只读的压缩文件系统，常用于存放固件、系统程序等不变的数据，节省空间。</li><li><strong>Ramdisk</strong>：将一部分内存（RAM）虚拟成块设备，作为临时性的高速文件系统，但掉电数据会丢失。</li></ul></li></ul></li><li><strong>驱动层 (Driver Layer)</strong><ul><li><strong>MTD子系统</strong>：这是Linux内核为<strong>内存技术设备</strong>设计的统一驱动框架，专门用于管理各类闪存。 <ul><li><strong>MTD设备驱动</strong>：直接操作具体的Flash硬件（如某型号的Nor或Nand Flash芯片），负责最底层的读写、擦除命令。</li><li><strong>MTD字符/块设备</strong>：MTD向上提供的两种视图。 <ul><li><strong>MTD字符设备</strong>：提供对闪存的原始、字节级访问（如用于烧写引导程序）。</li><li><strong>MTD块设备</strong>：将闪存模拟成标准的块设备（类似硬盘），这样上层的文件系统（如JFFS2）就可以像操作普通磁盘一样在其上创建文件系统。</li></ul></li></ul></li></ul></li><li><strong>硬件层 (Hardware Layer)</strong><ul><li><strong>Nor Flash</strong>：支持芯片内执行，读写速度快，但价格高、容量小，常用于存储启动代码。</li><li><strong>Nand Flash</strong>：容量大、成本低，是主要的存储介质，但需要复杂的坏块管理和磨损均衡。</li><li><strong>RAM</strong>：易失性存储器，速度快，用于Ramdisk或作为系统缓存。</li></ul></li><li><img src="'+t+'" alt="alt text"></li><li><img src="'+e+`" alt="alt text"></li></ul><hr><p><strong>关键技术与数据流</strong></p><ol><li><strong>VFS的抽象作用</strong>：VFS是连接用户空间和多样存储后端的桥梁，它使得 <code>ext4</code>, <code>FAT32</code>, <code>JFFS2</code> 等不同文件系统可以在Linux中共存，对用户透明。</li><li><strong>MTD的标准化意义</strong>：在MTD出现之前，每种Flash都需要为其文件系统编写专用驱动，耦合度高。MTD定义了标准的Flash操作接口，将<strong>闪存驱动</strong>和<strong>闪存文件系统</strong>解耦。文件系统基于MTD接口开发，驱动则实现MTD接口，二者可以独立开发和替换。</li><li><strong>完整数据访问路径示例</strong><br> 当用户执行 <code>cat /mnt/nand/example.txt</code> 时： <ol><li>用户层通过路径发起请求。</li><li>VFS解析路径，发现 <code>/mnt/nand</code> 挂载的是YAFFS2文件系统。</li><li>VFS调用YAFFS2文件系统的 <code>read</code> 方法。</li><li>YAFFS2文件系统将文件操作转换为对逻辑块地址的请求，并通过MTD块设备接口下发。</li><li>MTD子系统将块设备请求转换为对具体Nand Flash芯片的读操作序列。</li><li>MTD设备驱动操控硬件，从Nand Flash中读取数据，并按原路返回给用户。</li></ol></li></ol><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h3><p><strong>bootloder</strong></p><ul><li>硬件上电后固定跳转到该位置执行代码</li><li>初始化相应硬件设备</li><li>加载操作系统内核代码到内存</li><li>跳转到内核代码的起始位置开始执行</li></ul><p><strong>kernel</strong></p><ul><li>内核自解压ulmage</li><li>初始化硬件设备</li><li>初始化静态编译进内核的驱动模块</li><li>挂载根文件系统</li><li>执行第一个用户空间程序</li></ul><p><strong>第一个用户空间程序</strong></p><ul><li>配置用户环境</li><li>执行服务进程</li></ul><h2 id="u-boot-的配置、编译、烧写" tabindex="-1"><a class="header-anchor" href="#u-boot-的配置、编译、烧写"><span>u-boot 的配置、编译、烧写</span></a></h2><p><strong>u-boot是什么？</strong></p><ul><li>U-Boot(Universal Boot Loader)，即通用Bootloader <ul><li>通用 <ul><li>支持多架构CPU: PowerPC、MIPC、X86、ARM等;</li><li>支持多系统OS: Linux、VxWorks、QNX、LynxOscar等操作系统</li></ul></li></ul></li><li>德国DENX小组开发的用于多种嵌入式CPU的bootloader程序</li><li>遵循GPL条款的开放源代码项目</li></ul><blockquote><ul><li>Bootloader不属于操作系统内核，这一部分代码不具有可移植性;</li><li>在移植操作系统时，这部分代码必须加以改写;</li><li>Bootloader不但依赖于CPU的体系结构，而且依赖于嵌入式系统板级设备的配置</li></ul></blockquote><p><strong>u-boot特点</strong></p><ul><li>代码结构清晰、易于移植</li><li>支持多种处理器体系结构</li><li>支持众多开发板</li><li>支持网络协议、USB、SD等多种协议和设备</li><li>支持文件系统</li></ul><p><strong>u-boot代码的获取</strong></p><ul><li>官网获取 <a href="https://u-boot.org/" target="_blank" rel="noopener noreferrer">https://u-boot.org/</a></li><li>github获取 <a href="https://github.com/u-boot/u-boot" target="_blank" rel="noopener noreferrer">https://github.com/u-boot/u-boot</a></li><li>开发板厂商提供</li></ul><p><strong>配置wsl: Ubuntu 22.04 记录</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#4c4f69;--shiki-dark:#E6E6E6;--shiki-light-bg:#eff1f5;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes catppuccin-latte slack-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">cat</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;"> &gt;&gt;</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> /etc/wsl.conf</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;"> &lt;&lt;</span><span style="--shiki-light:#40A02B;--shiki-dark:#E6E6E6;"> EOF</span></span>
<span class="line"><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"># 互操作设置</span></span>
<span class="line"><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">[interop]</span></span>
<span class="line"><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"># 是否支持启动 Windows 进程</span></span>
<span class="line"><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">enabled=false</span></span>
<span class="line"><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"># 是否将 Windows 路径元素添加到 </span><span style="--shiki-light:#4C4F69;--shiki-dark:#9CDCFE;">$PATH</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> 环境变量</span></span>
<span class="line"><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">appendWindowsPath=false</span></span>
<span class="line"><span style="--shiki-light:#40A02B;--shiki-dark:#E6E6E6;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"># 在windows中执行： </span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"># 关闭 WSL 发行版，以便重启 WSL 实例</span></span>
<span class="line"><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">wsl.exe</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> --shutdown</span></span>
<span class="line"><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">wsl</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> --list</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> --all</span></span>
<span class="line"><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">wsl</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> --manage</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> Ubuntu-24.04</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> --move</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> D:</span><span style="--shiki-light:#EA76CB;--shiki-dark:#D7BA7D;">\\W</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">SL</span><span style="--shiki-light:#EA76CB;--shiki-dark:#D7BA7D;">\\U</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;">buntu</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>安装gcc编译器</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#4c4f69;--shiki-dark:#E6E6E6;--shiki-light-bg:#eff1f5;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes catppuccin-latte slack-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">sudo</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> update</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"># 安装 build-essential: gcc/g++/make/dpkg-dev/libc...</span></span>
<span class="line"><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">sudo</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> apt</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> install</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> build-essential</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"># 编译u-boot要求gcc版本&gt;10</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"># Ubuntu 20.04 默认 装的是GCC 9.4</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"># Ubuntu 22.04 默认 装的是GCC 11.3</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>在Linux系统安装ARM交叉编译工具</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#4c4f69;--shiki-dark:#E6E6E6;--shiki-light-bg:#eff1f5;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes catppuccin-latte slack-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"># 从arm官网找到下载链接</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"># 注意不要下载嵌入式的编译工具gcc-arm-none-eabi</span></span>
<span class="line"><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">wget</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> https://developer.arm.com/-/media/Files/downloads/gnu/14.3.rel1/binrel/arm-gnu-toolchain-14.3.rel1-x86_64-aarch64-none-linux-gnu.tar.xz</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"># 解压</span></span>
<span class="line"><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">tar</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> -xJvf</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> arm-gnu-toolchain-14.3.rel1-x86_64-aarch64-none-linux-gnu.tar.xz</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;"> </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"># 安装</span></span>
<span class="line"><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">mkdir</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> ~/.tools</span></span>
<span class="line"><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">mv</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> ./arm-gnu-toolchain-14.3.rel1-x86_64-aarch64-none-linux-gnu/</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> ~/.tools/</span></span>
<span class="line"><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">vi</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> ~/.bashrc</span></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#569CD6;">export</span><span style="--shiki-light:#4C4F69;--shiki-dark:#9CDCFE;"> PATH</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#4C4F69;--shiki-dark:#9CDCFE;">$PATH</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">:/</span><span style="--shiki-light:#4C4F69;--shiki-dark:#9CDCFE;">root</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">/.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#9CDCFE;">tools</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">/</span><span style="--shiki-light:#4C4F69;--shiki-dark:#9CDCFE;">arm-gnu-toolchain-14</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#9CDCFE;">3</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#9CDCFE;">rel1-x86_64-aarch64-none-linux-gnu</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">/</span><span style="--shiki-light:#4C4F69;--shiki-dark:#9CDCFE;">bin</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">/</span></span>
<span class="line"><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">source</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> ~/.bashrc</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>构建 Arm 可信固件 (TF-A)</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#4c4f69;--shiki-dark:#E6E6E6;--shiki-light-bg:#eff1f5;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes catppuccin-latte slack-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">git</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> clone</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> https://git.trustedfirmware.org/TF-A/trusted-firmware-a.git</span></span>
<span class="line"><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">cd</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> trusted-firmware-a</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"># 编译 目标平台=sun50i_h616 (根据dts设备树描述，h618的cpu和h616共用一个)</span></span>
<span class="line"><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">make</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> CROSS_COMPILE=aarch64-none-linux-gnu-</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> PLAT=sun50i_h616</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> DEBUG=</span><span style="--shiki-light:#FE640B;--shiki-dark:#B5CEA8;">1</span></span>
<span class="line"><span style="--shiki-light:#8839EF;--shiki-dark:#569CD6;">export</span><span style="--shiki-light:#4C4F69;--shiki-dark:#9CDCFE;"> BL31</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">$(</span><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">pwd</span><span style="--shiki-light:#7C7F93;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">/</span><span style="--shiki-light:#4C4F69;--shiki-dark:#9CDCFE;">build</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">/</span><span style="--shiki-light:#4C4F69;--shiki-dark:#9CDCFE;">sun50i_h616</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">/</span><span style="--shiki-light:#4C4F69;--shiki-dark:#9CDCFE;">debug</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">/</span><span style="--shiki-light:#4C4F69;--shiki-dark:#9CDCFE;">bl31</span><span style="--shiki-light:#4C4F69;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#4C4F69;--shiki-dark:#9CDCFE;">bin</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>构建u-boot</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#4c4f69;--shiki-dark:#E6E6E6;--shiki-light-bg:#eff1f5;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes catppuccin-latte slack-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">wget</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> https://github.com/u-boot/u-boot/archive/refs/tags/v2026.01-rc4.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">tar</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> -xzvf</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> u-boot-2026.01-rc4.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#D20F39;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">cd</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> u-boot-2026.01-rc4</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"># 安装后续编译操作的依赖项 否则将依次报错缺失相关文件</span></span>
<span class="line"><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">sudo</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> apt-get</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> install</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> bison</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> flex</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> swig</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> python3-dev</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> libssl-dev</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> libgnutls28-dev</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"># 查看支持的开发板</span></span>
<span class="line"><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">ls</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> configs/</span><span style="--shiki-light:#179299;--shiki-dark:#D4D4D4;"> |</span><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;"> grep</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> orangepi</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"># 生成配置文件 .config</span></span>
<span class="line"><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">make</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> orangepi_zero2w_defconfig</span></span>
<span class="line"><span style="--shiki-light:#7C7F93;--shiki-light-font-style:italic;--shiki-dark:#6A9955;--shiki-dark-font-style:inherit;"># 生成 u-boot</span></span>
<span class="line"><span style="--shiki-light:#1E66F5;--shiki-light-font-style:italic;--shiki-dark:#DCDCAA;--shiki-dark-font-style:inherit;">make</span><span style="--shiki-light:#40A02B;--shiki-dark:#CE9178;"> CROSS_COMPILE=aarch64-none-linux-gnu-</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,53)]))}const p=s(h,[["render",r]]),d=JSON.parse('{"path":"/%E7%94%B5%E5%AD%90/%E5%B5%8C%E5%85%A5%E5%BC%8FLinux%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","title":"嵌入式Linux系统移植学习笔记","lang":"zh-CN","frontmatter":{"tittle":"嵌入式Linux系统移植学习笔记","date":"2025-12-11T18:01:00.000Z","tag":["嵌入式"],"category":"电子","article":false,"description":"嵌入式Linux系统移植学习笔记 嵌入式Linux系统移植概述 嵌入式Linux系统构成 典型嵌入式Linux系统的组成部分 bootloder 引导程序 kernel Linux内核 fs 文件系统 存放用户态的可执行程序和数据 rootfs 系统级可执行程序 datafs/userfs 用户数据 什么是移植？ 修改bootloder源代码 修改ke...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"WebPage\\",\\"name\\":\\"嵌入式Linux系统移植学习笔记\\",\\"description\\":\\"嵌入式Linux系统移植学习笔记 嵌入式Linux系统移植概述 嵌入式Linux系统构成 典型嵌入式Linux系统的组成部分 bootloder 引导程序 kernel Linux内核 fs 文件系统 存放用户态的可执行程序和数据 rootfs 系统级可执行程序 datafs/userfs 用户数据 什么是移植？ 修改bootloder源代码 修改ke...\\"}"],["meta",{"property":"og:url","content":"https://dingdingdang.online/%E7%94%B5%E5%AD%90/%E5%B5%8C%E5%85%A5%E5%BC%8FLinux%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"}],["meta",{"property":"og:site_name","content":"YiguiDing的Blog小站"}],["meta",{"property":"og:title","content":"嵌入式Linux系统移植学习笔记"}],["meta",{"property":"og:description","content":"嵌入式Linux系统移植学习笔记 嵌入式Linux系统移植概述 嵌入式Linux系统构成 典型嵌入式Linux系统的组成部分 bootloder 引导程序 kernel Linux内核 fs 文件系统 存放用户态的可执行程序和数据 rootfs 系统级可执行程序 datafs/userfs 用户数据 什么是移植？ 修改bootloder源代码 修改ke..."}],["meta",{"property":"og:type","content":"website"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-12-15T00:53:01.000Z"}],["meta",{"property":"article:tag","content":"嵌入式"}],["meta",{"property":"article:published_time","content":"2025-12-11T18:01:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-12-15T00:53:01.000Z"}],["meta",{"name":"baidu-site-verification","content":"codeva-PwE9Ts6nMl"}]]},"git":{"createdTime":1765476219000,"updatedTime":1765759981000,"contributors":[{"name":"YiguiDing","username":"YiguiDing","email":"2449695354@qq.com","commits":2,"url":"https://github.com/YiguiDing"}]},"readingTime":{"minutes":7.77,"words":2331},"filePathRelative":"电子/嵌入式Linux系统移植学习笔记/README.md","excerpt":"","autoDesc":true}');export{p as comp,d as data};
