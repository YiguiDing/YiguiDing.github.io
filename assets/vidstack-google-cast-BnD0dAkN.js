var vt=Object.defineProperty;var W=d=>{throw TypeError(d)};var Lt=(d,t,s)=>t in d?vt(d,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):d[t]=s;var G=(d,t,s)=>Lt(d,typeof t!="symbol"?t+"":t,s),O=(d,t,s)=>t.has(d)||W("Cannot "+s);var e=(d,t,s)=>(O(d,t,"read from private field"),s?s.call(d):t.get(d)),m=(d,t,s)=>t.has(d)?W("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(d):t.set(d,s),l=(d,t,s,a)=>(O(d,t,"write to private field"),a?a.call(d,s):t.set(d,s),s),r=(d,t,s)=>(O(d,t,"access private method"),s);import{v as St,x as v,af as Z,o as At,D as tt,h as V,l as et,j as It,ag as bt,L as Rt}from"./app-WJyYCnEI.js";import{R as wt}from"./vidstack-DqAw8m9J-D4n5br_i.js";import{g as Mt,a as Dt,b as it,h as st,l as Nt,c as xt}from"./vidstack-D2pY00kU-BWY-ATQd.js";var g,P,at;class Pt{constructor(t){m(this,P);m(this,g);l(this,g,new chrome.cast.media.MediaInfo(t.src,t.type))}build(){return e(this,g)}setStreamType(t){return t.includes("live")?e(this,g).streamType=chrome.cast.media.StreamType.LIVE:e(this,g).streamType=chrome.cast.media.StreamType.BUFFERED,this}setTracks(t){return e(this,g).tracks=t.map(r(this,P,at)),this}setMetadata(t,s){return e(this,g).metadata=new chrome.cast.media.GenericMediaMetadata,e(this,g).metadata.title=t,e(this,g).metadata.images=[{url:s}],this}}g=new WeakMap,P=new WeakSet,at=function(t,s){const a=new chrome.cast.media.Track(s,chrome.cast.media.TrackType.TEXT);return a.name=t.label,a.trackContentId=t.src,a.trackContentType="text/vtt",a.language=t.language,a.subtype=t.kind.toUpperCase(),a};var p,k,M,h,$,A,rt,nt,ot,H,x,U;class _t{constructor(t,s,a){m(this,h);m(this,p);m(this,k);m(this,M);l(this,p,t),l(this,k,s),l(this,M,a)}setup(){const t=this.syncRemoteActiveIds.bind(this);et(e(this,k).audioTracks,"change",t),et(e(this,k).textTracks,"mode-change",t),It(r(this,h,nt).bind(this))}getLocalTextTracks(){return e(this,k).$state.textTracks().filter(t=>t.src&&t.type==="vtt")}syncRemoteTracks(t){if(!e(this,p).isMediaLoaded)return;const s=r(this,h,$).call(this),a=this.getLocalTextTracks(),c=r(this,h,A).call(this,chrome.cast.media.TrackType.AUDIO),T=r(this,h,A).call(this,chrome.cast.media.TrackType.TEXT);for(const u of c){if(r(this,h,H).call(this,s,u))continue;const w={id:u.trackId.toString(),label:u.name,language:u.language,kind:u.subtype??"main",selected:!1};e(this,k).audioTracks[Rt.add](w,t)}for(const u of T){if(r(this,h,H).call(this,a,u))continue;const w={id:u.trackId.toString(),src:u.trackContentId,label:u.name,language:u.language,kind:u.subtype.toLowerCase()};e(this,k).textTracks.add(w,t)}}syncRemoteActiveIds(t){if(!e(this,p).isMediaLoaded)return;const s=r(this,h,rt).call(this),a=new chrome.cast.media.EditTracksInfoRequest(s);r(this,h,ot).call(this,a).catch(c=>{})}}p=new WeakMap,k=new WeakMap,M=new WeakMap,h=new WeakSet,$=function(){return e(this,k).$state.audioTracks()},A=function(t){const s=e(this,p).mediaInfo?.tracks??[];return t?s.filter(a=>a.type===t):s},rt=function(){const t=[],s=r(this,h,$).call(this).find(c=>c.selected),a=this.getLocalTextTracks().filter(c=>c.mode==="showing");if(s){const c=r(this,h,A).call(this,chrome.cast.media.TrackType.AUDIO),T=r(this,h,x).call(this,c,s);T&&t.push(T.trackId)}if(a?.length){const c=r(this,h,A).call(this,chrome.cast.media.TrackType.TEXT);if(c.length)for(const T of a){const u=r(this,h,x).call(this,c,T);u&&t.push(u.trackId)}}return t},nt=function(){const t=this.getLocalTextTracks();if(!e(this,p).isMediaLoaded)return;const s=r(this,h,A).call(this,chrome.cast.media.TrackType.TEXT);for(const a of t)if(!r(this,h,x).call(this,s,a)){bt(()=>{var T;return(T=e(this,M))==null?void 0:T.call(this)});break}},ot=function(t){const s=it();return new Promise((a,c)=>s?.editTracksInfo(t,a,c))},H=function(t,s){return t.find(a=>r(this,h,U).call(this,a,s))},x=function(t,s){return t.find(a=>r(this,h,U).call(this,s,a))},U=function(t,s){return s.name===t.label&&s.language===t.language&&s.subtype.toLowerCase()===t.kind.toLowerCase()};var n,o,C,E,D,I,L,S,b,N,f,R,i,ct,ht,F,dt,q,lt,ut,mt,B,X,Y,K,Tt,ft,gt,j,kt,z,yt,J,y,pt,Ct,Q,Et;class Ht{constructor(t,s){m(this,i);G(this,"$$PROVIDER_TYPE","GOOGLE_CAST");G(this,"scope",St());m(this,n);m(this,o);m(this,C);m(this,E,null);m(this,D,"disconnected");m(this,I,0);m(this,L,0);m(this,S,new v(0,0));m(this,b,new wt(r(this,i,ut).bind(this)));m(this,N);m(this,f,null);m(this,R,!1);l(this,n,t),l(this,o,s),l(this,C,new _t(t,s,r(this,i,Et).bind(this)))}get type(){return"google-cast"}get currentSrc(){return e(this,E)}get player(){return e(this,n)}get cast(){return Mt()}get session(){return Dt()}get media(){return it()}get hasActiveSession(){return st(e(this,E))}setup(){r(this,i,ct).call(this),r(this,i,ht).call(this),e(this,C).setup(),e(this,o).notify("provider-setup",this)}async play(){if(!(!e(this,n).isPaused&&!e(this,R))){if(e(this,R)){await r(this,i,Q).call(this,!1,0);return}e(this,n).controller?.playOrPause()}}async pause(){e(this,n).isPaused||e(this,n).controller?.playOrPause()}getMediaStatus(t){return new Promise((s,a)=>{this.media?.getStatus(t,s,a)})}setMuted(t){(t&&!e(this,n).isMuted||!t&&e(this,n).isMuted)&&e(this,n).controller?.muteOrUnmute()}setCurrentTime(t){e(this,n).currentTime=t,e(this,o).notify("seeking",t),e(this,n).controller?.seek()}setVolume(t){e(this,n).volumeLevel=t,e(this,n).controller?.setVolumeLevel()}async loadSource(t){if(e(this,f)?.src!==t&&l(this,f,null),st(t)){r(this,i,dt).call(this),l(this,E,t);return}e(this,o).notify("load-start");const s=r(this,i,Ct).call(this,t),a=await this.session.loadMedia(s);if(a){l(this,E,null),e(this,o).notify("error",Error(xt(a)));return}l(this,E,t)}destroy(){r(this,i,F).call(this),r(this,i,q).call(this)}}n=new WeakMap,o=new WeakMap,C=new WeakMap,E=new WeakMap,D=new WeakMap,I=new WeakMap,L=new WeakMap,S=new WeakMap,b=new WeakMap,N=new WeakMap,f=new WeakMap,R=new WeakMap,i=new WeakSet,ct=function(){Nt(cast.framework.CastContextEventType.CAST_STATE_CHANGED,r(this,i,B).bind(this))},ht=function(){const t=cast.framework.RemotePlayerEventType,s={[t.IS_CONNECTED_CHANGED]:r(this,i,B),[t.IS_MEDIA_LOADED_CHANGED]:r(this,i,X),[t.CAN_CONTROL_VOLUME_CHANGED]:r(this,i,Y),[t.CAN_SEEK_CHANGED]:r(this,i,K),[t.DURATION_CHANGED]:r(this,i,gt),[t.IS_MUTED_CHANGED]:r(this,i,j),[t.VOLUME_LEVEL_CHANGED]:r(this,i,j),[t.IS_PAUSED_CHANGED]:r(this,i,kt),[t.LIVE_SEEKABLE_RANGE_CHANGED]:r(this,i,z),[t.PLAYER_STATE_CHANGED]:r(this,i,yt)};l(this,N,s);const a=r(this,i,mt).bind(this);for(const c of Z(s))e(this,n).controller.addEventListener(c,a);At(()=>{for(const c of Z(s))e(this,n).controller.removeEventListener(c,a)})},F=function(){e(this,f)||(l(this,L,0),l(this,S,new v(0,0))),e(this,b).stop(),l(this,I,0),l(this,f,null)},dt=function(){const t=new tt("resume-session",{detail:this.session});r(this,i,X).call(this,t);const{muted:s,volume:a,savedState:c}=e(this,o).$state,T=c();this.setCurrentTime(Math.max(e(this,n).currentTime,T?.currentTime??0)),this.setMuted(s()),this.setVolume(a()),T?.paused===!1&&this.play()},q=function(){this.cast.endCurrentSession(!0);const{remotePlaybackLoader:t}=e(this,o).$state;t.set(null)},lt=function(){const{savedState:t}=e(this,o).$state;t.set({paused:e(this,n).isPaused,currentTime:e(this,n).currentTime}),r(this,i,q).call(this)},ut=function(){r(this,i,ft).call(this)},mt=function(t){e(this,N)[t.type].call(this,t)},B=function(t){const s=this.cast.getCastState(),a=s===cast.framework.CastState.CONNECTED?"connected":s===cast.framework.CastState.CONNECTING?"connecting":"disconnected";if(e(this,D)===a)return;const c={type:"google-cast",state:a},T=r(this,i,y).call(this,t);l(this,D,a),e(this,o).notify("remote-playback-change",c,T),a==="disconnected"&&r(this,i,lt).call(this)},X=function(t){if(!!!e(this,n).isMediaLoaded)return;const a=V(e(this,o).$state.source);Promise.resolve().then(()=>{if(a!==V(e(this,o).$state.source)||!e(this,n).isMediaLoaded)return;r(this,i,F).call(this);const c=e(this,n).duration;l(this,S,new v(0,c));const T={provider:this,duration:c,buffered:new v(0,0),seekable:r(this,i,J).call(this)},u=r(this,i,y).call(this,t);e(this,o).notify("loaded-metadata",void 0,u),e(this,o).notify("loaded-data",void 0,u),e(this,o).notify("can-play",T,u),r(this,i,Y).call(this),r(this,i,K).call(this,t);const{volume:_,muted:w}=e(this,o).$state;this.setVolume(_()),this.setMuted(w()),e(this,b).start(),e(this,C).syncRemoteTracks(u),e(this,C).syncRemoteActiveIds(u)})},Y=function(){e(this,o).$state.canSetVolume.set(e(this,n).canControlVolume)},K=function(t){const s=r(this,i,y).call(this,t);e(this,o).notify("stream-type-change",r(this,i,Tt).call(this),s)},Tt=function(){return e(this,n).mediaInfo?.streamType===chrome.cast.media.StreamType.LIVE?e(this,n).canSeek?"live:dvr":"live":"on-demand"},ft=function(){if(e(this,f))return;const t=e(this,n).currentTime;t!==e(this,I)&&(e(this,o).notify("time-change",t),t>e(this,L)&&(l(this,L,t),r(this,i,z).call(this)),e(this,o).$state.seeking()&&e(this,o).notify("seeked",t),l(this,I,t))},gt=function(t){if(!e(this,n).isMediaLoaded||e(this,f))return;const s=e(this,n).duration,a=r(this,i,y).call(this,t);l(this,S,new v(0,s)),e(this,o).notify("duration-change",s,a)},j=function(t){if(!e(this,n).isMediaLoaded)return;const s={muted:e(this,n).isMuted,volume:e(this,n).volumeLevel},a=r(this,i,y).call(this,t);e(this,o).notify("volume-change",s,a)},kt=function(t){const s=r(this,i,y).call(this,t);e(this,n).isPaused?e(this,o).notify("pause",void 0,s):e(this,o).notify("play",void 0,s)},z=function(t){const s={seekable:r(this,i,J).call(this),buffered:new v(0,e(this,L))},a=t?r(this,i,y).call(this,t):void 0;e(this,o).notify("progress",s,a)},yt=function(t){const s=e(this,n).playerState,a=chrome.cast.media.PlayerState;if(l(this,R,s===a.IDLE),s===a.PAUSED)return;const c=r(this,i,y).call(this,t);switch(s){case a.PLAYING:e(this,o).notify("playing",void 0,c);break;case a.BUFFERING:e(this,o).notify("waiting",void 0,c);break;case a.IDLE:e(this,b).stop(),e(this,o).notify("pause"),e(this,o).notify("end");break}},J=function(){return e(this,n).liveSeekableRange?new v(e(this,n).liveSeekableRange.start,e(this,n).liveSeekableRange.end):e(this,S)},y=function(t){return t instanceof Event?t:new tt(t.type,{detail:t})},pt=function(t){const{streamType:s,title:a,poster:c}=e(this,o).$state;return new Pt(t).setMetadata(a(),c()).setStreamType(s()).setTracks(e(this,C).getLocalTextTracks()).build()},Ct=function(t){const s=r(this,i,pt).call(this,t),a=new chrome.cast.media.LoadRequest(s),c=e(this,o).$state.savedState();return a.autoplay=(e(this,f)?.paused??c?.paused)===!1,a.currentTime=e(this,f)?.time??c?.currentTime??0,a},Q=async function(t,s){const a=V(e(this,o).$state.source);l(this,f,{src:a,paused:t,time:s}),await this.loadSource(a)},Et=function(){r(this,i,Q).call(this,e(this,n).isPaused,e(this,n).currentTime).catch(t=>{})};export{Ht as GoogleCastProvider};
