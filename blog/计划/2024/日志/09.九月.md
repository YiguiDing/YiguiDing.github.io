---
title: 2024年九月日志
cover: ./cover/我要向前走.png
category: to-do-list
tag: [to-do-list]
article: false
---



九月一日 周日 休息一天 睡到下午一点 出门吃了碗小混沌 回家学高数 做中值定理例题 下午五点发现今天生日 出去吃的牛肉火锅 回家后看了下stm32 的AD模块 尝试实现了注入组连续多通道模数转换，然后又再看了下熵增定律 刷了会儿bilibili 到十二点半 准备睡觉。

九月二日 周一 上班 八点半起床 测试上周五客户发回的推进器 确实是上位机中没有设置勾选响应状态消息 ，中午下小雨 和李走路去吃饭 下午写了会儿代码 然后接着测推进器，发现转速到两万七电机就会定子磁场转，转子不转，测试了全新的bldc-电调vesc则没有问题，说明是电路板的问题。下班和ly去吃烧烤 他请客 ，回家已经八九点了，一天已经废了，玩到现在十二点半了，立马睡觉！以后十点关灯 十一点睡觉！

九月三日 周二 早上八点十分起床取快递 显示器到了 九点上班 尝试通过rtcrecordjs对whepClient中的mediaStream进行录制结果发现录制结果始终为0字节，搜了下库的issue发现大量同样的问题，直接使用MediaRecorder进行录制问题依然存在，怀疑是浏览器的问题，中午吃饭送李yu回公寓，下午一边摸鱼一边尝试解决这个问题，摸鱼成果为看了三四集嘉立创EDA的教程，晚上六点二十下班，七点半吃完饭，看了会儿视频就睡着了，睡到凌晨两点五十起床洗漱，学到五点睡觉，早上八点十分起床取快递，拆快递，装显卡到机箱，八点三十五出门上班

九月四日 周三 上班 尝试解决无法对mediaStream录制的问题，给media Recorder指定minetype后发现可以录制了，但只能录制最后几秒，随后尝试用两个浏览器建立webrtc连接，然后对media Stream录制，发现可以录制成功，问题可能出在推流的过程，也就是问题可能出在ffmpeg编码视频流并用rtsp格式推送到服务器，然后服务器再以whep方式推流到浏览器的这个过程，随后尝试在wsl编译使用ffmpeg-webrtc这个库，配合srs实时流服务器，推送whep流到浏览器，然后浏览器对mediaStream录制，发现可以录制，问题应该解决了，中途还配合测试了推进器，下班回家测试电脑，重装显卡，少装了螺丝固定，移光猫和路由器，接网线，因为电脑只有网口，下载常用软件 vs code 、gitbash 、qq、激活windows、下载steam、饥荒、悟空，测试手柄，到晚上十二点，睡觉！！！


九月五日 周四 早八点三十起床洗漱 八点四十一出门  八点59分到公司打卡 上午尝试使用srs的rtmp2webrtc功能实现了用ffmpeg将usb摄像头用rtmp协议推流到srs然后在浏览器使用webrtc播放，实测延时为0.13s，比之前的方式还要低，中午到常州大学旁边的沙县吃饭，下午纯摸鱼，看了会儿文档，刷了会儿知乎，配合测试了下推进器，然后下班，到武进图书馆后的沙县吃份炒饭，晚上把快递到货的2t机械装机，然后将电脑的d盘克隆到机械，然后改机械盘符为D盘，玩游戏悟空到晚上十点，然后学嘉立创EDA到凌晨一点，准备睡觉计划早上八点起。

九月六日 周五 早八点三十五起床 洗漱 四十出门 五十九到公司楼下打卡 几乎摸鱼一天 主要在看simpleFOC的工具函数的源代码，一个是查表法计算sin函数，另一个是计算快速反正切的函数，写了两篇笔记，记录实现原理，下班去武进图书馆后面的沙县小吃吃份炒饭，回家修复博客网站代码块样式消失的问题，然后打游戏到十二点，又莫名其妙熬到12点四十，睡觉！
熬到凌晨三点睡觉

九月七日 周六 上午十一点睡醒 起床洗漱吃饭 然后几乎打了一天游戏 把幽魂、广智、林虚子、广谋打过了，下一个打了很久没打过，到凌晨六点，准备睡觉

九月八日  周日 睡到下午三点 起床继续玩游戏 打白衣 打金池 打黑风怪（人） 、打黑风怪（熊），熊没打过，到一点多，准备睡觉，实际到四五点才睡着。

九月九日 周一 八点三十五起床 准时上班打卡 在上位机完整实现视频录制功能，然后开始摸鱼，主要是看simpleFOC源代码：FocDriver、FOC Motor、sensor几个文件的代码，然后尝试解决了博客网站上的问题，数学公式消失不渲染、博客文章只展示一半，试过各种更新，最后把package.json恢复回去发现就行了，回家吃饭休息，刷哔哩哔哩 ，学PCB布线的内容，十点洗漱，十一点半准备睡觉。

九月十日 周二 准时上班 尝试在electron中利用stream Recorder实现了对whepClient.mediaStream的录制功能，测试效果不错，然后按惯例摸鱼，尝试着把《simpleFOC源码阅读笔记：查表法计算正弦余弦值》的笔记搬运到知乎，回家好像啥也没干，而且还刷手机到凌晨，第二天早上困得要死。

九月十一日，周三，准时上班，尝试给定制的摄像头模块按通信协议编写驱动并测试，主要测试拍照、录制、水印叠加功能，一直测到下班，最后对方承认有bug，中途尝试把昨天知乎的文章搬到csdn上，半天收获两百浏览次数、五个粉丝、三个收藏、两个赞，回家又是几乎啥也没干，还熬到现在凌晨一点。漫无目的、随心所欲，不是自由，而是自我放逐，是一种对自己有限生命的挥霍，如果不对自己的行为加以约束，如果不管理好自己有限的精力和注意力，不自律、不自爱，那么这种行为等同于慢性自杀。因为熵增定律表面，孤立无外力做工的系统中任何事物都将从有序走向无序，系统的混乱程度只增不减，直至死亡。
明天开始九点半洗漱，十点之后开始躺床上学习助眠，十一点应当睡觉，早七点起床。
睡眠质量是个重大问题！！！
睡眠是生命实现熵减的重要部分

九月十二日 周四 八点二十起床洗漱 准时上班 上午进一步测试昨天的摄像头，然后摸鱼，看simpleFOC源码，下午也在摸鱼，主要在看vuepress-hope主题en- markdown插件，准备给加一个新功能，写了百分之九十，还差一点，然后下班，晚上回家收拾房间，吃饭，九点半洗漱，十点关灯睡觉，打算看灯哥开源foc算法讲解助眠。

九月十二日 周四 八点二十起床洗漱 准时上班 上午进一步测试昨天的摄像头，然后摸鱼，看simpleFOC源码，下午也在摸鱼，主要在看vuepress-hope主题en- markdown插件，准备给加一个新功能，写了百分之九十，还差一点，然后下班，晚上回家收拾房间，吃饭，九点半洗漱，十点关灯睡觉，打算看灯哥开源foc算法讲解助眠。

九月十三日 周五 八点三十起床洗漱 九点准时上班 把昨天测试的摄像头集成到上位机软件中，实现开启/关闭动态添加水印功能，中午去交警中队处理骑车没戴头盔，到了发现下班了，然后去吃饭，下午继续给vuepress-theme-hope写Desmos插件，两点多再去，三点多回来继续写，下班回家取快递组装椅子吃完饭刷会儿视频九点半准备洗漱十点多关灯 十一点左右睡觉 早睡第二天

九月十四日 周六 八点三十起床洗漱 九点零五上班 摸鱼一天 主要在尝试继续给vuepress-theme-hope写desmos插件，功能写完了，文档也写了，下班回家吃完饭刷会儿视频，九点半洗漱 十点关灯，十点半准备刷会儿视频催眠睡觉

九月十五 周日 十点起床 继续看desmos插件的语法部分，尝试语法的parser，尝试学习arduino并做笔记，尝试写foc开环位置控制代码，尝试实现定点数计算sine
两点睡觉
两点半
找到定点数计算sine的bug：线性插值的计算溢出

九月十六 周一 睡到十点 起床写代码 使用定点数实现了逆帕克变换、逆克拉克变换、实现了BldcMotor和BldcDriver 然后下午刮台风停电，到现在晚上十一点....
凌晨一两点睡

九月十七 周二 睡到早上九点 起床给昨天代码做笔记，洗漱出门吃饭 回家后尝试实现速度开环控制 一直没成功 然后另外尝试实现HFIsensor，发现得先实现电流检测，然后发现要想知道dq轴的电流得先知道位置，或者得有估计位置，最后决定还是先实现as5600Sensor，了解了下i2c通信，然后实现了sensor，尝试实现速度闭环控制时发现无法烧录代码了， 晚上十二点左右睡觉


九月二十 周三  睡到八点半起床洗漱 九点到公司楼下 摸鱼一天 上午因为楼上漏水 键盘和鼠标进水了 擦桌子扫地换鼠标键盘鼠标垫 看simpleFOC中电流检测计算dq轴电流的代码 看simplefoc文档中foc原理内容，了解电磁感应定律左手定则 尝试解释为什么超前90度相位的磁场产生力矩最大，然后看卡尔曼滤波公式推导 理解了 第一集 递归算法 第二集 数据融合 协方差矩阵 内容 晚上下班回家尝试解决Arduino烧录代码不运行的问题 无法解决 怀疑是引导代码的问题，因为之前代码sensor.connectMotor忘记调用了，导致sensor.motor.setPhrase voltage可能是空指针异常，程序跳转到了错误的地方执行代码，只能这么解释了，然后继续看卡尔曼滤波，理解了第二集中状态方程的内容。洗漱到现在00:40

九月二十一日 周四 睡到八点半起床洗漱出门 准时上班 看simpleFOC代码 实现timer基类获取dt（）实现Sensor位置传感器的update、getPosition获取位置getpositions获取位置带圈数，getvolecity获取速度， 实现低通滤波器 下班帮人改代码小赚50但是浪费一晚上时间

我本将心向明月 奈何明月照沟渠
日月蹉跎 人已将老 而功业未建
人生于天地之间 无终始者非君子也
知我者谓我心忧 不知我者谓我何求

九月二十二日周五 八点半起床 准时上班 测试timer、Sensor、LowPassFilter并做实现笔记，尝试实现开环速度控制未果，下班回家后取快递，用ArduinoR4的板子尝试改pwm频率到20k后才实现，改用浮点数实现了timer 晚上两点左右睡觉


九月二十三日 周六 十点起床 尝试用浮点数实现和重构了Sensor、Lowpassfilter、实现并测试了PID Controller、实现了开环电压控制、实现了对sensor方向和motor方向的控制。
凌晨三点半准备睡觉
测试了当前sensor最大可测量的速度大概是80圈/s，再高位置计算结果不准确。

九月二十三日周日 早七点睡觉 下午两点起床 开始尝试实现闭环电流控制 然后写了下currentSensor 但是还是有问题 0.2A的电流不知道为什么显示有2A左右，凌晨一点准备睡觉

九月二十四日 周一 准时上班 老板不在 继续写我的foc驱动 尝试解决昨天晚上的问题，发现两个问题，一个是beta轴的公式好像用错了，另外一个就是算d轴时给int16_t的 cos变量加了个符号，这可能导致溢出，这两个问题解决改完，还是没发现问题出在哪里，下班回家继续弄，毫无进展。


九月二十五日 周二 测试第二版的可绘制水印的相机，拉rtsp流后绘制水印导致死机的问题解决了，但是又有新的问题，拉rtsp流后拍照/录像导致死机，反应了bug之后下午又发了一个改好的固件过来，烧录测试可用，但是拍照会导致rtsp流的清晰度发生变化。又反应了下，对方说就是这样的.....。然后尝试继续解决昨天foc驱动的问题，发现好像给的角度不对，应该是电角度而不是转子的机械角度，下班回家后继续弄，尝试把没有滤波的i.alpha i.beta不滤波输出，发现幅值确实有2A左右，但是稳压电源显示只有0.2A，后来尝试堵转电机，发现i.d向0波动，i.q向2A波动，也就是说计算其实没问题，电流确实在q轴，可能是电机转太快了，e_theta是当前时刻转子的位置，但此时的测量得到电流是用上一时刻的转子位置在u.q轴注入电压而产生的响应，这个电流可能应该乘上一时刻的电机位置，反正最后没管这个问题，因为计算流程是对的，直接写了个pid_id_controller和pid_iq_controller，来保持id=0，iq=target，实测效果非常好，dq轴电流波形也很完美，电机转速也变快了，弄到凌晨一点，明天打算再输出下alpha beta轴的波形看一下 现在凌晨一点半，睡觉
看三国到4.30睡觉


九月二十六日 周三 正常上班 尝试写速度闭环 基本的框架 pid控制器和速度获取和滤波，勉强实现，但是速度控制效果感觉不理想，首先电机发热，感觉电流环参数有问题，然后就是低速情况下有抖动，另外由于怀疑传感器接触不良遂直接把传感器焊板子上，但是问题依旧，下班前测试相机新增的改预览分辨率的接口，下班回家忘了干啥了 但看三国凌晨四点半才睡


九月二十七日 周四 正常上班 上午原本在写速度闭环，调电流环的参数，然后老板让测试下电机，遂把之前写的电机上位机拿出来，测试其位置 速度 力矩模式控制效果，发现有大问题，查了半天，最后发现是因为电机通信控制协议格式改了,位置速度数据位置没改，但力矩数据格式位置变了，而我这个数据我最终填充0，0代表-MAX，所以电机猛转发热，调好之后用电机测试减速机和机械臂，减速机不够顺滑，电机转不动，并且发热严重，其实不是电机的问题，p=UI=FV，减速机把速度减小了力矩放大了，所以电机应该输出高转速低扭矩，而减速机系统内部的摩擦力太大了，直接抵消了电机的扭矩，转不起来，效率百分之0。举例来说就是减速机把1N放大100N，原因是因为1N是100m/s，100N是1m/s，现在系统的阻力0.5f，那么效率直接砍掉一半，系统阻力1N，效率直接为0。晚上回家继续调电流闭环的pid参数，好像有点搞懂了。另外找出了as5600的i2c总是断开链接的原因，尝试过直接焊接杜邦线防止接触不良，拆除电机铜柱垫片较小磁铁和磁编码器的距离，尝试过拆下多余的上拉电阻防止时钟和数据电压太高芯片拉不下来，尝试过给芯片供电引脚加1uf和0.1u电容防止受到电机的干扰，尝试过改i2c通信速率，最后发现原因是通信完没有delay 1ms，简直了，调力矩环参数到凌晨两点半，感觉有点懂了，iq要滤波，kp不能太小，ki太大不行，太小更不想，uq变化率可能也要限制 不行了 得睡了 凌晨三点了马上
4：41睡觉....

九月二十八日周五 准时上班 原本计划继续写foc驱动调昨天没调好的参数，结果电流给太高mos管直接烧了，股市行情走势大好，美联储降息，央行降息放水，连涨三天，上午上交所服务器都崩了，十一点才好，买的股票今天也涨停了，除了协助同事完成工作，今天一天好像啥也没干，下午尝试写一个调pid参数的图形化界面，开了个头，回家后继续弄foc驱动算法，现在又莫名其妙凌晨一点了。


几月二十八日 周六 放假一天 睡到下午两三点 起床洗漱吃碗泡面，然后继续研究foc算法，一方面确认了下关于dq轴电流计算是否正确的问题，然后继续调参，电流闭环和速度闭环，基本搞好了，到现在凌晨两点半，准备睡觉
3:47 睡觉

九月二十九 周日 白天调参 晚上调参 并写了个调参上位机 到凌晨五点 然后发现明天还要上班 ，以为明天国庆了，赶紧睡觉！


九月三十日 正常上班 ... 上午尝试写中空电机上位机的新功能，通信不上，懒得管了，然后接着调参数，尝试使用昨天晚上写的上位机，验证之前电流环的参数是否正确，下午给电机上位机添加新功能，周期正反转功能，下班前写好。晚上回家打了会儿游戏，凌晨睡觉。
