---
title: 2024年三月日志
date: 2024-04-01
cover: ./cover/我要向前走.png
category: to-do-list
tag: [to-do-list]
article: false
---


3月1号 周五  周四和周五主要在尝试直接在前端播放PCM格式音频，这个是目的，具体做的事就是尝试搭建开发环境编译gs-js，周五下午下班的时候编译成功了，晚上就是在测试如何写gstreamer管道描述字符串，最后实现了在前端播放视频和音频，原理就是gstreager解码音频为PCM格式，然后用AudioContenx播放，但是音频有卡顿，

3月2号 周六睡到12点起床，解决了音频有卡顿的问题。

3月3号 周日睡到上午十点 学stm32单片机并做笔记 主要对标准外设库的目录结构做了解释，对工程的架构进行重新的梳理，笔记了些stm32的一些基本概念 比如系统框图 引脚定义 所有外设的名称 然后对RCC常用的三个函数做了笔记 GPIO概念 库函数常用方法的作用做了说明 还写了案例代码

3月4号 周一  和老板一起试着把周六写的播放音频和绘制波形的东西测试了下 下午商量了下整个水下机械臂摄像机产品的架构 然后开始着手写在linux上运行的服务端代码 下午还实现了简易版的设备发现服务 通过arp-a得到局域网主机ip 然后使用udp 轮询发送hello？linux开发版回复hello！用来确定linux开发版的ip， 晚上回家接着学stm32,从外部中断的概念 编写外部中断案例代码 到 定时器的概念 普通 通用 高级计时器的结构框图都重新学了一遍 并做了笔记 到凌晨三点，然后凌晨四点点四十五睡觉

3月5号 周二  上午学习了解并配置了下rollup 

3月6号 周三 下午编写linux开发版服务端代码 视频封面生成 list videos list images 的代码写好了 但还没测试通

3月7号 周四 上午实现socket2canbus  重构代码主要就是实现在选中设备ip后 同时刷新页面上的图片视频资源 下午摆烂 下班回家睡觉

3月8号 周五 昨天重构了些代码 今天实现点击切换音频波形 一共四种波形 然后重构实现了robotManager 以及派发task并在服务端执行task 晚上论文开了个头

3月9号 周六 睡到下午一点 十一点多才开始补毕设论文 到现在凌晨三点 摆烂一天 凌晨五点四十准备睡觉 上午九点睡觉...

3月10号 周日 下午五点四十二起床 ？？？ 凌晨四点睡觉

3月11号 周一 ？？？

3月12号 周二 上午补论文 下午写电机的上位机 下班前写完 晚上十点半睡觉，太困。

3月13号周三 上班写电机上位机 使用echarts添加了图表 改进了布局 新增了对同步帧发送频率的修改功能 以及位置环kp ki的控制 六点下班 回家刷视频 然后学习单片机 尝试使用gcc编译arm 学习makefile 凌晨三点09睡觉

3月14号 周四 上班写电机上位机 改进布局 实现固件烧录功能 学习并尝试在canvas中实现pid算法 整理笔记 尝试修复博客网站构建的bug 到现在凌晨3点35 准备睡觉

3月15日 周五 上午修复博客主题新版本依赖版本导致无法构建的问题 下午改毕设论文 解决一个工作问题 主要是无法从canvas上获取渲染的webl图像 通过异步多次获取解决  晚上改毕设论文 然后接着了解了下makefile 现在凌晨四点半 睡觉

3月16日 周六 下午两点起床 弄了一天 现在凌晨5:52 把编译、链接器脚本、和openocd烧录的问题解决了，但是还没解决c和cpp混合编译器的问题

2月17日 周日 下午三点四十三起床；混合编译的问题解决了 原因出在没有在头文件中加extern c；重新编译测试流外部中断测试程序；另外学习了定时器中断 利用内部时钟源实现了Tim2_setInterval(callback,ms)、利用外部时钟源实现了Tim2_setInterval(callback,times) 凌晨5点15睡觉，没睡着

3月18号 周一 9:04到公司，今天上班发布了一篇笔记，并整理了过去的笔记目录结构， 现在22:11睡觉

![Alt text](assets/images/4ebeb7e337e8d43f3bf474eb93e23cd0.png)
![Alt text](assets/images/8ef4cea54aa197038a644a5699e07208.gif)
![Alt text](assets/images/73642cbc516f355c51491f363c0e77d3.gif)

3月19号 周二 早上好像睡到九点多 到公司后在研究vuepress配置侧边栏和auto-catlog生成目录顺序的问题，下午在研究在md中无法使用相对路径引用文件实现点击下载、引用相对链接跳转访问的问题，反馈给主题作者，后面回复我说是预期行为... 下班到家吃饭 然后打算接着学stm32 结果太困了睡着了，睡到凌晨一点

3月20号 周三 从凌晨一点开始一直睡不着，然后就刷哔哩哔哩视频，结果看到天亮，八点多洗了个头，出去吃完混沌，迟到几分钟到公司，坐了一会儿就开始接着昨天下班前的进度调试设备，昨天调试发现树莓派和相机都获取不到ip，查到是电源供电的问题，今天花了一上午时间，发现相机供电板发热，拆开相机外壳发现排线已经烧了...，下午要了块树莓派板子，想调试水下机械臂的Linux板子，太困了，趴着睡了会，没什么进展，然后想尝试下stable diffusion webui的项目，于是就在解决miniconda在控制台的报错，尝试安装项目所需依赖下班后回家吃饭，然后继续解决依赖的问题，尝试重装了显卡驱动和cuda，这两个东西也装了很长时间，很多坑，一方面是c盘满了，又去找spacesniffer这个软件来清理系统盘，另外就是cuda安装不上去，最后的发现只勾选cuda运行库和编译器这些东西就可以了，多勾线了就无法安装。终于能正常启动项目了，但是会闪退，后面尝试改了虚拟内存，不闪退了，但是还是不能用，然后就到了三点钟了，看了下小猫，被大猫搬走了，跟着大猫找小猫，又找了好长时间，找到了，现在又是凌晨三点四十了。困死了 睡觉

3月21号 周四？

3月22号 周五 上午在尝试通过iframe来嵌入file browser 一直在尝试通过写css来重写其滚动条，后来看了文档发现可以直接制定custom.css的路径，中午的时候老板找我谈薪资，起薪13k 下午摸了会儿鱼，到两三点了，然后去吃午饭，然后修改布局，把浏览音频文件的组件拿掉了，然后想把右上角的taskdispatcher布局也改了，后来老板叫我查一下wc-gs模块保存视频不能播放的问题，用mp4dump看了下，发现是没有moov元素，也就是问题出在停止录制的时候，没有正确的发送sendEOS，晚上凌晨五点才睡觉

3月23号 周六 睡到下午两三点起床 次日凌晨两三点睡觉 中间收拾房间 理发 补RCC时钟树的笔记  时基单元时序的笔记 学习输出比较的内容 大多时候在刷哔哩哔哩浪费时间

3月24号 周日 睡到差不多中午起床 然后学了输出比较电路 的几种模式 尝试了输出pwm波实现呼吸灯 和舵机控制 还有啥.... 浪费时间到凌晨三点，睡觉。

3月25号 周一 睡到中午 十一点打卡上班 下午重构代码 准备把拍照录像和设置定时任务的功能完成 晚上吃过饭后去接九爷 十一点的时候被大猫叫去找小猫 十二点回来 最后凌晨三点睡觉
![Alt text](assets/images/304f5842a3741279f3b6aa96b5d2847c.png)

3月26号 周二 上午在做电机上位机软件的收尾工作，主要是电机配置页面的banner图标和软件icon的选择问题，中午才确定；下午在解决electron中通过iframe嵌入filebrowser文件浏览器后无法下载的问题，原因在于electron无法实现window.open 和a标签target=blank这两种打开新页面的方式，需要通过electron提供的接口重写window.open方法，实现在默认浏览器打开下载链接，晚上十一点多睡觉。

3月27号 周三，上午在看rov设备的上位机代码，下午在尝试在软件层面实现对手柄按键keyDown和keyUp事件的检测，并实现触发调用上位机功能，下班前一个小时写好，但应对面同事的问题留到晚上九点，晚上回家测试到货的电机和电调，一点左右睡觉。

3月28号 周四 ，上午到公司发现设备没电了，等老板来，然后找通信盒子的充电器，然后配置手柄自锁按键为keyup keydown触发，以及相机变焦的实现，到快中午的时候打算打包软件，安装到笔记本上，然后拿到隔壁组装车间去测试设备，结果发现不知道是u盘还是笔记本的问题，拷贝进u盘的文件全部变成快捷方式，尝试了杀毒，最后打算重装系统。然后差不多到下午了，和老板商量了下决定直接过去把设备搬过来测试，连上设备后，发现发送给设备的指令没执行，差了很久的问题，中途还发现rtsp播放的部分有内存泄漏的问题，最后装了whaleshark来查看发送出的数据包的差异，发现问题在于数据包的header中systemid不一致，查了文档发现原因在于mavlink.send的第二个参数为systemid，但是没有填，所以默认为0xfe ，而实际下位机只认0xff，改完之后就测通了，手柄的指令设备执行了，变焦的部分还有问题。应该改成按键按下时向相机发出变焦指令，按键抬起时发送暂停变焦指令。太晚了，九点多了，就回家了，回家刷会儿视频就十二点了，一点多睡着。

3月29号,周五，上午先实现了相机变焦控制，非常完美，然后查了rtsp播放器内存泄漏的问题，原因在于当把窗口放到后台时，主进程持续在将解码为yuv的视频数据发送到渲染进程，丢进webgl的render方法中，但可能是这个方法会在窗口在后台的时候缓存数据，这导致内存泄漏，几分钟三五个GB内存。然后通过有限长度的队列来解决了这里的问题，主进程的数据先扔进队列，然后用RequestAnimationFrame来消耗这个队列，并调用webgl的render方法，这样当窗口在后台时，就不会消耗队列。这部分问题解决后，又实现了连接上设备后，显示连接状态的功能，另外还实现了arm和disarm状态的实时显示，这部分内容查了文档，发现在接受到的心跳数据包中payload.base_status的最高位，表示是否arm，这部分功能实现后，又解决了webglCanvas.toDataURL得到的图片黑屏的问题，这个需要在初始化webgl的时候，指定weblg不清空缓冲区，这样从canvas得到图片的问题就解决了，然后又去着手解决实现当上位机按下拍照按键或手柄按下拍照按键后，调用拍照方法，另外要实现对rtsp url的配置，照片路径、视频保存路径的配置，大概晚上十一点弄好下班，晚上一点多睡觉

3月30号,周六，上午十点睡醒，中午和九爷出去吃碗面，下午开始继续学stm32定时器相关内容，尝试输出pwm通过tb6612控制直流电机，后来想把稳压直流电源直接接到电机上，测试了很久之后发现稳压电源坏了，录视频和客服沟通花了些时间，晚上一点左右睡觉。

3月31号周日，上午九点半到公司，尝试实现加载中、播放中 warning三个状态的切换，然后尝试解决丢包导致画面暂停的问题，然后实现保存视频的功能，然后修改info的图标等的一些ui问题，在保存前，实现递归自动创建所需的文件夹，七点半下班。