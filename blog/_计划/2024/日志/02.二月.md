---
title: 2024年二月日志
date: 2024-03-01
cover: ./cover/我要向前走.png
category: to-do-list
tag: [to-do-list]
article: false
---


`2024-02-01` 周五

- 18：41 上午实现了机械臂状态同步到3d模型 下午通过useTransfor函数实现了对串口数据到can总线数据帧的双向转换
- 0:18 重构 将useTramsfor重构为CanBus类
  - 主要通过继承Duplex类实现 具体实现为
  - can -> encoder -> encoder
  - can <- decoder <- serial
  - 这里的can就是一个Duplex的子类
  - 这里encoder和decoder是node:Tramsfor的子类
  - 分别实现了将要发送的can数据帧转换成要写入到串口的数据
  - 将串口接收到的数据解析为can数据帧

`2024-02-02` 周六

- 次日凌晨
  - 01:25
    - 今天上午测试了昨晚重构实现的CanBus
    - 但是这块板子存在问题 原先使用的基于PcanUSB的驱动板，不是基于串口的，现在使用的是基于串口的驱动板，问题在于当上位机主动断开串口连接后再次重新连接时，只能向电机发送数据不能接收数据，该现象在该电机的官方上位机上也会出现。
    - 最后打算改回原来基于PcanUSB的写法。
    - 今天晚上就是做了这部分工作，实现了两个适配器，
    - 目的之一是实践自己在设计模式中学到的适配器模式 面向接口编程，通过适配器适配两个不兼容的接口。

`2024-02-03` 周日

- 次日凌晨
  - 01：43
  - 今天一方面是测试修复昨天晚上写的两个适配器
  - 第二件事就是修改机械臂驱动代码 实现机械臂支持执行Task队列
    - 这里问题的关键就在于如何判断当前的Task是否执行完成
    - 由于向电机发送的goTo(position)命令是异步的
    - 并且 电机不会主动报告位置 也不会在到达指定位置后响应其所到达的位置
    - 这就需要不断向电机询问其状态信息(位置) 然后和目标状态对比 当其差值小于一定值时判断为到达目标位置
    - 然后执行后续操作 这里的设计是让Motor extends Emiter即让电机驱动类继承自事件发送器，
    - 然后在电机驱动初始化后不断发送同步帧给实际的电机 setInterval(sendSyncData,1000)，同时监听来自Can总线的数据，this.canBus.onData(syncCurState)
    - 当接收到实际电机的响应时，更新驱动上的属性值，比如this.positionX = canbusDataFrame.posX
    - 同时触发一个事件 表示电机数据同步成功 this.emit('sync');
    - 而当执行goTo(pos)时，该命令就是一个异步函数，有了上面的设计，这里实际只做两件事，一个是绑定监听函数到'sync"事件上，负责监听电机位置更新后电机的实际位置,并且当实际位置达到目标位置后返回resolve;另外一步就是发送实际的goto命令，即发送电机的目标位置。
    - 有了这样的设计，就能使得异步任务可以像同步代码一样执行。
  - 第三件事就是精简代码
  - 2：14 睡觉

`2024-02-04` 周一

- 6：30 五点起床 现在到火车站
- 次日凌晨：
  - 2：02
    - 原本是早上七点从武进出发，然后晚上七点到站成都，一共十个小时的高铁票
    - 结果列车到站晚点一个多小时,由于湖北下暴雪冻雨，到站南京之后停了四个多小时，中途开的比绿皮火车还要慢，
    - 现在到了第二天凌晨两点了还没到

`2024-02-05` 周二

- 21：42
  - 4：48 到站重庆；5：54 到路边摊吃饭；一碗混沌 但桌上的泡菜萝卜比混沌馅儿还好吃 吃了好几碟 吃完坐车回乡里 大概两三个小时车程 听司机说女儿是985的，在准备考研。卑微了。 然后开始睡觉 大概天亮到乡里街上的小嬢家 然后聊天摆烂啥事不干到中午吃饭，下午和堂弟堂姐去乡里的首富家干活给树上挂彩灯，弄到下午五点，然后回家，到门口的地里锄了会儿地翻了下土。
- 21：48
  - 吃完饭和堂弟堂姐去荣县，看堂弟的三嬢，去了他们开的饭店，聊了会儿天，然后堂弟带我去他高中逛了逛，走过去，走回来，然后和堂弟的朋友们去茶馆打麻将，可惜我是一点不会，旁边看看就好。过程中感觉自己像一个局外人，旁观者，但我更多的感受不是孤独，而是荒诞和虚无，这是一种我无法理解的生活方式，无法领会这其中分毫的乐趣，这周围环境的喧哗和热闹都是与我无关的，我想逃离这里，但我不能。我想融入他们，但我做不到。
