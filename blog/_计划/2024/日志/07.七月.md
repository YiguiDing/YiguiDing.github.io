---
title: 2024年七月日志
cover: ./cover/我要向前走.png
category: to-do-list
tag: [to-do-list]
article: false
---


七月一号,周一，上午签劳动合同，下午？，好像是用css实现了大小窗口切换效果封装组件取名viewports，然后测试rtk定位效果，周二 写react- native，尝试用canvas实现室内定位界面，性能堪忧，还是pc端的浏览器好，开始尝试搭建electron项目，打算重写rov的pc端上位机。周三，上午去科教城参加签约仪式，中午吃饭，下午对昨天写的pc端上位机做连接测试，通信测试和视频播放测试，修复存在的问题，然后开始研究joystick相关的内容。

七月四号，周四，凌晨四点睡醒，学习stm32的spi硬件外设并完成代码编写，实现读写w25q64芯片，八点半出门，九点前到公司上班，继续写新的上位机，完成页面切换的界面设计，使用keep- alive实现router-view的持久化，使用ResizeObserver修复在切换页面和大小视口时地图不能自动计算大小的问题和小窗口的绝对定位位置计算问题。修复keep-alive导致的视频自动暂停播放的问题，修复whep客户端在断开连接后不会自动重连的问题。实现gamepad对下位机的驱动控制，修复commonjs规范的mavlink.js库中非严格模式代码导致vite的rollup无法转换的问题，实现gampad通道配置和反相配置以及相关的界面，下班晚上回家学习stm32，unix时间戳和bkp备份寄存器RTC时钟等相关内容。

七月五号，周五，上班，写新electron上位机，实现手柄按钮功能的配置页面；实现手柄按钮对下位机的控制。下班学习stm32的bkp外设和rtc外设。
七月六号，周六，复习node-addon和ffmpeg解码相关内容，尝试编写media-decoder项目，并在electron中成功实现对rtsp流的解码和播放

七月七号，周日，学习stm32的bkp外设，完成读写bkp备份寄存寄存器的案例代码，学习rtc外设，实现获取毫秒级uin64t时间戳。

七月八日，周一，上午和同事测试网口相机，下午给新上位机new-gqc写功能扩展，实现按钮类型的选择，实现对手柄自锁按键的支持，晚上学习stm32电源管理pwr

以及卡尔曼滤波器

七月九日 周二 修复whepclient在断开连接时抛出错 优化whepclient组件在协商失败和断开连接后的重新初始化逻辑。实现mavlink消息的展示。七月十日 周三 重构threejs组件，实现展示设备的姿态，实现视频流地址的配置页面和功能，重构和修改部分组件名称，实现logo的动态放大效果，尝试编译并修复相关报错，重构一些组件，以修复视频地址配置变更后不更新的问题，修复地图组件在切换页面的短暂黑屏闪烁的问题。

七月十一 周四，？
七月十一 周五，睡到九点四十，十点多到公司，通过mapbox自定义图层实现将机器三维模型放入地图中，并同步姿态和位置，另外优化数据更新和渲染的次数。

周六周日 大部分时间都在睡觉  小部分实现在学习stm32 pwr电源控制 完成了修改主频、睡眠模式 停止模式 待机模式的测试代码

周一 尝试给新上位机编写路径规划的功能，晚上学习stm32看门狗电路的理论部分。

周二 继续给新上位机写路径规划功能，晚上学习stm32看门狗外设，编程实现案例1。周三，基本实现路径规划功能。晚上学习stm32看门狗外设，编程实现案例2。

周四 基本实现了路径规划功能 周五 优化路径规划功能的页面ui

周六 早八点多出门去图书馆，学习stm32入门教程最后两集flash外设并做笔记然后编程实现案例代码，然后复习高数，主要是之前学的汤家凤基础教程时做的笔记，回家后找了下张宇的教程，然后看了mpu6050的姿态解算过程，基本看懂了，但是卡尔曼滤波还是没懂。
打算明天看宋浩的教程，因为之前已经学了一点并做了笔记了，现在学汤家凤的教程和张宇的教程，发现还是宋浩讲的最基础
感觉汤家凤和张宇的教程都是默认你有一定基础了的，现在打算先复习宋浩的教程，然后把剩余内容学完
然后复习汤家凤的教程，然后把剩余内容学完
然后看了下mpu6050官方dmp库的移植教程 准备尝试实现，然后建工程的时候打算写一个编写stm32-makefile-c-cpp-template的工程文件的建立过程，中间有些问题，到凌晨四点睡觉

周日 早上八点起床 去图书馆 先是在看笔记，看例题，看讲解，然后重新把例题计算了一遍，总共复习了十多页的内容，然后稍微看了点线性代数


周一 上午原本打算给实现坐标编辑功能，就是在地图上创建一个点后可以编辑坐标的经纬度，但是有点复杂，可能需要改很多代码，后面再说吧。然后来了台手提电脑，老板说是属于这周要交付的项目的一部分，测试后发现软件有点问题，原因在于，电脑的UPS设备也被识别为了游戏手柄，但我写的软件假设所有手柄都有遥感和按键，而UPS没有遥感和按键，gampad.buttons.length就获取不到，程序卡死了，找了很久才查出原因，改好代码之后发现电脑的遥感、旋钮、按键都有问题，有个遥感的通道只有半个轴有用，旋钮是开关量不是模拟量，三档开关实际只有两档。

7月二十二号，周一，下班前修复了上述问题，晚上回顾stm32-makefile项目的创建（c/c++混合编译）并总结成笔记

七月二十三号，周二，实现手柄的启用和关闭，多个手柄的选择，优化遥感通道配置界面，重构配置页，实现不同地图源的切换，下班后，尝试修复博客打包时的各种报错，到凌晨两点。

七月二十四日，周三，修复软件中切换mapbox的style后导致自定义层被覆盖的问题，修复在启用和关闭地图功能是的卡顿问题，尝试为地图添加语言切换功能，修改实现讲3d模型模型居中到原点。晚上继续尝试修复博客网站不能打包的问题，凌晨一点终于弄好。
七月二十四日，周三，修复软件中切换mapbox的style后导致自定义层被覆盖的问题，修复在启用和关闭地图功能是的卡顿问题，尝试为地图添加语言切换功能，修改实现讲3d模型模型居中到原点，测试修复之前写的通信配置的进度条功能，修复3d模型渲染存在的性能问题（从数据改变到渲染更新之间没有设置阈值）。晚上继续尝试修复博客网站不能打包的问题，凌晨一点终于弄好。


七月二十五日，周四，和同事刘一起尝试解决通信问题，问题有两个，一个是同事的程序里mavlink id是1而不是0xff，第二个问题是没有广播心跳包而是而是在等待上位机的心跳包，而上位机程序的逻辑是仅在收到下位机的心跳包后才发送各种消息。下班后四十分钟解决，晚上尝试按教程的步骤实现mpu6050的DMP库的移植

七月二十六日 周五 修复手柄控制数据只发送了两个字节的bug，尝试实现UDP_Connection类，晚上继续学习昨天的mpu的DMP库的移植，主要整体看了下motiont_driver_6.12这个库各个模块所负责的功能，看了移植教程文档，总结了笔记，到凌晨两点。

七月二十七日 周六 早八点半到图书馆 继续复习高数 还在看求极限  做了几道题 复习了下几个导数公式，看不进去了，下午开始研究如何在浏览器通过canvas渲染洛克王国的swf格式的精灵图，先是在尝试获取洛克的官方素材，看了些提取教程，测试了几个提取软件。然后在尝试找可以实现在预想功能的库，先尝试了swf2js这个库，starts数620，但尝试着使用了下并看了下源代码，感觉质量不高。后来发现了个叫open-flash的库，starts数87，但是看了下源代码，感觉质量不错，这个库分成了几个模块，测试了下swf- parser也就是swf文件的解析器，可以使用，然后就差不多到五点了，收拾回家，回家后主要在看swf-renderer的源代码，学习其整体架构和其中的clock 模块的实现，该模块通过对系统定时器的封装实现了一个可以暂停pause和恢复resume的定时器，以及一个startLoop(clock,fps,onTick)函数，通过clock可以暂停和恢复循环，通过返回值可以结束循环，整体代码质量较高

七月二十八日 周日 早八点半到图书馆 今天来的算早 图书馆还没开门 等了一会儿。主要把之前学的高数极限部分复习完了 然后更新了下博客内容 提交之前的foc克拉克变换学习笔记 提交昨天晚上写的openswf源码阅读笔记 关闭了博客的pwa功能 阅读博客主题hope官方文档 学习了下侧边栏和自动生成目录的配置 另外尝试配置了下shiki 的twoslash插件 但还有些css样式上的问题 这个插件对vitepress做了适配 但暂时还没有对vuepress2做适配，晚上继续看open swf的源码 写了个demo 把洛克的精灵图丢进去播放试了试，修复了几个异常，能播了，但是太卡了，开始意识到在浏览器解析播放洛克的swf精灵图不太现实，特别是在阅读了源码之后，因为每次要播放下一帧的时候都要提前根据关键帧做计算，而且源码似乎没有对计算结果做缓存，这也许是可以优化的地方。但目前来说暂时不想在这上面浪费时间了，因为突然发现这些精灵图的素材似乎没有走路移动的动画，用这种素材做游戏二次开发可能不太现实。

七月二十九 周一 总结了两篇笔记 主要记录了如何通过网线将window的网络共享给linux 另外就是在Linux上部署mediamtx服务实现超低延迟的webrtc视频图传的流程。另外尝试着在上位机实现了udp Connection和websocketConnection，前者测试了，后者还没测试，需要给下位机编写程序，但是下位机的系统太老了 用的是2020年就停止维护的杰西 使用apt update都无法更新软件源 尝试安装的nodejs和通过vscode remote-ssh插件安装的vscode- server都无法运行 因为依赖的动态链接库版本不够。晚上似乎没做什么事，睡前看了几篇webrtc的文章

七月三十日 周二 修建上位机的功能，为明天即将发货的设备做准备，优化已有功能，比如手柄通道配置部分的代码，以及按键实际下发状态的显示，另外实现了代码的混淆加密，给软件添加了logo，修改编写了使用说明、继续看昨天晚上的webrtc文章 尝试编写webRtc DataChannel的案例，打算实现一个webRtcSocket实现端到端的字节流传输。晚上又找了个教学视频来看，总之相关概念和通信流程应该说是更清晰了。 到现在快一点了 准备睡觉。


七月三十一日 周三 定义实现window.navigator.geolocation接口实现对设备的定位并在地图实时显示。晚上更新web-rtc的学习笔记

