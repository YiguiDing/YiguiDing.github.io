<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.52" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://dingdingdang.online/%E7%90%86%E8%AE%BA/ffmpeg%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><meta property="og:site_name" content="YiguiDingçš„Blogå°ç«™"><meta property="og:title" content="ffmpegéŸ³è§†é¢‘å¼€å‘å­¦ä¹ ç¬”è®°"><meta property="og:description" content="ffmpegéŸ³è§†é¢‘å¼€å‘å­¦ä¹ ç¬”è®° ç›®å½• ffmpegéŸ³è§†é¢‘å¼€å‘å­¦ä¹ ç¬”è®° ç›®å½• ffmpegç®€ä»‹ å¼€å‘ç¯å¢ƒæ­å»º æ—¥å¿—ç³»ç»Ÿ ç¼–è¯‘å‘½ä»¤ æ‰“å¼€è¾“å…¥ è§£å°è£…æå–AACéŸ³é¢‘ è§£å°è£…æå–H264è§†é¢‘ è½¬å°è£…â€”â€”mp4-to-flv æ—¶é—´åŸºã€æ—¶é—´æˆ³ã€æ—¶é•¿ æˆªå–å°è£… RGBã€YUV RGB YUV è§†é¢‘è§£ç  ä¿®æ”¹åˆ†è¾¨ç‡ ä¿®æ”¹æ ¼å¼ä¸ºRGB24 ä¿å­˜rawæ ¼å¼å›¾åƒ YUV_t..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-06-27T17:57:29.000Z"><meta property="article:author" content="ä¸æ¯…æ¡‚"><meta property="article:published_time" content="2024-04-01T16:01:00.000Z"><meta property="article:modified_time" content="2024-06-27T17:57:29.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"ffmpegéŸ³è§†é¢‘å¼€å‘å­¦ä¹ ç¬”è®°","image":[""],"datePublished":"2024-04-01T16:01:00.000Z","dateModified":"2024-06-27T17:57:29.000Z","author":[{"@type":"Person","name":"ä¸æ¯…æ¡‚","email":"2449695354@qq.com"}]}</script><meta name="baidu-site-verification" content="codeva-PwE9Ts6nMl"><link rel="icon" href="/images/favicon_icon.jpg"><link rel="icon" href="/images/favicon_icon.jpg" type="image/png" sizes="192x192"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><link rel="apple-touch-icon" href="/images/favicon_icon.jpg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/images/favicon_icon.jpg"><meta name="msapplication-TileColor" content="#46bd87"><link rel="alternate" type="application/rss+xml" href="https://dingdingdang.online/rss.xml" title="YiguiDingçš„Blogå°ç«™ RSS Feed"><title>ffmpegéŸ³è§†é¢‘å¼€å‘å­¦ä¹ ç¬”è®° | YiguiDingçš„Blogå°ç«™</title><meta name="description" content="ffmpegéŸ³è§†é¢‘å¼€å‘å­¦ä¹ ç¬”è®° ç›®å½• ffmpegéŸ³è§†é¢‘å¼€å‘å­¦ä¹ ç¬”è®° ç›®å½• ffmpegç®€ä»‹ å¼€å‘ç¯å¢ƒæ­å»º æ—¥å¿—ç³»ç»Ÿ ç¼–è¯‘å‘½ä»¤ æ‰“å¼€è¾“å…¥ è§£å°è£…æå–AACéŸ³é¢‘ è§£å°è£…æå–H264è§†é¢‘ è½¬å°è£…â€”â€”mp4-to-flv æ—¶é—´åŸºã€æ—¶é—´æˆ³ã€æ—¶é•¿ æˆªå–å°è£… RGBã€YUV RGB YUV è§†é¢‘è§£ç  ä¿®æ”¹åˆ†è¾¨ç‡ ä¿®æ”¹æ ¼å¼ä¸ºRGB24 ä¿å­˜rawæ ¼å¼å›¾åƒ YUV_t...">
    <link rel="preload" href="/assets/style-BtEAEzu2.css" as="style"><link rel="stylesheet" href="/assets/style-BtEAEzu2.css">
    <link rel="modulepreload" href="/assets/app-DXcObvjK.js"><link rel="modulepreload" href="/assets/index.html-CQ7K4dXd.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><!----><!----><span class="vp-site-name">YiguiDingçš„Blogå°ç«™</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="ä¸»é¡µ"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-house-chimney" style=""></span><!--]-->ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="ç¬”è®°"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>ç¬”è®°<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/%E5%89%8D%E7%AB%AF/" aria-label="å‰ç«¯"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-code" style=""></span><!--]-->å‰ç«¯<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/%E5%90%8E%E7%AB%AF/" aria-label="åç«¯"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-server" style=""></span><!--]-->åç«¯<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/%E7%AE%97%E6%B3%95/" aria-label="ç®—æ³•"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-diagram-project" style=""></span><!--]-->ç®—æ³•<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/%E7%94%B5%E5%AD%90/" aria-label="ç”µå­"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-bolt" style=""></span><!--]-->ç”µå­<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/%E6%BA%90%E7%A0%81/" aria-label="æºç "><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-code-fork" style=""></span><!--]-->æºç <!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/%E7%90%86%E8%AE%BA/" aria-label="ç†è®º"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-book-bookmark" style=""></span><!--]-->ç†è®º<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/%E5%B7%A5%E5%85%B7/" aria-label="å·¥å…·"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-screwdriver-wrench" style=""></span><!--]-->å·¥å…·<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/%E9%9A%8F%E7%AC%94/" aria-label="éšç¬”"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-note-sticky" style=""></span><!--]-->éšç¬”<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/%E8%AE%A1%E5%88%92/" aria-label="è®¡åˆ’"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-list-check" style=""></span><!--]-->è®¡åˆ’<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/%E9%A1%B9%E7%9B%AE/" aria-label="é¡¹ç›®"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-box" style=""></span><!--]-->é¡¹ç›®<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/%E7%BD%91%E7%AB%99/%E5%8F%8B%E9%93%BE.html" aria-label="å‹é“¾"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-user-group" style=""></span><!--]-->å‹é“¾<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/%E7%BD%91%E7%AB%99/%E5%85%B3%E4%BA%8E.html" aria-label="å…³äº"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-address-card" style=""></span><!--]-->å…³äº<!----></a></div></nav><!----><!----><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">æœç´¢</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">23ç§è®¾è®¡æ¨¡å¼å­¦ä¹ ç¬”è®°</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2023 12 13 æ¸¸æˆè®¾è®¡æ¨¡å¼å­¦ä¹ ç¬”è®°</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2023 12 15 å®ç°ç®€æ˜“ç¼–è¯‘å™¨å’Œè§£é‡Šå™¨</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2023 12 20 ä½¿ç”¨é€’å½’ä¸‹é™ç®—æ³•å®ç°ç®€æ˜“è§£é‡Šå™¨</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2023 12 23 ã€ç¼–è¯‘åŸç†ã€‘é‡å­¦ç¬”è®°</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">Ffmpegå­¦ä¹ ç¬”è®°</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/%E7%90%86%E8%AE%BA/ffmpeg%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" aria-label="ffmpegéŸ³è§†é¢‘å¼€å‘å­¦ä¹ ç¬”è®°"><!---->ffmpegéŸ³è§†é¢‘å¼€å‘å­¦ä¹ ç¬”è®°<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">è®¾è®¡æ¨¡å¼å­¦ä¹ ç¬”è®°( Javaç‰ˆ)</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">è®¾è®¡æ¨¡å¼å­¦ä¹ ç¬”è®°( Type Scriptç‰ˆ)</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->ffmpegéŸ³è§†é¢‘å¼€å‘å­¦ä¹ ç¬”è®°</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">ä¸æ¯…æ¡‚</span></span><span property="author" content="ä¸æ¯…æ¡‚"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-04-01T16:01:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 58 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT58M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ç›®å½•">ç›®å½•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ffmpegç®€ä»‹">ffmpegç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å¼€å‘ç¯å¢ƒæ­å»º">å¼€å‘ç¯å¢ƒæ­å»º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æ—¥å¿—ç³»ç»Ÿ">æ—¥å¿—ç³»ç»Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ç¼–è¯‘å‘½ä»¤">ç¼–è¯‘å‘½ä»¤</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æ‰“å¼€è¾“å…¥">æ‰“å¼€è¾“å…¥</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#è§£å°è£…æå–aacéŸ³é¢‘">è§£å°è£…æå–AACéŸ³é¢‘</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#è§£å°è£…æå–h264è§†é¢‘">è§£å°è£…æå–H264è§†é¢‘</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#è½¬å°è£…â€”â€”mp4-to-flv">è½¬å°è£…â€”â€”mp4-to-flv</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æ—¶é—´åŸºã€æ—¶é—´æˆ³ã€æ—¶é•¿">æ—¶é—´åŸºã€æ—¶é—´æˆ³ã€æ—¶é•¿</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æˆªå–å°è£…">æˆªå–å°è£…</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#rgbã€yuv">RGBã€YUV</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#rgb">RGB</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#yuv">YUV</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#è§†é¢‘è§£ç ">è§†é¢‘è§£ç </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ä¿®æ”¹åˆ†è¾¨ç‡">ä¿®æ”¹åˆ†è¾¨ç‡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ä¿®æ”¹æ ¼å¼ä¸ºrgb24">ä¿®æ”¹æ ¼å¼ä¸ºRGB24</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ä¿å­˜rawæ ¼å¼å›¾åƒ">ä¿å­˜rawæ ¼å¼å›¾åƒ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#yuv-to-h264è§†é¢‘ç¼–ç ">YUV_to_H264è§†é¢‘ç¼–ç </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#éŸ³é¢‘è§£ç aac-pcm">éŸ³é¢‘è§£ç AAC_PCM</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#éŸ³é¢‘ç¼–ç pcm-to-aac">éŸ³é¢‘ç¼–ç PCM_to_AAC</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#éŸ³è§†é¢‘é‡‡é›†">éŸ³è§†é¢‘é‡‡é›†</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è§†é¢‘é‡‡é›†">è§†é¢‘é‡‡é›†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#éŸ³é¢‘é‡‡é›†">éŸ³é¢‘é‡‡é›†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŒæ—¶é‡‡é›†è§†é¢‘å’ŒéŸ³é¢‘">åŒæ—¶é‡‡é›†è§†é¢‘å’ŒéŸ³é¢‘</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#éŸ³è§†é¢‘æ’­æ”¾ä¸æ˜¾ç¤º">éŸ³è§†é¢‘æ’­æ”¾ä¸æ˜¾ç¤º</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#sdl">SDL</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="ffmpegéŸ³è§†é¢‘å¼€å‘å­¦ä¹ ç¬”è®°" tabindex="-1"><a class="header-anchor" href="#ffmpegéŸ³è§†é¢‘å¼€å‘å­¦ä¹ ç¬”è®°"><span>ffmpegéŸ³è§†é¢‘å¼€å‘å­¦ä¹ ç¬”è®°</span></a></h1><h2 id="ç›®å½•" tabindex="-1"><a class="header-anchor" href="#ç›®å½•"><span>ç›®å½•</span></a></h2><ul><li><a href="#ffmpeg%E9%9F%B3%E8%A7%86%E9%A2%91%E5%BC%80%E5%8F%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0">ffmpegéŸ³è§†é¢‘å¼€å‘å­¦ä¹ ç¬”è®°</a><ul><li><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a></li><li><a href="#ffmpeg%E7%AE%80%E4%BB%8B">ffmpegç®€ä»‹</a></li><li><a href="#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA">å¼€å‘ç¯å¢ƒæ­å»º</a></li><li><a href="#%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F">æ—¥å¿—ç³»ç»Ÿ</a></li><li><a href="#%E7%BC%96%E8%AF%91%E5%91%BD%E4%BB%A4">ç¼–è¯‘å‘½ä»¤</a></li><li><a href="#%E6%89%93%E5%BC%80%E8%BE%93%E5%85%A5">æ‰“å¼€è¾“å…¥</a></li><li><a href="#%E8%A7%A3%E5%B0%81%E8%A3%85%E6%8F%90%E5%8F%96aac%E9%9F%B3%E9%A2%91">è§£å°è£…æå–AACéŸ³é¢‘</a></li><li><a href="#%E8%A7%A3%E5%B0%81%E8%A3%85%E6%8F%90%E5%8F%96h264%E8%A7%86%E9%A2%91">è§£å°è£…æå–H264è§†é¢‘</a></li><li><a href="#%E8%BD%AC%E5%B0%81%E8%A3%85mp4-to-flv">è½¬å°è£…â€”â€”mp4-to-flv</a></li><li><a href="#%E6%97%B6%E9%97%B4%E5%9F%BA%E6%97%B6%E9%97%B4%E6%88%B3%E6%97%B6%E9%95%BF">æ—¶é—´åŸºã€æ—¶é—´æˆ³ã€æ—¶é•¿</a></li><li><a href="#%E6%88%AA%E5%8F%96%E5%B0%81%E8%A3%85">æˆªå–å°è£…</a></li><li><a href="#rgbyuv">RGBã€YUV</a><ul><li><a href="#rgb">RGB</a></li><li><a href="#yuv">YUV</a></li></ul></li><li><a href="#%E8%A7%86%E9%A2%91%E8%A7%A3%E7%A0%81">è§†é¢‘è§£ç </a></li><li><a href="#%E4%BF%AE%E6%94%B9%E5%88%86%E8%BE%A8%E7%8E%87">ä¿®æ”¹åˆ†è¾¨ç‡</a></li><li><a href="#%E4%BF%AE%E6%94%B9%E6%A0%BC%E5%BC%8F%E4%B8%BArgb24">ä¿®æ”¹æ ¼å¼ä¸ºRGB24</a></li><li><a href="#%E4%BF%9D%E5%AD%98raw%E6%A0%BC%E5%BC%8F%E5%9B%BE%E5%83%8F">ä¿å­˜rawæ ¼å¼å›¾åƒ</a></li><li><a href="#yuv_to_h264%E8%A7%86%E9%A2%91%E7%BC%96%E7%A0%81">YUV_to_H264è§†é¢‘ç¼–ç </a></li><li><a href="#%E9%9F%B3%E9%A2%91%E8%A7%A3%E7%A0%81aac_pcm">éŸ³é¢‘è§£ç AAC_PCM</a></li><li><a href="#%E9%9F%B3%E9%A2%91%E7%BC%96%E7%A0%81pcm_to_aac">éŸ³é¢‘ç¼–ç PCM_to_AAC</a></li><li><a href="#%E9%9F%B3%E8%A7%86%E9%A2%91%E9%87%87%E9%9B%86">éŸ³è§†é¢‘é‡‡é›†</a><ul><li><a href="#%E8%A7%86%E9%A2%91%E9%87%87%E9%9B%86">è§†é¢‘é‡‡é›†</a></li><li><a href="#%E9%9F%B3%E9%A2%91%E9%87%87%E9%9B%86">éŸ³é¢‘é‡‡é›†</a></li><li><a href="#%E5%90%8C%E6%97%B6%E9%87%87%E9%9B%86%E8%A7%86%E9%A2%91%E5%92%8C%E9%9F%B3%E9%A2%91">åŒæ—¶é‡‡é›†è§†é¢‘å’ŒéŸ³é¢‘</a></li></ul></li><li><a href="#%E9%9F%B3%E8%A7%86%E9%A2%91%E6%92%AD%E6%94%BE%E4%B8%8E%E6%98%BE%E7%A4%BA">éŸ³è§†é¢‘æ’­æ”¾ä¸æ˜¾ç¤º</a><ul><li><a href="#sdl">SDL</a></li></ul></li></ul></li></ul><h2 id="ffmpegç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#ffmpegç®€ä»‹"><span>ffmpegç®€ä»‹</span></a></h2><p><strong>ç»„æˆ</strong></p><ul><li>ffmpegéŸ³è§†é¢‘è½¬ç ã€ç¼–è§£ç å·¥å…·</li><li>ffprobeå¤šåª’ä½“åˆ†æå™¨</li><li>ffplayéŸ³è§†é¢‘æ’­æ”¾å™¨</li><li>ffserverå¤šåª’ä½“å®æ—¶å¹¿æ’­æµæœåŠ¡å™¨</li></ul><p><strong>æ¨¡å—</strong></p><ul><li><strong>AVCodecç¼–è§£ç æ¨¡å—</strong></li><li><strong>AVFormatå°è£…æ¨¡å—</strong></li><li>AVFilteræ»¤é•œæ¨¡å—</li><li>AVUtilåŸºæœ¬å·¥å…·æ¨¡å—</li><li>AVDeviceé‡‡é›†ä¸æ¸²æŸ“ï¼ˆè¾“å…¥ä¸è¾“å‡ºï¼‰æ¨¡å—</li><li>swcacleè§†é¢‘å›¾åƒè½¬æ¢æ¨¡å—</li><li>swresampleéŸ³é¢‘è½¬æ¢è®¡ç®—æ¨¡å—</li></ul><p><strong>åº”ç”¨</strong></p><ul><li><strong>å¼€å‘éŸ³è§†é¢‘æ’­æ”¾å™¨ï¼ˆffmpeg+SDL/QTï¼‰</strong></li><li>å¼€å‘æµåª’ä½“æœåŠ¡å™¨/åœ¨çº¿ç›´æ’­ (ffmpeg + Live555/libRTMP)</li><li><strong>æå–å¯ç§»æ¤çš„codecç®—æ³• (éŸ³é¢‘ã€è§†é¢‘)</strong></li><li>å¼€å‘ç¼–è§£ç ã€è½¬ç å™¨ (ffmpeg + libx264/libx265)</li><li>è§†é¢‘ä¼šè®® (ffmpeg+ webrtc)</li><li>è¾…åŠ©å·¥å…·ï¼Œåå¤„ç†(postproc + libavutils)</li><li><strong>CVè®­ç»ƒå·¥å…· (ffmpeg+opencv)</strong></li></ul><h2 id="å¼€å‘ç¯å¢ƒæ­å»º" tabindex="-1"><a class="header-anchor" href="#å¼€å‘ç¯å¢ƒæ­å»º"><span>å¼€å‘ç¯å¢ƒæ­å»º</span></a></h2><ul><li>æ ¹æ® <a href="https://ffmpeg.org/download.html" target="_blank" rel="noopener noreferrer">https://ffmpeg.org/download.html</a>é¡µé¢æç¤ºï¼Œ</li><li>å¯ä»<a href="https://www.gyan.dev/ffmpeg/builds/" target="_blank" rel="noopener noreferrer">Windows builds from gyan.dev</a>ä¸‹è½½windowsé¢„ç¼–è¯‘ç‰ˆï¼Œ</li><li>ä¸‹è½½å‘è¡Œç‰ˆï¼ˆfull-sharedï¼‰<a href="https://www.gyan.dev/ffmpeg/builds/ffmpeg-release-full-shared.7z" target="_blank" rel="noopener noreferrer">release builds-ffmpeg-release-full-shared.7z</a></li></ul><p><strong>ç›®å½•ç»“æ„</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> cd</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> ffmpeg-6.1.1-full_build-shared</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> ls</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">bin/</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  doc/</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  include/</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  lib/</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  LICENSE</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  presets/</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  README.txt</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é…ç½®PKG_CONFIG_PATH</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"># å¯èƒ½ä¹Ÿä¸æ˜¯å¿…è¦çš„</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> PKG_CONFIG_PATH</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">$PKG_CONFIG_PATH</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">:/</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">to</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">ffmpeg-6</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">lib</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">pkgconfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æ—¥å¿—ç³»ç»Ÿ" tabindex="-1"><a class="header-anchor" href="#æ—¥å¿—ç³»ç»Ÿ"><span>æ—¥å¿—ç³»ç»Ÿ</span></a></h2><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;stddef.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavutil/log.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // ffmpegçš„æ—¥å¿—ç³»ç»Ÿ</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> **</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // è®¾ç½®æ—¥å¿—çº§åˆ«</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log_set_level</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(AV_LOG_INFO);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_INFO, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;this is a info log.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;this is a error log.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_DEBUG, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;this is a debug log.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_FATAL, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;this is a fatal log.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç¼–è¯‘å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#ç¼–è¯‘å‘½ä»¤"><span>ç¼–è¯‘å‘½ä»¤</span></a></h2><p><strong>æœ€ç®€å†™æ³•</strong></p><div class="language-makefile line-numbers-mode" data-highlighter="shiki" data-ext="makefile" data-title="makefile" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">#######################################</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"># simple test</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">#######################################</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"># ç¼–è¯‘</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"># gcc -c src/main.c -o ./out.o -I D:/app/ffmpeg-6.1.1-full_build-shared/include</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"># é“¾æ¥</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"># gcc ./out.o -o ./out.exe -L D:/app/ffmpeg-6.1.1-full_build-shared/lib  -l avutil -l avformat -l avcodec</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">#######################################</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"># OUTPUT</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">#######################################</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">TARGET</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> = main.exe</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">BUILD_DIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> = build</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">OUTPUT_DIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> = output</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">#######################################</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"># SOURCES</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">#######################################</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">C_CPP_DEFS</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> =</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">C_SOURCES</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> =  </span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> src/main.c</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">vpath</span><span style="--shiki-light:#005CC5;--shiki-dark:#E6E6E6;"> %</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">.c </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">$(</span><span style="--shiki-light:#005CC5;--shiki-dark:#DCDCAA;">sort</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> $(</span><span style="--shiki-light:#005CC5;--shiki-dark:#DCDCAA;">dir</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> $(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">C_SOURCES</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">CPP_SOURCES</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> = </span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> $(</span><span style="--shiki-light:#005CC5;--shiki-dark:#DCDCAA;">wildcard</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> src/lib/</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">.cpp)</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;"> \</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> # src/main.cpp</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">vpath</span><span style="--shiki-light:#005CC5;--shiki-dark:#E6E6E6;"> %</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">.cpp </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">$(</span><span style="--shiki-light:#005CC5;--shiki-dark:#DCDCAA;">sort</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> $(</span><span style="--shiki-light:#005CC5;--shiki-dark:#DCDCAA;">dir</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> $(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">CPP_SOURCES</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">C_CPP_INCLUDES</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> =  </span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> -I D:/app/ffmpeg-6.1.1-full_build-shared/include </span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> -I src/lib/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">LIBDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> = </span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> -L D:/app/ffmpeg-6.1.1-full_build-shared/lib  -l avutil -l avformat -l avcodec</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">DLL_SOURCES</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> = </span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> $(</span><span style="--shiki-light:#005CC5;--shiki-dark:#DCDCAA;">wildcard</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> D:/app/ffmpeg-6.1.1-full_build-shared/bin/</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">.dll)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">#######################################</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"># COMMAND</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">#######################################</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">CC</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> = gcc</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">XX</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> = g++</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">#######################################</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"># OBJECTS</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">#######################################</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">C_CPP_FLAGS</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> =  </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">C_CPP_DEFS</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> $(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">C_CPP_INCLUDES</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">BUILD_DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> mkdir </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">$@</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">C_OBJECTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> = </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">$(</span><span style="--shiki-light:#005CC5;--shiki-dark:#DCDCAA;">addprefix</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> $(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">BUILD_DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)/,$(</span><span style="--shiki-light:#005CC5;--shiki-dark:#DCDCAA;">notdir</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> $(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">C_SOURCES:.c=.o</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">vpath</span><span style="--shiki-light:#005CC5;--shiki-dark:#E6E6E6;"> %</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">.o </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">$(</span><span style="--shiki-light:#005CC5;--shiki-dark:#DCDCAA;">sort</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> $(</span><span style="--shiki-light:#005CC5;--shiki-dark:#DCDCAA;">dir</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> $(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">C_OBJECTS</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">BUILD_DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">/%.o: %.c | </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">BUILD_DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> $(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">CC</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> -c </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">C_CPP_FLAGS</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> $&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> -o </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">$@</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">CPP_OBJECTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> = </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">$(</span><span style="--shiki-light:#005CC5;--shiki-dark:#DCDCAA;">addprefix</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> $(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">BUILD_DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)/,$(</span><span style="--shiki-light:#005CC5;--shiki-dark:#DCDCAA;">notdir</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> $(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">CPP_SOURCES:.cpp=.o</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">vpath</span><span style="--shiki-light:#005CC5;--shiki-dark:#E6E6E6;"> %</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">.o </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">$(</span><span style="--shiki-light:#005CC5;--shiki-dark:#DCDCAA;">sort</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> $(</span><span style="--shiki-light:#005CC5;--shiki-dark:#DCDCAA;">dir</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> $(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">CPP_OBJECTS</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">BUILD_DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">/%.o: %.cpp | </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">BUILD_DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> $(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">XX</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> -c </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">C_CPP_FLAGS</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> $&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> -o </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">$@</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">#######################################</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"># LINK</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">#######################################</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">LD_FLAGS</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> = </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">LIBDIR</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">OUTPUT_DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> mkdir </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">$@</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> cp </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">DLL_SOURCES</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> $@</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">OUTPUT_DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">TARGET</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">C_OBJECTS</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> $(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">CPP_OBJECTS</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> | </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">OUTPUT_DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> $(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">CC</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  $(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">C_OBJECTS</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> $(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">CPP_OBJECTS</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> -o </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">$@</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> $(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">LD_FLAGS</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">#######################################</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"># COMMAND</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">#######################################</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">all</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">OUTPUT_DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">TARGET</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">clean</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> -rm -fR </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">BUILD_DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> -rm -fR </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">OUTPUT_DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æ‰“å¼€è¾“å…¥" tabindex="-1"><a class="header-anchor" href="#æ‰“å¼€è¾“å…¥"><span>æ‰“å¼€è¾“å…¥</span></a></h2><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;stddef.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavutil/log.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // ffmpegçš„æ—¥å¿—ç³»ç»Ÿ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavformat/avformat.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> err;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> **</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // è®¾ç½®æ—¥å¿—çº§åˆ«</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log_set_level</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(AV_LOG_INFO);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æç¤ºç”¨æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (argc </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;usage </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> media.mp4_or_url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">]);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    const</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;"> char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">url </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVFormatContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">formatCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ‰“å¼€æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_open_input</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">formatCtx, url, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (err)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_FATAL, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;open url </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> fail: </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, url, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">av_err2str</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(err));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> err;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // è¾“å‡ºæµä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_dump_format</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(formatCtx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, url, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // å…³é—­æµ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    avformat_close_input</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">formatCtx);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è¾“å‡º</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">mime</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> type</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> not</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> rfc8216</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> compliant</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[hls @ 000002a673c8a8c0] Opening </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&#39;http://devimages.apple.com/iphone/samples/bipbop/gear1/fileSequence0.ts&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;"> for</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> reading</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[hls @ 000002a673c8a8c0] Opening </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&#39;http://devimages.apple.com/iphone/samples/bipbop/gear1/fileSequence1.ts&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;"> for</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> reading</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">Input</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> #0, hls, from &#39;http://devimages.apple.com/iphone/samples/bipbop/gear1/prog_index.m3u8&#39;:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  Duration:</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> 00:30:01.00,</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> bitrate:</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> N/A</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  Program</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    Metadata:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">      variant_bitrate</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> :</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  Stream</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> #0:0: Audio: aac ([15][0][0][0] / 0x000F), 0 channels</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    Metadata:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">      variant_bitrate</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> :</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  Stream</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> #0:1: Video: h264 ([27][0][0][0] / 0x001B), none, 90k tbn</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    Metadata:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">      variant_bitrate</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> :</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="è§£å°è£…æå–aacéŸ³é¢‘" tabindex="-1"><a class="header-anchor" href="#è§£å°è£…æå–aacéŸ³é¢‘"><span>è§£å°è£…æå–AACéŸ³é¢‘</span></a></h2><p><strong>AAC</strong></p><ul><li>AACåªæ˜¯æ•°æ®ç¼–ç æ ¼å¼</li><li>ç æµç»„ç»‡æ ¼å¼æœ‰ï¼š <ul><li>ADIF(Audio Data Interchange Format)</li><li>ADTS (Audio Data Transport Stream)</li></ul></li><li>ADIFç¼–ç ä¿¡æ¯å­˜åœ¨ä¸€ä¸ªå›ºå®šçš„åœ°æ–¹,æ‰€ä»¥ADIFä¸»è¦ç”¨äºç£ç›˜å­˜å‚¨æ–‡ä»¶ï¼Œ</li><li>ADTSç¼–ç ä¿¡æ¯æ˜¯æ¯ä¸€ä¸ªåŒ…ä¸­éƒ½æœ‰,ADTSä¸»è¦ç”¨äºæ¸è¿›å¼ä¼ è¾“çš„ç½‘ç»œæµ</li></ul><p><strong>ADTS æµæ ¼å¼</strong></p><ul><li>ADTSæµæ ¼å¼ä¸ºADTSå¤´éƒ¨åŠ AACè£¸æ•°æ®ã€‚</li><li><code>[ADTSå¤´](AACæ•°æ®) | [ADTSå¤´](AACæ•°æ®) | ...</code></li><li>ADTS Headerä¸ºå›ºå®šçš„7å­—èŠ‚é•¿åº¦ï¼Œæ ¼å¼å¯ä»¥ç”¨ä¸‹é¢å­—æ¯åºåˆ—æ¥è¡¨ç¤ºï¼Œä¸€ä¸ªå­—æ¯è¡¨ç¤ºä¸€ç§å­—æ®µï¼Œæ•°é‡è¡¨ç¤ºæ¯”ç‰¹é•¿åº¦ã€‚</li><li><code>AAAAAAAA AAAABCCD EEFFFFGH HHIJKLMM MMMMMMMM MMMOOOOO OOOOOOPP (QQQQQQQQ QQQQQQQQ)</code></li><li>å…¶ä¸­A-Jç§°ä¸ºADTSå›ºå®šå¤´éƒ¨ï¼ŒK-Qç§°ä¸ºå¯å˜å¤´éƒ¨ã€‚</li></ul><table><thead><tr><th style="text-align:left;">æ ‡å¿—</th><th style="text-align:left;">æ¯”ç‰¹</th><th style="text-align:left;">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left;">A</td><td style="text-align:left;">12</td><td style="text-align:left;">åŒæ­¥å­—æ®µï¼Œå…¨1</td></tr><tr><td style="text-align:left;">B</td><td style="text-align:left;">1</td><td style="text-align:left;">MPEGç‰ˆæœ¬: 0 for MPEG-4, 1 for MPEG-2ï¼Œmp4æ˜¯0</td></tr><tr><td style="text-align:left;">C</td><td style="text-align:left;">2</td><td style="text-align:left;">Layer: å…¨0</td></tr><tr><td style="text-align:left;">D</td><td style="text-align:left;">1</td><td style="text-align:left;">ä¿æŠ¤ç¼ºå¤±æ ‡è¯†ProtectionAbsent , 1 è¡¨ç¤ºæ—  CRC ï¼Œ0 è¡¨ç¤ºæœ‰ CRC</td></tr><tr><td style="text-align:left;">E</td><td style="text-align:left;">2</td><td style="text-align:left;">AACç¼–ç çº§åˆ«, MPEG-4 Audio Object Typeå‡1ã€‚0: Main Profile, 1:LC, 2: SSRï¼Œ3:ä¿ç•™ã€‚å¸¸ç”¨ä½å¤æ‚åº¦ç¼–ç LCã€‚</td></tr><tr><td style="text-align:left;">F</td><td style="text-align:left;">4</td><td style="text-align:left;">MPEG-4 é‡‡æ ·ç‡è¡¨åºå·ï¼Œæ³¨æ„è¿™é‡Œæ˜¯åºå·ï¼Œä¸æ˜¯é‡‡æ ·ç‡å€¼ï¼Œå‚è€ƒé‡‡æ ·ç‡è¡¨ã€‚</td></tr><tr><td style="text-align:left;">G</td><td style="text-align:left;">1</td><td style="text-align:left;">ç§æœ‰ä½ï¼Œè®¾ä¸º0ï¼Œè§£ç æ—¶å¿½ç•¥</td></tr><tr><td style="text-align:left;">H</td><td style="text-align:left;">3</td><td style="text-align:left;">å£°é“æ•°ï¼Œå–å€¼èŒƒå›´1-7ã€‚</td></tr><tr><td style="text-align:left;">I</td><td style="text-align:left;">1</td><td style="text-align:left;">æºæ ‡è¯†, ç¼–ç è®¾ä¸º0ï¼Œè§£ç å¿½ç•¥</td></tr><tr><td style="text-align:left;">J</td><td style="text-align:left;">1</td><td style="text-align:left;">home, ç¼–ç è®¾ä¸º0ï¼Œè§£ç å¿½ç•¥</td></tr><tr><td style="text-align:left;">K</td><td style="text-align:left;">1</td><td style="text-align:left;">ç‰ˆæƒæ ‡å¿—ä½ï¼Œç¼–ç è®¾ä¸º0ï¼Œè§£ç å¿½ç•¥</td></tr><tr><td style="text-align:left;">L</td><td style="text-align:left;">1</td><td style="text-align:left;">ç‰ˆæƒæ ‡å¿—å¼€å§‹ä½ï¼Œç¼–ç è®¾ä¸º0ï¼Œè§£ç å¿½ç•¥</td></tr><tr><td style="text-align:left;">M</td><td style="text-align:left;">13</td><td style="text-align:left;">å¸§é•¿åº¦ï¼Œä¸ºAACåŸå§‹æ•°æ®é•¿åº¦+ADTSå¤´é•¿åº¦ï¼ˆProtectionAbsent == 1 ? 7 : 9ï¼‰</td></tr><tr><td style="text-align:left;">O</td><td style="text-align:left;">11</td><td style="text-align:left;">Buffer fullnessï¼Œ 0x7FF è¯´æ˜æ˜¯ç ç‡å¯å˜çš„ç æµ</td></tr><tr><td style="text-align:left;">P</td><td style="text-align:left;">2</td><td style="text-align:left;">AACå¸§æ•°é‡å‡1å€¼ï¼Œæœ‰1ä¸ªå¸§æ—¶æ­¤å€¼ä¸º0</td></tr><tr><td style="text-align:left;">Q</td><td style="text-align:left;">16</td><td style="text-align:left;">å¦‚æœä¿æŠ¤ç¼ºå¤±æ ‡è¯†ProtectionAbsentä¸º0ï¼Œæ ‡è¯†æœ‰2å­—èŠ‚CRCæ ¡éªŒå­—æ®µ</td></tr></tbody></table><p><strong>å›ºå®šå¤´</strong><br><img src="/assets/image-10-BxAx0vdC.png" alt="Alt text"></p><p><strong>å¯å˜å¤´</strong><br><img src="/assets/image-11-CAuFhYG9.png" alt="Alt text"></p><p><strong>é‡‡æ ·ç‡å¯¹ç…§è¡¨</strong></p><p><img src="/assets/image-12-CvaCi7q0.png" alt="Alt text"></p><p><img src="/assets/5d3f95aa0b5db04cb5964b68745a60f1-DaSnfsFP.png" alt="Alt text"><br><img src="/assets/image-_7ZNUn9n.png" alt="Alt text"></p><p><strong>æå–è§†é¢‘ä¸­çš„AACéŸ³é¢‘</strong></p><blockquote><p>å¦‚æœffplayä¸èƒ½æ’­æ”¾ï¼Œæ˜¯å› ä¸ºaacæ ¼å¼ä¸æ˜¯adts</p></blockquote><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;stddef.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavutil/avutil.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     // for log</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavformat/avformat.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // for avformat</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavcodec/avcodec.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">   // for packet</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &quot;./lib/adts.h&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">           // for adts éŸ³é¢‘å¤´</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> err;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> **</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // è®¾ç½®æ—¥å¿—çº§åˆ«</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  av_log_set_level</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(AV_LOG_INFO);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // æç¤ºç”¨æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (argc </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;usage: </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> input.mp4 output.aac</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">]);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">  const</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;"> char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">input </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">  const</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;"> char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">output </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // æ‰“å¼€æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  AVFormatContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">format_ctx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_open_input</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">format_ctx, input, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;open input </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> fail: </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, input, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">av_err2str</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(err));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> err;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  av_dump_format</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(format_ctx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, input, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // è·å–ç æµä¿¡æ¯ï¼Œå®é™…æ˜¯å»å¯¹formatCtxä¸­streamç›¸å…³çš„å‚æ•°èµ‹å€¼ï¼Œå› ä¸ºåé¢éœ€è¦ç”¨</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // Read packets of a media file to get stream information.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_find_stream_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(format_ctx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;find stream info failed:</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%s</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">av_err2str</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(err));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> err;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // è·å–éŸ³é¢‘æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">  int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> audio_idx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_find_best_stream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(format_ctx, AVMEDIA_TYPE_AUDIO, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (audio_idx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;find best audio stream index failed; index: </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%d</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, audio_idx);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  else</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_INFO, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;find best audio stream index is </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%d</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, audio_idx);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // åˆ›å»ºæ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  FILE </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">dest_fp </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> fopen</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(output, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;wb&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (dest_fp </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;make file failed.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // åˆå§‹åŒ–packet</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  AVPacket </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">packet </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_packet_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // è¯»å–packet</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  while</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">av_read_frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(format_ctx, packet) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ‰¾åˆ°éŸ³é¢‘æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">stream_index</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> ==</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> audio_idx)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">      // å†™å…¥ADTS_Header</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">      uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> adts_header</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">7</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> {</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">};</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">      set_ADTS_Header</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">          adts_header,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">          packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">          format_ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">streams</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[audio_idx]-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codecpar</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">profile</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">          format_ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">streams</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[audio_idx]-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codecpar</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">sample_rate</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">          format_ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">streams</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[audio_idx]-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codecpar</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">channels</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> //</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">      );</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">fwrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(adts_header, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(adts_header), dest_fp) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">!=</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;"> sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(adts_header))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">      {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;write ADTS_Header failed.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">      }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">      // å†™å…¥æ–‡ä»¶ï¼ˆdataæ˜¯åŸå§‹æ•°æ®ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">fwrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, dest_fp) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">      {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;write file failed.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // é‡Šæ”¾packetä¸­çš„data</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_packet_unref</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(packet);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // é‡Šæ”¾packet</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  av_packet_free</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">packet);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // å…³é—­æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (format_ctx)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    avformat_close_input</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">format_ctx);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // å…³é—­æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (dest_fp)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    fclose</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(dest_fp);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>adts.h</strong></p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#ifndef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> _ADTSHEADER_H</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> _ADTSHEADER_H</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;stdio.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;stdint.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> ADTS_HEADER_LEN</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 7</span><span style="--shiki-light:#24292E;--shiki-dark:#569CD6;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> sampling_frequencies</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">[]</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">    96000</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // 0x0</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">    88200</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // 0x1</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">    64000</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // 0x2</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">    48000</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // 0x3</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">    44100</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // 0x4</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">    32000</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // 0x5</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">    24000</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // 0x6</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">    22050</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // 0x7</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">    16000</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // 0x8</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">    12000</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // 0x9</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">    11025</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // 0xa</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">    8000</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">   // 0xb</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // 0xc d e fæ˜¯ä¿ç•™çš„</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> set_ADTS_Header</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">char</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">7</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">],</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">                int</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> data_length</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">                int</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> profile</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">                int</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> samplerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">                int</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> channels</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> sampling_frequency_index </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // é»˜è®¤ä½¿ç”¨48000hz</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> adtsLen </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> data_length </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 7</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // ADTSä¸æ˜¯å•çº¯çš„dataï¼Œæ˜¯hearder+dataçš„ï¼Œæ‰€ä»¥åŠ 7è¿™ä¸ªå¤´éƒ¨hearderçš„é•¿åº¦ï¼Œè¿™é‡Œ7æ˜¯å› ä¸ºåé¢protection absentä½è®¾ä¸º1ï¼Œä¸åšæ ¡éªŒï¼Œæ‰€ä»¥ç›´æ¥åŠ 7ï¼Œå¦‚æœåšæ ¡éªŒï¼Œå¯èƒ½ä¼šæ˜¯9</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> frequencies_size </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;"> sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(sampling_frequencies) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;"> sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">sampling_frequencies</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">]);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (i </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> frequencies_size; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // æŸ¥æ‰¾é‡‡æ ·ç‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">sampling_frequencies</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[i] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> samplerate)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">            sampling_frequency_index </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> i;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">            break</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (i </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&gt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> frequencies_size)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        printf</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;unsupport samplerate:</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%d</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, samplerate);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">    data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#B5CEA8;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">ff</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                    // syncword:0xfff                          é«˜8bits</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">    data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#B5CEA8;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">f0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                    // syncword:0xfff                          ä½4bits</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">    data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">|=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> &lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                               // MPEG Version:0 for MPEG-4,1 for MPEG-2  1bit</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">    data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">|=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> &lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                               // Layer:0                                 2bits</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">    data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">|=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                      // protection absent:1                     1bit</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">    data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (profile) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 6</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                          // profile:profile               2bits</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">    data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">|=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (sampling_frequency_index </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#B5CEA8;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0f</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // sampling frequency index:sampling_frequency_index  4bits</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">    data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">|=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> &lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                               // private bit:0                   1bit</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">    data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">|=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (channels </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#B5CEA8;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">04</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&gt;&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                 // channel configuration:channels  é«˜1bit</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">    data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (channels </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#B5CEA8;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">03</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 6</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                  // channel configuration:channels ä½2bits</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">    data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">|=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> &lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                               // originalï¼š0                1bit</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">    data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">|=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> &lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 4</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                               // homeï¼š0                    1bit</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">    data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">|=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> &lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                               // copyright id bitï¼š0        1bit</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">    data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">|=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> &lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                               // copyright id startï¼š0      1bit</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">    data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">|=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ((adtsLen </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#B5CEA8;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1800</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&gt;&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 11</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">             // frame lengthï¼švalue    é«˜2bits</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">    data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">uint8_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)((adtsLen </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#B5CEA8;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">7f8</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&gt;&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">       // frame length: value    ä¸­é—´8bits</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">    data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">uint8_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)((adtsLen </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#B5CEA8;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">7</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">         // frame length: value    ä½3bits</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">    data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">|=</span><span style="--shiki-light:#D73A49;--shiki-dark:#B5CEA8;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1f</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                   // buffer fullness:0x7ff é«˜5bits</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">    data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">6</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#B5CEA8;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">fc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                    // 11111100       //buffer fullness:0x7ff ä½6bits</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // number_of_raw_data_blocks_in_frameï¼š  //    è¡¨ç¤ºADTSå¸§ä¸­æœ‰number_of_raw_data_blocks_in_frame + 1ä¸ªAACåŸå§‹å¸§ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#endif</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // _ADTSHEADER_H</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>AACéŸ³é¢‘æ ¼å¼</strong></p><ul><li><img src="/assets/image-1-B4EPieMY.png" alt="Alt text"></li><li>ADIF-å¤´ä¿¡æ¯ä»…åœ¨å¼€å¤´ï¼Œé€‚ç”¨äºæ–‡ä»¶ä¼ è¾“</li><li>ADTS-å¤´ä¿¡æ¯åœ¨ä»»æ„å¸§ï¼Œé€‚ç”¨äºæµåª’ä½“ <ul><li>7~9ä¸ªå­—èŠ‚çš„å¤´ä¿¡æ¯</li><li><img src="/assets/image-2-zoGBhsAP.png" alt="Alt text"></li><li><img src="/assets/image-3-45CRhuLA.png" alt="Alt text"></li><li><img src="/assets/image-4-DxYKL9Ru.png" alt="Alt text"></li></ul></li></ul><h2 id="è§£å°è£…æå–h264è§†é¢‘" tabindex="-1"><a class="header-anchor" href="#è§£å°è£…æå–h264è§†é¢‘"><span>è§£å°è£…æå–H264è§†é¢‘</span></a></h2><p><img src="/assets/image-5-D1629hX7.png" alt="Alt text"><br><strong>264å°è£…æ ¼å¼</strong></p><ul><li>AnnexB æ¯ä¸€å¸§æ•°æ®éƒ½ç”±<code>startCode</code>+<code>NALU</code>æ•°æ®ç»„æˆï¼Œé€‚åˆäºæµåª’ä½“å®æ—¶ä¼ è¾“çš„å°è£…æ ¼å¼</li><li>AVCC æ•´ä¸ªæ–‡ä»¶ç”±NALUé•¿åº¦+NALUæ•°æ®ç»„æˆï¼Œ é€‚åˆå­˜å‚¨<br><img src="/assets/image-7-CCfBBqpI.png" alt="Alt text"></li></ul><p><strong>å­—èŠ‚æµè¿‡æ»¤å™¨ï¼šAVCCè½¬AnnexB</strong></p><p><img src="/assets/image-8-BQAu2F0O.png" alt="Alt text"></p><p><img src="/assets/image-6-EGxkPaws.png" alt="Alt text"><br><img src="/assets/image-9-yBDTRhfB.png" alt="Alt text"></p><p>ä»£ç å’Œæå–éŸ³é¢‘å‡ ä¹æ²¡æœ‰åŒºåˆ«</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;stddef.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavutil/avutil.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     // for log</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavformat/avformat.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // for avformat</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavcodec/avcodec.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">   // for packet</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavcodec/bsf.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">       // for bsf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> err;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> **</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // è®¾ç½®æ—¥å¿—çº§åˆ«</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  av_log_set_level</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(AV_LOG_INFO);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // æç¤ºç”¨æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (argc </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;usage: </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> input.mp4 output.h264</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">]);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">  const</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;"> char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">input </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">  const</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;"> char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">output </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // æ‰“å¼€æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  AVFormatContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">format_ctx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_open_input</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">format_ctx, input, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;open input </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> fail: </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, input, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">av_err2str</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(err));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> err;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  av_dump_format</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(format_ctx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, input, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // è·å–ç æµä¿¡æ¯ï¼Œå®é™…æ˜¯å»å¯¹formatCtxä¸­streamç›¸å…³çš„å‚æ•°èµ‹å€¼ï¼Œå› ä¸ºåé¢éœ€è¦ç”¨</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // Read packets of a media file to get stream information.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_find_stream_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(format_ctx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;find stream info failed:</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%s</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">av_err2str</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(err));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> err;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // è·å–è§†é¢‘æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">  int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> video_idx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_find_best_stream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(format_ctx, AVMEDIA_TYPE_VIDEO, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (video_idx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;find best video stream index failed; index: </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%d</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, video_idx);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  else</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_INFO, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;find best video stream index is </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%d</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, video_idx);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // åˆ›å»ºæ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  FILE </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">dest_fp </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> fopen</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(output, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;wb&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (dest_fp </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;make file failed.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // è·å–æ¯”ç‰¹æµè¿‡æ»¤å™¨</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // mp4 to annexb</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // Convert an H.264 bitstream from `length prefixed mode` to `start code prefixed mode`</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  //  this filter is auto-inserted for MPEG-TS (muxer mpegts) and raw H.264 (muxer h264) output formats.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // ffmpeg -i INPUT.mp4 -codec copy -bsf:v h264_mp4toannexb OUTPUT.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AVBitStreamFilter </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">bsf </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_bsf_get_by_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;h264_mp4toannexb&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (bsf </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;creat AVBitStreamFilter: h264_mp4toannexb  failed.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // Allocate a context for a given bitstream filter.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // åˆ›å»ºbsfä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  AVBSFContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">bsf_ctx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  av_bsf_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(bsf, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">bsf_ctx);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // å¤åˆ¶ç¼–ç å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // æå–h264,ä¸éœ€è¦æ”¹å˜ç¼–ç å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  avcodec_parameters_copy</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">bsf_ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">par_in</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">format_ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">streams</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[video_idx]-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codecpar</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // åˆå§‹åŒ–bsf</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // Prepare the filter for use</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  av_bsf_init</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(bsf_ctx);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // åˆå§‹åŒ–packet</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  AVPacket </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">packet </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_packet_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // è¯»å–packet</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  while</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">av_read_frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(format_ctx, packet) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ‰¾åˆ°è§†é¢‘æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">stream_index</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> ==</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> video_idx)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">      // å‘é€åˆ°bsf</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">av_bsf_send_packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(bsf_ctx, packet) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">      {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // ä»bsfæ¥æ”¶æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        while</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">av_bsf_receive_packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(bsf_ctx, packet)</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">          // å†™å…¥æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">          if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">fwrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, dest_fp) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">          {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">            av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;write file failed.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">            return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">          }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">      }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">      else</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">      {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;send packet to bsf failed.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // é‡Šæ”¾packetä¸­çš„data</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_packet_unref</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(packet);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // é‡Šæ”¾packet</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  av_packet_free</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">packet);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // å…³é—­æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (format_ctx)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    avformat_close_input</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">format_ctx);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // æ¸…é™¤bsf</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (bsf_ctx)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_bsf_free</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">bsf_ctx);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // å…³é—­æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (dest_fp)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    fclose</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(dest_fp);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="è½¬å°è£…â€”â€”mp4-to-flv" tabindex="-1"><a class="header-anchor" href="#è½¬å°è£…â€”â€”mp4-to-flv"><span>è½¬å°è£…â€”â€”mp4-to-flv</span></a></h2><p><strong>Iã€Pã€Bå¸§</strong></p><ul><li>Iå¸§ï¼Œå…³é”®å¸§ï¼ŒGOPçš„ç¬¬ä¸€å¸§ï¼Œè½»åº¦å‹ç¼©ï¼Œ</li><li>På¸§ï¼Œå‰å‘é¢„æµ‹ç¼–ç å¸§ã€‚</li><li>Bå¸§ï¼ŒåŒå‘é¢„æµ‹å†…æ’ç¼–ç å¸§ã€‚</li><li><img src="/assets/image-13-DBymkk8l.png" alt="Alt text"></li></ul><p><strong>è§£ç å’Œæ˜¾ç¤ºé¡ºåº</strong></p><ul><li>Bå¸§è§£ç ä¾èµ–Iå¸§å’ŒPå¸§ï¼ŒBå¸§å¤ªå¤šï¼Œåˆ™è§£ç éœ€è¦ç¼“å­˜æ›´å¤šæ•°æ®</li><li>Bå¸§åˆæ˜¯ä½“æœºæœ€å°çš„å¸§ï¼ŒBå¸§å¤šï¼Œå¯ä»¥é™ä½å¸¦å®½ã€‚<br><img src="/assets/image-14-j83o5ZZK.png" alt="Alt text"></li></ul><p><strong>PTSå’ŒDTS</strong><br><img src="/assets/image-15-BYRARtai.png" alt="Alt text"></p><p><strong>è½¬å°è£…æµç¨‹</strong></p><p><img src="/assets/image-16-DdboDbxP.png" alt="Alt text"></p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;stdint.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavutil/avutil.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     // for log</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavformat/avformat.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // for avformat</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavcodec/avcodec.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">   // for packet</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavcodec/bsf.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">       // for bsf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> **</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // è®¾ç½®æ—¥å¿—çº§åˆ«</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  av_log_set_level</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(AV_LOG_INFO);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // æç¤ºç”¨æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (argc </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;usage: </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> input.mp4 output.flv</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">]);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">  const</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;"> char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">input </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">  const</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;"> char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">output </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // æ‰“å¼€è¾“å…¥ä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  AVFormatContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">in_format_ctx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">  int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_open_input</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">in_format_ctx, input, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;open input </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> fail;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, input);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // æ˜¾ç¤ºè¾“å…¥çš„è¯¦ç»†ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // Print detailed information about the input or output format</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  av_dump_format</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(in_format_ctx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, input, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // è·å–è¾“å…¥ç æµä¿¡æ¯ï¼Œå®é™…æ˜¯å»å¯¹formatCtxä¸­streamç›¸å…³çš„å‚æ•°èµ‹å€¼ï¼Œå› ä¸ºåé¢éœ€è¦ç”¨</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // Read packets of a media file to get stream information.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_find_stream_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(in_format_ctx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;find stream info failed</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // åˆ›å»ºè¾“å‡ºä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  AVFormatContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">out_format_ctx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_alloc_output_context2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">out_format_ctx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, output);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;alloc output format failed</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // å¯¹è¾“å‡ºæµè®¡æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">  int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> out_stream_idx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // è®°å½•è¾“å…¥æµå’Œè¾“å‡ºæµçš„å¯¹åº”å…³ç³»</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">  int</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> io_stream_idx_map</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">in_format_ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">nb_streams</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  memset</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(io_stream_idx_map, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(io_stream_idx_map));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // æ”¶é›†(æŒ‘é€‰)è§†é¢‘æµã€éŸ³é¢‘æµã€å­—å¹•æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  for</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">uint8_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> in_stream_idx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">; in_stream_idx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> in_format_ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">nb_streams</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">; in_stream_idx</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVStream </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">in_stream </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> in_format_ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">streams</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[in_stream_idx];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">in_stream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codecpar</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codec_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> ==</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AVMEDIA_TYPE_AUDIO </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">||</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">        in_stream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codecpar</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codec_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> ==</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AVMEDIA_TYPE_VIDEO </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">||</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">        in_stream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codecpar</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codec_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> ==</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AVMEDIA_TYPE_SUBTITLE)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">      // åˆ›å»ºè¾“å‡ºçš„è§†é¢‘æµã€éŸ³é¢‘æµã€å­—å¹•æµ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">      // Add a new stream to a media file. When demuxing</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">      AVStream </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">out_stream </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_new_stream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(out_format_ctx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (out_stream </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">      {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;creat media stream failed.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">      }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">      // æ‹·è´æµçš„ç¼–ç å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">      // Copy the contents of src to dst.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">      avcodec_parameters_copy</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">out_stream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codecpar</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">in_stream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codecpar</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">      // Additional information about the codec</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">      out_stream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codecpar</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codec_tag</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // codec_tagä¸éœ€è¦æ‹·è´</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">      // è®°å½•å¯¹åº”å…³ç³»</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">      io_stream_idx_map</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[in_stream_idx] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> out_stream_idx</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">out_format_ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">oformat</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">flags</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AVFMT_NOFILE)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // AVFMT_NOFILE cant be write</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;AVFMT_NOFILE cant be write.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // Create and initialize a AVIOContext for accessing the resource indicated by url.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // è¾“å‡ºæ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // I/O context</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avio_open</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">out_format_ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">pb</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, output, AVIO_FLAG_WRITE);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;open </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> file failed.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, output);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // å†™å…¥æ–‡ä»¶å¤´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_write_header</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(out_format_ctx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;write stream header to output media file failed.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // è¯»å–æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  AVPacket </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">packet </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_packet_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  while</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">av_read_frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(in_format_ctx, packet) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // å¦‚æœæ‰¾åˆ°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">io_stream_idx_map</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">stream_index</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">      // è·å–è¾“å…¥æµå’Œè¾“å‡ºæµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">      AVStream </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">inStream </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> in_format_ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">streams</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">stream_index</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">      AVStream </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">outStream </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> out_format_ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">streams</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">io_stream_idx_map</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">stream_index</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">]];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">      // ä¿®æ”¹stream_index</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">      packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">stream_index</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> io_stream_idx_map</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">stream_index</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">      // é‡æ–°è®¡ç®—pts(æ˜¾ç¤ºæ—¶é—´æˆ³) : arg1 * arg2 / arg3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">      packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">pts</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_rescale_q</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">pts</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">inStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">time_base</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">outStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">time_base</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">      // é‡æ–°è®¡ç®—dts(è§£ç æ—¶é—´æˆ³)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">      packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">dts</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_rescale_q</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">dts</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">inStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">time_base</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">outStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">time_base</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">      // é‡æ–°è®¡ç®—duration</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">      packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">duration</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_rescale_q</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">duration</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">inStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">time_base</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">outStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">time_base</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">      // byte position in stream, -1 if unknown</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">      packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">pos</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">      // å†™å…¥packet</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">      // Write a packet to an output media file ensuring correct interleaving.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">av_interleaved_write_frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(out_format_ctx, packet) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">      {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;Write packet to output media file failed.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ¸…é™¤buffer</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_packet_unref</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(packet);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  av_packet_free</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">packet);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // å†™å…¥æ–‡ä»¶å°¾</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  av_write_trailer</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(out_format_ctx);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // å…³é—­è¾“å…¥ä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (in_format_ctx)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    avformat_close_input</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">in_format_ctx);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // å…³é—­I/O context.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (out_format_ctx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> out_format_ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">pb</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> &amp;&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">out_format_ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">flags</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AVFMT_NOFILE))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    avio_closep</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">out_format_ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">pb</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // å…³é—­è¾“å‡ºä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (out_format_ctx)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    avformat_free_context</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(out_format_ctx);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æ—¶é—´åŸºã€æ—¶é—´æˆ³ã€æ—¶é•¿" tabindex="-1"><a class="header-anchor" href="#æ—¶é—´åŸºã€æ—¶é—´æˆ³ã€æ—¶é•¿"><span>æ—¶é—´åŸºã€æ—¶é—´æˆ³ã€æ—¶é•¿</span></a></h2><p><strong>æ€»ç»“</strong></p><blockquote><ul><li>æ—¶é—´åŸºå¯ä»¥ç†è§£ä¸ºç –å—çš„åšåº¦ï¼Œ</li><li>æ—¶é—´æˆ³å¯ä»¥ç†è§£ä¸ºç –å—çš„æ•°é‡</li><li>æ—¶é—´ï¼ˆå¢™çš„é«˜åº¦ï¼‰=æ—¶é—´åŸº(ç –å—åšåº¦) * æ—¶é—´æˆ³(ç –å—æ•°é‡)</li></ul></blockquote><p>åœ¨ FFmpeg ä¸­ï¼Œæœ‰å‡ ä¸ªå…³é”®çš„æ—¶é—´åŸºæ¦‚å¿µä»¥åŠå®ƒä»¬çš„ä½œç”¨ï¼š</p><ol><li><p><strong>æ—¶é—´åŸºï¼ˆTime Baseï¼‰</strong>ï¼šåœ¨ FFmpeg ä¸­ï¼Œæ—¶é—´åŸºæ˜¯ç”¨äºè¡¡é‡æ—¶é—´çš„åŸºæœ¬å•ä½ï¼Œé€šå¸¸è¡¨ç¤ºæ¯ç§’çš„å¸§æ•°æˆ–æ ·æœ¬æ•°ã€‚é»˜è®¤çš„æ—¶é—´åŸºæ˜¯ 1 ç§’ç­‰äº 1000000 å¾®ç§’ï¼ˆAV_TIME_BASEï¼‰ã€‚æ—¶é—´åŸºåœ¨è§†é¢‘å’ŒéŸ³é¢‘ç¼–è§£ç è¿‡ç¨‹ä¸­èµ·ç€é‡è¦ä½œç”¨ï¼Œç”¨äºåŒæ­¥å’Œè®¡æ—¶ã€‚</p></li><li><p><strong>å°è£…æ ¼å¼ï¼ˆContainer Formatï¼‰</strong>ï¼šå°è£…æ ¼å¼æ˜¯ç”¨äºå°è£…éŸ³é¢‘ã€è§†é¢‘ã€å­—å¹•ç­‰å¤šç§æ•°æ®æµçš„å®¹å™¨ã€‚å¸¸è§çš„å°è£…æ ¼å¼æœ‰ MP4ã€AVIã€MKV ç­‰ã€‚å°è£…æ ¼å¼ä¸­åŒ…å«äº†åª’ä½“æ•°æ®çš„æè¿°ä¿¡æ¯ä»¥åŠæ—¶é—´åŸºç­‰å…ƒæ•°æ®ã€‚</p></li><li><p><strong>TBR å¸§ç‡ï¼ˆTime Base Rate Frame Rateï¼‰</strong>ï¼šTBR å¸§ç‡æŒ‡çš„æ˜¯è§†é¢‘æµä¸­å®é™…çš„å¸§ç‡ï¼Œå³æ¯ç§’æ˜¾ç¤ºçš„å¸§æ•°ã€‚TBR å¸§ç‡æ˜¯æ ¹æ®æ—¶é—´åŸºå’Œæ—¶é•¿è®¡ç®—å¾—å‡ºçš„ï¼Œç¡®ä¿è§†é¢‘æµçš„æ’­æ”¾é€Ÿåº¦ã€‚</p></li><li><p><strong>TBN æµçš„æ—¶é—´åŸºï¼ˆTime Base Numeratorï¼‰</strong>ï¼šTBN æ˜¯è§†é¢‘æµçš„æ—¶é—´åŸºçš„åˆ†å­éƒ¨åˆ†ï¼Œç”¨äºç¡®å®šæ¯ä¸ªæ—¶é—´å•ä½çš„å¤§å°ã€‚TBN æŒ‡å®šäº†è§†é¢‘æµä¸­æ—¶é—´å•ä½çš„æ•°é‡ã€‚</p></li><li><p><strong>TBC è§£ç æ—¶é—´åŸºï¼ˆTime Base Denominatorï¼‰</strong>ï¼šTBC æ˜¯è§†é¢‘æµçš„æ—¶é—´åŸºçš„åˆ†æ¯éƒ¨åˆ†ï¼Œç”¨äºæŒ‡å®šè§†é¢‘è§£ç å™¨çš„æ—¶é—´å•ä½ã€‚TBC æŒ‡å®šäº†è§†é¢‘è§£ç å™¨ä½¿ç”¨çš„æ—¶é—´å•ä½ã€‚</p></li></ol><p>è¿™äº›æ¦‚å¿µä¹‹é—´çš„å…³ç³»æ˜¯ï¼š</p><ul><li>æ—¶é—´åŸºä¸ºå…¶ä»–æ—¶é—´ç›¸å…³å‚æ•°æä¾›äº†åŸºç¡€å•ä½ï¼Œæ¯”å¦‚ TBR å¸§ç‡ã€TBN æµçš„æ—¶é—´åŸºå’Œ TBC è§£ç æ—¶é—´åŸºã€‚</li><li>å°è£…æ ¼å¼ä¸­é€šå¸¸åŒ…å«äº†åª’ä½“æ•°æ®æµçš„æ—¶é—´åŸºä¿¡æ¯ï¼Œç¡®ä¿æ’­æ”¾å™¨èƒ½å¤Ÿæ­£ç¡®è§£é‡Šå’ŒåŒæ­¥éŸ³è§†é¢‘æ•°æ®ã€‚</li><li>TBR å¸§ç‡æ˜¯æ ¹æ®æ—¶é—´åŸºè®¡ç®—å¾—å‡ºçš„å®é™…å¸§ç‡ï¼Œç”¨äºç¡®ä¿è§†é¢‘æµçš„æ’­æ”¾é€Ÿåº¦ã€‚</li><li>TBN æµçš„æ—¶é—´åŸºå’Œ TBC è§£ç æ—¶é—´åŸºæ˜¯è§†é¢‘æµçš„æ—¶é—´åŸºçš„åˆ†å­å’Œåˆ†æ¯éƒ¨åˆ†ï¼Œåˆ†åˆ«æŒ‡å®šäº†è§†é¢‘æµä¸­æ—¶é—´å•ä½çš„å¤§å°å’Œè§£ç å™¨çš„æ—¶é—´å•ä½ã€‚</li></ul><p>ç»¼ä¸Šæ‰€è¿°ï¼Œæ—¶é—´åŸºã€å°è£…æ ¼å¼ã€TBR å¸§ç‡ã€TBN æµçš„æ—¶é—´åŸºå’Œ TBC è§£ç æ—¶é—´åŸºä¹‹é—´å¯†åˆ‡ç›¸å…³ï¼Œå…±åŒç¡®ä¿äº†åª’ä½“æ–‡ä»¶çš„æ­£ç¡®è§£æã€åŒæ­¥å’Œæ’­æ”¾ã€‚</p><p><img src="/assets/image-17-eEciIJZ4.png" alt="Alt text"></p><p>åœ¨FFmpegä¸­ï¼Œæ—¶é—´åŸºï¼ˆTime Baseï¼‰å’Œæ—¶é—´æˆ³ï¼ˆTimestampï¼‰æ˜¯ç”¨äºæè¿°åª’ä½“æ•°æ®æ—¶é—´ä¿¡æ¯çš„é‡è¦æ¦‚å¿µã€‚</p><ol><li><p><strong>æ—¶é—´åŸºï¼ˆTime Baseï¼‰</strong>ï¼šæ—¶é—´åŸºè¡¨ç¤ºåª’ä½“æ•°æ®ä¸­æ—¶é—´å•ä½çš„å¤§å°ï¼Œé€šå¸¸ä»¥åˆ†æ•°çš„å½¢å¼è¡¨ç¤ºã€‚å®ƒæè¿°äº†æ—¶é—´çš„åˆ»åº¦ï¼Œå³æ¯ä¸ªæ—¶é—´å•ä½çš„å¤§å°ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæ—¶é—´åŸºä¸º 1/1000 ç§’ï¼Œåˆ™è¡¨ç¤ºæ¯ä¸ªæ—¶é—´å•ä½æ˜¯æ¯«ç§’çº§åˆ«çš„ã€‚æ—¶é—´åŸºå®šä¹‰äº†åª’ä½“æ•°æ®çš„æ—¶é—´åˆ†è¾¨ç‡ã€‚</p></li><li><p><strong>æ—¶é—´æˆ³ï¼ˆTimestampï¼‰</strong>ï¼šæ—¶é—´æˆ³è¡¨ç¤ºç‰¹å®šåª’ä½“æ•°æ®å¸§æˆ–æ ·æœ¬çš„æ—¶é—´ä¿¡æ¯ã€‚å®ƒæ˜¯ä¸€ä¸ªä»¥æ—¶é—´åŸºä¸ºå•ä½çš„æ•´æ•°å€¼ï¼Œç”¨äºè¡¨ç¤ºç‰¹å®šå¸§æˆ–æ ·æœ¬åœ¨æ—¶é—´è½´ä¸Šçš„ä½ç½®ã€‚æ—¶é—´æˆ³å¯ä»¥æ˜¯ç›¸å¯¹æ—¶é—´ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹æ—¶é—´ã€‚åœ¨è§†é¢‘ä¸­ï¼Œæ—¶é—´æˆ³é€šå¸¸è¡¨ç¤ºæ¯ä¸ªè§†é¢‘å¸§çš„å‘ˆç°æ—¶é—´ï¼›åœ¨éŸ³é¢‘ä¸­ï¼Œæ—¶é—´æˆ³è¡¨ç¤ºæ¯ä¸ªéŸ³é¢‘æ ·æœ¬çš„å‘ˆç°æ—¶é—´ã€‚</p></li></ol><p>ä¸ºä»€ä¹ˆè¯´æ—¶é—´åŸºè¡¨ç¤ºæ—¶é—´åˆ»åº¦ï¼Œè€Œæ—¶é—´æˆ³è¡¨ç¤ºæœ‰å¤šå°‘ä¸ªæ—¶é—´åˆ»åº¦ï¼Œç›¸ä¹˜å°±æ˜¯æ—¶é•¿å‘¢ï¼Ÿ</p><ul><li><p><strong>æ—¶é—´åŸºè¡¨ç¤ºæ—¶é—´åˆ»åº¦</strong>ï¼šæ—¶é—´åŸºæè¿°äº†æ¯ä¸ªæ—¶é—´å•ä½çš„å¤§å°ï¼Œå®ƒæ˜¯æ—¶é—´çš„åˆ»åº¦ã€‚å°±åƒä¸€æŠŠå°ºå­ä¸Šçš„åˆ»åº¦ä¸€æ ·ï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬æ—¶é—´çš„å•ä½å¤§å°æ˜¯å¤šå°‘ï¼Œä½†ä¸æä¾›ä»»ä½•ç‰¹å®šæ—¶é—´ç‚¹çš„ä¿¡æ¯ã€‚</p></li><li><p><strong>æ—¶é—´æˆ³è¡¨ç¤ºæœ‰å¤šå°‘ä¸ªæ—¶é—´åˆ»åº¦</strong>ï¼šæ—¶é—´æˆ³æ˜¯ç‰¹å®šå¸§æˆ–æ ·æœ¬çš„æ—¶é—´ä¿¡æ¯ï¼Œå®ƒè¡¨ç¤ºäº†ä»åª’ä½“å¼€å§‹åˆ°è¯¥å¸§æˆ–æ ·æœ¬çš„æ—¶é—´è·ç¦»ã€‚è¿™ä¸ªè·ç¦»æ˜¯ä»¥æ—¶é—´åŸºä¸ºå•ä½çš„æ•´æ•°å€¼ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬å°†æ—¶é—´åŸºä¹˜ä»¥æ—¶é—´æˆ³çš„å€¼ï¼Œå°±å¯ä»¥å¾—åˆ°ä»åª’ä½“å¼€å§‹åˆ°è¯¥å¸§æˆ–æ ·æœ¬çš„æ—¶é•¿ã€‚ä¾‹å¦‚ï¼Œæ—¶é—´åŸºä¸º 1/1000 ç§’ï¼Œæ—¶é—´æˆ³ä¸º 500ï¼Œåˆ™è¡¨ç¤ºè¯¥å¸§æˆ–æ ·æœ¬è·ç¦»åª’ä½“å¼€å§‹çš„æ—¶é—´æ˜¯ 500 * (1/1000) = 0.5 ç§’ã€‚</p></li></ul><p>ç»¼ä¸Šæ‰€è¿°ï¼Œæ—¶é—´åŸºå’Œæ—¶é—´æˆ³åœ¨æè¿°åª’ä½“æ•°æ®æ—¶é—´ä¿¡æ¯æ—¶èµ·åˆ°äº†ä¸åŒçš„ä½œç”¨ï¼Œæ—¶é—´åŸºè¡¨ç¤ºæ—¶é—´çš„åˆ»åº¦ï¼Œè€Œæ—¶é—´æˆ³è¡¨ç¤ºå…·ä½“çš„æ—¶é—´è·ç¦»ï¼Œé€šè¿‡ä¸æ—¶é—´åŸºç›¸ä¹˜å¯ä»¥å¾—åˆ°æ—¶é—´çš„æ—¶é•¿ã€‚</p><p><img src="/assets/image-18-aRgmCPaT.png" alt="Alt text"></p><p><code>æ—¶é—´ = æ—¶é—´æˆ³ \* æ—¶é—´åŸº</code></p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &quot;libavutil/avutil.h&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     // å·¥å…·å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &quot;libavformat/avformat.h&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // å°è£…</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &quot;libavcodec/avcodec.h&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">   // ç¼–è§£ç å™¨</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> **</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  av_log_set_level</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(AV_LOG_DEBUG);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (argc </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;usage: </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;filename.mp4&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">]);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">  char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">inFileName </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // æ‰“å¼€è¾“å…¥</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // Open an input stream and read the header.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  AVFormatContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">format_ctx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  avformat_open_input</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">format_ctx, inFileName, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // è·å–æµä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // Read packets of a media file to get stream information.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  avformat_find_stream_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(format_ctx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // è¾“å‡ºå°è£…çš„inputçš„è¯¦ç»†ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // Print detailed information about the input or output format</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  av_dump_format</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(format_ctx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, inFileName, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  //  ffmpeg å†…éƒ¨æ—¶é—´åŸº</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_INFO, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;ffmpeg internal time base: </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> / </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%d</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">AV_TIME_BASE_Q</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">num</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">AV_TIME_BASE_Q</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">den</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // AV_TIME_BASE_Q è¡¨ç¤ºçš„æ˜¯æ—¶é—´åŸº,å€¼ä¸º 1/1000000 ç§’</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // æ—¶é—´åŸºxæ—¶é—´æˆ³=æ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_INFO, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;input format duration(timestamp):</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%lld</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">format_ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">duration</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                 // durationè¡¨å¾çš„æ˜¯æ—¶é—´æˆ³</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_INFO, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;input format duration(s):</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%lf</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">format_ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">duration</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_q2d</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(AV_TIME_BASE_Q));</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // av_q2då°†åˆ†æ•°è½¬æ¢æˆå°æ•°</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  for</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">uint8_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> idx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">; idx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> format_ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">nb_streams</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">; idx</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVStream </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">stream </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> format_ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">streams</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[idx];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codecpar</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codec_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> ==</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AVMEDIA_TYPE_VIDEO)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">      // è§†é¢‘æµçš„æ—¶é—´åŸº</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">      AVRational videoTimeBase </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> stream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">time_base</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">      av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_INFO, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;video stream time base: </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> / </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%d</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">videoTimeBase</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">num</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">videoTimeBase</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">den</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codecpar</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codec_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> ==</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AVMEDIA_TYPE_AUDIO)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">      // éŸ³é¢‘æµçš„æ—¶é—´åŸº</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">      AVRational audioTimeBase </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> stream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">time_base</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">      av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_INFO, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;audio stream time base: </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> / </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%d</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">audioTimeBase</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">num</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">audioTimeBase</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">den</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  AVPacket </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">packet </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_packet_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  while</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">av_read_frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(format_ctx, packet) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVStream </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">mediaStream </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> format_ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">streams</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">stream_index</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVRational streamTimeBase </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> mediaStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">time_base</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_INFO, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;stream index: </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%d</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">stream_index</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_INFO, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\t</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> stream time base: </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> / </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%d</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">streamTimeBase</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">num</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">streamTimeBase</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">den</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_INFO, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\t</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> packet ptsæ¸²æŸ“æ—¶é—´æˆ³: </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%lld</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">pts</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_INFO, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\t</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> packet ptsTimeæ¸²æŸ“æ—¶é—´: </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%lf</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">pts</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_q2d</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(streamTimeBase));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_INFO, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\t</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> packet dtsè§£ç æ—¶é—´æˆ³: </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%lld</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">dts</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_INFO, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\t</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> packet ptsTimeè§£ç æ—¶é—´: </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%lf</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">dts</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_q2d</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(streamTimeBase));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_INFO, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\t</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> packet durationæ—¶é—´æˆ³: </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%lld</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">duration</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_INFO, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\t</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> packet durationæ—¶é—´: </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%lf</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">duration</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_q2d</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(streamTimeBase));</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // é‡Šæ”¾bufferå†…å­˜</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_packet_unref</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(packet);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  av_packet_free</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">packet);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æˆªå–å°è£…" tabindex="-1"><a class="header-anchor" href="#æˆªå–å°è£…"><span>æˆªå–å°è£…</span></a></h2><p><img src="/assets/image-19-nKTvxPxh.png" alt="Alt text"></p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &quot;libavutil/avutil.h&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     // å·¥å…·å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &quot;libavformat/avformat.h&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // å°è£…</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &quot;libavcodec/avcodec.h&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">   // ç¼–è§£ç å™¨</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> **</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // è®¾ç½®logçº§åˆ«</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  av_log_set_level</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(AV_LOG_DEBUG);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // åˆ¤æ–­å‚æ•°ä¸ªæ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (argc </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;usage: </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;in_filename.mp4&gt; &lt;start_time_s&gt; &lt;end_time_s&gt; &lt;out_filename.mp4&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">]);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">  char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">inFileName </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">  char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">outFileName </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">  int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> startTimeS </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> atoi</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">]);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">  int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> endTimeS </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> atoi</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // æ‰“å¼€è¾“å…¥æµå¹¶è¯»å–å¤´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  AVFormatContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">inFmtCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // Open an input stream and read the header.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">  int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_open_input</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">inFmtCtx, inFileName, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avformat_open_input failed.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // è¯»å–æµçš„å¤´ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // Read packets of a media file to get stream information.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_find_stream_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(inFmtCtx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avformat_find_stream_info failed.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // Allocate an AVFormatContext for an output format</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  AVFormatContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">outFmtCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_alloc_output_context2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">outFmtCtx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, outFileName);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avformat_alloc_output_context2 failed.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // åˆ›å»ºæµåˆ°è¾“å‡ºæ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  for</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">uint8_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> idx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">; idx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> inFmtCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">nb_streams</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">; idx</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVStream </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">inStream </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> inFmtCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">streams</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[idx];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVStream </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">outStream </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_new_stream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(outFmtCtx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> //  Add a new stream to a media file.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // Copy the contents of src to dst.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_parameters_copy</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">outStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codecpar</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">inStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codecpar</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">      av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_parameters_copy failed.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">      return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    outStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codecpar</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codec_tag</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // æ£€æµ‹æ ‡å¿—ä½</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">outFmtCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">flags</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AVFMT_NOFILE)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;AVFMT_NOFILE flag is set in iformat/oformat.flags. In this a case, the (de)muxer will handle I/O in some other way and this field(outFmtCtx-&gt;pb) will be NULL.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // æ‰“å¼€è¾“å…¥ï¼ˆåˆ›å»ºè¾“å…¥è¾“å‡ºç¯å¢ƒAVIOContextï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avio_open</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">outFmtCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">pb</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, outFileName, AVIO_FLAG_WRITE);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avio_open failed.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // å†™å…¥æ–‡ä»¶å¤´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_write_header</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(outFmtCtx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avformat_write_header failed.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // å®šä½åˆ°å…³é”®å¸§</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // Seek to the keyframe at timestamp</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_seek_frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">      inFmtCtx,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                  // media file handle</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">      -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                        //  æµçš„id,-1ä¸ºé»˜è®¤æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">      startTimeS </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AV_TIME_BASE,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // æ—¶é—´æˆ³ï¼Œå¦‚æœæŒ‡å®šäº†å…·ä½“æµï¼Œåˆ™å¡«åŸºäºæµæ—¶é—´åŸºçš„æ—¶é—´æˆ³ï¼›å¦‚æœæœªæŒ‡å®šå…·ä½“æµï¼ˆ-1ï¼‰ï¼Œåˆ™å¡«åŸºäºAV_TIME_BASEæ—¶é—´åŸºçš„æ—¶é—´æˆ³</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">      AVSEEK_FLAG_ANY</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">            // seek to any frame, even non-keyframes</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  );</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;av_seek_frame failed.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // è®°å½•æµçš„å¼€å§‹æ—¶é—´æˆ³</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">  int</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> firstPTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">inFmtCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">nb_streams</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">  int</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> firstDTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">inFmtCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">nb_streams</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  memset</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(firstPTS, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(firstPTS));</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  memset</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(firstDTS, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(firstDTS));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  AVPacket </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">packet </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_packet_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  while</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">av_read_frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(inFmtCtx, packet) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVStream </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">inStream </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> inFmtCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">streams</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">stream_index</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVStream </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">outStream </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> outFmtCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">streams</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">stream_index</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // ptsæ¸²æŸ“æ—¶é—´æˆ³ x æµçš„æ—¶é—´åŸº = æ’­æ”¾æ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> curTimeS </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">pts</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_q2d</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">inStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">time_base</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (curTimeS </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> endTimeS)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">      break</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // è®°å½•æµçš„å¼€å§‹æ—¶é—´æˆ³</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">firstPTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">stream_index</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">      firstPTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">stream_index</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">pts</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">firstDTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">stream_index</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">      firstDTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">stream_index</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">dts</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // é‡æ–°è®¡ç®—æ¸²æŸ“æ—¶é—´æˆ³</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">pts</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_rescale_q</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">pts</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> firstPTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">stream_index</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">], </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">inStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">time_base</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">outStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">time_base</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">pts</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">      packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">pts</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // é‡æ–°è®¡ç®—è§£ç æ—¶é—´æˆ³</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">dts</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_rescale_q</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">dts</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> firstDTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">stream_index</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">], </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">inStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">time_base</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">outStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">time_base</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">dts</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">      packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">dts</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // é‡æ–°è®¡ç®—æ—¶é•¿</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">duration</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_rescale_q</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">duration</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">inStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">time_base</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">outStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">time_base</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // ä½ç½®ä½ç½®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">pos</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // ç”±äºI P B ä¸‰ä¸ªå¸§çš„å­˜åœ¨ï¼Œptså’Œdtsçš„å€¼å¯èƒ½ä¸ä¸€æ ·ï¼Œè¿™é‡Œæ ¹æ®æ—¶é—´èŒƒå›´æš´åŠ›æˆªå–packetæ—¶ï¼Œå¯èƒ½å¯¼è‡´pts&lt;dtsçš„æƒ…å†µå‘ç”Ÿï¼Œé‚£ä¹ˆåç»­çš„æ ¡éªŒä¼šä¸é€šè¿‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">pts</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> &lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">dts</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">      continue</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // å†™å…¥å°è£…</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // av_interleaved_write_frame ç›¸æ¯”äº write_packet å‰è€…ä¼šå¯¹ptsã€dtsã€stream_indexåšæ ¡éªŒï¼Œä¸”å‰è€…ä¾èµ–äºåè€…</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_interleaved_write_frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(outFmtCtx, packet);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">      av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;av_interleaved_write_frame failed.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">      return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // é‡Šæ”¾packetä¸­bufferå†…å­˜</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_packet_unref</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(packet);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // é‡Šæ”¾packetå†…å­˜</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  av_packet_free</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">packet);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // å†™æ–‡ä»¶å°¾</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // Write the stream trailer to an output media file and free the file private data</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  av_write_trailer</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(outFmtCtx);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // é‡Šæ”¾å†…å­˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (inFmtCtx)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    avformat_close_input</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">inFmtCtx);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (outFmtCtx)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    avio_close</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">outFmtCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">pb</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    avformat_close_input</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">outFmtCtx);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="rgbã€yuv" tabindex="-1"><a class="header-anchor" href="#rgbã€yuv"><span>RGBã€YUV</span></a></h2><p>ä¸‰åŸè‰²: çº¢ç»¿è“ä¸‰ç§è‰²å…‰æ— æ³•è¢«åˆ†è§£ï¼Œæ•…ç§°ä¸ºä¸‰åŸè‰²å…‰ï¼Œç­‰é‡çš„ä¸‰åŸè‰²å…‰ç›¸åŠ ä¼šå˜ä¸ºç™½å…‰ï¼Œå³ç™½å…‰ä¸­å«æœ‰ç­‰é‡çš„çº¢å…‰ (R) ã€ç»¿å…‰ (G) ã€è“å…‰ (B)ã€‚</p><p>æ˜¾ç¤ºå™¨: ä½¿ç”¨RGBä¸‰ç§é¢œè‰²çš„å‘å…‰ä½“ä½œä¸ºåŸºæœ¬å‘å…‰å•å…ƒï¼Œé€šè¿‡æ§åˆ¶å®ƒä»¬å‘å…‰å¼ºåº¦ä»è€Œå¾—åˆ°ä¸åŒè‰²å½©ã€‚</p><p>åˆ†è¾¨ç‡å«ä¹‰: æ‰‹æœºå±å¹•åˆ†è¾©æ˜¯1280x720ï¼Œè¯´æ˜æ°´å¹³æ–¹å‘æœ‰720ä¸ªåƒç´ ç‚¹ï¼Œå‚ç›´æ–¹å‘æœ‰1280ä¸ªåƒç´ ç‚¹ï¼Œæ‰€ä»¥æ•´ä¸ªæ‰‹æœºå±å¹•å°±æœ‰1280X720ä¸ªåƒç´ ç‚¹ã€‚</p><p>å¦‚å›¾ï¼Œæ¯ä¸ªåƒç´ ç‚¹éƒ½ç”±ä¸‰ä¸ªå­åƒç´ ç‚¹ç»„æˆï¼Œè®¡ç®—æœºä½¿ç”¨æ•°å­—çš„æ–¹å¼è¡¨è¾¾R G Bçš„å‘å…‰å¼ºåº¦æ•°å€¼ï¼Œè¿™å°±æ˜¯RGBæ ¼å¼ã€‚<br><img src="/assets/image-20-enIlnP4c.png" alt="Alt text"></p><h3 id="rgb" tabindex="-1"><a class="header-anchor" href="#rgb"><span>RGB</span></a></h3><p>è°ƒè‰²æ¿: é€šè¿‡ç¼–å·æ˜ å°„åˆ°é¢œè‰²çš„ä¸€å¼ äºŒç»´è¡¨ï¼Œå¦‚01ç´¢å¼•ï¼Œè¡¨ç¤ºçº¢è‰²ã€‚</p><p><strong>ç´¢å¼•æ ¼å¼:</strong></p><ul><li>RGB1:æ¯ä¸ªåƒç´ ç”¨1bitè¡¨ç¤ºï¼Œå¯è¡¨ç¤ºé¢œè‰²èŒƒå›´ä¸ºåŒè‰²ï¼Œå³é»‘å’Œç™½ï¼Œéœ€è¦ç”¨åˆ°è°ƒè‰²æ¿</li><li>RGB4:æ¯ä¸ªåƒç´ ç”¨4bitè¡¨ç¤ºï¼Œç´¢å¼•èŒƒå›´ä¸º0-16ï¼Œå…±16ä¸ªï¼Œè¡¨ç¤º16ç§é¢œè‰²ï¼Œéœ€è¦ç”¨åˆ°è°ƒè‰²æ¿ã€‚</li><li>RGB8:æ¯ä¸ªåƒç´ ç”¨8bitè¡¨ç¤ºï¼Œç´¢å¼•èŒƒå›´ä¸º0-255ï¼Œå…±256ä¸ªï¼Œè¡¨ç¤º256ç§é¢œè‰²ï¼Œéœ€è¦ç”¨åˆ°è°ƒè‰²æ¿ã€‚</li></ul><p>æ€»ç»“:å›¾åƒè´¨é‡ä¸é«˜ï¼Œä½†å å­˜å‚¨ç©ºé—´å°‘ï¼Œæ ¼å¼è¾ƒè€ï¼Œæ— æ³•æ»¡è¶³é«˜æ ‡å‡†çš„è§†è§‰ä½“éªŒéœ€æ±‚ã€‚</p><p><strong>åƒç´ æ ¼å¼ï¼š</strong></p><ul><li>å­˜å‚¨çš„æ˜¯æ¯ä¸€ä¸ªåƒç´ ç‚¹çš„RGBå€¼</li><li>RGB565 <ul><li>æ¯ä¸ªåƒç´ ç”¨16bitè¡¨ç¤ºï¼Œ2å­—èŠ‚ï¼ŒRGBåˆ†åˆ«ç”¨5 6 5ä¸ªbitè¡¨ç¤ºã€‚</li><li><img src="/assets/image-21-CeVhZUmC.png" alt="Alt text"></li></ul></li><li>RGB555: <ul><li>æ¯ä¸ªåƒç´ ç”¨16bitè¡¨ç¤ºï¼Œ2å­—èŠ‚ï¼ŒRGB åˆ†åˆ«ç”¨5 5 5ä¸ªbitè¡¨ç¤ºï¼Œæœ€é«˜ä½ä¸ç”¨ã€‚</li><li><img src="/assets/image-22-cIYYXvl4.png" alt="Alt text"></li></ul></li><li>RGB24: <ul><li>æ¯ä¸ªåƒç´ ç”¨24bitè¡¨ç¤ºï¼Œ3å­—èŠ‚ï¼ŒRGBåˆ†åˆ«ç”¨8 8 8ä¸ªbitè¡¨ç¤ºã€‚</li><li><strong>æ³¨æ„RGB24æ ¼å¼æŒ‰BGRçš„æ–¹å¼å­˜å‚¨</strong></li><li><img src="/assets/image-23-BUveD0no.png" alt="Alt text"></li></ul></li><li>RGB32ï¼š <ul><li>æ¯ä¸ªåƒç´ ç”¨32bitè¡¨ç¤ºï¼Œ4ä¸ªå­—èŠ‚ï¼ŒRï¼ŒGï¼ŒBåˆ†é‡åˆ†åˆ«ç”¨8 8 8ä¸ªbitè¡¨ç¤ºï¼Œå­˜å‚¨é¡ºåºä¸ºBï¼ŒGï¼ŒRï¼Œæœ€å8ä¸ªå­—èŠ‚ä¿ç•™ã€‚</li></ul></li><li>ARGB32 <ul><li>æ¯ä¸ªåƒç´ ç”¨32bitè¡¨ç¤ºï¼Œ4ä¸ªå­—èŠ‚ï¼ŒRï¼ŒGï¼ŒBåˆ†é‡åˆ†åˆ«ç”¨8 8 8ä¸ªbitè¡¨ç¤ºï¼Œå­˜å‚¨é¡ºåºä¸ºBï¼ŒGï¼ŒRï¼Œæœ€å8ä¸ªå­—èŠ‚æ˜¯A(alpha)é€šé“ï¼Œè¡¨ç¤ºé€æ˜åº¦ã€‚</li><li><img src="/assets/image-24-C0PpH3gE.png" alt="Alt text"></li></ul></li></ul><p><strong>ffmpegå‘½ä»¤å°†å›¾ç‰‡è½¬rgbæ•°æ®:</strong></p><blockquote><p>ffmpeg -i 200x200.png -s 200x200 -pix_fmt rgb24 rgb24.rgb</p></blockquote><p><strong>ffplayæ’­æ”¾:</strong></p><blockquote><p>ffplay -s 200*200 -pix_fmt rgb24 rgb24.rgb</p></blockquote><p><strong>å¤§å°è®¡ç®—:</strong><br> ä»¥RGB24ä¸ºä¾‹: 200<em>200</em>3=120000 byte</p><h3 id="yuv" tabindex="-1"><a class="header-anchor" href="#yuv"><span>YUV</span></a></h3><p><strong>YUVæ¦‚å¿µ</strong></p><ul><li>YUVï¼ˆä¹Ÿç§°YCbCrï¼‰æ˜¯ç”µè§†ç³»ç»Ÿæ‰€é‡‡ç”¨çš„ä¸€ç§é¢œè‰²ç¼–ç æ–¹æ³•ã€‚</li><li>å…¶ä¸­&quot;Yâ€è¡¨ç¤ºæ˜äº®åº¦(Luminance)ï¼Œä¹Ÿç§°ç°é˜¶å€¼ï¼Œå®ƒæ˜¯åŸºç¡€ä¿¡å·;</li><li>è€ŒUå’ŒVè¡¨ç¤ºçš„åˆ™æ˜¯è‰²åº¦(Chrominance),å®ƒä»¬çš„ä½œç”¨æ˜¯æè¿°å½±åƒçš„è‰²å½©åŠé¥±å’Œåº¦ï¼Œç”¨äºæŒ‡å®šåƒç´ çš„é¢œè‰²ï¼›</li><li>äº®åº¦å’Œè‰²åº¦éƒ½æ˜¯è¢«æ­£äº¤è°ƒåˆ¶çš„ã€‚</li><li><strong>äº®åº¦Y</strong>æ˜¯é€šè¿‡RGBè¾“å…¥ä¿¡å·æ¥å»ºç«‹çš„ï¼Œæ–¹æ³•æ˜¯å°† RGBä¿¡å·çš„ç‰¹å®šéƒ¨åˆ†å åŠ åˆ°ä¸€èµ·ã€‚</li><li><strong>è‰²åº¦UV</strong>åˆ™å®šä¹‰äº†é¢œè‰²çš„è‰²è°ƒä¸é¥±å’Œåº¦ï¼Œåˆ†åˆ«ç”¨Crå’ŒCbæ¥è¡¨ç¤ºã€‚ <ul><li>å…¶ä¸­ï¼ŒCråæ˜ äº†RGBè¾“å…¥ä¿¡å·çº¢è‰²éƒ¨åˆ†ä¸RGBä¿¡å·äº®åº¦å€¼ä¹‹é—´çš„å·®å¼‚ï¼Œ</li><li>è€ŒCbåæ˜ çš„åˆ™æ˜¯RGBè¾“å…¥ä¿¡å·è“è‰²éƒ¨åˆ†ä¸RGBä¿¡å·äº®åº¦å€¼ä¹‹é—´çš„å·®å¼‚ã€‚</li></ul></li><li>ä¸RGBç±»å‹ï¼Œä¸€å¹…å›¾åƒçš„æ¯ä¸ªåƒç´ ç‚¹ç”±YUVä¸‰ä¸ªåˆ†é‡æ„æˆã€‚</li><li><strong>UVå¹³é¢ï¼ˆY=0.5ï¼‰ï¼š</strong></li><li><img src="/assets/image-25-C7zY5zue.png" alt="Alt text"></li><li><strong>é‡‡æ ·æ ¼å¼</strong><ul><li>4:4:4è¡¨ç¤ºå®Œå…¨å–æ ·ã€‚</li><li>4:2:2è¡¨ç¤º2:1çš„æ°´å¹³å–æ ·ï¼Œå‚ç›´å®Œå…¨é‡‡æ ·ã€‚</li><li>4:2:0è¡¨ç¤º2:1çš„æ°´å¹³å–æ ·ï¼Œå‚ç›´2:1é‡‡æ ·ã€‚</li></ul></li><li><strong>å­˜å‚¨æ ¼å¼</strong><ul><li>planner(å¹³é¢)æ ¼å¼:å…ˆè¿ç»­å­˜å‚¨æ‰€æœ‰åƒç´ ç‚¹çš„Yåˆ†é‡ï¼Œç´§æ¥ç€å­˜å‚¨æ‰€æœ‰åƒç´ ç‚¹çš„Uåˆ†é‡ï¼Œæœ€åæ˜¯æ‰€æœ‰åƒç´ ç‚¹çš„Våˆ†é‡ã€‚</li><li>packed(æ‰“åŒ…)æ ¼å¼:æ¯ä¸ªåƒç´ ç‚¹çš„Yã€Uã€Væ˜¯è¿ç»­äº¤æ›¿å­˜å‚¨çš„ã€‚</li><li>YUV420Pä¸­çš„Yã€Uã€Våˆ†é‡éƒ½æ˜¯å¹³é¢æ ¼å¼</li><li><img src="/assets/image-34-vL_Bt3Ex.png" alt="Alt text"></li><li>YUV420SPä¸­çš„Yåˆ†é‡ä¸ºå¹³é¢æ ¼å¼ï¼ŒUVåˆ†é‡ä¸ºæ‰“åŒ…æ ¼å¼ï¼Œå³Uå’ŒVåˆ†é‡äº¤é”™æ’åˆ—ã€‚</li><li><img src="/assets/image-33-B3rdfJqh.png" alt="Alt text"></li></ul></li></ul><p>æŠŠäº®åº¦å’Œè‰²åº¦åˆ†ç¦»ï¼Œæ²¡æœ‰è‰²åº¦ä¿¡æ¯ä»èƒ½æ˜¾ç¤ºå®Œæ•´çš„å›¾åƒï¼Œåªä¸è¿‡æ˜¯é»‘ç™½çš„ï¼Œè§£å†³äº†å½©è‰²ç”µè§†è·Ÿé»‘ç™½ç”µè§†çš„å…¼å®¹é—®é¢˜ã€‚<br> ä¸RGBè§†é¢‘ä¿¡å·ä¼ è¾“ç›¸æ¯”ï¼Œå®ƒæœ€å¤§çš„ä¼˜ç‚¹åœ¨äºåªéœ€è¦å ç”¨æå°‘çš„é¢‘å®½(RGBè¦æ±‚3ä¸ªç‹¬ç«‹çš„é¢œè‰²åˆ†é‡åŒæ—¶ä¼ è¾“)ã€‚</p><p><strong>RGBåˆ°YCbCrçš„è½¬æ¢è¿‡ç¨‹ï¼š</strong></p><ul><li>æ‘„åƒæœºä»å›¾åƒä¼ æ„Ÿå™¨æ¥æ”¶å…‰çº¿ç”ŸæˆRGBå›¾åƒã€‚</li><li>RGBå›¾åƒè¢«ç¼–ç æˆYCbCrä¿¡å·ï¼Œè¿™æ˜¯è®°å½•å’Œä¼ è¾“åˆ°è§‚çœ‹è®¾å¤‡çš„ä¿¡å·ã€‚</li><li>æ˜¾ç¤ºè®¾å¤‡ï¼ˆç”µè„‘ã€ç”µè§†æœºæˆ–æ˜¾ç¤ºå™¨ï¼‰å¯¹YCbCrä¿¡å·è¿›è¡Œè§£ç ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºRGBä¿¡å·ä»¥è¿›è¡Œæ˜¾ç¤ºã€‚<br> ç”±äºåŸå§‹å›¾åƒæ•°æ®å’Œæ˜¾ç¤ºçš„å›¾åƒéƒ½ä½¿ç”¨RGBæ ¼å¼ï¼Œé€šå¸¸æˆ‘ä»¬ä¸éœ€è¦è¿‡å¤šå…³æ³¨YCbCrä¿¡å·ã€‚</li></ul><p><strong>ç¼–ç RGBâ€œ4:2:2â€å’Œâ€œ4:2:0â€ï¼š</strong></p><ul><li>è‰²åº¦çš„å­é‡‡æ ·å’Œæ•°æ®å‹ç¼©å¯¹äºäººç±»æ¥è¯´ï¼Œäº®åº¦çš„å˜åŒ–æ¯”é¢œè‰²çš„å·®å¼‚æ›´ä¸ºæ˜¾è€Œæ˜“è§ã€‚</li><li>è‰²åº¦ï¼ˆé¢œè‰²ï¼‰å­é‡‡æ ·æ˜¯ä¸€ç§æ–¹æ³•ï¼Œé€šè¿‡å°†RGBæ–‡ä»¶è½¬æ¢ä¸ºYCbCrä¿¡å·ï¼Œå¯ä»¥å‡å°‘é¢œè‰²ä¿¡æ¯ï¼Œä»è€Œç¼©å°æ•°æ®æ–‡ä»¶ã€‚</li><li>4:2:2å’Œ4:2:0æŒ‡çš„æ˜¯è‰²åº¦å­é‡‡æ ·çš„ä¸åŒæ–¹æ³•ã€‚</li></ul><p><strong>å…¶å¦‚ä½•è¿ä½œï¼Ÿ</strong></p><ul><li>è‰²å½©é‡‡æ ·åœ¨4Ã—2ä¸ªé˜µåˆ—ä¸­æ¯8ä¸ªåƒç´ å‘ç”Ÿä¸€æ¬¡ã€‚</li><li>4åˆ—åƒç´ çš„äº®åº¦ï¼ˆYï¼‰é€šé“è¢«è®°å½•ä¸‹æ¥ï¼Œå› æ­¤ç¬¬ä¸€ä¸ªæ•°å­—æ˜¯4ã€‚</li><li>ç¬¬äºŒä¸ªæ•°å­—è¡¨ç¤ºä»ç¬¬ä¸€è¡Œåƒç´ è®°å½•çš„è‰²å·®ä¿¡å·ï¼ˆCbCrï¼‰æ•°é‡ã€‚</li><li>ç¬¬ä¸‰ä¸ªæ•°å­—è¡¨ç¤ºä»ç¬¬äºŒè¡Œåƒç´ è®°å½•çš„è‰²å·®ä¿¡å·ï¼ˆCbCrï¼‰æ•°é‡ã€‚</li></ul><p><strong>æœªå‹ç¼©çš„YCbCr 4:4:4</strong></p><ul><li><img src="/assets/image-35-DdxawQDy.png" alt="Alt text"></li><li>å½“æ‰€æœ‰åƒç´ çš„CbCrä¿¡æ¯éƒ½è¢«è®°å½•ä¸‹æ¥æ—¶ï¼ˆæ— æœªé‡‡æ ·çš„åƒç´ ï¼‰ï¼Œè‰²åº¦å­é‡‡æ ·å³å¯è¢«æ ‡ç¤ºä¸º4:4:4ï¼ˆæ— å­é‡‡æ ·ï¼‰ã€‚è¿™å¯æä¾›æœ€é«˜å“è´¨ - RAWæ–‡ä»¶ç­‰åŒ4:4:4ã€‚ç„¶è€Œï¼Œå…¶ä¹Ÿå¯èƒ½å¯¼è‡´æ–‡ä»¶å¤§å°å¢åŠ ã€‚</li><li>æ–‡ä»¶å°ºå¯¸è¾ƒå°æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæŸè€—ä¸€äº›é¢œè‰²ä¿¡æ¯ï¼Œæ‰èƒ½å‹ç¼©æ–‡ä»¶ã€‚ä¸€ç§æ–¹æ³•æ˜¯åˆ©ç”¨å­é‡‡æ ·ï¼Œå³ä¸è®°å½•æŸäº›åƒç´ çš„ä¿¡æ¯ã€‚</li></ul><p><strong>å‹ç¼©çš„YUV</strong></p><ul><li><img src="/assets/image-36-QIBP_nGy.png" alt="Alt text"></li><li><code>YCbCr 4:2:2</code> å­é‡‡æ ·:åœ¨æ¯ä¸ªåƒç´ è¡Œä¸­ï¼Œåªæœ‰ä¸¤ä¸ªåƒç´ çš„CbCrä¿¡å·è¢«è®°å½•ä¸‹æ¥ã€‚</li><li><code>YCbCr 4:2:0</code> å­é‡‡æ ·:é’ˆå¯¹æœ€ä¸Šé¢ä¸€è¡Œï¼Œåªè®°å½•ä¸¤ä¸ªåƒç´ çš„CbCrä¿¡å·ã€‚ç¬¬äºŒè¡Œåƒç´ å¹¶æœªè®°å½•CbCrä¿¡å·ã€‚</li><li><strong>è§£ç </strong> å½“ä¿¡å·è¢«è§£ç æˆRGBä»¥ä¾¿æ˜¾ç¤ºåœ¨æ˜¾ç¤ºå™¨ä¸Šæ—¶ï¼Œæ²¡æœ‰CbCrè®°å½•çš„åƒç´ å·¦è¾¹ã€å·¦ä¸Šæ–¹å’Œ/æˆ–ä¸Šæ–¹çš„CbCrä¿¡æ¯è¢«å¤åˆ¶åˆ°è¯¥åƒç´ ã€‚</li><li>ç”±äºäººç±»å¯¹é¢œè‰²å·®å¼‚çš„è§†è§‰æ„ŸçŸ¥èƒ½åŠ›ç›¸å¯¹è¾ƒå·®ï¼Œå› æ­¤å¤§å¤šæ•°äººé€šå¸¸ä¸ä¼šæ³¨æ„åˆ°æœªè®°å½•çš„åƒç´ ä¿¡æ¯æ‰€å¯¼è‡´çš„å›¾åƒè´¨é‡ä¸‹é™é—®é¢˜ã€‚ç¼©å‡æ‰€è¦è®°å½•çš„ä¿¡æ¯ï¼Œæœ‰åŠ©äºç¼©å‡æ•°æ®é‡ã€‚</li></ul><p><strong>4:2:0å’Œ4:2:2ä¹‹é—´æœ‰ä½•åŒºåˆ«ï¼Ÿ</strong></p><p>æ­£å¦‚ä¸Šæ–¹æ’å›¾æ‰€ç¤ºï¼Œ4:2:2æ¯”4:2:0è®°å½•æ›´å¤šè‰²å½©ä¿¡æ¯ã€‚</p><p>ç›®å‰ï¼Œç”µè§†æœºã€DVD/è“å…‰æ ¼å¼ï¼Œä»¥åŠå…¶ä»–å¤§å¤šæ•°è§†å¬å’Œå›¾åƒæ˜¾ç¤ºè£…ç½®éƒ½ä½¿ç”¨YCbCr 4:2:0ä¿¡å·ã€‚æ­£å¸¸è§‚çœ‹ç”»é¢æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½ä¸ä¼šè§‰å¾—4:2:0ä¿¡å·çš„å›¾åƒè´¨é‡è¾ƒå·®ã€‚</p><p>ç„¶è€Œï¼Œåœ¨å½±ç‰‡çš„åˆ¶ä½œè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä»é¡»ç¡®ä¿å½±ç‰‡å°½å¯èƒ½è¾¾åˆ°é«˜å“è´¨ã€‚å½“ç„¶ï¼Œç”±äºè®°å½•åŒ…å«å„ä¸ªåƒç´ çš„YCbCræ•°æ®ï¼Œå› æ­¤4:4:4æä¾›äº†æœ€é«˜çš„å“è´¨ - è¿™å°±æ˜¯RAWæ•°æ®çš„ç‰¹ç‚¹ã€‚ä½†è¿™æ ·åšçš„ç¼ºç‚¹å´æ˜¯æ–‡ä»¶ä½“ç§¯å¢å¤§ï¼Œè¿™åœ¨æŸäº›åˆ¶ä½œæƒ…å†µä¸‹æ˜¯ä¸å¯è¡Œçš„ã€‚</p><p>è¿™æ­£æ˜¯å­é‡‡æ ·å¯ä»¥å‘æŒ¥ä½œç”¨ä¹‹å¤„ã€‚4:2:0çš„å­é‡‡æ ·æä¾›äº†æœ€è½»å·§çš„æ–‡ä»¶ï¼Œä½†è‰²å½©ä¿¡æ¯å‡å°‘å´ç»™åæœŸç¼–è¾‘æä¾›äº†è¾ƒå°‘çš„ä½™åœ°ã€‚åŒæ—¶ï¼Œ4:2:2ç¼©å‡äº†æ–‡ä»¶å¤§å°ï¼ŒåŒæ—¶å‚¨å­˜äº†æ›´å¤šçš„è‰²å½©ä¿¡æ¯ã€‚è¿™ä¸ä»…è®©ç¼–è¾‘æœ‰æ›´å¤šçš„å¼¹æ€§ï¼Œæ›´èƒ½åœ¨è°ƒè‰²åä¿æŒå›¾åƒæé«˜çš„å“è´¨ã€‚</p><p><strong>YUV4:4:4</strong></p><ul><li>YUVä¸‰ä¸ªä¿¡é“çš„æŠ½æ ·ç‡ç›¸åŒï¼Œåœ¨ç”Ÿæˆçš„å›¾åƒä¸­ï¼Œæ¯ä¸ªåƒç´ å ç”¨3å­—èŠ‚ï¼Œæ¯ä¸€ä¸ªYåˆ†é‡éƒ½å¯¹åº”ä¸€ç»„UVåˆ†é‡ã€‚</li><li>è¿™ç§æ ¼å¼ï¼Œè‰²åº¦ä¿¡å·çš„åˆ†è¾¨ç‡å’Œäº®åº¦ä¿¡å·çš„åˆ†è¾¨ç‡æ˜¯ç›¸åŒçš„ã€‚è¿™ç§æ ¼å¼ä¸»è¦åº”ç”¨åœ¨è§†é¢‘å¤„ç†è®¾å¤‡å†…éƒ¨ï¼Œé¿å…ç”»é¢è´¨é‡åœ¨å¤„ç†è¿‡ç¨‹ä¸­é™ä½ã€‚</li><li>ç©ºå¿ƒåœ†è¡¨ç¤ºæ‰€é‡‡æ ·é¢œè‰²çš„UVåˆ†é‡ï¼Œé»‘ç‚¹è¡¨ç¤ºæ‰€é‡‡æ ·é¢œè‰²çš„Yåˆ†é‡ã€‚</li><li><img src="/assets/image-28-CsymLX26.png" alt="Alt text"></li><li>YUV444æ˜¯è‰²åº¦ä¿¡å·åˆ†è¾¨ç‡æœ€é«˜çš„æ ¼å¼ï¼Œ444æ„æ€æ˜¯æ¯1ç‚¹ Y é‡‡æ ·ç›¸å¯¹åº”çš„1ä¸ª U é‡‡æ ·å’Œ1ä¸ª V é‡‡æ ·ã€‚</li><li><img src="/assets/image-29-C6GBp-Dq.png" alt="Alt text"></li><li>å…¬å¼(NTSCæ ‡å‡†): <ul><li><img src="/assets/image-26-SruUoIQP.png" alt="Alt text"></li><li><img src="/assets/image-27-BeLWtWZa.png" alt="Alt text"></li></ul></li></ul><p><strong>YUV4:2:2</strong></p><ul><li>æ¯ä¸ªUVä¿¡é“çš„æŠ½æ ·ç‡æ˜¯Yçš„ä¸€åŠï¼Œåœ¨ç”Ÿæˆçš„å›¾åƒä¸­ï¼Œæ¯ä¸ªç”±ä¸¤ä¸ªæ°´å¹³æ–¹å‘ç›¸é‚»çš„åƒç´ ç»„æˆçš„å®åƒç´ å ç”¨4å­—èŠ‚ã€‚æ¯ä¸¤ä¸ªYåˆ†é‡å…±ç”¨ä¸€ç»„UVåˆ†é‡ã€‚</li><li><img src="/assets/image-31-CBFpu5hS.png" alt="Alt text"></li></ul><p><strong>YUV4:2:0</strong></p><ul><li>æ¯ä¸ªè‰²åº¦åˆ†é‡ï¼Œ<strong>æ°´å¹³æ–¹å‘å’Œç«–ç›´æ–¹å‘çš„æŠ½æ ·ç‡éƒ½æ˜¯2:1ï¼Œè‰²åº¦çš„æŠ½æ ·ç‡ä¸º4:1</strong>ï¼Œå³æ¯éš”ä¸€ä¸ªåƒç´ é‡‡æ ·ä¸€æ¬¡ã€‚åŒæ—¶ï¼Œæ°´å¹³æ–¹å‘ä¸Šè‰²åº¦åˆ†é‡çš„æŠ½æ ·ç‡ä¸º1/4ï¼Œå³æ¯éš”å››ä¸ªåƒç´ é‡‡æ ·ä¸€æ¬¡ã€‚æ¯ä¸ªç”±2x2ä¸ª2è¡Œ2åˆ—ç›¸é‚»çš„åƒç´ ç»„æˆçš„å®åƒç´ éœ€è¦å ç”¨6å­—èŠ‚å†…å­˜ï¼Œæ¯å››ä¸ªYåˆ†é‡å…±ç”¨ä¸€ç»„UVåˆ†é‡ã€‚</li><li><img src="/assets/image-32-Cjpaf6A_.png" alt="Alt text"></li><li>420è¡¨ç¤ºæ¯4ç‚¹ Y é‡‡æ ·ç›¸å¯¹åº”çš„1ä¸ª U é‡‡æ ·å’Œ1ä¸ª V é‡‡æ ·ï¼Œå…·ä½“æƒ…å†µå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</li><li><img src="/assets/image-30-oibcU7zT.png" alt="Alt text"></li></ul><p><strong>å¤§å°è®¡ç®—</strong></p><ul><li>RGB24:ä¸€å¼ 4x4åƒç´ çš„RGBå›¾åƒå¤§å°ä¸º4x4x3=48å­—èŠ‚ã€‚</li><li>YUV444:ä¸€å¼ 4x4åƒç´ çš„YUV444å›¾åƒå¤§å°ä¸º4x4x3=48å­—èŠ‚ï¼Œè·ŸRGBä¸€æ ·å¤§ã€‚Yã€UVä¸‰ä¸ªåˆ†é‡çš„å¤§å°éƒ½æ˜¯4x4=16å­—èŠ‚ã€‚</li><li>YUV422:ä¸€å¼ 4x4åƒç´ çš„YUV422å›¾åƒå¤§å°ä¸º4x4x2=32å­—èŠ‚ï¼ŒYåˆ†é‡ä¸ºå…¨é‡‡æ ·ï¼Œå³4x4=16å­—èŠ‚ï¼ŒUåˆ†é‡å’ŒVåˆ†é‡åªæœ‰Yåˆ†é‡çš„ä¸€åŠï¼Œå³Uåˆ†é‡ä¸º4x4/2=8å­—èŠ‚ï¼ŒVåˆ†é‡ä¹Ÿæ˜¯4x4/2=8å­—èŠ‚ã€‚</li><li>YUV420:ä¸€å¼ 4x4åƒç´ çš„YUV420å›¾åƒå¤§å°ä¸º4x4x(3/2)=24å­—èŠ‚ï¼ŒYåˆ†é‡ä¸ºå…¨é‡‡æ ·å³4x4=16å­—èŠ‚ï¼ŒUåˆ†é‡å’ŒVåˆ†é‡åªæœ‰Yåˆ†é‡çš„å››åˆ†ä¹‹ä¸€ï¼Œå³Uåˆ†é‡å’ŒVåˆ†é‡çš„å¤§å°å‡ä¸º4x4/4=4å­—èŠ‚ã€‚</li></ul><p><strong>ffmpegå‘½ä»¤å°†å›¾ç‰‡è½¬yuvæ•°æ®:</strong></p><p>ffmpeg -i 200x200.png -s 200x200 -pix_fmt yuv420p yuv420p.yuv</p><p><strong>YUV Player æ’­æ”¾å™¨æ’­æ”¾:</strong></p><p>å¤§å°è®¡ç®—:</p><p>ä»¥YUV420Pä¸ºä¾‹:200<em>200</em>3/2=60000byte</p><h2 id="è§†é¢‘è§£ç " tabindex="-1"><a class="header-anchor" href="#è§†é¢‘è§£ç "><span>è§†é¢‘è§£ç </span></a></h2><p><img src="/assets/image-37-DyZ_7DRm.png" alt="Alt text"></p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavformat\avformat.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // è§£å°è£…</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavutil\avutil.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     // æ—¥å¿—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavcodec\avcodec.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">   // ç¼–è§£ç </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">AVFormatContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">inputFmtCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">FILE </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">destFile </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">AVCodecContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">decoderCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (inputFmtCtx)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        avformat_close_input</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">inputFmtCtx);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (destFile)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        fclose</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(destFile);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (decoderCtx)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        avcodec_free_context</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">decoderCtx);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ret;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> avc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">[]</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // è®¾ç½®æ—¥å¿—çº§åˆ«</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log_set_level</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(AV_LOG_INFO);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ‰“å°ç”¨æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (avc </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_INFO, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;usage:</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;inFileName.mp4&gt; &lt;outFileName.yuv&gt;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">]);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">inFileName </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">outFileName </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ‰“å¼€è¾“å…¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ((ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_open_input</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">inputFmtCtx, inFileName, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avformat_open_input failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // åˆ›å»ºè¾“å‡ºæ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    destFile </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> fopen</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(outFileName, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;wb&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (destFile </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;fopene failed.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ¢æµ‹æµä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ((ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_find_stream_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(inputFmtCtx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avformat_find_stream_info failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // å¾—åˆ°è§†é¢‘æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> videoIdx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_find_best_stream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(inputFmtCtx, AVMEDIA_TYPE_VIDEO, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (videoIdx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;av_find_best_stream failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // å¾—åˆ°ç¼–è§£ç ä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ((decoderCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_alloc_context3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_alloc_context3 failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // å°†è§†é¢‘æµç¼–è§£ç å™¨ä¿¡æ¯æ‹·è´åˆ°ç¼–è§£ç ä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ((ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_parameters_to_context</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">inputFmtCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">streams</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[videoIdx]-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codecpar</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_parameters_to_context failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ ¹æ®ç¼–è§£ç å™¨idè·å–è§£ç å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AVCodec </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">videoDecoder </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_find_decoder</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codec_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (videoDecoder </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_find_decoder failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // ä½¿ç”¨ ç¼–è§£ç å™¨ åˆå§‹åŒ– ç¼–è§£ç å™¨çš„ä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ((ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_open2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, videoDecoder, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_open2 failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // è¯»å–æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVPacket </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">packet </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_packet_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">frame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_frame_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> render_process</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(AVCodecContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> decoderCtx, AVPacket </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> packet, AVFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> frame, FILE </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> destFile);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">av_read_frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(inputFmtCtx, packet) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // å¦‚æœæ˜¯è§†é¢‘æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">stream_index</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> ==</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> videoIdx)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">            // æŠŠpacketå‘é€ç»™è§£ç å™¨å¾—åˆ°YUVå¸§</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">render_process</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, packet, frame, destFile) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">                av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;render_process failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_packet_unref</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(packet);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // å†æ¬¡æŠŠpacketå‘é€ç»™è§£ç å™¨å¾—åˆ°YUVå¸§</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // ï¼ˆè¿™é‡Œæ˜¯ä¸ºäº†é˜²æ­¢ptså’Œdtsçš„åŸå› å¯¼è‡´è§£ç å™¨ä¸­è¿˜æœ‰YUVå¸§æ²¡æœ‰å–å‡ºï¼Œæ‰€ä»¥å‘é€packet=NULL,ç„¶åå†è¯»Frameï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // å¦‚æœä¸è¿™ä¹ˆåšï¼Œå¯èƒ½å¯¼è‡´æœ€åå°‘å‡ å¸§</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">render_process</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, frame, destFile) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;render_process failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_packet_free</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">packet);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_frame_free</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">frame);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> render_process</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(AVCodecContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AVPacket </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AVFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, FILE </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">destFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     * avcodec_send_packet:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     * packet can be NULL (or an AVPacket with data set to NULL and</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     * size set to 0); in this case, it is considered a flush</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     * packet, which signals the end of the stream.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // å°†æ•°æ®å‘é€ç»™è§£ç å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ((ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_send_packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, packet)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_send_packet failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ¥æ”¶è§£ç å™¨è§£ç åçš„æ•°æ®frame</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">avcodec_receive_frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, frame) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // YUV420</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // Y</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // ã€Y Y Y Yã€‘</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // ã€Y Y Y Yã€‘</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // U</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // ã€U 0 U 0ã€‘</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // ã€0 0 0 0ã€‘</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // V</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // ã€V 0 V 0ã€‘</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // ã€0 0 0 0ã€‘</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // å†™æ³•1ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // data[0]è¡¨ç¤ºYæ•°æ®ï¼Œé€šè¿‡ decoderCtx-&gt;width * decoderCtx-&gt;height è®¡ç®—æ•°æ®çš„é•¿åº¦</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // è¿™é‡Œçš„é—®é¢˜åœ¨äºè§£ç å™¨å’ŒCPUå¯èƒ½ä¼šä¼˜åŒ–ï¼Œå¯¼è‡´frame-&gt;data[0]æ•°æ®çš„å®½åº¦å’ŒdecoderCtx-&gt;widthä¸ä¸€è‡´ï¼Œæœ‰å¤šä½™çš„æ— ç”¨æ•°æ®ï¼Œä½¿å¾—æ— æ³•æ­£å¸¸æ’­æ”¾</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // fwrite(frame-&gt;data[0], 1, decoderCtx-&gt;width * decoderCtx-&gt;height, destFile);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // fwrite(frame-&gt;data[1], 1, decoderCtx-&gt;width * decoderCtx-&gt;height / 4, destFile);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // fwrite(frame-&gt;data[2], 1, decoderCtx-&gt;width * decoderCtx-&gt;height / 4, destFile);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // å†™æ³•2:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // data[0]è¡¨ç¤ºYæ•°æ®ï¼Œé€šè¿‡ frame-&gt;linesize[0] * decoderCtx-&gt;height è®¡ç®—æ•°æ®çš„é•¿åº¦</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // è¿™é‡Œçš„é—®é¢˜åœ¨äºè§£ç å™¨å’ŒCPUå¯èƒ½ä¼šä¼˜åŒ–ï¼Œframe-&gt;linesize[0]æ¯”å®é™…å®½åº¦å¤§ã€dataä¸­ä¹Ÿæœ‰å¤šä½™çš„æ— ç”¨æ•°æ®ï¼Œå¦‚æœä¸èƒ½æ­£ç¡®æŒ‡å®šå®½é«˜ï¼Œè§†é¢‘å°†æ— æ³•æ­£å¸¸æ’­æ”¾</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        fwrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">], </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">linesize</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, destFile);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // Y</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        fwrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">], </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">linesize</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">height</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, destFile);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // U</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        fwrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">], </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">linesize</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">height</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, destFile);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // V</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // è¾“å‡ºå®é™…å®½é«˜</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_INFO, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;w:</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">,h:</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">width</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">       // 480x270</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_INFO, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;w:</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">,h:</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">linesize</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">], </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // 512x270</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // æ’­æ”¾æ—¶è¦æŒ‡å®šå®½åº¦ä¸ºï¼š512x270 è€Œä¸æ˜¯å®é™…å®½åº¦480x270,å¦åˆ™ä¸èƒ½æ­£å¸¸æ’­æ”¾</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // $ ffplay -f rawvideo -video_size 512x270 -pixel_format yuv420p file.yuv</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_frame_unref</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(frame);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å­˜åœ¨é—®é¢˜</strong></p><ul><li>è§£ç å™¨å’ŒCPUå¯èƒ½ä¼šä¼˜åŒ–</li><li>å¯¼è‡´frame-&gt;data[0]æ•°æ®çš„å®½åº¦å’ŒdecoderCtx-&gt;widthä¸ä¸€è‡´ï¼Œæœ‰å¤šä½™çš„æ— ç”¨æ•°æ®ï¼Œä½¿å¾—æ— æ³•æ­£å¸¸æ’­æ”¾</li><li>å®é™…å®½åº¦480x270çš„è§†é¢‘è¢«ä¼˜åŒ–æˆäº†512x270</li><li><img src="/assets/image-38-BbwfFWC0.png" alt="Alt text"></li></ul><h2 id="ä¿®æ”¹åˆ†è¾¨ç‡" tabindex="-1"><a class="header-anchor" href="#ä¿®æ”¹åˆ†è¾¨ç‡"><span>ä¿®æ”¹åˆ†è¾¨ç‡</span></a></h2><p><img src="/assets/image-39-BR-wQD83.png" alt="Alt text"><br><img src="/assets/image-40-LU2-N4cy.png" alt="Alt text"><br><img src="/assets/image-41-L9j-Wglo.png" alt="Alt text"></p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavformat\avformat.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // è§£å°è£…</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavutil\avutil.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     // æ—¥å¿—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavutil\parseutils.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // è§£æå­—ç¬¦ä¸²</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavutil\imgutils.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">   // è®¡ç®—è§†é¢‘å¤§å°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavcodec\avcodec.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">   // ç¼–è§£ç </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libswscale\swscale.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">   // è§†é¢‘ç¼©æ”¾</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">AVFormatContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">inputFmtCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">FILE </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">destFile </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">AVCodecContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">decoderCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (inputFmtCtx)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        avformat_close_input</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">inputFmtCtx);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (destFile)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        fclose</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(destFile);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (decoderCtx)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        avcodec_free_context</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">decoderCtx);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ret;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> avc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">[]</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // è®¾ç½®æ—¥å¿—çº§åˆ«</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log_set_level</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(AV_LOG_INFO);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ‰“å°ç”¨æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (avc </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 4</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_INFO, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;usage:</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;inFileName.mp4&gt; &lt;outFileName.yuv&gt; &lt;widthxheight&gt;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">]);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">inFileName </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">outFileName </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">resolution </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> destWidth </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, destHeight </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // è§£æå®½é«˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ((ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_parse_video_size</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">destWidth, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">destHeight, resolution)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;av_parse_video_size failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ‰“å¼€è¾“å…¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ((ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_open_input</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">inputFmtCtx, inFileName, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avformat_open_input failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // åˆ›å»ºè¾“å‡ºæ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    destFile </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> fopen</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(outFileName, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;wb&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (destFile </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;fopene failed.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ¢æµ‹æµä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ((ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_find_stream_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(inputFmtCtx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avformat_find_stream_info failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // å¾—åˆ°è§†é¢‘æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> videoIdx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_find_best_stream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(inputFmtCtx, AVMEDIA_TYPE_VIDEO, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (videoIdx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;av_find_best_stream failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // å¾—åˆ°ç¼–è§£ç ä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ((decoderCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_alloc_context3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_alloc_context3 failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // å°†è§†é¢‘æµç¼–è§£ç å™¨ä¿¡æ¯æ‹·è´åˆ°ç¼–è§£ç ä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ((ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_parameters_to_context</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">inputFmtCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">streams</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[videoIdx]-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codecpar</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_parameters_to_context failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ ¹æ®ç¼–è§£ç å™¨idè·å–è§£ç å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AVCodec </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">videoDecoder </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_find_decoder</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codec_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (videoDecoder </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_find_decoder failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // ä½¿ç”¨ ç¼–è§£ç å™¨ åˆå§‹åŒ– ç¼–è§£ç å™¨çš„ä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ((ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_open2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, videoDecoder, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_open2 failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // è·å–æºé¢œè‰²ç©ºé—´</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AVPixelFormat srcPixFmt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">pix_fmt</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AVPixelFormat destPixFmt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> srcPixFmt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // AV_PIX_FMT_YUV420P</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // è·å–swscaleä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> SwsContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">swsCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> sws_getContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">        decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">width</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, srcPixFmt,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // æºåˆ†è¾¨ç‡ æºå›¾åƒç©ºé—´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        destWidth, destHeight, destPixFmt,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                // ç›®æ ‡åˆ†è¾¨ç‡ ç›®æ ‡å›¾åƒç©ºé—´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        SWS_FAST_BILINEAR,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                // ç¼©æ”¾ç®—æ³•</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">        NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                             // æºå›¾åƒè¿‡æ»¤å™¨ï¼ˆå‰åå›¾åƒæ»¤æ³¢å¤„ç†ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">        NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                             // ç›®æ ‡å›¾åƒæ»¤æ³¢å™¨</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">        NULL</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                              // å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (swsCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;sws_getContext failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // åˆ›å»ºdestFrame</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">destFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_frame_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // ä¸ºdestFrameçš„dataåˆ†é…å†…å­˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    uint8_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">destBuffer </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_malloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">av_image_get_buffer_size</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(destPixFmt, destWidth, destHeight, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æŠŠæ‰€åˆ†é…å†…å­˜çš„åœ°å€ï¼Œé€šè¿‡è®¡ç®—ï¼Œåˆ†åˆ«è®¾ç½®åˆ°Y:data[0] U:data[1] V:data[2] ä¸­</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_image_fill_arrays</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">destFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">destFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">linesize</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, destBuffer, destPixFmt, destWidth, destHeight, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // è¯»å–æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVPacket </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">packet </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_packet_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">srcFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_frame_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> render_process</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(AVCodecContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> decoderCtx, AVPacket </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> packet, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> SwsContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> swsCtx, AVFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> srcFrame, AVFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> destFrame, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> destWidht, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> destHeight, FILE </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">destFile);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">av_read_frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(inputFmtCtx, packet) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // å¦‚æœæ˜¯è§†é¢‘æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">stream_index</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> ==</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> videoIdx)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">            // æŠŠpacketå‘é€ç»™è§£ç å™¨å¾—åˆ°YUVå¸§</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">render_process</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, packet, swsCtx, srcFrame, destFrame, destWidth, destHeight, destFile) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">                av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;render_process failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_packet_unref</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(packet);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // å†æ¬¡æŠŠpacketå‘é€ç»™è§£ç å™¨å¾—åˆ°YUVå¸§</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // ï¼ˆè¿™é‡Œæ˜¯ä¸ºäº†é˜²æ­¢ptså’Œdtsçš„åŸå› å¯¼è‡´è§£ç å™¨ä¸­è¿˜æœ‰YUVå¸§æ²¡æœ‰å–å‡ºï¼Œæ‰€ä»¥å‘é€packet=NULL,ç„¶åå†è¯»Frameï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // å¦‚æœä¸è¿™ä¹ˆåšï¼Œå¯èƒ½å¯¼è‡´æœ€åå°‘å‡ å¸§</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">render_process</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, swsCtx, srcFrame, destFrame, destWidth, destHeight, destFile) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;render_process failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_packet_free</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">packet);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_frame_free</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">srcFrame);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> render_process</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(AVCodecContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AVPacket </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> SwsContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">swsCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AVFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">srcFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AVFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">destFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> destWidht</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> destHeight</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, FILE </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">destFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     * avcodec_send_packet:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     * packet can be NULL (or an AVPacket with data set to NULL and</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     * size set to 0); in this case, it is considered a flush</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     * packet, which signals the end of the stream.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // å°†æ•°æ®å‘é€ç»™è§£ç å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ((ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_send_packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, packet)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_send_packet failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ¥æ”¶è§£ç å™¨è§£ç åçš„æ•°æ®frame</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">avcodec_receive_frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, srcFrame) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // YUV420</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // Y</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // ã€Y Y Y Yã€‘</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // ã€Y Y Y Yã€‘</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // U</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // ã€U 0 U 0ã€‘</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // ã€0 0 0 0ã€‘</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // V</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // ã€V 0 V 0ã€‘</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // ã€0 0 0 0ã€‘</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // å†™æ³•1ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // data[0]è¡¨ç¤ºYæ•°æ®ï¼Œé€šè¿‡ decoderCtx-&gt;width * decoderCtx-&gt;height è®¡ç®—æ•°æ®çš„é•¿åº¦</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // è¿™é‡Œçš„é—®é¢˜åœ¨äºè§£ç å™¨å’ŒCPUå¯èƒ½ä¼šä¼˜åŒ–ï¼Œå¯¼è‡´frame-&gt;data[0]æ•°æ®çš„å®½åº¦å’ŒdecoderCtx-&gt;widthä¸ä¸€è‡´ï¼Œæœ‰å¤šä½™çš„æ— ç”¨æ•°æ®ï¼Œä½¿å¾—æ— æ³•æ­£å¸¸æ’­æ”¾</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // fwrite(frame-&gt;data[0], 1, decoderCtx-&gt;width * decoderCtx-&gt;height, destFile);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // fwrite(frame-&gt;data[1], 1, decoderCtx-&gt;width * decoderCtx-&gt;height / 4, destFile);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // fwrite(frame-&gt;data[2], 1, decoderCtx-&gt;width * decoderCtx-&gt;height / 4, destFile);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // å†™æ³•2:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // data[0]è¡¨ç¤ºYæ•°æ®ï¼Œé€šè¿‡ frame-&gt;linesize[0] * decoderCtx-&gt;height è®¡ç®—æ•°æ®çš„é•¿åº¦</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // è¿™é‡Œçš„é—®é¢˜åœ¨äºè§£ç å™¨å’ŒCPUå¯èƒ½ä¼šä¼˜åŒ–ï¼Œframe-&gt;linesize[0]æ¯”å®é™…å®½åº¦å¤§ã€dataä¸­ä¹Ÿæœ‰å¤šä½™çš„æ— ç”¨æ•°æ®ï¼Œå¦‚æœä¸èƒ½æ­£ç¡®æŒ‡å®šå®½é«˜ï¼Œè§†é¢‘å°†æ— æ³•æ­£å¸¸æ’­æ”¾</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // fwrite(srcFrame-&gt;data[0], 1, srcFrame-&gt;linesize[0] * decoderCtx-&gt;height, destFile); // Y</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // fwrite(srcFrame-&gt;data[1], 1, srcFrame-&gt;linesize[1] * decoderCtx-&gt;height, destFile); // U</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // fwrite(srcFrame-&gt;data[2], 1, srcFrame-&gt;linesize[2] * decoderCtx-&gt;height, destFile); // V</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // // è¾“å‡ºå®é™…å®½é«˜</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // av_log(NULL, AV_LOG_INFO, &quot;w:%d,h:%d.\n&quot;, srcFrame-&gt;width, srcFrame-&gt;height);       // 480x270</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // av_log(NULL, AV_LOG_INFO, &quot;w:%d,h:%d.\n&quot;, srcFrame-&gt;linesize[0], srcFrame-&gt;height); // 512x270</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // av_log(NULL, AV_LOG_INFO, &quot;w:%d,h:%d.\n&quot;, srcFrame-&gt;linesize[1], srcFrame-&gt;height); // 512x270</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // av_log(NULL, AV_LOG_INFO, &quot;w:%d,h:%d.\n&quot;, srcFrame-&gt;linesize[2], srcFrame-&gt;height); // 512x270</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // æ’­æ”¾æ—¶è¦æŒ‡å®šå®½åº¦ä¸ºï¼š512x270 è€Œä¸æ˜¯å®é™…å®½åº¦480x270,å¦åˆ™ä¸èƒ½æ­£å¸¸æ’­æ”¾</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // $ ffplay -f rawvideo -video_size 512x270 -pixel_format yuv420p file.yuv</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // å†™æ³•3ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // åˆ©ç”¨swscaleè£å‰ª</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // æ­¤æ—¶destFrameä¸­æ²¡æœ‰å¤šä½™çš„æ•°æ®ï¼Œä½†æ˜¯destFrame-&gt;heightä¸º0,destFrame-&gt;widthæœ‰æ­£ç¡®å€¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">            (ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> sws_scale</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(swsCtx,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                                                            // swscaleä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">                             (</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;"> uint8_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">srcFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">srcFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">linesize</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // æºFrameæ•°æ® æºFrameå®½åº¦ èµ·å§‹ä½ç½® åŸå§‹å›¾ç‰‡é«˜åº¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">                             destFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">destFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">linesize</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                               // ç›®æ ‡Frameæ•°æ® ç›®æ ‡Frameå®½åº¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">                             )) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">            av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;sws_scale failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">            return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        fwrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">destFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">], </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, destWidht </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> destHeight, destFile);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     // Y</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        fwrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">destFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">], </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, destWidht </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> destHeight </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 4</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, destFile);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // U</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        fwrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">destFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">], </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, destWidht </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> destHeight </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 4</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, destFile);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // V</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_frame_unref</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(srcFrame);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ä¿®æ”¹æ ¼å¼ä¸ºrgb24" tabindex="-1"><a class="header-anchor" href="#ä¿®æ”¹æ ¼å¼ä¸ºrgb24"><span>ä¿®æ”¹æ ¼å¼ä¸ºRGB24</span></a></h2><p>åªéœ€è¦åœ¨ä¹‹å‰ä»£ç çš„åŸºç¡€ä¸Šä¿®æ”¹ï¼Œåªéœ€è¦ä¿®æ”¹ä¼ é€’ç»™swscaleçš„å‚æ•°å³å¯</p><p><strong>ä¿®æ”¹ç›®æ ‡æ ¼å¼</strong></p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">// enum AVPixelFormat destPixFmt = AV_PIX_FMT_YUV420P; // AV_PIX_FMT_YUV420P</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AVPixelFormat destPixFmt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AV_PIX_FMT_RGB24;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // AV_PIX_FMT_RGB24</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä¿®æ”¹è¾“å‡ºæ–¹å¼</strong></p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">// YUV420 æ˜¯planeræ•°æ® ä¸‰ä¸ªåˆ†é‡åˆ†å¼€å­˜æ”¾</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">// fwrite(destFrame-&gt;data[0], 1, destWidht * destHeight, destFile);     // Y</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">// fwrite(destFrame-&gt;data[1], 1, destWidht * destHeight / 4, destFile); // U</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">// fwrite(destFrame-&gt;data[2], 1, destWidht * destHeight / 4, destFile); // V</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">// RGB24æ˜¯packedæ•°æ®ï¼Œä¸‰ä¸ªåˆ†é‡æ‰“åŒ…å­˜æ”¾</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">fwrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(destFrame</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">-&gt;</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">], </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, destWidht </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> destHeight </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, destFile);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // RGB23</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ’­æ”¾</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"># è½¬æ¢</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">./output/main</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> ./bigbuckbunny_h264_aac.mp4</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> resize.rgb24</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> 720x576</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"># æ’­æ”¾</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">ffplay</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> rawvideo</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -video_size</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> 720x576</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -pixel_format</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> rgb24</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> resize.rgb24</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ä¿å­˜rawæ ¼å¼å›¾åƒ" tabindex="-1"><a class="header-anchor" href="#ä¿å­˜rawæ ¼å¼å›¾åƒ"><span>ä¿å­˜rawæ ¼å¼å›¾åƒ</span></a></h2><p><strong>BMP</strong></p><ul><li>BMPæ–‡ä»¶æ ¼å¼ï¼Œåˆç§°ä¸ºBitmap (ä½å›¾)æˆ–æ˜¯DIB(Device-lndependent Deviceï¼Œè®¾å¤‡æ— å…³ä½å›¾)ï¼Œ</li><li>æ˜¯Windowsç³»ç»Ÿä¸­å¹¿æ³›ä½¿ç”¨çš„å›¾åƒæ–‡ä»¶æ ¼å¼ã€‚</li><li>ç”±äºå®ƒå¯ä»¥ä¸ä½œä»»ä½•å˜æ¢åœ°ä¿å­˜å›¾åƒåƒç´ åŸŸçš„æ•°æ®ï¼Œå› æ­¤æˆä¸ºæˆ‘ä»¬å–å¾—RAWæ•°æ®çš„é‡è¦æ¥æºã€‚</li><li>**æ‰«ææ–¹å¼:**ä»å·¦åˆ°å³ã€ä»ä¸‹åˆ°ä¸Š</li><li>æ–‡ä»¶ç»„æˆ: <ul><li>ä½å›¾æ–‡ä»¶å¤´(bmp file header): æä¾›æ–‡ä»¶çš„æ ¼å¼ã€å¤§å°ç­‰ä¿¡æ¯ã€‚</li><li>ä½å›¾ä¿¡æ¯å¤´(bitmap information): æä¾›å›¾åƒæ•°æ®çš„å°ºå¯¸ã€ä½å¹³é¢æ•°ã€å‹ç¼©æ–¹å¼ã€é¢œè‰²ç´¢å¼•ç­‰ä¿¡æ¯.</li><li>è°ƒè‰²æ¿(color palette): å¯é€‰ï¼Œå¦‚ä½¿ç”¨ç´¢å¼•æ¥è¡¨ç¤ºå›¾åƒï¼Œè°ƒè‰²æ¿å°±æ˜¯ç´¢å¼•ä¸å…¶å¯¹åº”çš„é¢œè‰²çš„æ˜ å°„è¡¨ã€‚</li><li>ä½å›¾æ•°æ®(bitmap data): å›¾åƒæ•°æ®åŒºã€‚</li></ul></li></ul><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;stdint.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavformat\avformat.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // è§£å°è£…</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavutil\avutil.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     // æ—¥å¿—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavutil\parseutils.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // è§£æå­—ç¬¦ä¸²</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavutil\imgutils.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">   // è®¡ç®—è§†é¢‘å¤§å°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavcodec\avcodec.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">   // ç¼–è§£ç </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libswscale\swscale.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">   // è§†é¢‘ç¼©æ”¾</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> * win32 ç±»å‹</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;"> uint16_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> WORD;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;"> uint32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> DWORD;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;"> int32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> LONG;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">// è®¾ç½®æŒ‰1å­—èŠ‚å¯¹é½ï¼Œé˜²æ­¢ç¼–è¯‘å™¨å¯¹ç»“æ„ä½“åšå­—èŠ‚å¯¹é½</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#pragma</span><span style="--shiki-light:#6F42C1;--shiki-dark:#9CDCFE;"> pack</span><span style="--shiki-light:#24292E;--shiki-dark:#569CD6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#569CD6;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">// ä½å›¾æ–‡ä»¶æ–‡ä»¶å¤´</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;"> struct</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    WORD bfType;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">      // æ–‡ä»¶ç±»å‹ å›ºå®šä¸º0x4d42 è¡¨ç¤ºBM(BitMap)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    DWORD bfSize;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     // æ•´ä¸ªæ–‡ä»¶å¤§å°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    WORD bfReserved1;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // ä¿ç•™å­—</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    WORD bfReserved2;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // ä¿ç•™å­—</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    DWORD bfOffBits;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // å®é™…ä½å›¾æ•°æ®çš„åç§»å­—èŠ‚æ•°ï¼ˆç›¸å¯¹äºæ•´ä¸ªæ–‡ä»¶ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">} BitMapFileHeader;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">// ä½å›¾æ–‡ä»¶ä¿¡æ¯å¤´</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;"> struct</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    DWORD biSize;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">         // è¡¨ç¤ºå½“å‰ç»“æ„ä½“çš„é•¿åº¦ï¼Œè®¾ç½®ä¸º40 ä¸è¦ç”¨sizeofå› ä¸ºä¸å‡†ç¡®ï¼Œé™¤éå…³é—­å­—èŠ‚å¯¹é½</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    LONG biWidth;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">         // å›¾ç‰‡å®½åº¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    LONG biHeight;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // å›¾ç‰‡é«˜åº¦ï¼Œé«˜åº¦å­—æ®µçš„æ­£è´Ÿå€¼è¡¨ç¤ºä½å›¾çš„ä¸Šä¸‹æ–¹å‘ã€‚å½“é«˜åº¦ä¸ºæ­£æ—¶ï¼Œå›¾åƒæ˜¯ä»ä¸Šåˆ°ä¸‹ç»˜åˆ¶çš„ï¼›å½“é«˜åº¦ä¸ºè´Ÿæ—¶ï¼Œå›¾åƒæ˜¯ä»ä¸‹åˆ°ä¸Šç»˜åˆ¶çš„ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    WORD biPlanes;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // å›¾ç‰‡å¹³é¢æ•° è®¾ç½®ä¸º1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    WORD biBitCount;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">      // é¢œè‰²ä½æ•° 1(é»‘ç™½)ã€8ã€16ã€24ã€32ä½å›¾</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    DWORD biCompression;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // å‹ç¼©å±æ€§ï¼Œä½å›¾æ˜¯ä¸å‹ç¼©çš„ï¼Œæ‰€ä»¥è®¾ç½®0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    DWORD biSizeImage;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // ä½å›¾æ•°æ®å®é™…å ç”¨çš„å­—èŠ‚æ•°ï¼ˆä¸å‹ç¼©å°±ä¸ç”¨å¡«ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    LONG biXPelsPerMeter;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // Xæ–¹å‘åˆ†è¾¨ç‡,å¯çœç•¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    LONG biYPelsPerMeter;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // Yæ–¹å‘åˆ†è¾¨ç‡,å¯çœç•¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    DWORD biClrUsed;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">      // ä½¿ç”¨äº†å¤šå°‘ä¸ªé¢œè‰²ç´¢å¼•è¡¨ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼ï¼š2^(biBitCounté¢œè‰²ä½æ•°)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    DWORD biClrImportant;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // é‡è¦é¢œè‰²æ•°ï¼Œ0è¡¨ç¤ºæ‰€æœ‰é¢œè‰²éƒ½æ˜¯é‡è¦çš„</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">} BitMapFileInfoHeader;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#pragma</span><span style="--shiki-light:#6F42C1;--shiki-dark:#9CDCFE;"> endregion</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">// å†™å…¥bitmapæ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> writeBitMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;"> char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">bmpFileName</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">uint8_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">rgb24Data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> width</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> height</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    BitMapFileHeader fileHeader </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> {</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">};</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    BitMapFileInfoHeader infoHeader </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> {</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    fileHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">bfType</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#B5CEA8;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">4d42</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    fileHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">bfSize</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;"> sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(BitMapFileHeader) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">+</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;"> sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(BitMapFileInfoHeader) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> width </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> height </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    fileHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">bfOffBits</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;"> sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(BitMapFileHeader) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">+</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;"> sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(BitMapFileInfoHeader);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    infoHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">biSize</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;"> sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(BitMapFileInfoHeader);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    infoHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">biWidth</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> width;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    infoHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">biHeight</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> height;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    infoHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">biPlanes</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    infoHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">biBitCount</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 24</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    FILE </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">file </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> fopen</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(bmpFileName, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;wb&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (file </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;fopen failed</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    fwrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">fileHeader, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(BitMapFileHeader), file);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    fwrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">infoHeader, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(BitMapFileInfoHeader), file);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    fwrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(rgb24Data, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, width </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> height </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, file);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    fclose</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(file);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">AVFormatContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">inputFmtCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">AVCodecContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">decoderCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (inputFmtCtx)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        avformat_close_input</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">inputFmtCtx);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (decoderCtx)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        avcodec_free_context</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">decoderCtx);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ret;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> avc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">[]</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // è®¾ç½®æ—¥å¿—çº§åˆ«</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log_set_level</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(AV_LOG_INFO);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ‰“å°ç”¨æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (avc </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_INFO, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;usage:</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;inFileName.mp4&gt;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">]);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">inFileName </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ‰“å¼€è¾“å…¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ((ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_open_input</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">inputFmtCtx, inFileName, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avformat_open_input failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ¢æµ‹æµä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ((ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_find_stream_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(inputFmtCtx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avformat_find_stream_info failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // å¾—åˆ°è§†é¢‘æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> videoIdx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_find_best_stream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(inputFmtCtx, AVMEDIA_TYPE_VIDEO, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (videoIdx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;av_find_best_stream failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // å¾—åˆ°ç¼–è§£ç ä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ((decoderCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_alloc_context3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_alloc_context3 failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // å°†è§†é¢‘æµç¼–è§£ç å™¨ä¿¡æ¯æ‹·è´åˆ°ç¼–è§£ç ä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ((ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_parameters_to_context</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">inputFmtCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">streams</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[videoIdx]-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codecpar</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_parameters_to_context failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ ¹æ®ç¼–è§£ç å™¨idè·å–è§£ç å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AVCodec </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">videoDecoder </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_find_decoder</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codec_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (videoDecoder </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_find_decoder failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // ä½¿ç”¨ ç¼–è§£ç å™¨ åˆå§‹åŒ– ç¼–è§£ç å™¨çš„ä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ((ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_open2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, videoDecoder, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_open2 failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // è·å–æºé¢œè‰²ç©ºé—´</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AVPixelFormat srcPixFmt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">pix_fmt</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ®è¯´ï¼šBitMapæœŸæœ›çš„å­˜å‚¨æ ¼å¼ä¸ºRGB ä½†æ˜¯ffmpegä¸­RGBçš„å­˜å‚¨æ ¼å¼ä¸ºBGR,æ‰€ä»¥è¿™é‡Œå¾—å†™BGR,å¾—åˆ°çš„å­˜å‚¨æ ¼å¼æ‰èƒ½æ˜¯RGB</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AVPixelFormat destPixFmt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AV_PIX_FMT_BGR24;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // è·å–swscaleä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> SwsContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">swsCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> sws_getContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">        decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">width</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, srcPixFmt,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // æºåˆ†è¾¨ç‡ æºå›¾åƒç©ºé—´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">        decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">width</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, destPixFmt,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // ç›®æ ‡åˆ†è¾¨ç‡ ç›®æ ‡å›¾åƒç©ºé—´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        SWS_FAST_BILINEAR,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                 // ç¼©æ”¾ç®—æ³•</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">        NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                              // æºå›¾åƒè¿‡æ»¤å™¨ï¼ˆå‰åå›¾åƒæ»¤æ³¢å¤„ç†ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">        NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                              // ç›®æ ‡å›¾åƒæ»¤æ³¢å™¨</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">        NULL</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                               // å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (swsCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;sws_getContext failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // åˆ›å»ºdestFrame</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">destFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_frame_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // ä¸ºdestFrameçš„dataåˆ†é…å†…å­˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    uint8_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">destBuffer </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">uint8_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">av_malloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">av_image_get_buffer_size</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(destPixFmt, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">width</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æŠŠæ‰€åˆ†é…å†…å­˜çš„åœ°å€ï¼Œé€šè¿‡è®¡ç®—ï¼Œåˆ†åˆ«è®¾ç½®åˆ°Y:data[0] U:data[1] V:data[2] ä¸­</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_image_fill_arrays</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">destFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">destFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">linesize</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, destBuffer, destPixFmt, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">width</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // è¯»å–æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVPacket </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">packet </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_packet_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">srcFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_frame_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> render_process</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(AVCodecContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> decoderCtx, AVPacket </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> packet, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> SwsContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> swsCtx, AVFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> srcFrame, AVFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> destFrame, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> destWidht, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> destHeight);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">av_read_frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(inputFmtCtx, packet) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // å¦‚æœæ˜¯è§†é¢‘æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">stream_index</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> ==</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> videoIdx)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">            // æŠŠpacketå‘é€ç»™è§£ç å™¨å¾—åˆ°YUVå¸§</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">render_process</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, packet, swsCtx, srcFrame, destFrame, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">width</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">                av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;render_process failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_packet_unref</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(packet);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // å†æ¬¡æŠŠpacketå‘é€ç»™è§£ç å™¨å¾—åˆ°YUVå¸§</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // ï¼ˆè¿™é‡Œæ˜¯ä¸ºäº†é˜²æ­¢ptså’Œdtsçš„åŸå› å¯¼è‡´è§£ç å™¨ä¸­è¿˜æœ‰YUVå¸§æ²¡æœ‰å–å‡ºï¼Œæ‰€ä»¥å‘é€packet=NULL,ç„¶åå†è¯»Frameï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // å¦‚æœä¸è¿™ä¹ˆåšï¼Œå¯èƒ½å¯¼è‡´æœ€åå°‘å‡ å¸§</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">render_process</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, swsCtx, srcFrame, destFrame, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">width</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;render_process failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_packet_free</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">packet);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_frame_free</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">srcFrame);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> render_process</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(AVCodecContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AVPacket </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> SwsContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">swsCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AVFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">srcFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AVFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">destFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> destWidht</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> destHeight</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     * avcodec_send_packet:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     * packet can be NULL (or an AVPacket with data set to NULL and</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     * size set to 0); in this case, it is considered a flush</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     * packet, which signals the end of the stream.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // å°†æ•°æ®å‘é€ç»™è§£ç å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ((ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_send_packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, packet)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_send_packet failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> frameCnt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ¥æ”¶è§£ç å™¨è§£ç åçš„æ•°æ®frame</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">avcodec_receive_frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, srcFrame) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // åˆ©ç”¨swscaleè£å‰ª</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // æ­¤æ—¶destFrameä¸­æ²¡æœ‰å¤šä½™çš„æ•°æ®ï¼Œä½†æ˜¯destFrame-&gt;heightä¸º0,destFrame-&gt;widthæœ‰æ­£ç¡®å€¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">            (ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> sws_scale</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(swsCtx,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                                                            // swscaleä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">                             (</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;"> uint8_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">srcFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">srcFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">linesize</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // æºFrameæ•°æ® æºFrameå®½åº¦ èµ·å§‹ä½ç½® åŸå§‹å›¾ç‰‡é«˜åº¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">                             destFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">destFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">linesize</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                               // ç›®æ ‡Frameæ•°æ® ç›®æ ‡Frameå®½åº¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">                             )) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">            av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;sws_scale failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">            return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // RGB24æ˜¯packedæ•°æ®ï¼Œä¸‰ä¸ªåˆ†é‡æ‰“åŒ…å­˜æ”¾</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">        char</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> fileName</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> {</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">};</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        sprintf</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(fileName, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;./pic/</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%lld</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">.bmp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, frameCnt</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_INFO, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%s</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, fileName);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        writeBitMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(fileName, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">destFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">], destWidht, destHeight);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_frame_unref</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(srcFrame);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="yuv-to-h264è§†é¢‘ç¼–ç " tabindex="-1"><a class="header-anchor" href="#yuv-to-h264è§†é¢‘ç¼–ç "><span>YUV_to_H264è§†é¢‘ç¼–ç </span></a></h2><p><img src="/assets/image-43-D8HjxgdW.png" alt="Alt text"></p><p><img src="/assets/image-42-BOm90U7z.png" alt="Alt text"></p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;stdint.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavformat\avformat.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // è§£å°è£…</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavutil\avutil.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     // æ—¥å¿—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavutil\parseutils.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // è§£æå­—ç¬¦ä¸²</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavutil\imgutils.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">   // è®¡ç®—è§†é¢‘å¤§å°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavcodec\avcodec.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">   // ç¼–è§£ç </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libswscale\swscale.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">   // è§†é¢‘ç¼©æ”¾</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> avc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">[]</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // è®¾ç½®æ—¥å¿—çº§åˆ«</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log_set_level</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(AV_LOG_DEBUG);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ‰“å°ç”¨æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (avc </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_INFO, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;usage:</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;inFileName.yuv&gt; &lt;outFileName.h264&gt; &lt;encoderName&gt; &lt;yuvW x yuvH&gt;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">]);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // è·å–å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">yuvFileName </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">h264FileName </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">encoderName </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">yuvSize </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> yuvFmt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AV_PIX_FMT_YUV420P;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> yuvW </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, yuvH </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_parse_video_size</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">yuvW, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">yuvH, yuvSize);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // åˆå§‹åŒ–ç¼–ç å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AVCodec </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">encoder </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_find_encoder_by_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(encoderName);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // è·å–ç¼–ç å™¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVCodecContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">encoderCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_alloc_context3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(encoder);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">       // è·å–ç¼–ç å™¨ä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    encoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codec_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AVMEDIA_TYPE_VIDEO;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                        // ç¼–ç è§†é¢‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    encoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">pix_fmt</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> yuvFmt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                       // ç¼–ç è§†é¢‘æ ¼å¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    encoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">width</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> yuvW;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                           // ç¼–ç è§†é¢‘å®½åº¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    encoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">height</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> yuvH;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                          // ç¼–ç è§†é¢‘é«˜åº¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    encoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">time_base</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (AVRational){</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">30</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">};</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                        // ç¼–ç æ—¶é—´åŸº</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    encoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">bit_rate</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 4096000</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                     // æ¯”ç‰¹ç‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    encoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">max_b_frames</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                       // æ²¡æœ‰Bå¸§ï¼ˆBå¸§éœ€è¦å‰åä¸¤å¸§æ¥æ¨æµ‹ï¼Œè¿™ä¼šé™ä½è§£ç æ•ˆç‡ï¼Œæé«˜å­˜å‚¨æ•ˆç‡ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    encoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">gop_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                          // åŒæ—¶å†³å®šäº†Iå¸§ï¼ˆå…³é”®å¸§ï¼‰çš„é—´éš” ï¼ˆå¯ä»¥ç”¨ESEyEå·¥å…·æ¥æŸ¥çœ‹ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    avcodec_open2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(encoderCtx, encoder, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                           // æ‰“å¼€ç¼–ç å™¨</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // åˆå§‹åŒ–yuvFrame</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">yuvFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_frame_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                                       // åˆ›å»ºFrame</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    uint8_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">yuvBuffer </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_malloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">av_image_get_buffer_size</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(yuvFmt, yuvW, yuvH, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">));</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">            // ä¸ºdataåˆ†é…å†…å­˜</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_image_fill_arrays</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">yuvFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">yuvFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">linesize</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, yuvBuffer, yuvFmt, yuvW, yuvH, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // å°†åˆ†é…çš„å†…å­˜èµ‹å€¼åˆ°data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    yuvFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">format</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> yuvFmt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                                                  // å¿…é¡»è®¾ç½®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    yuvFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">width</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> yuvW;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                                                     // å¿…é¡»è®¾ç½®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    yuvFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">height</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> yuvH;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                                                    // å¿…é¡»è®¾ç½®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    yuvFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">pts</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                                                          // åˆå§‹åŒ–</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> frameSize </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> yuvW </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> yuvH;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                                                // frameSize</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> dataSize </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> frameSize </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">+</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                                                  // Y:4</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">                   frameSize </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 4</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> +</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                                              // U:2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">                   frameSize </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 4</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                                               // V:0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // åˆå§‹åŒ–h264Packet</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVPacket </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">h264Packet </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_packet_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // ç¼–ç ã€è¯»å†™æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    FILE </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">yuvFile </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> fopen</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(yuvFileName, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;rb&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    FILE </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">h264File </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> fopen</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(h264FileName, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;wb&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">fread</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(yuvBuffer, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, dataSize, yuvFile) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> dataSize)</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // è¯»å–yuvæ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // ä¸‹é¢ä¸‰è¡Œç­‰æ•ˆäºï¼šav_image_fill_arrays()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // yuvFrame-&gt;data[0] = yuvBuffer;                 // Y</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // yuvFrame-&gt;data[1] = yuvBuffer + frameSize;     // U</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // yuvFrame-&gt;data[2] = yuvBuffer + frameSize / 4; // V</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">        yuvFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">pts</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // å¿…é¡»è®¾ç½®</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_send_frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(encoderCtx, yuvFrame);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // å‘é€ç»™ç¼–ç å™¨ (å¯èƒ½ç¼–ç å™¨ä¸­è¿˜æœ‰å‰©ä½™çš„å¸§ï¼Œéœ€è¦flush)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">            av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_send_frame failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">            return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        while</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">avcodec_receive_packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(encoderCtx, h264Packet) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // è¯»å–ç¼–ç åçš„æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">            fwrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">h264Packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">h264Packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, h264File);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // å†™å…¥æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">            av_packet_unref</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(h264Packet);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                             // é‡Šæ”¾h264Packet-&gt;data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="éŸ³é¢‘è§£ç aac-pcm" tabindex="-1"><a class="header-anchor" href="#éŸ³é¢‘è§£ç aac-pcm"><span>éŸ³é¢‘è§£ç AAC_PCM</span></a></h2><p><img src="/assets/image-44-DV3-Aw8k.png" alt="Alt text"></p><p><strong>PCM</strong></p><ul><li><p>PCM(Pulse Code Modulation),è„‰å†²ç¼–ç è°ƒåˆ¶ï¼Œæ˜¯ä¸€ç§ç”¨æ•°å­—è¡¨ç¤ºé‡‡æ ·æ¨¡æ‹Ÿä¿¡å·çš„æ–¹æ³•ã€‚</p></li><li><p>æ ¸å¿ƒè¿‡ç¨‹:é‡‡æ ·--&gt;é‡åŒ–--&gt;ç¼–ç </p><ul><li>**é‡‡æ ·ï¼š**å°†è¿ç»­é‡ç¦»æ•£åŒ–çš„è¿‡ç¨‹ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯æ¯éš”ä¸€æ®µæ—¶é—´å»é‡‡é›†æ•°æ®ï¼Œé‡‡é›†çš„é¢‘ç‡å°±æ˜¯é‡‡æ ·ç‡ï¼Œé‡‡æ ·ç‡è¶Šé«˜ï¼Œæ•°æ®è¶Šä¿çœŸã€‚</li><li>**é‡åŒ–ï¼š**æŒ‡å°†é‡‡æ ·åå¾—åˆ°çš„ç¦»æ•£ä¿¡å·æ˜ å°„åˆ°ä¸€ç»„æœ‰é™çš„ç¦»æ•£é‡ä¸Šçš„è¿‡ç¨‹ï¼Œå¦‚æŠŠ0v~3.3vçš„æ¨¡æ‹Ÿç”µå‹ä¿¡å·é‡æ–°æ˜ å°„åˆ°0~255çš„èŒƒå›´ã€‚</li><li>**ç¼–ç ï¼š**å°†é‡‡é›†å’Œé‡åŒ–åçš„æ•°æ®ä¿å­˜</li></ul></li><li><p><strong>é‡‡æ ·ç‡(sampleRate) :</strong> æ¯ç§’ä¸­é‡‡é›†æ ·æœ¬çš„ä¸ªæ•°ï¼Œå¦‚8KHzï¼Œè¡¨ç¤ºæ¯ç§’é‡‡æ ·8000æ¬¡ã€‚</p><ul><li>å¥ˆå¥æ–¯ç‰¹å®šç†: æŒ‰æ¯”å£°éŸ³æœ€é«˜é¢‘ç‡é«˜2å€ä»¥ä¸Šçš„é¢‘ç‡å¯¹å£°éŸ³è¿›è¡Œé‡‡æ ·ï¼›</li><li>äººè€³èƒ½æ¥å—çš„é¢‘ç‡èŒƒå›´ä¸º20Hz~20kHzï¼Œæ•…é‡‡æ ·ç‡ä¸€èˆ¬ä¸º44.1KHzè¾ƒå¥½ï¼Œ</li><li>é‡‡æ ·ç‡è¶Šé«˜ï¼Œè´¨é‡è¶Šé«˜ï¼Œä½†å­˜å‚¨ç©ºé—´å¢å¤§ã€‚</li></ul></li><li><p><strong>é‡åŒ–æ ¼å¼ (sampleFormat):</strong></p><ul><li>ffmpegæ”¯æŒçš„é‡åŒ–æ ¼å¼: <code>ffmpeg -formats|grep PCM</code></li></ul></li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> ffmpeg</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -formats</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> PCM</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> DE</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> alaw</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">            PCM</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> A-law</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> DE</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> f32be</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">           PCM</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> 32-bit</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> floating-point</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> big-endian</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> DE</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> f32le</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">           PCM</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> 32-bit</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> floating-point</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> little-endian</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> DE</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> f64be</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">           PCM</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> 64-bit</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> floating-point</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> big-endian</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> DE</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> f64le</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">           PCM</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> 64-bit</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> floating-point</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> little-endian</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> DE</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> mulaw</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">           PCM</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> mu-law</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> DE</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> s16be</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">           PCM</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> signed</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> 16-bit</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> big-endian</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> DE</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> s16le</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">           PCM</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> signed</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> 16-bit</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> little-endian</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> DE</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> s24be</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">           PCM</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> signed</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> 24-bit</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> big-endian</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> DE</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> s24le</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">           PCM</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> signed</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> 24-bit</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> little-endian</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> DE</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> s32be</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">           PCM</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> signed</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> 32-bit</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> big-endian</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> DE</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> s32le</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">           PCM</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> signed</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> 32-bit</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> little-endian</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> DE</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> s8</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">              PCM</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> signed</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> 8-bit</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> DE</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> u16be</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">           PCM</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> unsigned</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> 16-bit</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> big-endian</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> DE</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> u16le</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">           PCM</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> unsigned</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> 16-bit</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> little-endian</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> DE</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> u24be</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">           PCM</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> unsigned</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> 24-bit</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> big-endian</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> DE</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> u24le</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">           PCM</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> unsigned</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> 24-bit</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> little-endian</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> DE</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> u32be</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">           PCM</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> unsigned</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> 32-bit</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> big-endian</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> DE</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> u32le</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">           PCM</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> unsigned</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> 32-bit</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> little-endian</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> DE</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> u8</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">              PCM</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> unsigned</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> 8-bit</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> DE</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> vidc</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">            PCM</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> Archimedes</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> VIDC</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>å£°é“æ•°ï¼ˆchannelï¼‰:</strong><ul><li>å•å£°é“ï¼ˆmonoï¼‰</li><li>åŒå£°é“ï¼ˆstereoï¼‰</li></ul></li></ul><p><strong>å­˜å‚¨æ ¼å¼:</strong></p><ul><li>åŒå£°é“éŸ³é¢‘æ–‡ä»¶ <ul><li>é‡‡æ ·æ•°æ®æŒ‰LRLRæ–¹å¼å­˜å‚¨ï¼Œå­˜å‚¨çš„æ—¶å€™ä¸å­—èŠ‚åºæœ‰å…³ã€‚</li></ul></li><li>å•å£°é“éŸ³é¢‘æ–‡ä»¶ï¼Œ <ul><li>é‡‡æ ·æ•°æ®æŒ‰æ—¶é—´å…ˆåä¾æ¬¡å­˜å…¥</li><li>(æœ‰æ—¶ä¹Ÿä¼šç”¨LRLRæ–¹å¼å­˜å‚¨ï¼Œä½†å¦ä¸€ä¸ªå£°é“æ•°æ®ä¸º0)</li></ul></li></ul><p><strong>å­˜å‚¨æ ¼å¼</strong></p><ul><li>Packedå’ŒPlannerä¸¤ç§ï¼Œ</li><li>å¯¹äºåŒé€šé“éŸ³é¢‘ï¼ŒPackedä¸ºä¸¤ä¸ªå£°é“çš„æ•°æ®äº¤é”™å­˜å‚¨;Plannerä¸ºä¸¤ä¸ªå£°é“æ•°æ®åˆ†å¼€å­˜å‚¨: <ul><li>Packed: LRLRLR</li><li>Planner: LLLRRR</li></ul></li></ul><p><strong>åœ¨ffmpegä¸­çš„å­˜å‚¨æ ¼å¼</strong></p><ul><li>PCMæ•°æ®å­˜å‚¨åœ¨AVFrameä¸­</li><li>å¯¹äºPackedæ ¼å¼çš„PCMæ•°æ®ï¼Œframe.data[0] æˆ– frame.extened_data[0]åŒ…å«æ‰€æœ‰éŸ³é¢‘æ•°æ®</li><li>å¯¹äºPlanaræ ¼å¼çš„PCMæ•°æ®ï¼Œframe.data[i] æˆ– frame.extened_data[i]è¡¨ç¤ºiå£°é“çš„æ•°æ®</li><li>å®é™…éŸ³é¢‘æ–‡ä»¶é‡‡ç”¨Packedæ ¼å¼ï¼Œffmpegå†…éƒ¨å¤„ç†éŸ³é¢‘é‡‡ç”¨Planaræ ¼å¼ã€‚</li></ul><p><strong>å¤§å°è®¡ç®—:</strong></p><ul><li>ä»¥CDçš„éŸ³è´¨ä¸ºä¾‹:é‡åŒ–æ ¼å¼ä¸º16æ¯”ç‰¹(2å­—èŠ‚)ï¼Œé‡‡æ ·ç‡ä¸º44100ï¼Œå£°é“æ•°ä¸º2ã€‚</li><li>æ¯”ç‰¹ç‡ä¸º:44100<em>16</em>2=1378.125kbps</li><li>1åˆ†é’ŸéŸ³é¢‘å¤§å°:1378.125*60/8/1024=10.09MB</li></ul><p><strong>ffmpegæå–pcmæ•°æ®å‘½ä»¤:</strong></p><ul><li>ffmpeg -i break.aac -ar 48000 -ac 2 -f s16le out.pcm</li></ul><p><strong>ffplayæ’­æ”¾pcmæ•°æ®:</strong></p><ul><li>ffplay -ar 48000 -ac 2 -fs16le outpcm</li></ul><p><img src="/assets/image-45-Bi_bDula.png" alt="Alt text"></p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavutil/avutil.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     // å·¥å…·å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavutil/frame.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">      // å·¥å…·å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavformat/avformat.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // è§£å°è£…</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavcodec/avcodec.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">   // è§£ç </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">AVFormatContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">inFmtCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (inFmtCtx)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        avformat_close_input</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">inFmtCtx);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> **</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // è®¾ç½®æ—¥å¿—çº§åˆ«</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log_set_level</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(AV_LOG_INFO);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (argc </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;useage: </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;input.mp4&gt; &lt;output.pcm&gt;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">]);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">input </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">output </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ‰“å¼€è¾“å…¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_open_input</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">inFmtCtx, input, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avformat_open_input failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ‰“å¼€è¾“å‡º</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    FILE </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">outFile </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> fopen</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(output, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;wb+&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ‰¾åˆ°æµä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_find_stream_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(inFmtCtx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avformat_find_stream_info failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ‰¾åˆ°éŸ³é¢‘æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> audioIdx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_find_best_stream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(inFmtCtx, AVMEDIA_TYPE_AUDIO, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (audioIdx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;av_find_best_stream failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // åˆ›å»ºè§£ç å™¨ä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVCodecContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">audioDecoderCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_alloc_context3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ‹·è´è§£ç å™¨å‚æ•°åˆ°è§£ç å™¨ä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_parameters_to_context</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(audioDecoderCtx, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">inFmtCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">streams</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[audioIdx]-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codecpar</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_parameters_to_context failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ‰¾åˆ°è§£ç å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AVCodec </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">audioDecoder </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_find_decoder</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">audioDecoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codec_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ‰“å¼€è§£ç å™¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_open2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(audioDecoderCtx, audioDecoder, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_open2 failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // åˆ›å»ºframe</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">audioFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_frame_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // åˆ›å»ºbuffer</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> bufSize </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_samples_get_buffer_size</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">audioDecoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">ch_layout</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">nb_channels</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">audioDecoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">sample_rate</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">audioDecoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">sample_fmt</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    uint8_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">buf </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_malloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(bufSize);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // åˆ†é…bufferåˆ°frame-&gt;dataä¸­</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    audioFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">nb_samples</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> audioDecoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">sample_rate</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // å¿…é¡»é¢„å…ˆè®¾ç½®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_fill_audio_frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(audioFrame, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">audioDecoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">ch_layout</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">nb_channels</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">audioDecoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">sample_fmt</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, buf, bufSize, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_fill_audio_frame failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // å•ä¸ªé‡‡æ ·æ‰€å å­—èŠ‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> bytesPerSample </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_get_bytes_per_sample</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">audioDecoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">sample_fmt</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // è¯»å–packet</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVPacket </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">packet </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_packet_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">av_read_frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(inFmtCtx, packet) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">stream_index</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> ==</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> audioIdx)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">            // å‘é€ä¸ªè§£ç å™¨</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">            avcodec_send_packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(audioDecoderCtx, packet);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">            // ä»è§£ç å™¨æ¥æ”¶æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">            while</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">avcodec_receive_frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(audioDecoderCtx, audioFrame) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                 * éœ€è¦æŠŠè§£ç åçš„éäº¤é”™æ ¼å¼ï¼ˆPlanerï¼‰ï¼Œå†™å…¥æ–‡ä»¶ä½¿ç”¨äº¤é”™æ ¼å¼ï¼ˆPackedï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                 *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                 * audioFrame  æ ¼å¼ï¼šfltp(float32-le)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                 *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                 * frame-&gt;data[ch=0] L L L L</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                 * frame-&gt;data[ch=1] R R R R</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                 *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                 * å†™å…¥æ–‡ä»¶ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                 * L R L R L R L R L R L R</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                 */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">                for</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> sampleIdx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">; sampleIdx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> audioFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">nb_samples</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">; sampleIdx</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">                {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">                    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ch </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">; ch </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> audioFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">ch_layout</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">nb_channels</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">; ch</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">                    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">                        fwrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">audioFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[ch] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> sampleIdx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> bytesPerSample, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, bytesPerSample, outFile);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">                    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_packet_unref</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(packet);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    $ ffprobe.exe out.aac</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        Input #0, aac, from &#39;out.aac&#39;:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        Duration: 00:00:34.95, bitrate: 122 kb/s</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        Stream #0:0: Audio: aac (LC), 44100 Hz, stereo, fltp, 122 kb/s</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     */</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    /*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    $ ./output/main.exe out.aac aac_to_pcm.pcm</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    $ ffplay.exe -i aac_to_pcm.pcm -ac 2 -ar 44100 -f f32le</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="éŸ³é¢‘ç¼–ç pcm-to-aac" tabindex="-1"><a class="header-anchor" href="#éŸ³é¢‘ç¼–ç pcm-to-aac"><span>éŸ³é¢‘ç¼–ç PCM_to_AAC</span></a></h2><blockquote><p>ffmpeg -ac 2 -ar 48000 -fs16le -i s16le_48000_2_break.pcm -acodec libfdk_aac out1.aac</p><ul><li>ac éŸ³é¢‘é€šé“æ•°</li><li>ar éŸ³é¢‘é‡‡æ ·ç‡</li><li>f æ ¼å¼</li><li>i è¾“å…¥</li><li>acodecéŸ³é¢‘ç¼–ç å™¨</li></ul></blockquote><p><img src="/assets/image-46-CvNeNZ-8.png" alt="Alt text"></p><blockquote><p>è¿™é‡Œæ˜¯éœ€è¦æŠŠPCMæ•°æ®å†™å…¥Frameï¼Œ<br> éœ€è¦æŠŠéŸ³é¢‘çš„ä¸€äº›å‚æ•°å†™å…¥Frame</p></blockquote><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavutil/avutil.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     // å·¥å…·å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavutil/frame.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">      // å·¥å…·å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavformat/avformat.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // è§£å°è£…</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavcodec/avcodec.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">   // è§£ç </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &quot;./lib/adts.h&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">           // for adts éŸ³é¢‘å¤´</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">AVFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">frame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (frame)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_frame_unref</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(frame);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_frame_free</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">frame);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> **</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // è®¾ç½®æ—¥å¿—çº§åˆ«</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log_set_level</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(AV_LOG_INFO);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (argc </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;useage: </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;input.pcm&gt; &lt;output.aac&gt;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">]);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">input </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">output </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ‰“å¼€è¾“å…¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    FILE </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">srcFile </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> fopen</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(input, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;rb&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (srcFile </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;fopen srcFile failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ‰“å¼€è¾“å‡º</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    FILE </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">destFile </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> fopen</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(output, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;wb&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (destFile </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;fopen destFile failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // è·å–å•å£°é“pcm</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // ffmpeg -i bigbuckbunny_h264_aac.mp4 -ar 44100 -ac 1 -f f32le r_44100_c_1_f_f32le.pcm</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // è·å–åŒå£°é“pcm</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // ffmpeg -i bigbuckbunny_h264_aac.mp4 -ar 44100 -ac 2 -f f32le r_44100_c_2_f_f32le.pcm</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // å•å£°é“pcmè½¬æ¢æˆaac</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // ./output/main.exe r_44100_c_1_f_f32le.pcm pcm_to_aac.aac</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // åŒå£°é“pcmè½¬æ¢æˆaac</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // ./output/main.exe r_44100_c_2_f_f32le.pcm pcm_to_aac.aac</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ’­æ”¾</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // ffplay.exe pcm_to_aac.aac</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // ä¸»è¦çš„æ˜¯å‰ä¸‰ä¸ªå‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVChannelLayout ch_layout </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AV_CHANNEL_LAYOUT_MONO;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // å•å£°é“æˆ–åŒå£°é“</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> sample_rate </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 44100</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                            // é‡‡æ ·ç‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> sample_fmt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AV_SAMPLE_FMT_FLTP;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                // é‡‡æ ·æ ¼å¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> nb_samples </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 1024</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                              // æ¯ä¸ªframeçš„æ¯ä¸ªé€šé“å«æœ‰çš„é‡‡æ ·æ•°</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // åˆå§‹åŒ–frame</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    frame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_frame_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">ch_layout</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ch_layout;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">     // av_frame_alloc</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">sample_rate</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> sample_rate;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // é‡‡æ ·ç‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">format</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> sample_fmt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">       /* å¯¹äºlibfdk_aacç¼–ç å™¨ï¼Œå¡«ï¼šAV_SAMPLE_FMT_S16(packet)ï¼Œå› ä¸ºè¿™æ˜¯`ff_libfdk_aac_encoder`æ‰€æ”¯æŒçš„æ ¼å¼</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                       * å› ä¸ºæˆ‘çš„ffmpegæ˜¯å¼€æºç¤¾åŒºä¸‹è½½çš„ï¼Œæ²¡æœ‰åŒ…å«libfdk_aacè§£ç å™¨ï¼Œéœ€è¦æ‰‹åŠ¨ç¼–è¯‘æ‰æœ‰ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                       * </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                       * å¯¹äºaacç¼–ç å™¨ï¼Œå¡«ï¼ŒAV_SAMPLE_FMT_FLTPï¼ˆfltpï¼‰ï¼ˆfloat, planarï¼‰FFmpegå†…éƒ¨AACæ ¼å¼åªæ”¯æŒAV_SAMPLE_FMT_FLTPæ ¼å¼çš„PCM</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                       * è¿™é‡Œæ’­æ”¾æ—¶æç¤ºï¼ŒAAC RDB per ADTS frame is not implementedï¼Œæ˜¯å› ä¸ºæˆ‘è¿™é‡Œçš„aacç¼–ç å™¨æ²¡æœ‰å®ç°adtså¤´æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                       * å¦å¤–ï¼Œç”±äºfltpæ˜¯æŒ‡planaræ ¼å¼ï¼Œè€Œffmpegæå–pcmæ ¼å¼æ–‡ä»¶ä¸ºpackedæ ¼å¼ï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                       * æ‰€ä»¥è¯»å–æ–‡ä»¶çš„æ—¶å€™è¦åšç‰¹æ®Šå¤„ç†ï¼Œæˆ–è€…ä»…å¤„ç†å•å£°é“æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                       */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">nb_samples</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> nb_samples;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">   // æ¯å¸§ï¼ˆframeï¼‰é‡‡æ ·æ•°ï¼Œå¦‚æœæ˜¯`LC profile`é»˜è®¤ä¸º1024,å¦‚æœæ˜¯`HE profile`åˆ™è®¾ç½®ä¸º2048</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // ä¸ºframeåˆ†é…bufferç©ºé—´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_frame_get_buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(frame, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;av_frame_get_buffer failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ‰¾åˆ°ç¼–ç å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AVCodec </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">encoder </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_find_encoder_by_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;aac&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (encoder </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_find_encoder_by_name failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // åˆ›å»ºä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVCodecContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">encoderCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_alloc_context3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(encoder);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (encoderCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_alloc_context3 failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // å¡«å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    encoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">ch_layout</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> ch_layout;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    encoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">sample_rate</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> sample_rate;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">    encoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">sample_fmt</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> sample_fmt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ‰“å¼€ç¼–ç å™¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_open2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(encoderCtx, encoder, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_open2 failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // è¯»å–æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVPacket </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">packet </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_packet_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">fread</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">], </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">linesize</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">], srcFile) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // å‘é€ç»™ç¼–ç å™¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_send_frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(encoderCtx, frame);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">            av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_send_frame failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">            cleanUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">            return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // ä»ç¼–ç å™¨æ¥æ”¶æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        while</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">avcodec_receive_packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(encoderCtx, packet) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">            // å†™å…¥ADTS_Header</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">            uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> adts_header</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">7</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> {</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">};</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">            set_ADTS_Header</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">                adts_header,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">                packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">                1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">                sample_rate,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">                ch_layout</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">nb_channels</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">            fwrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(adts_header, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(adts_header), destFile);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">            // å†™å…¥æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">            fwrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, destFile);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">            av_packet_unref</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(packet);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="éŸ³è§†é¢‘é‡‡é›†" tabindex="-1"><a class="header-anchor" href="#éŸ³è§†é¢‘é‡‡é›†"><span>éŸ³è§†é¢‘é‡‡é›†</span></a></h2><h3 id="è§†é¢‘é‡‡é›†" tabindex="-1"><a class="header-anchor" href="#è§†é¢‘é‡‡é›†"><span>è§†é¢‘é‡‡é›†</span></a></h3><p><img src="/assets/image-47-BwTj37th.png" alt="Alt text"></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"># æŸ¥çœ‹è®¾å¤‡åˆ—è¡¨</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> ffmpeg</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -devices</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">Devices:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> D.</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> Demuxing</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> supported</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> .E</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> Muxing</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> supported</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> --</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  E</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> caca</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">            caca</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (color </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">ASCII</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> art</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">) output device</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> D</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  dshow</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">           DirectShow</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> capture</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> D</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  gdigrab</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">         GDI</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> API</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> Windows</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> frame</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> grabber</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> D</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  lavfi</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">           Libavfilter</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> virtual</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> input</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> device</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">      #è™šæ‹Ÿè¾“å…¥è®¾å¤‡</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> D</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  libcdio</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  E</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> sdl,sdl2</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">        SDL2</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> output</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> device</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                    #è¾“å‡ºè®¾å¤‡</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> D</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  vfwcap</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">          VfW</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> video</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> capture</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"># æŸ¥çœ‹dshowæ”¯æŒçš„å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> ffmpeg</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -h</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> demuxer=dshow</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">Demuxer</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> dshow</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> [DirectShow </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">capture]:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">dshow</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> indev</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> AVOptions:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  -video_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">        &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">image_siz</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> .D.........</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> video</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> size</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> given</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> string</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> such</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> as</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> 640x480</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> or</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> hd720.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  -pixel_format</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">      &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">pix_fm</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">    .D.........</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> video</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> pixel</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> format</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (default </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">none</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  -framerate</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">         &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">strin</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">g</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">     .D.........</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> video</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> frame</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> rate</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  -sample_rate</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">       &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">        .D.........</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> audio</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> sample</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> rate</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (from </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> INT_MAX</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">) (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">default</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  -sample_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">       &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">        .D.........</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> audio</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> sample</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> size</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (from </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> to</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 16</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">) (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">default</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  -channels</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">          &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">        .D.........</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> number</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> audio</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> channels,</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> such</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> as</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> or</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (from </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> INT_MAX</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">) (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">default</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">  -audio_buffer_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">        .D.........</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> audio</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> device</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> buffer</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> latency</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> size</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> milliseconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (default </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">is</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> device&#39;s default) (from 0 to INT_MAX) (default 0)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  -list_devices      &lt;boolean&gt;    .D......... list available devices (default false)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  -list_options      &lt;boolean&gt;    .D......... list available options for specified device (default false)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  -video_device_number &lt;int&gt;        .D......... set video device number for devices with same name (starts at 0) (from 0 to INT_MAX) (default 0)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  -audio_device_number &lt;int&gt;        .D......... set audio device number for devices with same name (starts at 0) (from 0 to INT_MAX) (default 0)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  -crossbar_video_input_pin_number &lt;int&gt;        .D......... set video input pin number for crossbar device (from -1 to INT_MAX) (default -1)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  -crossbar_audio_input_pin_number &lt;int&gt;        .D......... set audio input pin number for crossbar device (from -1 to INT_MAX) (default -1)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  -show_video_device_dialog &lt;boolean&gt;    .D......... display property dialog for video capture device (default false)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  -show_audio_device_dialog &lt;boolean&gt;    .D......... display property dialog for audio capture device (default false)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  -show_video_crossbar_connection_dialog &lt;boolean&gt;    .D......... display property dialog for crossbar connecting pins filter on video device (default false)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  -show_audio_crossbar_connection_dialog &lt;boolean&gt;    .D......... display property dialog for crossbar connecting pins filter on audio device (default false)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  -show_analog_tv_tuner_dialog &lt;boolean&gt;    .D......... display property dialog for analog tuner filter (default false)        </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  -show_analog_tv_tuner_audio_dialog &lt;boolean&gt;    .D......... display property dialog for analog tuner audio filter (default false)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  -audio_device_load &lt;string&gt;     .D......... load audio capture filter device (and properties) from file</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  -audio_device_save &lt;string&gt;     .D......... save audio capture filter device (and properties) to file</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  -video_device_load &lt;string&gt;     .D......... load video capture filter device (and properties) from file</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  -video_device_save &lt;string&gt;     .D......... save video capture filter device (and properties) to file</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  -use_video_device_timestamps &lt;boolean&gt;    .D......... use device instead of wallclock timestamps for video frames (default true)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"># æŸ¥çœ‹æ”¯æŒçš„é‡‡é›†è®¾å¤‡åˆ—è¡¨</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">ffmpeg</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> dshow</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -list_devices</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> true</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> dummy</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[dshow @ 00000242b296d600] </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;USB2.0 UVC HD Webcam&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">video</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[dshow @ 00000242b296d600]   Alternative name </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;@device_pnp_</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">?\usb#vid_13d3&amp;pid_5654&amp;mi_00#6&amp;3907f7b1&amp;0&amp;0000#{65e8773d-8f56-11d0-a3b9-00a0c9223196}\global&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[dshow @ 00000242b296d600] </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;éº¦å…‹é£ (Realtek High Definition Audio)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">audio</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[dshow @ 00000242b296d600]   Alternative name </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;@device_cm_{33D9A762-90C8-11D0-BD43-00A0C911CE86}\wave_{4030643A-CF6B-43BC-99F6-7AB127C53A99}&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"># é‡‡é›†ç”»é¢</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">ffmpeg</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> dshow</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> video=&#39;USB2.0 UVC HD Webcam&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -framerate</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 30</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -video_size</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> 640x480</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -pixel_format</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> yuyv422</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">  out.yuv</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"># ï¼ˆæŒ‡å®šçš„å‚æ•°å¥½åƒæ²¡æœ‰ç”¨</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"># æ’­æ”¾ç”»é¢</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">ffplay</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -framerate</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 30</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -video_size</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> 640x480</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -pixel_format</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> yuyv422</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> out.yuv</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/assets/image-48-CkZEueT-.png" alt="Alt text"></p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;stddef.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;stdio.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavutil/avutil.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavutil/imgutils.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // è®¡ç®—è§†é¢‘å¤§å°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavutil/log.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">      // ffmpegçš„æ—¥å¿—ç³»ç»Ÿ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavformat/avformat.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavcodec/avcodec.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavdevice/avdevice.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // è®¾å¤‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libswscale/swscale.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">   // è§†é¢‘ç¼©æ”¾</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> err;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> * åˆ—å‡ºå½“å‰æ‰€è¿è®¾å¤‡</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> list_devices</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // ffmpeg -f dshow -list_devices true -i dummy</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AVInputFormat </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">inputFmt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_find_input_format</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;dshow&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (inputFmt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;av_find_input_format failed!!!</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVDictionary </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">options </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_dict_set</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">options, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;list_devices&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;true&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVFormatContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">fmtCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_alloc_context</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_open_input</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">fmtCtx, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;dummy&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, inputFmt, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">options);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avformat_open_input failed!!!</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        è¾“å‡ºï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">            [dshow @ 000002572fc93000] &quot;USB2.0 UVC HD Webcam&quot; (video)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">            [dshow @ 000002572fc93000]   Alternative name &quot;@device_pnp_\\?\usb#vid_13d3&amp;pid_5654&amp;mi_00#6&amp;3907f7b1&amp;0&amp;0000#{65e8773d-8f56-11d0-a3b9-00a0c9223196}\global&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">            [dshow @ 000002572fc93000] &quot;éº¦å…‹é£ (Realtek High Definition Audio)&quot; (audio)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">            [dshow @ 000002572fc93000]   Alternative name &quot;@device_cm_{33D9A762-90C8-11D0-BD43-00A0C911CE86}\wave_{4030643A-CF6B-43BC-99F6-7AB127C53A99}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (fmtCtx)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        avformat_close_input</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">fmtCtx);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // å…³é—­è¾“å…¥</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        avformat_free_context</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(fmtCtx);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // é‡Šæ”¾è¾“å…¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> decodeVideoYUV420p</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(AVCodecContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> SwsContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">swsCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AVPacket </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AVFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">destFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, FILE </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">dest</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">avcodec_send_packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, packet) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        AVFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">srcframe </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_frame_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        while</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">avcodec_receive_frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, srcframe) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">            sws_scale</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(swsCtx,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                                    // swscaleä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">                      srcframe</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">srcframe</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">linesize</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // æºFrameæ•°æ® æºFrameå®½åº¦ èµ·å§‹ä½ç½® åŸå§‹å›¾ç‰‡é«˜åº¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">                      destFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">destFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">linesize</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                       // ç›®æ ‡Frameæ•°æ® ç›®æ ‡Frameå®½åº¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">            );</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">            // yuv420p (packed format)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">            fwrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">destFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">], </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">width</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, dest);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">            fwrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">destFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">], </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">width</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">height</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 4</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, dest);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">            fwrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">destFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">], </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">width</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">height</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 4</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, dest);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_frame_free</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">srcframe);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> decodeVideo</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(AVCodecContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AVPacket </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, FILE </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">dest</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">avcodec_send_packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, packet) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        AVFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">frame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_frame_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        while</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">avcodec_receive_frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, frame) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">            // uyvu422 yuv422 (packed format)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">            fwrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">], </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">width</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">height</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, dest);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_frame_free</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">frame);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> **</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // è®¾ç½®æ—¥å¿—çº§åˆ«</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log_set_level</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(AV_LOG_INFO);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ³¨å†Œæ‰€æœ‰device</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    avdevice_register_all</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (argc </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // æ˜¾ç¤ºæ‰€æœ‰è¾“å…¥è®¾å¤‡</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        list_devices</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // æ˜¾ç¤ºç”¨æ³•</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;useage: </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;deviceName&gt; &lt;output.yuv&gt; &lt;yuv420p.yuv&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">]);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ‰“å¼€è®¾å¤‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">deviceName </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">outputName1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">outputNmae2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // open file</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    FILE </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">dest1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> fopen</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(outputName1, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;wb&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (dest1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;fopen failed!!!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        goto</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> end;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    FILE </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">dest2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> fopen</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(outputNmae2, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;wb&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (dest2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;fopen failed!!!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        goto</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> end;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // ffmpeg -f dshow -i video=&#39;USB2.0 UVC HD Webcam&#39; -framerate 30 -video_size 640x480 -pixel_format yuyv422  out.yuv</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // ffplay out.yuv -framerate 30 -video_size 640x480 -pixel_format yuyv422</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AVInputFormat </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">inputFmt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_find_input_format</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;dshow&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (inputFmt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;av_find_input_format failed!!!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        goto</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> end;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVFormatContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">fmtCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_alloc_context</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    char</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> inputName</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">256</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> {</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">};</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    strcat</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(inputName, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;video=&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    strcat</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(inputName, deviceName);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_INFO, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;input: </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%s</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, inputName);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVDictionary </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">options </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // av_dict_set(&amp;options, &quot;framerate&quot;, &quot;30&quot;, 0);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // av_dict_set(&amp;options, &quot;pixel_format&quot;, &quot;yuyv422&quot;, 0);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // av_dict_set(&amp;options, &quot;video_size&quot;, &quot;640x480&quot;, 0);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_open_input</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">fmtCtx, inputName, inputFmt, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">options);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (err)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avformat_open_input failed!!!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        goto</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> end;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // è¾“å‡ºæµä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_dump_format</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(fmtCtx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, deviceName, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ¢æµ‹æµ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // get stream information</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_find_stream_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(fmtCtx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;av_find_best_stream failed!!!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        goto</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> end;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ‰¾åˆ°è§†é¢‘æµ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // av_find_best_stream</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> videoIndex </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_find_best_stream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(fmtCtx, AVMEDIA_TYPE_VIDEO, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (videoIndex </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;av_find_best_stream failed!!!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        goto</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> end;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // åˆ†é…ç¼–ç å™¨ä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVCodecContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">decoderCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_alloc_context3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_parameters_to_context</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">fmtCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">streams</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[videoIndex]-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codecpar</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_parameters_to_context failed!!!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        goto</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> end;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AVCodec </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">decoder </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_find_decoder</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codec_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (decoder </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_find_decoder failed!!!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        goto</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> end;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_INFO, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;decoder name: </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%s</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoder</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_open2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, decoder, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_open2 failed!!!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        goto</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> end;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // è·å–æºé¢œè‰²ç©ºé—´</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AVPixelFormat srcPixFmt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;"> decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">pix_fmt</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AVPixelFormat destPixFmt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AV_PIX_FMT_YUV420P;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // AV_PIX_FMT_YUV420P</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // è·å–swscaleä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> SwsContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">swsCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> sws_getContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">        decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">width</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, srcPixFmt,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  // æºåˆ†è¾¨ç‡ æºå›¾åƒç©ºé—´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">        decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">width</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, destPixFmt,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // ç›®æ ‡åˆ†è¾¨ç‡ ç›®æ ‡å›¾åƒç©ºé—´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        SWS_FAST_BILINEAR,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                 // ç¼©æ”¾ç®—æ³•</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">        NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                              // æºå›¾åƒè¿‡æ»¤å™¨ï¼ˆå‰åå›¾åƒæ»¤æ³¢å¤„ç†ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">        NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                              // ç›®æ ‡å›¾åƒæ»¤æ³¢å™¨</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">        NULL</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">                                               // å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (swsCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;sws_getContext failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        goto</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> end;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // åˆ›å»ºdestFrame</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">destFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_frame_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // ä¸ºdestFrameçš„dataåˆ†é…å†…å­˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    uint8_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">destBuffer </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_malloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">av_image_get_buffer_size</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(destPixFmt, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">width</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æŠŠæ‰€åˆ†é…å†…å­˜çš„åœ°å€ï¼Œé€šè¿‡è®¡ç®—ï¼Œåˆ†åˆ«è®¾ç½®åˆ°Y:data[0] U:data[1] V:data[2] ä¸­</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_image_fill_arrays</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">destFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">destFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">linesize</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, destBuffer, destPixFmt, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">width</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVPacket </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">packet </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_packet_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">av_read_frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(fmtCtx, packet) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">stream_index</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> ==</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> videoIndex)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">                decodeVideo</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, packet, dest1);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">                decodeVideoYUV420p</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, swsCtx, packet, destFrame, dest2);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_packet_unref</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(packet);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_packet_free</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">packet);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    decodeVideo</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, dest1);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    decodeVideoYUV420p</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, swsCtx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, destFrame, dest2);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">end:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (dest1)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        fclose</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(dest1);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (fmtCtx)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        avformat_close_input</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">fmtCtx);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // å…³é—­è¾“å…¥</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        avformat_free_context</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(fmtCtx);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // é‡Šæ”¾è¾“å…¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="éŸ³é¢‘é‡‡é›†" tabindex="-1"><a class="header-anchor" href="#éŸ³é¢‘é‡‡é›†"><span>éŸ³é¢‘é‡‡é›†</span></a></h3><p><img src="/assets/image-49-DZPvMTFm.png" alt="Alt text"></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">ffmpeg</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> dshow</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -list_devices</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> true</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> dummy</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"># </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[dshow @ 000001fe0d72d340] </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;USB2.0 UVC HD Webcam&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">video</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[dshow @ 000001fe0d72d340]   Alternative name </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;@device_pnp_</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">?\usb#vid_13d3&amp;pid_5654&amp;mi_00#6&amp;3907f7b1&amp;0&amp;0000#{65e8773d-8f56-11d0-a3b9-00a0c9223196}\global&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[dshow @ 000001fe0d72d340] </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;éº¦å…‹é£ (Realtek High Definition Audio)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">audio</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[dshow @ 000001fe0d72d340]   Alternative name </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;@device_cm_{33D9A762-90C8-11D0-BD43-00A0C911CE86}\wave_{4030643A-CF6B-43BC-99F6-7AB127C53A99}&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"># é‡‡é›†</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">ffmpeg</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> dshow</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> audio=&quot;éº¦å…‹é£ (Realtek High Definition Audio)&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -ar</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 44100</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -ac</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 1</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> f32le</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> output.pcm</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"># æ’­æ”¾</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">ffplay</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -ar</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 44100</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -ac</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 1</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> f32le</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> output.pcm</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;stddef.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;stdio.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavutil/log.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // ffmpegçš„æ—¥å¿—ç³»ç»Ÿ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavformat/avformat.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavcodec/avcodec.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libavdevice/avdevice.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // è®¾å¤‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;libswscale/swscale.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">   // è§†é¢‘ç¼©æ”¾</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> err;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> * åˆ—å‡ºå½“å‰æ‰€è¿è®¾å¤‡</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> list_devices</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // ffmpeg -f dshow -list_devices true -i dummy</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AVInputFormat </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">inputFmt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_find_input_format</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;dshow&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (inputFmt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;av_find_input_format failed!!!</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVDictionary </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">options </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_dict_set</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">options, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;list_devices&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;true&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVFormatContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">fmtCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_alloc_context</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_open_input</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">fmtCtx, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;dummy&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, inputFmt, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">options);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avformat_open_input failed!!!</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        è¾“å‡ºï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">            [dshow @ 000002572fc93000] &quot;USB2.0 UVC HD Webcam&quot; (video)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">            [dshow @ 000002572fc93000]   Alternative name &quot;@device_pnp_\\?\usb#vid_13d3&amp;pid_5654&amp;mi_00#6&amp;3907f7b1&amp;0&amp;0000#{65e8773d-8f56-11d0-a3b9-00a0c9223196}\global&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">            [dshow @ 000002572fc93000] &quot;éº¦å…‹é£ (Realtek High Definition Audio)&quot; (audio)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">            [dshow @ 000002572fc93000]   Alternative name &quot;@device_cm_{33D9A762-90C8-11D0-BD43-00A0C911CE86}\wave_{4030643A-CF6B-43BC-99F6-7AB127C53A99}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (fmtCtx)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        avformat_close_input</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">fmtCtx);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // å…³é—­è¾“å…¥</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        avformat_free_context</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(fmtCtx);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // é‡Šæ”¾è¾“å…¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> decodeAudio</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(AVCodecContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AVPacket </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, FILE </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">dest</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">avcodec_send_packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, packet) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        AVFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">frame </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_frame_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        while</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">avcodec_receive_frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, frame) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">            // f32le packed</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">            fwrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">], </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">linesize</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">], dest);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_frame_free</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">frame);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> **</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // è®¾ç½®æ—¥å¿—çº§åˆ«</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log_set_level</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(AV_LOG_INFO);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ³¨å†Œæ‰€æœ‰device</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    avdevice_register_all</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (argc </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // æ˜¾ç¤ºæ‰€æœ‰è¾“å…¥è®¾å¤‡</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        list_devices</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        // æ˜¾ç¤ºç”¨æ³•</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;useage: </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> &lt;deviceName&gt; &lt;output_f32le.pcm&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">]);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ‰“å¼€è®¾å¤‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">deviceName </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">outputName </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // open file</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    FILE </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">dest </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> fopen</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(outputName, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;wb&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (dest </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;fopen failed!!!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        goto</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> end;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // ffmpeg -f dshow -i audio=&quot;éº¦å…‹é£ (Realtek High Definition Audio)&quot; -ar 44100 -ac 1 -f s16le output.pcm</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // ffplay -ar 44100 -ac 2 -f s16le output.pcm</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AVInputFormat </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">inputFmt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_find_input_format</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;dshow&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (inputFmt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;av_find_input_format failed!!!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        goto</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> end;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVFormatContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">fmtCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_alloc_context</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    char</span><span style="--shiki-light:#E36209;--shiki-dark:#9CDCFE;"> inputName</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">256</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> {</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">};</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    strcat</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(inputName, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;audio=&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    strcat</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(inputName, deviceName);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_INFO, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;input: </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%s</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, inputName);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVDictionary </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">options </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_dict_set</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">options, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;ar&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;44100&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_dict_set</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">options, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;ac&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_dict_set</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">options, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;f&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;s16le&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_open_input</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">fmtCtx, inputName, inputFmt, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">options);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (err)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avformat_open_input failed!!!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        goto</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> end;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // è¾“å‡ºæµä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_dump_format</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(fmtCtx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, deviceName, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ¢æµ‹æµ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // get stream information</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avformat_find_stream_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(fmtCtx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;av_find_best_stream failed!!!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        goto</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> end;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // æ‰¾åˆ°éŸ³é¢‘æµ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // av_find_best_stream</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> audioIndex </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_find_best_stream</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(fmtCtx, AVMEDIA_TYPE_AUDIO, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (audioIndex </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;av_find_best_stream failed!!!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        goto</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> end;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // åˆ†é…ç¼–ç å™¨ä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVCodecContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">decoderCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_alloc_context3</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_parameters_to_context</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">fmtCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">streams</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">[audioIndex]-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codecpar</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_parameters_to_context failed!!!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        goto</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> end;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#569CD6;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> AVCodec </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">decoder </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_find_decoder</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoderCtx</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">codec_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (decoder </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_find_decoder failed!!!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        goto</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> end;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_INFO, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;decoder name: </span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;">%s</span><span style="--shiki-light:#005CC5;--shiki-dark:#D7BA7D;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">decoder</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> avcodec_open2</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, decoder, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_log</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, AV_LOG_ERROR, </span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;">&quot;avcodec_open2 failed!!!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        goto</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> end;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    AVPacket </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">packet </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;"> av_packet_alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">av_read_frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(fmtCtx, packet) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">packet</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#9CDCFE;">stream_index</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;"> ==</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> audioIndex)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">                decodeAudio</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, packet, dest);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        av_packet_unref</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(packet);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    av_packet_free</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">packet);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">    decodeAudio</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(decoderCtx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#569CD6;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">, dest);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">end:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (dest)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        fclose</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(dest);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;"> (fmtCtx)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        avformat_close_input</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D4D4D4;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">fmtCtx);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // å…³é—­è¾“å…¥</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">        avformat_free_context</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">(fmtCtx);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // é‡Šæ”¾è¾“å…¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E6E6E6;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åŒæ—¶é‡‡é›†è§†é¢‘å’ŒéŸ³é¢‘" tabindex="-1"><a class="header-anchor" href="#åŒæ—¶é‡‡é›†è§†é¢‘å’ŒéŸ³é¢‘"><span>åŒæ—¶é‡‡é›†è§†é¢‘å’ŒéŸ³é¢‘</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCDCAA;">ffmpeg</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> dshow</span><span style="--shiki-light:#005CC5;--shiki-dark:#CE9178;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> video=&#39;USB2.0 UVC HD Webcam&#39;:audio=&quot;éº¦å…‹é£ (Realtek High Definition Audio)&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#CE9178;"> out.mp4</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#E6E6E6;--shiki-light-bg:#fff;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-light slack-dark vp-code"><code><span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="éŸ³è§†é¢‘æ’­æ”¾ä¸æ˜¾ç¤º" tabindex="-1"><a class="header-anchor" href="#éŸ³è§†é¢‘æ’­æ”¾ä¸æ˜¾ç¤º"><span>éŸ³è§†é¢‘æ’­æ”¾ä¸æ˜¾ç¤º</span></a></h2><h3 id="sdl" tabindex="-1"><a class="header-anchor" href="#sdl"><span>SDL</span></a></h3><p><img src="/assets/image-50-BjbQOY2C.png" alt="Alt text"></p></div><!----><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><!----><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: 2449695354@qq.com">YiguiDing</span><!--]--><!--]--></div></div></footer><!----><div id="vp-comment" class="giscus-wrapper input-top" style="display:block;"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><circle cx="28" cy="75" r="11" fill="currentColor"><animate attributeName="fill-opacity" begin="0s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></circle><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 47a28 28 0 0 1 28 28"><animate attributeName="stroke-opacity" begin="0.1s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 25a50 50 0 0 1 50 50"><animate attributeName="stroke-opacity" begin="0.2s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path></svg></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><!----><div class="vp-copyright">MIT Licensed | Copyright Â© 2019-present Yigui-Ding</div></footer></div><!--]--><!--[--><!----><!----><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-DXcObvjK.js" defer></script>
  </body>
</html>
