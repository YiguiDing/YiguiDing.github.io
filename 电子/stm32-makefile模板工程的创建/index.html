<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.52" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://dingdingdang.online/%E7%94%B5%E5%AD%90/stm32-makefile%E6%A8%A1%E6%9D%BF%E5%B7%A5%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA/"><meta property="og:site_name" content="YiguiDing的Blog小站"><meta property="og:title" content="stm32-makefile项目的创建(c/c++混合编译)"><meta property="og:description" content="stm32-makefile项目的创建(c/c++混合编译) 工程文件结构 Makefile文件的生成和修改 先使用STM32CubeMX生成Hal库的makefile工程 Alt text 删除大部分文件，保留两个文件 Makefile文件 链接脚本，文件名可能为：STM32F103C8Tx_FLASH.ld 下载并解压STM32F10x_StdPe..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-07-22T16:53:14.000Z"><meta property="article:author" content="丁毅桂"><meta property="article:published_time" content="2024-07-21T04:01:00.000Z"><meta property="article:modified_time" content="2024-07-22T16:53:14.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"stm32-makefile项目的创建(c/c++混合编译)","image":[""],"datePublished":"2024-07-21T04:01:00.000Z","dateModified":"2024-07-22T16:53:14.000Z","author":[{"@type":"Person","name":"丁毅桂","email":"2449695354@qq.com"}]}</script><meta name="baidu-site-verification" content="codeva-PwE9Ts6nMl"><link rel="alternate" type="application/rss+xml" href="https://dingdingdang.online/rss.xml" title="YiguiDing的Blog小站 RSS Feed"><link rel="icon" href="/images/favicon_icon.jpg"><title>stm32-makefile项目的创建(c/c++混合编译) | YiguiDing的Blog小站</title><meta name="description" content="stm32-makefile项目的创建(c/c++混合编译) 工程文件结构 Makefile文件的生成和修改 先使用STM32CubeMX生成Hal库的makefile工程 Alt text 删除大部分文件，保留两个文件 Makefile文件 链接脚本，文件名可能为：STM32F103C8Tx_FLASH.ld 下载并解压STM32F10x_StdPe...">
    <link rel="preload" href="/assets/style-C1dX7O-H.css" as="style"><link rel="stylesheet" href="/assets/style-C1dX7O-H.css">
    <link rel="modulepreload" href="/assets/app-DjDtDPYL.js"><link rel="modulepreload" href="/assets/index.html-B-etisI3.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><!----><!----><span class="vp-site-name">YiguiDing的Blog小站</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="主页"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-house-chimney" style=""></span><!--]-->主页<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="笔记"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>笔记<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/%E5%89%8D%E7%AB%AF/" aria-label="前端"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-code" style=""></span><!--]-->前端<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/%E5%90%8E%E7%AB%AF/" aria-label="后端"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-server" style=""></span><!--]-->后端<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/%E7%AE%97%E6%B3%95/" aria-label="算法"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-diagram-project" style=""></span><!--]-->算法<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/%E7%94%B5%E5%AD%90/" aria-label="电子"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-bolt" style=""></span><!--]-->电子<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/%E6%BA%90%E7%A0%81/" aria-label="源码"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-code-fork" style=""></span><!--]-->源码<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/%E7%90%86%E8%AE%BA/" aria-label="理论"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-book-bookmark" style=""></span><!--]-->理论<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/%E5%B7%A5%E5%85%B7/" aria-label="工具"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-screwdriver-wrench" style=""></span><!--]-->工具<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/%E9%9A%8F%E7%AC%94/" aria-label="随笔"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-note-sticky" style=""></span><!--]-->随笔<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/%E9%A1%B9%E7%9B%AE/" aria-label="项目"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-box" style=""></span><!--]-->项目<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/%E7%BD%91%E7%AB%99/%E5%8F%8B%E9%93%BE.html" aria-label="友链"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-user-group" style=""></span><!--]-->友链<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/%E7%BD%91%E7%AB%99/%E5%85%B3%E4%BA%8E.html" aria-label="关于"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-address-card" style=""></span><!--]-->关于<!----></a></div></nav><!----><!----><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">搜索</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">卡尔曼滤波器MPU6050姿态解算</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">FOC算法实现过程记录v2</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">卡尔曼滤波器学习笔记</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">51单片机重学笔记</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Arduino学习笔记</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">FOC算法学习与实现笔记</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">FOC算法实现过程记录</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Motion Driver 6.12(官方 DMP库)的移植和 MPU6050驱动的实现</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Multisim笔记</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Simple FOC源码阅读学习笔记</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">Stm32 Makefile模板工程的创建</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/%E7%94%B5%E5%AD%90/stm32-makefile%E6%A8%A1%E6%9D%BF%E5%B7%A5%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA/" aria-label="stm32-makefile项目的创建(c/c++混合编译)"><!---->stm32-makefile项目的创建(c/c++混合编译)<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">STM32及标准库学习笔记</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Zip笔记归档</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">串口通信</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">电机控制技术学习笔记</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">电路原理</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->stm32-makefile项目的创建(c/c++混合编译)</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">丁毅桂</span></span><span property="author" content="丁毅桂"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-07-21T04:01:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 2 分钟</span><meta property="timeRequired" content="PT2M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#工程文件结构">工程文件结构</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#makefile文件的生成和修改">Makefile文件的生成和修改</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#编写makefile指令实现写入-擦除">编写makefile指令实现写入\擦除</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="stm32-makefile项目的创建-c-c-混合编译" tabindex="-1"><a class="header-anchor" href="#stm32-makefile项目的创建-c-c-混合编译"><span>stm32-makefile项目的创建(c/c++混合编译)</span></a></h1><h2 id="工程文件结构" tabindex="-1"><a class="header-anchor" href="#工程文件结构"><span>工程文件结构</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">Core</span>
<span class="line">    Inc</span>
<span class="line">        stm32f10x_conf.h</span>
<span class="line">        stm32f10x_it.h</span>
<span class="line">    Src</span>
<span class="line">        main.cpp</span>
<span class="line">        stm32f10x_it.c</span>
<span class="line">Drivers</span>
<span class="line">    <span class="token comment"># 官方标准外设库:</span></span>
<span class="line">    <span class="token comment"># 文件目录保持原始结构</span></span>
<span class="line">    STM32F10x_StdPeriph_Lib_V3.5.0/Libraries/ </span>
<span class="line">        CMSIS/</span>
<span class="line">            CM3/CoreSupport/core_cm3/<span class="token punctuation">{</span>*.c,*.h<span class="token punctuation">}</span> <span class="token comment"># 内核接口</span></span>
<span class="line">            CM3/DeviceSupport/ST/STM32F10x/startup/gcc_ride7/startup_stm32f10x_md.s <span class="token comment"># 启动文件</span></span>
<span class="line">            CM3/DeviceSupport/ST/STM32F10x/<span class="token punctuation">{</span>stm32f10x.h<span class="token punctuation">}</span> <span class="token comment"># 头文件</span></span>
<span class="line">            CM3/DeviceSupport/ST/STM32F10x/system_stm32f10x<span class="token punctuation">{</span>.c,.h<span class="token punctuation">}</span></span>
<span class="line">        STM32F10x_StdPeriph_Driver/ <span class="token comment"># 标准外设库</span></span>
<span class="line">            inc/<span class="token punctuation">{</span>*.c<span class="token punctuation">}</span></span>
<span class="line">            inc/<span class="token punctuation">{</span>*.h<span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="makefile文件的生成和修改" tabindex="-1"><a class="header-anchor" href="#makefile文件的生成和修改"><span>Makefile文件的生成和修改</span></a></h2><ol><li>先使用STM32CubeMX生成Hal库的makefile工程 <ul><li><img src="/assets/image-BXVG57Dc.png" alt="Alt text"></li></ul></li><li>删除大部分文件，保留两个文件 <ol><li><code>Makefile</code>文件</li><li>链接脚本，文件名可能为：<code>STM32F103C8Tx_FLASH.ld</code></li></ol></li><li>下载并解压<code>STM32F10x_StdPeriph_Lib_V3.5.0</code></li><li>复制<code>STM32F10x_StdPeriph_Lib_V3.5.0</code>到<code>Drivers</code>目录</li><li>修改<code>Makefile</code>文件</li></ol><div class="vp-code-tabs"><div class="vp-code-tabs-nav" role="tablist"><button type="button" class="vp-code-tab-nav active" role="tab" aria-controls="codetab-56-0" aria-selected="true"><code>修改后的Makefile</code></button><button type="button" class="vp-code-tab-nav" role="tab" aria-controls="codetab-56-1" aria-selected="false"><code>修改前的Makefile</code></button><button type="button" class="vp-code-tab-nav" role="tab" aria-controls="codetab-56-2" aria-selected="false"><code>STM32F103C8Tx_FLASH.ld</code></button></div><!--[--><div class="vp-code-tab active" id="codetab-56-0" role="tabpanel" aria-expanded="true"><div class="vp-code-tab-title"><code>修改后的Makefile</code></div><!--[--><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp" data-title="cpp"><pre><code><span class="line"># <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Generic <span class="token function">Makefile</span> <span class="token punctuation">(</span>based on gcc<span class="token punctuation">)</span></span></span></span>
<span class="line">#</span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">ChangeLog <span class="token operator">:</span></span></span></span>
<span class="line"># 	<span class="token number">2024</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">22</span> <span class="token operator">-</span> 实现c<span class="token operator">/</span>c<span class="token operator">++</span>混合编译、调用openocd实现写入<span class="token operator">/</span>擦除</span>
<span class="line">#	<span class="token number">2017</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">10</span> <span class="token operator">-</span> Several enhancements <span class="token operator">+</span> project update mode</span>
<span class="line">#   <span class="token number">2015</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">22</span> <span class="token operator">-</span> first version</span>
<span class="line"># <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span></span>
<span class="line"></span>
<span class="line">######################################</span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">target</span></span></span>
<span class="line">######################################</span>
<span class="line">TARGET <span class="token operator">=</span> <span class="token keyword">template</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">######################################</span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">building</span> <span class="token expression">variables</span></span></span>
<span class="line">######################################</span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">debug</span> <span class="token expression">build<span class="token operator">?</span></span></span></span>
<span class="line">DEBUG <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">optimization</span></span></span>
<span class="line">OPT <span class="token operator">=</span> <span class="token operator">-</span>Og</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">#######################################</span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">paths</span></span></span>
<span class="line">#######################################</span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Build path</span></span></span>
<span class="line">BUILD_DIR <span class="token operator">=</span> build</span>
<span class="line"></span>
<span class="line">######################################</span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">source</span></span></span>
<span class="line">######################################</span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">C sources</span></span></span>
<span class="line">C_SOURCES <span class="token operator">=</span>  \</span>
<span class="line">	$<span class="token punctuation">(</span>wildcard Core<span class="token operator">/</span>Src<span class="token operator">/</span>stm32f10x_it<span class="token punctuation">.</span>c<span class="token punctuation">)</span> \</span>
<span class="line">	$<span class="token punctuation">(</span>wildcard Drivers<span class="token operator">/</span>STM32F10x_StdPeriph_Lib_V3<span class="token punctuation">.</span><span class="token number">5.0</span><span class="token operator">/</span>Libraries<span class="token operator">/</span>CMSIS<span class="token operator">/</span>CM3<span class="token operator">/</span>CoreSupport<span class="token comment">/*.c) \</span>
<span class="line">	$(wildcard Drivers/STM32F10x_StdPeriph_Lib_V3.5.0/Libraries/CMSIS/CM3/DeviceSupport/ST/STM32F10x/*.c) \</span>
<span class="line">	$(wildcard Drivers/STM32F10x_StdPeriph_Lib_V3.5.0/Libraries/STM32F10x_StdPeriph_Driver/src/*.c) \</span>
<span class="line"></span>
<span class="line">CPP_SOURCES =  \</span>
<span class="line">	$(wildcard Core/Src/main.cpp) \</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"># ASM sources</span>
<span class="line">ASM_SOURCES =  \</span>
<span class="line">	$(wildcard Drivers/STM32F10x_StdPeriph_Lib_V3.5.0/Libraries/CMSIS/CM3/DeviceSupport/ST/STM32F10x/startup/gcc_ride7/startup_stm32f10x_md.s) \</span>
<span class="line"></span>
<span class="line"># ASM sources</span>
<span class="line">ASMM_SOURCES = </span>
<span class="line"></span>
<span class="line"></span>
<span class="line">#######################################</span>
<span class="line"># binaries</span>
<span class="line">#######################################</span>
<span class="line">PREFIX = arm-none-eabi-</span>
<span class="line"># The gcc compiler bin path can be either defined in make command via GCC_PATH variable (&gt; make GCC_PATH=xxx)</span>
<span class="line"># either it can be added to the PATH environment variable.</span>
<span class="line">ifdef GCC_PATH</span>
<span class="line">CC = $(GCC_PATH)/$(PREFIX)gcc</span>
<span class="line">XX = $(GCC_PATH)/$(PREFIX)g++</span>
<span class="line">AS = $(GCC_PATH)/$(PREFIX)gcc -x assembler-with-cpp</span>
<span class="line">CP = $(GCC_PATH)/$(PREFIX)objcopy</span>
<span class="line">SZ = $(GCC_PATH)/$(PREFIX)size</span>
<span class="line">else</span>
<span class="line">CC = $(PREFIX)gcc</span>
<span class="line">XX = $(PREFIX)g++</span>
<span class="line">AS = $(PREFIX)gcc -x assembler-with-cpp</span>
<span class="line">CP = $(PREFIX)objcopy</span>
<span class="line">SZ = $(PREFIX)size</span>
<span class="line">endif</span>
<span class="line">HEX = $(CP) -O ihex</span>
<span class="line">BIN = $(CP) -O binary -S</span>
<span class="line"> </span>
<span class="line">#######################################</span>
<span class="line"># C_FLAGS</span>
<span class="line">#######################################</span>
<span class="line"># cpu</span>
<span class="line">CPU = -mcpu=cortex-m3</span>
<span class="line"></span>
<span class="line">FLASH_START = 0x08000000</span>
<span class="line"># fpu</span>
<span class="line"># NONE for Cortex-M0/M0+/M3</span>
<span class="line"></span>
<span class="line"># float-abi</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"># mcu</span>
<span class="line">MCU = $(CPU) -mthumb $(FPU) $(FLOAT-ABI)</span>
<span class="line"></span>
<span class="line"># macros for gcc</span>
<span class="line"># AS defines</span>
<span class="line">AS_DEFS = </span>
<span class="line"></span>
<span class="line"># C defines</span>
<span class="line">C_DEFS =  \</span>
<span class="line">	-D STM32F10X_MD \</span>
<span class="line">	-D USE_STDPERIPH_DRIVER</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"># AS includes</span>
<span class="line">AS_INCLUDES = </span>
<span class="line"></span>
<span class="line"># C includes</span>
<span class="line">C_CPP_INCLUDES =  \</span>
<span class="line">	-I Core/Inc/ \</span>
<span class="line">	-I Drivers/STM32F10x_StdPeriph_Lib_V3.5.0/Libraries/CMSIS/CM3/CoreSupport/ \</span>
<span class="line">	-I Drivers/STM32F10x_StdPeriph_Lib_V3.5.0/Libraries/CMSIS/CM3/DeviceSupport/ST/STM32F10x/ \</span>
<span class="line">	-I Drivers/STM32F10x_StdPeriph_Lib_V3.5.0/Libraries/STM32F10x_StdPeriph_Driver/inc/ \</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"># compile gcc flags</span>
<span class="line">ASFLAGS = $(MCU) $(AS_DEFS) $(AS_INCLUDES) $(OPT) -Wall -fdata-sections -ffunction-sections</span>
<span class="line"></span>
<span class="line">C_FLAGS += $(MCU) $(C_DEFS) $(C_CPP_INCLUDES) $(OPT) -Wall -fdata-sections -ffunction-sections</span>
<span class="line"></span>
<span class="line">CPP_FLAGS += $(MCU) $(C_DEFS) $(C_CPP_INCLUDES) $(OPT) -Wall -fdata-sections -ffunction-sections</span>
<span class="line"></span>
<span class="line">ifeq ($(DEBUG), 1)</span>
<span class="line">C_FLAGS += -g -gdwarf-2</span>
<span class="line">CPP_FLAGS += -g -gdwarf-2</span>
<span class="line">endif</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"># Generate dependency information</span>
<span class="line">C_FLAGS += -MMD -MP -MF&quot;$(@:%.o=%.d)&quot;</span>
<span class="line">CPP_FLAGS += -MMD -MP -MF&quot;$(@:%.o=%.d)&quot;</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">#######################################</span>
<span class="line"># LDFLAGS</span>
<span class="line">#######################################</span>
<span class="line"># link script</span>
<span class="line">LDSCRIPT = STM32F103C8Tx_FLASH.ld</span>
<span class="line"></span>
<span class="line"># libraries</span>
<span class="line">LIBS = -lc -lm -lnosys </span>
<span class="line">LIBDIR = </span>
<span class="line">LDFLAGS = $(MCU) -specs=nosys.specs -T$(LDSCRIPT) $(LIBDIR) $(LIBS) -Wl,-Map=$(BUILD_DIR)/$(TARGET).map,--cref -Wl,--gc-sections,--print-memory-usage </span>
<span class="line"></span>
<span class="line"># default action: build all</span>
<span class="line">all: $(BUILD_DIR)/$(TARGET).elf $(BUILD_DIR)/$(TARGET).hex $(BUILD_DIR)/$(TARGET).bin</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">#######################################</span>
<span class="line"># build the application</span>
<span class="line">#######################################</span>
<span class="line"># list of c program objects</span>
<span class="line">OBJECTS = $(addprefix $(BUILD_DIR)/,$(notdir $(C_SOURCES:.c=.o)))</span>
<span class="line">vpath %.c $(sort $(dir $(C_SOURCES)))</span>
<span class="line"># list of cpp program objects</span>
<span class="line">OBJECTS += $(addprefix $(BUILD_DIR)/,$(notdir $(CPP_SOURCES:.cpp=.o)))</span>
<span class="line">vpath %.cpp $(sort $(dir $(CPP_SOURCES)))</span>
<span class="line"># list of ASM program objects</span>
<span class="line">OBJECTS += $(addprefix $(BUILD_DIR)/,$(notdir $(ASM_SOURCES:.s=.o)))</span>
<span class="line">vpath %.s $(sort $(dir $(ASM_SOURCES)))</span>
<span class="line">OBJECTS += $(addprefix $(BUILD_DIR)/,$(notdir $(ASMM_SOURCES:.S=.o)))</span>
<span class="line">vpath %.S $(sort $(dir $(ASMM_SOURCES)))</span>
<span class="line"></span>
<span class="line">$(BUILD_DIR)/%.o: %.c Makefile | $(BUILD_DIR) </span>
<span class="line">	$(CC) -c $(C_FLAGS) -Wa,-a,-ad,-alms=$(BUILD_DIR)/$(notdir $(&lt;:.c=.lst)) $&lt; -o $@</span>
<span class="line"></span>
<span class="line">$(BUILD_DIR)/%.o: %.cpp Makefile | $(BUILD_DIR) </span>
<span class="line">	$(XX) -c $(CPP_FLAGS) -Wa,-a,-ad,-alms=$(BUILD_DIR)/$(notdir $(&lt;:.cpp=.lst)) $&lt; -o $@</span>
<span class="line"></span>
<span class="line">$(BUILD_DIR)/%.o: %.s Makefile | $(BUILD_DIR)</span>
<span class="line">	$(AS) -c $(C_FLAGS) $&lt; -o $@</span>
<span class="line"></span>
<span class="line">$(BUILD_DIR)/$(TARGET).elf: $(OBJECTS) Makefile</span>
<span class="line">	$(CC) $(OBJECTS) $(LDFLAGS) -o $@</span>
<span class="line">	$(SZ) $@</span>
<span class="line"></span>
<span class="line">$(BUILD_DIR)/%.hex: $(BUILD_DIR)/%.elf | $(BUILD_DIR)</span>
<span class="line">	$(HEX) $&lt; $@</span>
<span class="line">	</span>
<span class="line">$(BUILD_DIR)/%.bin: $(BUILD_DIR)/%.elf | $(BUILD_DIR)</span>
<span class="line">	$(BIN) $&lt; $@	</span>
<span class="line">	</span>
<span class="line">$(BUILD_DIR):</span>
<span class="line">	mkdir $@		</span>
<span class="line"></span>
<span class="line">#######################################</span>
<span class="line"># clean up</span>
<span class="line">#######################################</span>
<span class="line">clean:</span>
<span class="line">	-rm -fR $(BUILD_DIR)</span>
<span class="line"></span>
<span class="line">#######################################</span>
<span class="line"># write</span>
<span class="line">#######################################</span>
<span class="line">write: $(BUILD_DIR)/$(TARGET).bin</span>
<span class="line">	openocd \</span>
<span class="line">		-f interface/stlink.cfg \</span>
<span class="line">		-f target/stm32f1x.cfg \</span>
<span class="line">		-c &quot;init; reset halt; wait_halt; flash write_image erase $(BUILD_DIR)/$(TARGET).bin ${FLASH_START}; reset; shutdown;&quot; </span>
<span class="line">		@echo &quot;Write Completed.&quot;</span>
<span class="line"></span>
<span class="line">#######################################</span>
<span class="line"># erase</span>
<span class="line">#######################################</span>
<span class="line">erase:</span>
<span class="line">	openocd \</span>
<span class="line">		-f interface/stlink.cfg \</span>
<span class="line">		-f target/stm32f1x.cfg \</span>
<span class="line">		-c &quot;init; reset halt; flash erase_sector 0 0 1; exit&quot;</span>
<span class="line">	@echo &quot;Erase Completed.&quot;</span>
<span class="line"></span>
<span class="line">#######################################</span>
<span class="line"># reset</span>
<span class="line">#######################################</span>
<span class="line">reset:</span>
<span class="line">	openocd \</span>
<span class="line">		-f interface/stlink.cfg \</span>
<span class="line">		-f target/stm32f1x.cfg \</span>
<span class="line">		-c &quot;init; reset; exit&quot;</span>
<span class="line">	@echo &quot;Erase Completed.&quot;</span>
<span class="line">#######################################</span>
<span class="line"># dependencies</span>
<span class="line">#######################################</span>
<span class="line">-include $(wildcard $(BUILD_DIR)/*.d)</span>
<span class="line"></span>
<span class="line"># *** EOF ***</span>
<span class="line"></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="vp-code-tab" id="codetab-56-1" role="tabpanel" aria-expanded="false"><div class="vp-code-tab-title"><code>修改前的Makefile</code></div><!--[--><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp" data-title="cpp"><pre><code><span class="line">##########################################################################################################################</span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">File automatically<span class="token operator">-</span>generated by tool<span class="token operator">:</span> <span class="token punctuation">[</span>projectgenerator<span class="token punctuation">]</span> version<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">4.2</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token operator">-</span>B44<span class="token punctuation">]</span> date<span class="token operator">:</span> <span class="token punctuation">[</span>Sun Jul <span class="token number">21</span> <span class="token number">01</span><span class="token operator">:</span><span class="token number">54</span><span class="token operator">:</span><span class="token number">40</span> CST <span class="token number">2024</span><span class="token punctuation">]</span></span></span></span>
<span class="line">##########################################################################################################################</span>
<span class="line"></span>
<span class="line"># <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Generic <span class="token function">Makefile</span> <span class="token punctuation">(</span>based on gcc<span class="token punctuation">)</span></span></span></span>
<span class="line">#</span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">ChangeLog <span class="token operator">:</span></span></span></span>
<span class="line">#	<span class="token number">2017</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">10</span> <span class="token operator">-</span> Several enhancements <span class="token operator">+</span> project update mode</span>
<span class="line">#   <span class="token number">2015</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">22</span> <span class="token operator">-</span> first version</span>
<span class="line"># <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span></span>
<span class="line"></span>
<span class="line">######################################</span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">target</span></span></span>
<span class="line">######################################</span>
<span class="line">TARGET <span class="token operator">=</span> <span class="token keyword">template</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">######################################</span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">building</span> <span class="token expression">variables</span></span></span>
<span class="line">######################################</span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">debug</span> <span class="token expression">build<span class="token operator">?</span></span></span></span>
<span class="line">DEBUG <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">optimization</span></span></span>
<span class="line">OPT <span class="token operator">=</span> <span class="token operator">-</span>Og</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">#######################################</span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">paths</span></span></span>
<span class="line">#######################################</span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Build path</span></span></span>
<span class="line">BUILD_DIR <span class="token operator">=</span> build</span>
<span class="line"></span>
<span class="line">######################################</span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">source</span></span></span>
<span class="line">######################################</span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">C sources</span></span></span>
<span class="line">C_SOURCES <span class="token operator">=</span>  \</span>
<span class="line">Core<span class="token operator">/</span>Src<span class="token operator">/</span>main<span class="token punctuation">.</span>c \</span>
<span class="line">Core<span class="token operator">/</span>Src<span class="token operator">/</span>stm32f1xx_it<span class="token punctuation">.</span>c \</span>
<span class="line">Core<span class="token operator">/</span>Src<span class="token operator">/</span>stm32f1xx_hal_msp<span class="token punctuation">.</span>c \</span>
<span class="line">Drivers<span class="token operator">/</span>STM32F1xx_HAL_Driver<span class="token operator">/</span>Src<span class="token operator">/</span>stm32f1xx_hal_gpio_ex<span class="token punctuation">.</span>c \</span>
<span class="line">Drivers<span class="token operator">/</span>STM32F1xx_HAL_Driver<span class="token operator">/</span>Src<span class="token operator">/</span>stm32f1xx_hal_tim<span class="token punctuation">.</span>c \</span>
<span class="line">Drivers<span class="token operator">/</span>STM32F1xx_HAL_Driver<span class="token operator">/</span>Src<span class="token operator">/</span>stm32f1xx_hal_tim_ex<span class="token punctuation">.</span>c \</span>
<span class="line">Drivers<span class="token operator">/</span>STM32F1xx_HAL_Driver<span class="token operator">/</span>Src<span class="token operator">/</span>stm32f1xx_hal<span class="token punctuation">.</span>c \</span>
<span class="line">Drivers<span class="token operator">/</span>STM32F1xx_HAL_Driver<span class="token operator">/</span>Src<span class="token operator">/</span>stm32f1xx_hal_rcc<span class="token punctuation">.</span>c \</span>
<span class="line">Drivers<span class="token operator">/</span>STM32F1xx_HAL_Driver<span class="token operator">/</span>Src<span class="token operator">/</span>stm32f1xx_hal_rcc_ex<span class="token punctuation">.</span>c \</span>
<span class="line">Drivers<span class="token operator">/</span>STM32F1xx_HAL_Driver<span class="token operator">/</span>Src<span class="token operator">/</span>stm32f1xx_hal_gpio<span class="token punctuation">.</span>c \</span>
<span class="line">Drivers<span class="token operator">/</span>STM32F1xx_HAL_Driver<span class="token operator">/</span>Src<span class="token operator">/</span>stm32f1xx_hal_dma<span class="token punctuation">.</span>c \</span>
<span class="line">Drivers<span class="token operator">/</span>STM32F1xx_HAL_Driver<span class="token operator">/</span>Src<span class="token operator">/</span>stm32f1xx_hal_cortex<span class="token punctuation">.</span>c \</span>
<span class="line">Drivers<span class="token operator">/</span>STM32F1xx_HAL_Driver<span class="token operator">/</span>Src<span class="token operator">/</span>stm32f1xx_hal_pwr<span class="token punctuation">.</span>c \</span>
<span class="line">Drivers<span class="token operator">/</span>STM32F1xx_HAL_Driver<span class="token operator">/</span>Src<span class="token operator">/</span>stm32f1xx_hal_flash<span class="token punctuation">.</span>c \</span>
<span class="line">Drivers<span class="token operator">/</span>STM32F1xx_HAL_Driver<span class="token operator">/</span>Src<span class="token operator">/</span>stm32f1xx_hal_flash_ex<span class="token punctuation">.</span>c \</span>
<span class="line">Drivers<span class="token operator">/</span>STM32F1xx_HAL_Driver<span class="token operator">/</span>Src<span class="token operator">/</span>stm32f1xx_hal_exti<span class="token punctuation">.</span>c \</span>
<span class="line">Core<span class="token operator">/</span>Src<span class="token operator">/</span>system_stm32f1xx<span class="token punctuation">.</span>c  </span>
<span class="line"></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">ASM sources</span></span></span>
<span class="line">ASM_SOURCES <span class="token operator">=</span>  \</span>
<span class="line">startup_stm32f103xb<span class="token punctuation">.</span>s</span>
<span class="line"></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">ASM sources</span></span></span>
<span class="line">ASMM_SOURCES <span class="token operator">=</span> </span>
<span class="line"></span>
<span class="line"></span>
<span class="line">#######################################</span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">binaries</span></span></span>
<span class="line">#######################################</span>
<span class="line">PREFIX <span class="token operator">=</span> arm<span class="token operator">-</span>none<span class="token operator">-</span>eabi<span class="token operator">-</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">The gcc compiler bin path can be either defined in make command via GCC_PATH <span class="token function">variable</span> <span class="token punctuation">(</span><span class="token operator">&gt;</span> make GCC_PATH<span class="token operator">=</span>xxx<span class="token punctuation">)</span></span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">either</span> <span class="token expression">it can be added to the PATH environment variable<span class="token punctuation">.</span></span></span></span>
<span class="line">ifdef GCC_PATH</span>
<span class="line">CC <span class="token operator">=</span> $<span class="token punctuation">(</span>GCC_PATH<span class="token punctuation">)</span><span class="token operator">/</span>$<span class="token punctuation">(</span>PREFIX<span class="token punctuation">)</span>gcc</span>
<span class="line">AS <span class="token operator">=</span> $<span class="token punctuation">(</span>GCC_PATH<span class="token punctuation">)</span><span class="token operator">/</span>$<span class="token punctuation">(</span>PREFIX<span class="token punctuation">)</span>gcc <span class="token operator">-</span>x assembler<span class="token operator">-</span>with<span class="token operator">-</span>cpp</span>
<span class="line">CP <span class="token operator">=</span> $<span class="token punctuation">(</span>GCC_PATH<span class="token punctuation">)</span><span class="token operator">/</span>$<span class="token punctuation">(</span>PREFIX<span class="token punctuation">)</span>objcopy</span>
<span class="line">SZ <span class="token operator">=</span> $<span class="token punctuation">(</span>GCC_PATH<span class="token punctuation">)</span><span class="token operator">/</span>$<span class="token punctuation">(</span>PREFIX<span class="token punctuation">)</span>size</span>
<span class="line"><span class="token keyword">else</span></span>
<span class="line">CC <span class="token operator">=</span> $<span class="token punctuation">(</span>PREFIX<span class="token punctuation">)</span>gcc</span>
<span class="line">AS <span class="token operator">=</span> $<span class="token punctuation">(</span>PREFIX<span class="token punctuation">)</span>gcc <span class="token operator">-</span>x assembler<span class="token operator">-</span>with<span class="token operator">-</span>cpp</span>
<span class="line">CP <span class="token operator">=</span> $<span class="token punctuation">(</span>PREFIX<span class="token punctuation">)</span>objcopy</span>
<span class="line">SZ <span class="token operator">=</span> $<span class="token punctuation">(</span>PREFIX<span class="token punctuation">)</span>size</span>
<span class="line">endif</span>
<span class="line">HEX <span class="token operator">=</span> $<span class="token punctuation">(</span>CP<span class="token punctuation">)</span> <span class="token operator">-</span>O ihex</span>
<span class="line">BIN <span class="token operator">=</span> $<span class="token punctuation">(</span>CP<span class="token punctuation">)</span> <span class="token operator">-</span>O binary <span class="token operator">-</span>S</span>
<span class="line"> </span>
<span class="line">#######################################</span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">CFLAGS</span></span></span>
<span class="line">#######################################</span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">cpu</span></span></span>
<span class="line">CPU <span class="token operator">=</span> <span class="token operator">-</span>mcpu<span class="token operator">=</span>cortex<span class="token operator">-</span>m3</span>
<span class="line"></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">fpu</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">NONE <span class="token keyword">for</span> Cortex<span class="token operator">-</span>M0<span class="token operator">/</span>M0<span class="token operator">+</span><span class="token operator">/</span>M3</span></span></span>
<span class="line"></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">float</span><span class="token expression"><span class="token operator">-</span>abi</span></span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">mcu</span></span></span>
<span class="line">MCU <span class="token operator">=</span> $<span class="token punctuation">(</span>CPU<span class="token punctuation">)</span> <span class="token operator">-</span>mthumb $<span class="token punctuation">(</span>FPU<span class="token punctuation">)</span> $<span class="token punctuation">(</span>FLOAT<span class="token operator">-</span>ABI<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">macros</span> <span class="token expression"><span class="token keyword">for</span> gcc</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">AS defines</span></span></span>
<span class="line">AS_DEFS <span class="token operator">=</span> </span>
<span class="line"></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">C defines</span></span></span>
<span class="line">C_DEFS <span class="token operator">=</span>  \</span>
<span class="line"><span class="token operator">-</span>DUSE_HAL_DRIVER \</span>
<span class="line"><span class="token operator">-</span>DSTM32F103xB</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">AS includes</span></span></span>
<span class="line">AS_INCLUDES <span class="token operator">=</span> </span>
<span class="line"></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">C includes</span></span></span>
<span class="line">C_INCLUDES <span class="token operator">=</span>  \</span>
<span class="line"><span class="token operator">-</span>ICore<span class="token operator">/</span>Inc \</span>
<span class="line"><span class="token operator">-</span>IDrivers<span class="token operator">/</span>STM32F1xx_HAL_Driver<span class="token operator">/</span>Inc \</span>
<span class="line"><span class="token operator">-</span>IDrivers<span class="token operator">/</span>STM32F1xx_HAL_Driver<span class="token operator">/</span>Inc<span class="token operator">/</span>Legacy \</span>
<span class="line"><span class="token operator">-</span>IDrivers<span class="token operator">/</span>CMSIS<span class="token operator">/</span>Device<span class="token operator">/</span>ST<span class="token operator">/</span>STM32F1xx<span class="token operator">/</span>Include \</span>
<span class="line"><span class="token operator">-</span>IDrivers<span class="token operator">/</span>CMSIS<span class="token operator">/</span>Include</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">compile</span> <span class="token expression">gcc flags</span></span></span>
<span class="line">ASFLAGS <span class="token operator">=</span> $<span class="token punctuation">(</span>MCU<span class="token punctuation">)</span> $<span class="token punctuation">(</span>AS_DEFS<span class="token punctuation">)</span> $<span class="token punctuation">(</span>AS_INCLUDES<span class="token punctuation">)</span> $<span class="token punctuation">(</span>OPT<span class="token punctuation">)</span> <span class="token operator">-</span>Wall <span class="token operator">-</span>fdata<span class="token operator">-</span>sections <span class="token operator">-</span>ffunction<span class="token operator">-</span>sections</span>
<span class="line"></span>
<span class="line">CFLAGS <span class="token operator">+=</span> $<span class="token punctuation">(</span>MCU<span class="token punctuation">)</span> $<span class="token punctuation">(</span>C_DEFS<span class="token punctuation">)</span> $<span class="token punctuation">(</span>C_INCLUDES<span class="token punctuation">)</span> $<span class="token punctuation">(</span>OPT<span class="token punctuation">)</span> <span class="token operator">-</span>Wall <span class="token operator">-</span>fdata<span class="token operator">-</span>sections <span class="token operator">-</span>ffunction<span class="token operator">-</span>sections</span>
<span class="line"></span>
<span class="line"><span class="token function">ifeq</span> <span class="token punctuation">(</span>$<span class="token punctuation">(</span>DEBUG<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">CFLAGS <span class="token operator">+=</span> <span class="token operator">-</span>g <span class="token operator">-</span>gdwarf<span class="token operator">-</span><span class="token number">2</span></span>
<span class="line">endif</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Generate dependency information</span></span></span>
<span class="line">CFLAGS <span class="token operator">+=</span> <span class="token operator">-</span>MMD <span class="token operator">-</span>MP <span class="token operator">-</span>MF<span class="token string">&quot;$(@:%.o=%.d)&quot;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">#######################################</span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">LDFLAGS</span></span></span>
<span class="line">#######################################</span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">link</span> <span class="token expression">script</span></span></span>
<span class="line">LDSCRIPT <span class="token operator">=</span> STM32F103C8Tx_FLASH<span class="token punctuation">.</span>ld</span>
<span class="line"></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">libraries</span></span></span>
<span class="line">LIBS <span class="token operator">=</span> <span class="token operator">-</span>lc <span class="token operator">-</span>lm <span class="token operator">-</span>lnosys </span>
<span class="line">LIBDIR <span class="token operator">=</span> </span>
<span class="line">LDFLAGS <span class="token operator">=</span> $<span class="token punctuation">(</span>MCU<span class="token punctuation">)</span> <span class="token operator">-</span>specs<span class="token operator">=</span>nano<span class="token punctuation">.</span>specs <span class="token operator">-</span>T$<span class="token punctuation">(</span>LDSCRIPT<span class="token punctuation">)</span> $<span class="token punctuation">(</span>LIBDIR<span class="token punctuation">)</span> $<span class="token punctuation">(</span>LIBS<span class="token punctuation">)</span> <span class="token operator">-</span>Wl<span class="token punctuation">,</span><span class="token operator">-</span>Map<span class="token operator">=</span>$<span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span><span class="token operator">/</span>$<span class="token punctuation">(</span>TARGET<span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">,</span><span class="token operator">--</span>cref <span class="token operator">-</span>Wl<span class="token punctuation">,</span><span class="token operator">--</span>gc<span class="token operator">-</span>sections</span>
<span class="line"></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">default</span> <span class="token expression">action<span class="token operator">:</span> build all</span></span></span>
<span class="line">all<span class="token operator">:</span> $<span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span><span class="token operator">/</span>$<span class="token punctuation">(</span>TARGET<span class="token punctuation">)</span><span class="token punctuation">.</span>elf $<span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span><span class="token operator">/</span>$<span class="token punctuation">(</span>TARGET<span class="token punctuation">)</span><span class="token punctuation">.</span>hex $<span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span><span class="token operator">/</span>$<span class="token punctuation">(</span>TARGET<span class="token punctuation">)</span><span class="token punctuation">.</span>bin</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">#######################################</span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">build</span> <span class="token expression">the application</span></span></span>
<span class="line">#######################################</span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">list</span> <span class="token expression">of objects</span></span></span>
<span class="line">OBJECTS <span class="token operator">=</span> $<span class="token punctuation">(</span>addprefix $<span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">,</span>$<span class="token punctuation">(</span>notdir $<span class="token punctuation">(</span>C_SOURCES<span class="token operator">:</span><span class="token punctuation">.</span>c<span class="token operator">=</span><span class="token punctuation">.</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">vpath <span class="token operator">%</span><span class="token punctuation">.</span>c $<span class="token punctuation">(</span>sort $<span class="token punctuation">(</span>dir $<span class="token punctuation">(</span>C_SOURCES<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">list</span> <span class="token expression">of ASM program objects</span></span></span>
<span class="line">OBJECTS <span class="token operator">+=</span> $<span class="token punctuation">(</span>addprefix $<span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">,</span>$<span class="token punctuation">(</span>notdir $<span class="token punctuation">(</span>ASM_SOURCES<span class="token operator">:</span><span class="token punctuation">.</span>s<span class="token operator">=</span><span class="token punctuation">.</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">vpath <span class="token operator">%</span><span class="token punctuation">.</span>s $<span class="token punctuation">(</span>sort $<span class="token punctuation">(</span>dir $<span class="token punctuation">(</span>ASM_SOURCES<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">OBJECTS <span class="token operator">+=</span> $<span class="token punctuation">(</span>addprefix $<span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">,</span>$<span class="token punctuation">(</span>notdir $<span class="token punctuation">(</span>ASMM_SOURCES<span class="token operator">:</span><span class="token punctuation">.</span>S<span class="token operator">=</span><span class="token punctuation">.</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">vpath <span class="token operator">%</span><span class="token punctuation">.</span>S $<span class="token punctuation">(</span>sort $<span class="token punctuation">(</span>dir $<span class="token punctuation">(</span>ASMM_SOURCES<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">$<span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span><span class="token operator">/</span><span class="token operator">%</span><span class="token punctuation">.</span>o<span class="token operator">:</span> <span class="token operator">%</span><span class="token punctuation">.</span>c Makefile <span class="token operator">|</span> $<span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span> </span>
<span class="line">	$<span class="token punctuation">(</span>CC<span class="token punctuation">)</span> <span class="token operator">-</span>c $<span class="token punctuation">(</span>CFLAGS<span class="token punctuation">)</span> <span class="token operator">-</span>Wa<span class="token punctuation">,</span><span class="token operator">-</span>a<span class="token punctuation">,</span><span class="token operator">-</span>ad<span class="token punctuation">,</span><span class="token operator">-</span>alms<span class="token operator">=</span>$<span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span><span class="token operator">/</span>$<span class="token punctuation">(</span>notdir $<span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token punctuation">.</span>c<span class="token operator">=</span><span class="token punctuation">.</span>lst<span class="token punctuation">)</span><span class="token punctuation">)</span> $<span class="token operator">&lt;</span> <span class="token operator">-</span>o $@</span>
<span class="line"></span>
<span class="line">$<span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span><span class="token operator">/</span><span class="token operator">%</span><span class="token punctuation">.</span>o<span class="token operator">:</span> <span class="token operator">%</span><span class="token punctuation">.</span>s Makefile <span class="token operator">|</span> $<span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span></span>
<span class="line">	$<span class="token punctuation">(</span>AS<span class="token punctuation">)</span> <span class="token operator">-</span>c $<span class="token punctuation">(</span>CFLAGS<span class="token punctuation">)</span> $<span class="token operator">&lt;</span> <span class="token operator">-</span>o $@</span>
<span class="line">$<span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span><span class="token operator">/</span><span class="token operator">%</span><span class="token punctuation">.</span>o<span class="token operator">:</span> <span class="token operator">%</span><span class="token punctuation">.</span>S Makefile <span class="token operator">|</span> $<span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span></span>
<span class="line">	$<span class="token punctuation">(</span>AS<span class="token punctuation">)</span> <span class="token operator">-</span>c $<span class="token punctuation">(</span>CFLAGS<span class="token punctuation">)</span> $<span class="token operator">&lt;</span> <span class="token operator">-</span>o $@</span>
<span class="line"></span>
<span class="line">$<span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span><span class="token operator">/</span>$<span class="token punctuation">(</span>TARGET<span class="token punctuation">)</span><span class="token punctuation">.</span>elf<span class="token operator">:</span> $<span class="token punctuation">(</span>OBJECTS<span class="token punctuation">)</span> Makefile</span>
<span class="line">	$<span class="token punctuation">(</span>CC<span class="token punctuation">)</span> $<span class="token punctuation">(</span>OBJECTS<span class="token punctuation">)</span> $<span class="token punctuation">(</span>LDFLAGS<span class="token punctuation">)</span> <span class="token operator">-</span>o $@</span>
<span class="line">	$<span class="token punctuation">(</span>SZ<span class="token punctuation">)</span> $@</span>
<span class="line"></span>
<span class="line">$<span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span><span class="token operator">/</span><span class="token operator">%</span><span class="token punctuation">.</span>hex<span class="token operator">:</span> $<span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span><span class="token operator">/</span><span class="token operator">%</span><span class="token punctuation">.</span>elf <span class="token operator">|</span> $<span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span></span>
<span class="line">	$<span class="token punctuation">(</span>HEX<span class="token punctuation">)</span> $<span class="token operator">&lt;</span> $@</span>
<span class="line">	</span>
<span class="line">$<span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span><span class="token operator">/</span><span class="token operator">%</span><span class="token punctuation">.</span>bin<span class="token operator">:</span> $<span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span><span class="token operator">/</span><span class="token operator">%</span><span class="token punctuation">.</span>elf <span class="token operator">|</span> $<span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span></span>
<span class="line">	$<span class="token punctuation">(</span>BIN<span class="token punctuation">)</span> $<span class="token operator">&lt;</span> $@	</span>
<span class="line">	</span>
<span class="line">$<span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span><span class="token operator">:</span></span>
<span class="line">	mkdir $@		</span>
<span class="line"></span>
<span class="line">#######################################</span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">clean</span> <span class="token expression">up</span></span></span>
<span class="line">#######################################</span>
<span class="line">clean<span class="token operator">:</span></span>
<span class="line">	<span class="token operator">-</span>rm <span class="token operator">-</span>fR $<span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">#######################################</span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">dependencies</span></span></span>
<span class="line">#######################################</span>
<span class="line"><span class="token operator">-</span>include $<span class="token punctuation">(</span>wildcard $<span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span><span class="token comment">/*.d)</span>
<span class="line"></span>
<span class="line"># *** EOF ***</span>
<span class="line"></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="vp-code-tab" id="codetab-56-2" role="tabpanel" aria-expanded="false"><div class="vp-code-tab-title"><code>STM32F103C8Tx_FLASH.ld</code></div><!--[--><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp" data-title="cpp"><pre><code><span class="line"><span class="token comment">/*</span>
<span class="line">******************************************************************************</span>
<span class="line">**</span>
<span class="line"></span>
<span class="line">**  File        : LinkerScript.ld</span>
<span class="line">**</span>
<span class="line">**  Author		: STM32CubeMX</span>
<span class="line">**</span>
<span class="line">**  Abstract    : Linker script for STM32F103C8Tx series</span>
<span class="line">**                64Kbytes FLASH and 20Kbytes RAM</span>
<span class="line">**</span>
<span class="line">**                Set heap size, stack size and stack location according</span>
<span class="line">**                to application requirements.</span>
<span class="line">**</span>
<span class="line">**                Set memory bank area and size if external memory is used.</span>
<span class="line">**</span>
<span class="line">**  Target      : STMicroelectronics STM32</span>
<span class="line">**</span>
<span class="line">**  Distribution: The file is distributed “as is,” without any warranty</span>
<span class="line">**                of any kind.</span>
<span class="line">**</span>
<span class="line">*****************************************************************************</span>
<span class="line">** @attention</span>
<span class="line">**</span>
<span class="line">** &lt;h2&gt;&lt;center&gt;&amp;copy; COPYRIGHT(c) 2019 STMicroelectronics&lt;/center&gt;&lt;/h2&gt;</span>
<span class="line">**</span>
<span class="line">** Redistribution and use in source and binary forms, with or without modification,</span>
<span class="line">** are permitted provided that the following conditions are met:</span>
<span class="line">**   1. Redistributions of source code must retain the above copyright notice,</span>
<span class="line">**      this list of conditions and the following disclaimer.</span>
<span class="line">**   2. Redistributions in binary form must reproduce the above copyright notice,</span>
<span class="line">**      this list of conditions and the following disclaimer in the documentation</span>
<span class="line">**      and/or other materials provided with the distribution.</span>
<span class="line">**   3. Neither the name of STMicroelectronics nor the names of its contributors</span>
<span class="line">**      may be used to endorse or promote products derived from this software</span>
<span class="line">**      without specific prior written permission.</span>
<span class="line">**</span>
<span class="line">** THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</span>
<span class="line">** AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<span class="line">** IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span>
<span class="line">** DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE</span>
<span class="line">** FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</span>
<span class="line">** DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span>
<span class="line">** SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
<span class="line">** CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</span>
<span class="line">** OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<span class="line">** OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="line">**</span>
<span class="line">*****************************************************************************</span>
<span class="line">*/</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/* Entry Point */</span></span>
<span class="line"><span class="token function">ENTRY</span><span class="token punctuation">(</span>Reset_Handler<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/* Highest address of the user mode stack */</span></span>
<span class="line">_estack <span class="token operator">=</span> <span class="token function">ORIGIN</span><span class="token punctuation">(</span>RAM<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">LENGTH</span><span class="token punctuation">(</span>RAM<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/* end of RAM */</span></span>
<span class="line"><span class="token comment">/* Generate a link error if heap and stack don&#39;t fit into RAM */</span></span>
<span class="line">_Min_Heap_Size <span class="token operator">=</span> <span class="token number">0x200</span><span class="token punctuation">;</span>      <span class="token comment">/* required amount of heap  */</span></span>
<span class="line">_Min_Stack_Size <span class="token operator">=</span> <span class="token number">0x400</span><span class="token punctuation">;</span> <span class="token comment">/* required amount of stack */</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/* Specify the memory areas */</span></span>
<span class="line">MEMORY</span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line"><span class="token function">RAM</span> <span class="token punctuation">(</span>xrw<span class="token punctuation">)</span>      <span class="token operator">:</span> ORIGIN <span class="token operator">=</span> <span class="token number">0x20000000</span><span class="token punctuation">,</span> LENGTH <span class="token operator">=</span> <span class="token number">20</span>K</span>
<span class="line"><span class="token function">FLASH</span> <span class="token punctuation">(</span>rx<span class="token punctuation">)</span>      <span class="token operator">:</span> ORIGIN <span class="token operator">=</span> <span class="token number">0x8000000</span><span class="token punctuation">,</span> LENGTH <span class="token operator">=</span> <span class="token number">64</span>K</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/* Define output sections */</span></span>
<span class="line">SECTIONS</span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">/* The startup code goes first into FLASH */</span></span>
<span class="line">  <span class="token punctuation">.</span>isr_vector <span class="token operator">:</span></span>
<span class="line">  <span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">.</span> <span class="token operator">=</span> <span class="token function">ALIGN</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">KEEP</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">.</span>isr_vector<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">/* Startup code */</span></span>
<span class="line">    <span class="token punctuation">.</span> <span class="token operator">=</span> <span class="token function">ALIGN</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token operator">&gt;</span>FLASH</span>
<span class="line"></span>
<span class="line">  <span class="token comment">/* The program code and other data goes into FLASH */</span></span>
<span class="line">  <span class="token punctuation">.</span>text <span class="token operator">:</span></span>
<span class="line">  <span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">.</span> <span class="token operator">=</span> <span class="token function">ALIGN</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>           <span class="token comment">/* .text sections (code) */</span></span>
<span class="line">    <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">.</span>text<span class="token operator">*</span><span class="token punctuation">)</span>          <span class="token comment">/* .text* sections (code) */</span></span>
<span class="line">    <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">.</span>glue_7<span class="token punctuation">)</span>         <span class="token comment">/* glue arm to thumb code */</span></span>
<span class="line">    <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">.</span>glue_7t<span class="token punctuation">)</span>        <span class="token comment">/* glue thumb to arm code */</span></span>
<span class="line">    <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">.</span>eh_frame<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token function">KEEP</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">.</span>init<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">KEEP</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">.</span>fini<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token punctuation">.</span> <span class="token operator">=</span> <span class="token function">ALIGN</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    _etext <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">;</span>        <span class="token comment">/* define a global symbols at end of code */</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token operator">&gt;</span>FLASH</span>
<span class="line"></span>
<span class="line">  <span class="token comment">/* Constant data goes into FLASH */</span></span>
<span class="line">  <span class="token punctuation">.</span>rodata <span class="token operator">:</span></span>
<span class="line">  <span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">.</span> <span class="token operator">=</span> <span class="token function">ALIGN</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">.</span>rodata<span class="token punctuation">)</span>         <span class="token comment">/* .rodata sections (constants, strings, etc.) */</span></span>
<span class="line">    <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">.</span>rodata<span class="token operator">*</span><span class="token punctuation">)</span>        <span class="token comment">/* .rodata* sections (constants, strings, etc.) */</span></span>
<span class="line">    <span class="token punctuation">.</span> <span class="token operator">=</span> <span class="token function">ALIGN</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token operator">&gt;</span>FLASH</span>
<span class="line"></span>
<span class="line">  <span class="token punctuation">.</span>ARM<span class="token punctuation">.</span>extab   <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">.</span>ARM<span class="token punctuation">.</span>extab<span class="token operator">*</span> <span class="token punctuation">.</span>gnu<span class="token punctuation">.</span>linkonce<span class="token punctuation">.</span>armextab<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">&gt;</span>FLASH</span>
<span class="line">  <span class="token punctuation">.</span>ARM <span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    __exidx_start <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">.</span>ARM<span class="token punctuation">.</span>exidx<span class="token operator">*</span><span class="token punctuation">)</span></span>
<span class="line">    __exidx_end <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token operator">&gt;</span>FLASH</span>
<span class="line"></span>
<span class="line">  <span class="token punctuation">.</span>preinit_array     <span class="token operator">:</span></span>
<span class="line">  <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">PROVIDE_HIDDEN</span> <span class="token punctuation">(</span>__preinit_array_start <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">KEEP</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">.</span>preinit_array<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">PROVIDE_HIDDEN</span> <span class="token punctuation">(</span>__preinit_array_end <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token operator">&gt;</span>FLASH</span>
<span class="line">  <span class="token punctuation">.</span>init_array <span class="token operator">:</span></span>
<span class="line">  <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">PROVIDE_HIDDEN</span> <span class="token punctuation">(</span>__init_array_start <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">KEEP</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token function">SORT</span><span class="token punctuation">(</span><span class="token punctuation">.</span>init_array<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">KEEP</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">.</span>init_array<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">PROVIDE_HIDDEN</span> <span class="token punctuation">(</span>__init_array_end <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token operator">&gt;</span>FLASH</span>
<span class="line">  <span class="token punctuation">.</span>fini_array <span class="token operator">:</span></span>
<span class="line">  <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">PROVIDE_HIDDEN</span> <span class="token punctuation">(</span>__fini_array_start <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">KEEP</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token function">SORT</span><span class="token punctuation">(</span><span class="token punctuation">.</span>fini_array<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">KEEP</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">.</span>fini_array<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">PROVIDE_HIDDEN</span> <span class="token punctuation">(</span>__fini_array_end <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token operator">&gt;</span>FLASH</span>
<span class="line"></span>
<span class="line">  <span class="token comment">/* used by the startup to initialize data */</span></span>
<span class="line">  _sidata <span class="token operator">=</span> <span class="token function">LOADADDR</span><span class="token punctuation">(</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">/* Initialized data sections goes into RAM, load LMA copy after code */</span></span>
<span class="line">  <span class="token punctuation">.</span>data <span class="token operator">:</span> </span>
<span class="line">  <span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">.</span> <span class="token operator">=</span> <span class="token function">ALIGN</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    _sdata <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">;</span>        <span class="token comment">/* create a global symbol at data start */</span></span>
<span class="line">    <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span>           <span class="token comment">/* .data sections */</span></span>
<span class="line">    <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">.</span>data<span class="token operator">*</span><span class="token punctuation">)</span>          <span class="token comment">/* .data* sections */</span></span>
<span class="line"></span>
<span class="line">    <span class="token punctuation">.</span> <span class="token operator">=</span> <span class="token function">ALIGN</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    _edata <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">;</span>        <span class="token comment">/* define a global symbol at data end */</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token operator">&gt;</span>RAM AT<span class="token operator">&gt;</span> FLASH</span>
<span class="line"></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">/* Uninitialized data section */</span></span>
<span class="line">  <span class="token punctuation">.</span> <span class="token operator">=</span> <span class="token function">ALIGN</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">.</span>bss <span class="token operator">:</span></span>
<span class="line">  <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">/* This is used by the startup in order to initialize the .bss secion */</span></span>
<span class="line">    _sbss <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">;</span>         <span class="token comment">/* define a global symbol at bss start */</span></span>
<span class="line">    __bss_start__ <span class="token operator">=</span> _sbss<span class="token punctuation">;</span></span>
<span class="line">    <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">.</span>bss<span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">.</span>bss<span class="token operator">*</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">*</span><span class="token punctuation">(</span>COMMON<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token punctuation">.</span> <span class="token operator">=</span> <span class="token function">ALIGN</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    _ebss <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">;</span>         <span class="token comment">/* define a global symbol at bss end */</span></span>
<span class="line">    __bss_end__ <span class="token operator">=</span> _ebss<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token operator">&gt;</span>RAM</span>
<span class="line"></span>
<span class="line">  <span class="token comment">/* User_heap_stack section, used to check that there is enough RAM left */</span></span>
<span class="line">  <span class="token punctuation">.</span>_user_heap_stack <span class="token operator">:</span></span>
<span class="line">  <span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">.</span> <span class="token operator">=</span> <span class="token function">ALIGN</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">PROVIDE</span> <span class="token punctuation">(</span> end <span class="token operator">=</span> <span class="token punctuation">.</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">PROVIDE</span> <span class="token punctuation">(</span> _end <span class="token operator">=</span> <span class="token punctuation">.</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">.</span> <span class="token operator">=</span> <span class="token punctuation">.</span> <span class="token operator">+</span> _Min_Heap_Size<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">.</span> <span class="token operator">=</span> <span class="token punctuation">.</span> <span class="token operator">+</span> _Min_Stack_Size<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">.</span> <span class="token operator">=</span> <span class="token function">ALIGN</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token operator">&gt;</span>RAM</span>
<span class="line"></span>
<span class="line">  </span>
<span class="line"></span>
<span class="line">  <span class="token comment">/* Remove information from the standard libraries */</span></span>
<span class="line">  <span class="token operator">/</span>DISCARD<span class="token operator">/</span> <span class="token operator">:</span></span>
<span class="line">  <span class="token punctuation">{</span></span>
<span class="line">    libc<span class="token punctuation">.</span><span class="token function">a</span> <span class="token punctuation">(</span> <span class="token operator">*</span> <span class="token punctuation">)</span></span>
<span class="line">    libm<span class="token punctuation">.</span><span class="token function">a</span> <span class="token punctuation">(</span> <span class="token operator">*</span> <span class="token punctuation">)</span></span>
<span class="line">    libgcc<span class="token punctuation">.</span><span class="token function">a</span> <span class="token punctuation">(</span> <span class="token operator">*</span> <span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token punctuation">.</span>ARM<span class="token punctuation">.</span>attributes <span class="token number">0</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">.</span>ARM<span class="token punctuation">.</span>attributes<span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>主要添加/修改的内容为</p><div class="language-makefile line-numbers-mode" data-highlighter="prismjs" data-ext="makefile" data-title="makefile"><pre><code><span class="line"><span class="token comment">######################################</span></span>
<span class="line"><span class="token comment"># source</span></span>
<span class="line"><span class="token comment">######################################</span></span>
<span class="line"><span class="token comment"># C sources</span></span>
<span class="line">C_SOURCES <span class="token operator">=</span>  \</span>
<span class="line"> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">wildcard</span> Core/Src/stm32f10x_it.c<span class="token punctuation">)</span> \</span>
<span class="line"> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">wildcard</span> Drivers/STM32F10x_StdPeriph_Lib_V3.5.0/Libraries/CMSIS/CM3/CoreSupport/*.c<span class="token punctuation">)</span> \</span>
<span class="line"> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">wildcard</span> Drivers/STM32F10x_StdPeriph_Lib_V3.5.0/Libraries/CMSIS/CM3/DeviceSupport/ST/STM32F10x/*.c<span class="token punctuation">)</span> \</span>
<span class="line"> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">wildcard</span> Drivers/STM32F10x_StdPeriph_Lib_V3.5.0/Libraries/STM32F10x_StdPeriph_Driver/src/*.c<span class="token punctuation">)</span> \</span>
<span class="line"></span>
<span class="line">CPP_SOURCES <span class="token operator">=</span>  \</span>
<span class="line"> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">wildcard</span> Core/Src/*.cpp<span class="token punctuation">)</span> \</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ASM sources</span></span>
<span class="line">ASM_SOURCES <span class="token operator">=</span>  \</span>
<span class="line"> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">wildcard</span> Drivers/STM32F10x_StdPeriph_Lib_V3.5.0/Libraries/CMSIS/CM3/DeviceSupport/ST/STM32F10x/startup/gcc_ride7/startup_stm32f10x_md.s<span class="token punctuation">)</span> \</span>
<span class="line"></span>
<span class="line">FLASH_START <span class="token operator">=</span> 0x08000000</span>
<span class="line"></span>
<span class="line"><span class="token comment"># C defines</span></span>
<span class="line"><span class="token comment"># 定义芯片型号</span></span>
<span class="line"><span class="token comment"># 定义使用标准外设库</span></span>
<span class="line">C_DEFS <span class="token operator">=</span>  \</span>
<span class="line"> -D STM32F10X_MD \</span>
<span class="line"> -D USE_STDPERIPH_DRIVER</span>
<span class="line"></span>
<span class="line"><span class="token comment"># C includes</span></span>
<span class="line">C_CPP_INCLUDES <span class="token operator">=</span>  \</span>
<span class="line"> -I Core/Inc/ \</span>
<span class="line"> -I Drivers/STM32F10x_StdPeriph_Lib_V3.5.0/Libraries/CMSIS/CM3/CoreSupport/ \</span>
<span class="line"> -I Drivers/STM32F10x_StdPeriph_Lib_V3.5.0/Libraries/CMSIS/CM3/DeviceSupport/ST/STM32F10x/ \</span>
<span class="line"> -I Drivers/STM32F10x_StdPeriph_Lib_V3.5.0/Libraries/STM32F10x_StdPeriph_Driver/inc/ \</span>
<span class="line"></span>
<span class="line">CPP_FLAGS <span class="token operator">+=</span> <span class="token variable">$</span><span class="token punctuation">(</span>MCU<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>C_DEFS<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>C_CPP_INCLUDES<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>OPT<span class="token punctuation">)</span> -Wall -fdata-sections -ffunction-sections</span>
<span class="line"></span>
<span class="line"><span class="token keyword">ifeq</span> <span class="token punctuation">(</span><span class="token variable">$</span><span class="token punctuation">(</span>DEBUG<span class="token punctuation">)</span>, 1<span class="token punctuation">)</span></span>
<span class="line">C_FLAGS <span class="token operator">+=</span> -g -gdwarf-2</span>
<span class="line">CPP_FLAGS <span class="token operator">+=</span> -g -gdwarf-2</span>
<span class="line"><span class="token keyword">endif</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Generate dependency information</span></span>
<span class="line">C_FLAGS <span class="token operator">+=</span> -MMD -MP -MF<span class="token string">&quot;$(@:%.o=%.d)&quot;</span></span>
<span class="line">CPP_FLAGS <span class="token operator">+=</span> -MMD -MP -MF<span class="token string">&quot;$(@:%.o=%.d)&quot;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># link script</span></span>
<span class="line">LDSCRIPT <span class="token operator">=</span> STM32F103C8Tx_FLASH.ld</span>
<span class="line"></span>
<span class="line"><span class="token comment"># libraries</span></span>
<span class="line">LIBS <span class="token operator">=</span> -lc -lm -lnosys </span>
<span class="line">LIBDIR <span class="token operator">=</span> </span>
<span class="line"><span class="token comment"># 改成 -specs=nosys.specs</span></span>
<span class="line"><span class="token comment"># 添加 -Wl,--gc-sections,--print-memory-usage # 打印输出内存使用情况</span></span>
<span class="line"><span class="token comment"># 添加 -u _printf_float # 实现浮点数格式化输出 printf(&quot;%f&quot;,val);</span></span>
<span class="line">LDFLAGS <span class="token operator">=</span> <span class="token variable">$</span><span class="token punctuation">(</span>MCU<span class="token punctuation">)</span> -specs<span class="token operator">=</span>nosys.specs -T<span class="token variable">$</span><span class="token punctuation">(</span>LDSCRIPT<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>LIBDIR<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>LIBS<span class="token punctuation">)</span> -Wl,-Map<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span>/<span class="token variable">$</span><span class="token punctuation">(</span>TARGET<span class="token punctuation">)</span>.map,--cref -Wl,--gc-sections,--print-memory-usage </span>
<span class="line"></span>
<span class="line"><span class="token comment">#######################################</span></span>
<span class="line"><span class="token comment"># build the application</span></span>
<span class="line"><span class="token comment">#######################################</span></span>
<span class="line"><span class="token comment"># list of c program objects</span></span>
<span class="line">OBJECTS <span class="token operator">=</span> <span class="token variable">$</span><span class="token punctuation">(</span>addprefix <span class="token variable">$</span><span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span>/,<span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">notdir</span> <span class="token variable">$</span><span class="token punctuation">(</span>C_SOURCES<span class="token punctuation">:</span>.c<span class="token operator">=</span>.o<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">vpath</span> %.c <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">sort</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">dir</span> <span class="token variable">$</span><span class="token punctuation">(</span>C_SOURCES<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># list of cpp program objects</span></span>
<span class="line">OBJECTS <span class="token operator">+=</span> <span class="token variable">$</span><span class="token punctuation">(</span>addprefix <span class="token variable">$</span><span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span>/,<span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">notdir</span> <span class="token variable">$</span><span class="token punctuation">(</span>CPP_SOURCES<span class="token punctuation">:</span>.cpp<span class="token operator">=</span>.o<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">vpath</span> %.cpp <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">sort</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">dir</span> <span class="token variable">$</span><span class="token punctuation">(</span>CPP_SOURCES<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token target symbol"><span class="token variable">$</span>(BUILD_DIR)/%.o</span><span class="token punctuation">:</span> %.c Makefile <span class="token operator">|</span> <span class="token variable">$</span><span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span> </span>
<span class="line"> <span class="token variable">$</span><span class="token punctuation">(</span>CC<span class="token punctuation">)</span> -c <span class="token variable">$</span><span class="token punctuation">(</span>C_FLAGS<span class="token punctuation">)</span> -Wa,-a,-ad,-alms<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span>/<span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">notdir</span> <span class="token variable">$</span><span class="token punctuation">(</span>&lt;<span class="token punctuation">:</span>.c<span class="token operator">=</span>.lst<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token variable">$&lt;</span> -o <span class="token variable">$@</span></span>
<span class="line"></span>
<span class="line"><span class="token target symbol"><span class="token variable">$</span>(BUILD_DIR)/%.o</span><span class="token punctuation">:</span> %.cpp Makefile <span class="token operator">|</span> <span class="token variable">$</span><span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span> </span>
<span class="line"> <span class="token variable">$</span><span class="token punctuation">(</span>XX<span class="token punctuation">)</span> -c <span class="token variable">$</span><span class="token punctuation">(</span>CPP_FLAGS<span class="token punctuation">)</span> -Wa,-a,-ad,-alms<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span>/<span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">notdir</span> <span class="token variable">$</span><span class="token punctuation">(</span>&lt;<span class="token punctuation">:</span>.cpp<span class="token operator">=</span>.lst<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token variable">$&lt;</span> -o <span class="token variable">$@</span></span>
<span class="line"></span>
<span class="line"><span class="token target symbol"><span class="token variable">$</span>(BUILD_DIR)/%.o</span><span class="token punctuation">:</span> %.s Makefile <span class="token operator">|</span> <span class="token variable">$</span><span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span></span>
<span class="line"> <span class="token variable">$</span><span class="token punctuation">(</span>AS<span class="token punctuation">)</span> -c <span class="token variable">$</span><span class="token punctuation">(</span>C_FLAGS<span class="token punctuation">)</span> <span class="token variable">$&lt;</span> -o <span class="token variable">$@</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="编写makefile指令实现写入-擦除" tabindex="-1"><a class="header-anchor" href="#编写makefile指令实现写入-擦除"><span>编写makefile指令实现写入\擦除</span></a></h2><div class="language-makefile line-numbers-mode" data-highlighter="prismjs" data-ext="makefile" data-title="makefile"><pre><code><span class="line"><span class="token comment">#######################################</span></span>
<span class="line"><span class="token comment"># write</span></span>
<span class="line"><span class="token comment">#######################################</span></span>
<span class="line"><span class="token target symbol">write</span><span class="token punctuation">:</span> <span class="token variable">$</span><span class="token punctuation">(</span>BUILD_DIR<span class="token punctuation">)</span>/<span class="token variable">$</span><span class="token punctuation">(</span>TARGET<span class="token punctuation">)</span>.bin</span>
<span class="line"> openocd \</span>
<span class="line">  -f interface/stlink.cfg \</span>
<span class="line">  -f target/stm32f1x.cfg \</span>
<span class="line">  -c <span class="token string">&quot;init; reset halt; wait_halt; flash write_image erase $(BUILD_DIR)/$(TARGET).bin ${FLASH_START}; reset; shutdown;&quot;</span> </span>
<span class="line">  <span class="token operator">@</span>echo <span class="token string">&quot;Write Completed.&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">#######################################</span></span>
<span class="line"><span class="token comment"># erase</span></span>
<span class="line"><span class="token comment">#######################################</span></span>
<span class="line"><span class="token target symbol">erase</span><span class="token punctuation">:</span></span>
<span class="line"> openocd \</span>
<span class="line">  -f interface/stlink.cfg \</span>
<span class="line">  -f target/stm32f1x.cfg \</span>
<span class="line">  -c <span class="token string">&quot;init; reset halt; flash erase_sector 0 0 1; exit&quot;</span></span>
<span class="line"> <span class="token operator">@</span>echo <span class="token string">&quot;Erase Completed.&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">#######################################</span></span>
<span class="line"><span class="token comment"># reset</span></span>
<span class="line"><span class="token comment">#######################################</span></span>
<span class="line"><span class="token target symbol">reset</span><span class="token punctuation">:</span></span>
<span class="line"> openocd \</span>
<span class="line">  -f interface/stlink.cfg \</span>
<span class="line">  -f target/stm32f1x.cfg \</span>
<span class="line">  -c <span class="token string">&quot;init; reset; exit&quot;</span></span>
<span class="line"> <span class="token operator">@</span>echo <span class="token string">&quot;Reset Completed.&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><!----><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: 2449695354@qq.com">YiguiDing</span><!--]--><!--]--></div></div></footer><!----><div id="vp-comment" class="giscus-wrapper input-top" style="display:block;"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><circle cx="28" cy="75" r="11" fill="currentColor"><animate attributeName="fill-opacity" begin="0s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></circle><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 47a28 28 0 0 1 28 28"><animate attributeName="stroke-opacity" begin="0.1s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 25a50 50 0 0 1 50 50"><animate attributeName="stroke-opacity" begin="0.2s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path></svg></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><!----><div class="vp-copyright">MIT Licensed | Copyright © 2019-present Yigui-Ding</div></footer></div><!--]--><!--[--><!----><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-DjDtDPYL.js" defer></script>
  </body>
</html>
